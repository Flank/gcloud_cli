
.TH "GCLOUD_ALPHA_COMPUTE_BACKEND\-SERVICES_CREATE" 1



.SH "NAME"
.HP
gcloud alpha compute backend\-services create \- create a backend service



.SH "SYNOPSIS"
.HP
\f5gcloud alpha compute backend\-services create\fR \fIBACKEND_SERVICE_NAME\fR [\fB\-\-affinity\-cookie\-ttl\fR=\fIAFFINITY_COOKIE_TTL\fR] [\fB\-\-no\-cache\-key\-include\-host\fR] [\fB\-\-no\-cache\-key\-include\-protocol\fR] [\fB\-\-no\-cache\-key\-include\-query\-string\fR] [\fB\-\-connection\-drain\-on\-failover\fR] [\fB\-\-connection\-draining\-timeout\fR=\fICONNECTION_DRAINING_TIMEOUT\fR] [\fB\-\-custom\-request\-header\fR=\fICUSTOM_REQUEST_HEADER\fR] [\fB\-\-description\fR=\fIDESCRIPTION\fR] [\fB\-\-drop\-traffic\-if\-unhealthy\fR] [\fB\-\-[no\-]enable\-cdn\fR] [\fB\-\-[no\-]enable\-logging\fR] [\fB\-\-failover\-ratio\fR=\fIFAILOVER_RATIO\fR] [\fB\-\-health\-checks\fR=\fIHEALTH_CHECK\fR,[...]] [\fB\-\-http\-health\-checks\fR=\fIHTTP_HEALTH_CHECK\fR,[...]] [\fB\-\-https\-health\-checks\fR=\fIHTTPS_HEALTH_CHECK\fR,[...]] [\fB\-\-iap\fR=\fIdisabled\fR|\fIenabled\fR,[\fIoauth2\-client\-id\fR=\fIOAUTH2\-CLIENT\-ID\fR,\fIoauth2\-client\-secret\fR=\fIOAUTH2\-CLIENT\-SECRET\fR]] [\fB\-\-load\-balancing\-scheme\fR=\fILOAD_BALANCING_SCHEME\fR;\ default="EXTERNAL"] [\fB\-\-logging\-sample\-rate\fR=\fILOGGING_SAMPLE_RATE\fR] [\fB\-\-network\fR=\fINETWORK\fR] [\fB\-\-port\-name\fR=\fIPORT_NAME\fR] [\fB\-\-protocol\fR=\fIPROTOCOL\fR] [\fB\-\-session\-affinity\fR=\fISESSION_AFFINITY\fR] [\fB\-\-signed\-url\-cache\-max\-age\fR=\fISIGNED_URL_CACHE_MAX_AGE\fR] [\fB\-\-timeout\fR=\fITIMEOUT\fR;\ default="30s"] [\fB\-\-cache\-key\-query\-string\-blacklist\fR=[\fIQUERY_STRING\fR,...]\ |\ \fB\-\-cache\-key\-query\-string\-whitelist\fR=\fIQUERY_STRING\fR,[...]] [\fB\-\-global\fR\ |\ \fB\-\-region\fR=\fIREGION\fR] [\fB\-\-global\-health\-checks\fR\ |\ \fB\-\-health\-checks\-region\fR=\fIHEALTH_CHECKS_REGION\fR] [\fIGCLOUD_WIDE_FLAG\ ...\fR]



.SH "DESCRIPTION"

\fB(ALPHA)\fR \fBgcloud alpha compute backend\-services create\fR creates a
backend service. A backend service defines how Cloud Load Balancing distributes
traffic. The backend service configuration contains a set of values, such as the
protocol used to connect to backends, various distribution and session settings,
health checks, and timeouts. These settings provide fine\-grained control over
how your load balancer behaves. Most of the settings have default values that
allow for easy configuration if you need to get started quickly.

After you create a backend service, you add backends by using \f5gcloud compute
backend\-services add\-backend\fR.

For more information about the available settings, see
https://cloud.google.com/load\-balancing/docs/backend\-service.



.SH "POSITIONAL ARGUMENTS"

.RS 2m
.TP 2m
\fIBACKEND_SERVICE_NAME\fR
Name of the backend service to create.


.RE
.sp

.SH "FLAGS"

.RS 2m
.TP 2m
\fB\-\-affinity\-cookie\-ttl\fR=\fIAFFINITY_COOKIE_TTL\fR
If session\-affinity is set to "generated_cookie", this flag sets the TTL, in
seconds, of the resulting cookie. A setting of 0 indicates that the cookie
should be transient. See $ gcloud topic datetimes for information on duration
formats.

.TP 2m
\fB\-\-cache\-key\-include\-host\fR
Enable including host in cache key. If enabled, requests to different hosts will
be cached separately. Can only be applied for global resources. Enabled by
default, use \fB\-\-no\-cache\-key\-include\-host\fR to disable.

.TP 2m
\fB\-\-cache\-key\-include\-protocol\fR
Enable including protocol in cache key. If enabled, http and https requests will
be cached separately. Can only be applied for global resources. Enabled by
default, use \fB\-\-no\-cache\-key\-include\-protocol\fR to disable.

.TP 2m
\fB\-\-cache\-key\-include\-query\-string\fR
Enable including query string in cache key. If enabled, the query string
parameters will be included according to
\-\-cache\-key\-query\-string\-whitelist and
\-\-cache\-key\-query\-string\-blacklist. If neither is set, the entire query
string will be included. If disabled, then the entire query string will be
excluded. Can only be applied for global resources. Enabled by default, use
\fB\-\-no\-cache\-key\-include\-query\-string\fR to disable.

.TP 2m
\fB\-\-connection\-drain\-on\-failover\fR
Connection drain is enabled by default and on failover or failback connections
will be drained. If connection drain is disabled, the existing connection state
will be cleared immediately on a best effort basis on failover or failback, all
connections will then be served by the active pool of instances. Not compatible
with the \-\-global flag, load balancing scheme must be INTERNAL, and the
protocol must be TCP.

.TP 2m
\fB\-\-connection\-draining\-timeout\fR=\fICONNECTION_DRAINING_TIMEOUT\fR
Connection draining timeout to be used during removal of VMs from instance
groups. This guarantees that for the specified time all existing connections to
a VM will remain untouched, but no new connections will be accepted. Set timeout
to zero to disable connection draining. Enable feature by specifying a timeout
of up to one hour. If the flag is omitted API default value (0s) will be used.
See $ gcloud topic datetimes for information on duration formats.

.TP 2m
\fB\-\-custom\-request\-header\fR=\fICUSTOM_REQUEST_HEADER\fR
Specifies a HTTP Header to be added by your load balancer. This flag can be
repeated to specify multiple headers. For example:

.RS 2m
$ gcloud alpha compute backend\-services create NAME             \e
    \-\-custom\-request\-header "header\-name: value"             \e
    \-\-custom\-request\-header "another\-header:"
.RE

.TP 2m
\fB\-\-description\fR=\fIDESCRIPTION\fR
An optional, textual description for the backend service.

.TP 2m
\fB\-\-drop\-traffic\-if\-unhealthy\fR
Enable dropping of traffic if there are no healthy VMs detected in both the
primary and backup instance groups. Not compatible with the \-\-global flag and
load balancing scheme must be INTERNAL.

.TP 2m
\fB\-\-[no\-]enable\-cdn\fR
Enable or disable Cloud CDN for the backend service. Only available for backend
services with \-\-load\-balancing\-scheme=EXTERNAL that use a \-\-protocol of
HTTP, HTTPS, or HTTP2. Cloud CDN caches HTTP responses at the edge of Google's
network. Cloud CDN is disabled by default. Use \fB\-\-enable\-cdn\fR to enable
and \fB\-\-no\-enable\-cdn\fR to disable.

.TP 2m
\fB\-\-[no\-]enable\-logging\fR
The logging options for the load balancer traffic served by this backend
service. If logging is enabled, logs will be exported to Stackdriver. Enabled by
default. Use \fB\-\-enable\-logging\fR to enable and
\fB\-\-no\-enable\-logging\fR to disable.

.TP 2m
\fB\-\-failover\-ratio\fR=\fIFAILOVER_RATIO\fR
If the ratio of the healthy VMs in the primary backend is at or below this
number, traffic arriving at the load\-balanced IP will be directed to the
failover backend(s). Not compatible with the \-\-global flag.

.TP 2m
\fB\-\-health\-checks\fR=\fIHEALTH_CHECK\fR,[...]
Specifies a list of health check objects for checking the health of the backend
service. Currently at most one health check can be specified. Health checks need
not be for the same protocol as that of the backend service.

.TP 2m
\fB\-\-http\-health\-checks\fR=\fIHTTP_HEALTH_CHECK\fR,[...]
Specifies a list of legacy HTTP health check objects for checking the health of
the backend service.

Legacy health checks are not recommended for backend services. It is possible to
use a legacy health check on a backend service for a HTTP(S) load balancer if
that backend service uses instance groups. For more information, refer to this
guide:
https://cloud.google.com/load\-balancing/docs/health\-check\-concepts#lb_guide.

.TP 2m
\fB\-\-https\-health\-checks\fR=\fIHTTPS_HEALTH_CHECK\fR,[...]
Specifies a list of legacy HTTPS health check objects for checking the health of
the backend service.

Legacy health checks are not recommended for backend services. It is possible to
use a legacy health check on a backend service for a HTTP(S) load balancer if
that backend service uses instance groups. For more information, refer to this
guide:
https://cloud.google.com/load\-balancing/docs/health\-check\-concepts#lb_guide.

.TP 2m
\fB\-\-iap\fR=\fIdisabled\fR|\fIenabled\fR,[\fIoauth2\-client\-id\fR=\fIOAUTH2\-CLIENT\-ID\fR,\fIoauth2\-client\-secret\fR=\fIOAUTH2\-CLIENT\-SECRET\fR]
Configure Identity Aware Proxy (IAP) for external HTTP(S) load balancing. You
can configure IAP to be \f5enabled\fR or \f5disabled\fR (default). If enabled,
you can provide values for \f5oauth2\-client\-id\fR and
\f5oauth2\-client\-secret\fR. For example,
\f5\-\-iap=enabled,oauth2\-client\-id=foo,oauth2\-client\-secret=bar\fR turns
IAP on, and \f5\-\-iap=disabled\fR turns it off. For more information, see
https://cloud.google.com/iap/.

.TP 2m
\fB\-\-load\-balancing\-scheme\fR=\fILOAD_BALANCING_SCHEME\fR; default="EXTERNAL"
Specifies the load balancer type. Choose EXTERNAL for load balancers that
receive traffic from external clients. Choose INTERNAL for Internal TCP/UDP Load
Balancing. Choose INTERNAL_MANAGED for Internal HTTP(S) Load Balancing. Choose
INTERNAL_SELF_MANAGED for Traffic Director. For more information, refer to this
guide: https://cloud.google.com/load\-balancing/docs/choosing\-load\-balancer.
\fILOAD_BALANCING_SCHEME\fR must be one of: \fBINTERNAL\fR, \fBEXTERNAL\fR,
\fBINTERNAL_SELF_MANAGED\fR, \fBINTERNAL_MANAGED\fR.

.TP 2m
\fB\-\-logging\-sample\-rate\fR=\fILOGGING_SAMPLE_RATE\fR
This field can only be specified if logging is enabled for the backend service.
The value of the field must be a float in the range [0, 1]. This configures the
sampling rate of requests to the load balancer where 1.0 means all logged
requests are reported and 0.0 means no logged requests are reported. The default
value is 1.0.

.TP 2m
\fB\-\-network\fR=\fINETWORK\fR
Network that this backend service applies to. It can only be set if the
load\-balancing\-scheme is INTERNAL.

.TP 2m
\fB\-\-port\-name\fR=\fIPORT_NAME\fR
The name of a service that has been added to an instance group in this backend.
Instance group services map a name to a port number which is used by the load
balancing service. Only one \f5\fIport\-name\fR\fR may be added to a backend
service, and that name must exist as a service on all instance groups that are a
part of this backend service. The port number associated with the name may
differ between instances. If you do not specify this flag, your instance groups
must have a service named \f5\fIhttp\fR\fR configured. See also \f5gcloud
compute instance\-groups set\-named\-ports \-\-help\fR. The
\f5\fIport\-name\fR\fR parameter cannot be set if the load\-balancing\-scheme is
INTERNAL.

.TP 2m
\fB\-\-protocol\fR=\fIPROTOCOL\fR
Protocol for incoming requests.

If the \f5load\-balancing\-scheme\fR is \f5INTERNAL\fR (internal TCP/UDP load
balancers), the protocol must be one of: TCP, UDP.

If the \f5load\-balancing\-scheme\fR is \f5INTERNAL_SELF_MANAGED\fR (Traffic
Director), the protocol must be one of: HTTP, HTTPS, HTTP2, GRPC.

If the \f5load\-balancing\-scheme\fR is \f5INTERNAL_MANAGED\fR (internal HTTP(S)
load balancers), the protocol must be one of: HTTP, HTTPS, HTTP2.

If the \f5load\-balancing\-scheme\fR is \f5EXTERNAL\fR (HTTP(S), SSL proxy, or
TCP proxy load balancers), the protocol must be one of: HTTP, HTTPS, HTTP2, SSL,
TCP.

.TP 2m
\fB\-\-session\-affinity\fR=\fISESSION_AFFINITY\fR
The type of session affinity to use. Supports both TCP and UDP.
\fISESSION_AFFINITY\fR must be one of:

.RS 2m
.TP 2m
\fBCLIENT_IP\fR
Route requests to instances based on the hash of the client's IP address.
.TP 2m
\fBCLIENT_IP_NO_DESTINATION\fR
Directs a particular client's request to the same backend VM based on a hash
created on the client's IP address only. This is used in L4 ILB as Next\-Hop
scenarios. It differs from the Client\-IP option in that Client\-IP uses a hash
based on both client\-IP's address and destination address.
.TP 2m
\fBCLIENT_IP_PORT_PROTO\fR
(Applicable if \f5\-\-load\-balancing\-scheme\fR is \f5INTERNAL\fR) Connections
from the same client IP with the same IP protocol and port will go to the same
backend VM while that VM remains healthy.
.TP 2m
\fBCLIENT_IP_PROTO\fR
(Applicable if \f5\-\-load\-balancing\-scheme\fR is \f5INTERNAL\fR) Connections
from the same client IP with the same IP protocol will go to the same backend VM
while that VM remains healthy.
.TP 2m
\fBGENERATED_COOKIE\fR
(Applicable if \f5\-\-load\-balancing\-scheme\fR is \f5INTERNAL_MANAGED\fR,
\f5INTERNAL_SELF_MANAGED\fR, or \f5EXTERNAL\fR) If the
\f5\-\-load\-balancing\-scheme\fR is \f5EXTERNAL\fR, routes requests to backend
VMs or endpoints in a NEG, based on the contents of the \f5GCLB\fR cookie set by
the load balancer. Only applicable when \f5\-\-protocol\fR is HTTP, HTTPS, or
HTTP2. If the \f5\-\-load\-balancing\-scheme\fR is \f5INTERNAL_MANAGED\fR or
\f5INTERNAL_SELF_MANAGED\fR, routes requests to backend VMs or endpoints in a
NEG, based on the contents of the \f5GCILB\fR cookie set by the proxy. (If no
cookie is present, the proxy chooses a backend VM or endpoint and sends a
\f5Set\-Cookie\fR response for future requests.) If the
\f5\-\-load\-balancing\-scheme\fR is \f5INTERNAL_SELF_MANAGED\fR, routes
requests to backend VMs or endpoints in a NEG, based on the contents of a cookie
set by Traffic Director.
.TP 2m
\fBHEADER_FIELD\fR
(Applicable if \f5\-\-load\-balancing\-scheme\fR is \f5INTERNAL_MANAGED\fR or
\f5INTERNAL_SELF_MANAGED\fR) Route requests to backend VMs or endpoints in a NEG
based on the value of the HTTP header named in the
\f5\-\-custom\-request\-header\fR flag. This session affinity is only valid if
the load balancing locality policy is either RING_HASH or MAGLEV and the backend
service's consistent hash specifies the name of the HTTP header.
.TP 2m
\fBHTTP_COOKIE\fR
(Applicable if \f5\-\-load\-balancing\-scheme\fR is \f5INTERNAL_MANAGED\fR or
\f5INTERNAL_SELF_MANAGED\fR) Route requests to backend VMs or endpoints in a
NEG, based on an HTTP cookie named in the \f5HTTP_COOKIE\fR flag (with the
optional \f5\-\-affinity\-cookie\-ttl\fR flag). If the client has not provided
the cookie, the proxy generates the cookie and returns it to the client in a
\f5Set\-Cookie\fR header. This session affinity is only valid if the load
balancing locality policy is either \f5RING_HASH\fR or \f5MAGLEV\fR and the
backend service's consistent hash specifies the HTTP cookie.
.TP 2m
\fBNONE\fR
Session affinity is disabled.
.RE
.sp


.TP 2m
\fB\-\-signed\-url\-cache\-max\-age\fR=\fISIGNED_URL_CACHE_MAX_AGE\fR
The amount of time up to which the response to a signed URL request will be
cached in the CDN. After this time period, the Signed URL will be revalidated
before being served. Cloud CDN will internally act as though all responses from
this backend had a \f5Cache\-Control: public, max\-age=[TTL]\fR header,
regardless of any existing Cache\-Control header. The actual headers served in
responses will not be altered. If unspecified, the default value is 3600s.

For example, specifying \f512h\fR will cause the responses to signed URL
requests to be cached in the CDN up to 12 hours. See $ gcloud topic datetimes
for information on duration formats.

This flag only affects signed URL requests.

.TP 2m
\fB\-\-timeout\fR=\fITIMEOUT\fR; default="30s"
Applicable to all load balancers except internal TCP/UDP load balancers. For
internal TCP/UDP load balancers (\f5\fIload\-balancing\-scheme\fR\fR INTERNAL),
\f5\fItimeout\fR\fR is ignored.

If the \f5\fIprotocol\fR\fR is HTTP, HTTPS, or HTTP2, \f5\fItimeout\fR\fR is a
request/response timeout for HTTP(S) traffic, meaning the amount of time that
the load balancer waits for a backend to return a full response to a request. If
WebSockets traffic is supported, the \f5\fItimeout\fR\fR parameter sets the
maximum amount of time that a WebSocket can be open (idle or not).

For example, for HTTP, HTTPS, or HTTP2 traffic, specifying a \f5\fItimeout\fR\fR
of 10s means that backends have 10 seconds to respond to the load balancer's
requests. The load balancer retries the HTTP GET request one time if the backend
closes the connection or times out before sending response headers to the load
balancer. If the backend sends response headers or if the request sent to the
backend is not an HTTP GET request, the load balancer does not retry. If the
backend does not reply at all, the load balancer returns a 502 Bad Gateway error
to the client.

If the \f5\fIprotocol\fR\fR is SSL or TCP, \f5\fItimeout\fR\fR is an idle
timeout.

.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-cache\-key\-query\-string\-blacklist\fR=[\fIQUERY_STRING\fR,...]
Specifies a comma separated list of query string parameters to exclude in cache
keys. All other parameters will be included. Either specify
\-\-cache\-key\-query\-string\-whitelist or
\-\-cache\-key\-query\-string\-blacklist, not both. '&' and '=' will be percent
encoded and not treated as delimiters. Can only be applied for global resources.

.TP 2m
\fB\-\-cache\-key\-query\-string\-whitelist\fR=\fIQUERY_STRING\fR,[...]
Specifies a comma separated list of query string parameters to include in cache
keys. All other parameters will be excluded. Either specify
\-\-cache\-key\-query\-string\-whitelist or
\-\-cache\-key\-query\-string\-blacklist, not both. '&' and '=' will be percent
encoded and not treated as delimiters. Can only be applied for global resources.

.RE
.sp
.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-global\fR
If set, the backend service is global.

.TP 2m
\fB\-\-region\fR=\fIREGION\fR
Region of the backend service to create. Overrides the default
\fBcompute/region\fR property value for this command invocation.

.RE
.sp
.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-global\-health\-checks\fR
If set, the health checks are global.

.TP 2m
\fB\-\-health\-checks\-region\fR=\fIHEALTH_CHECKS_REGION\fR
Region of the health checks to operate on. If not specified, you may be prompted
to select a region.

To avoid prompting when this flag is omitted, you can set the
\f5\fIcompute/region\fR\fR property:

.RS 2m
$ gcloud config set compute/region REGION
.RE

A list of regions can be fetched by running:

.RS 2m
$ gcloud compute regions list
.RE

To unset the property, run:

.RS 2m
$ gcloud config unset compute/region
.RE

Alternatively, the region can be stored in the environment variable
\f5\fICLOUDSDK_COMPUTE_REGION\fR\fR.


.RE
.RE
.sp

.SH "GCLOUD WIDE FLAGS"

These flags are available to all commands: \-\-account, \-\-billing\-project,
\-\-configuration, \-\-flags\-file, \-\-flatten, \-\-format, \-\-help,
\-\-impersonate\-service\-account, \-\-log\-http, \-\-project, \-\-quiet,
\-\-trace\-token, \-\-user\-output\-enabled, \-\-verbosity.

Run \fB$ gcloud help\fR for details.



.SH "NOTES"

This command is currently in ALPHA and may change without notice. If this
command fails with API permission errors despite specifying the right project,
you may be trying to access an API with an invitation\-only early access
whitelist. These variants are also available:

.RS 2m
$ gcloud compute backend\-services create
$ gcloud beta compute backend\-services create
.RE

