
.TH "GCLOUD_ALPHA_COMPUTE_OS\-CONFIG_PATCH\-JOBS_EXECUTE" 1



.SH "NAME"
.HP
gcloud alpha compute os\-config patch\-jobs execute \- execute an OS patch on the specified VM instances



.SH "SYNOPSIS"
.HP
\f5gcloud alpha compute os\-config patch\-jobs execute\fR (\fB\-\-instance\-filter\fR=\fIINSTANCE_FILTER\fR\ |\ \fB\-\-instance\-filter\-all\fR\ |\ \fB\-\-instance\-filter\-group\-labels\fR=[\fIKEY\fR=\fIVALUE\fR,...]\ \fB\-\-instance\-filter\-name\-prefixes\fR=[\fIINSTANCE_FILTER_NAME_PREFIXES\fR,...]\ \fB\-\-instance\-filter\-names\fR=[\fIINSTANCE_FILTER_NAMES\fR,...]\ \fB\-\-instance\-filter\-zones\fR=[\fIINSTANCE_FILTER_ZONES\fR,...]) [\fB\-\-async\fR] [\fB\-\-description\fR=\fIDESCRIPTION\fR] [\fB\-\-display\-name\fR=\fIDISPLAY_NAME\fR] [\fB\-\-dry\-run\fR] [\fB\-\-duration\fR=\fIDURATION\fR] [\fB\-\-reboot\-config\fR=\fIREBOOT_CONFIG\fR] [\fB\-\-retry\fR] [\fB\-\-apt\-dist\fR\ \fB\-\-apt\-excludes\fR=[\fIAPT_EXCLUDES\fR,...]\ |\ \fB\-\-apt\-exclusive\-packages\fR=[\fIAPT_EXCLUSIVE_PACKAGES\fR,...]] [\fB\-\-post\-patch\-linux\-executable\fR=\fIPOST_PATCH_LINUX_EXECUTABLE\fR\ \fB\-\-post\-patch\-linux\-success\-codes\fR=[\fIPOST_PATCH_LINUX_SUCCESS_CODES\fR,...]] [\fB\-\-post\-patch\-windows\-executable\fR=\fIPOST_PATCH_WINDOWS_EXECUTABLE\fR\ \fB\-\-post\-patch\-windows\-success\-codes\fR=[\fIPOST_PATCH_WINDOWS_SUCCESS_CODES\fR,...]] [\fB\-\-pre\-patch\-linux\-executable\fR=\fIPRE_PATCH_LINUX_EXECUTABLE\fR\ \fB\-\-pre\-patch\-linux\-success\-codes\fR=[\fIPRE_PATCH_LINUX_SUCCESS_CODES\fR,...]] [\fB\-\-pre\-patch\-windows\-executable\fR=\fIPRE_PATCH_WINDOWS_EXECUTABLE\fR\ \fB\-\-pre\-patch\-windows\-success\-codes\fR=[\fIPRE_PATCH_WINDOWS_SUCCESS_CODES\fR,...]] [\fB\-\-rollout\-mode\fR=\fIROLLOUT_MODE\fR\ \fB\-\-rollout\-disruption\-budget\fR=\fIROLLOUT_DISRUPTION_BUDGET\fR\ |\ \fB\-\-rollout\-disruption\-budget\-percent\fR=\fIROLLOUT_DISRUPTION_BUDGET_PERCENT\fR] [\fB\-\-windows\-exclusive\-patches\fR=[\fIWINDOWS_EXCLUSIVE_PATCHES\fR,...]\ |\ \fB\-\-windows\-classifications\fR=[\fIWINDOWS_CLASSIFICATIONS\fR,...]\ \fB\-\-windows\-excludes\fR=[\fIWINDOWS_EXCLUDES\fR,...]] [\fB\-\-yum\-exclusive\-packages\fR=[\fIYUM_EXCLUSIVE_PACKAGES\fR,...]\ |\ \fB\-\-yum\-excludes\fR=[\fIYUM_EXCLUDES\fR,...]\ \fB\-\-yum\-minimal\fR\ \fB\-\-yum\-security\fR] [\fB\-\-zypper\-exclusive\-patches\fR=[\fIZYPPER_EXCLUSIVE_PATCHES\fR,...]\ |\ \fB\-\-zypper\-categories\fR=[\fIZYPPER_CATEGORIES\fR,...]\ \fB\-\-zypper\-severities\fR=[\fIZYPPER_SEVERITIES\fR,...]\ \fB\-\-zypper\-with\-optional\fR\ \fB\-\-zypper\-with\-update\fR] [\fIGCLOUD_WIDE_FLAG\ ...\fR]



.SH "DESCRIPTION"

\fB(ALPHA)\fR Execute an OS patch on the specified VM instances.



.SH "REQUIRED FLAGS"

.RS 2m
.TP 2m

Filters for selecting which instances to patch: Exactly one of these must be
specified:

.RS 2m
.TP 2m
\fB\-\-instance\-filter\fR=\fIINSTANCE_FILTER\fR
(DEPRECATED) Filter expression for selecting the instances to patch. Patching
supports the same filter mechanisms as \f5gcloud compute instances list\fR,
allowing one to patch specific instances by name, zone, label, or other
criteria.

.RS 2m
\-\-instance\-filter is deprecated; use individual filter flags instead. See
the command help text for more details.
.RE

.TP 2m
\fB\-\-instance\-filter\-all\fR
A filter that targets all instances in the project.

.TP 2m

Individual filters. The targeted instances must meet all criteria specified.


.RS 2m
.TP 2m
\fB\-\-instance\-filter\-group\-labels\fR=[\fIKEY\fR=\fIVALUE\fR,...]
A filter that represents a label set. Targeted instances must have all specified
labels in this set. For example, "env=prod and app=web".

This flag can be repeated. Targeted instances must have at least one of these
label sets. This allows targeting of disparate groups, for example, "(env=prod
and app=web) or (env=staging and app=web)".

.TP 2m
\fB\-\-instance\-filter\-name\-prefixes\fR=[\fIINSTANCE_FILTER_NAME_PREFIXES\fR,...]
A filter that targets instances whose name starts with one of these prefixes.
For example, "prod\-".

.TP 2m
\fB\-\-instance\-filter\-names\fR=[\fIINSTANCE_FILTER_NAMES\fR,...]
A filter that targets instances of any of the specified names. Instances are
specified by the URI in the form "zones/<ZONE>/instances/<INSTANCE_NAME>",
"projects/<PROJECT_ID>/zones/<ZONE>/instances/<INSTANCE_NAME>", or
"https://www.googleapis.com/compute/v1/projects/<PROJECT_ID>/zones/<ZONE>/instances/<INSTANCE_NAME>".

.TP 2m
\fB\-\-instance\-filter\-zones\fR=[\fIINSTANCE_FILTER_ZONES\fR,...]
A filter that targets instances in any of the specified zones. Leave empty to
target instances in any zone.


.RE
.RE
.RE
.sp

.SH "OPTIONAL FLAGS"

.RS 2m
.TP 2m
\fB\-\-async\fR
Return immediately, without waiting for the operation in progress to complete.

.TP 2m
\fB\-\-description\fR=\fIDESCRIPTION\fR
Textual description of the patch job.

.TP 2m
\fB\-\-display\-name\fR=\fIDISPLAY_NAME\fR
Display name for this patch job. This does not have to be unique.

.TP 2m
\fB\-\-dry\-run\fR
Whether to execute this patch job as a dry run. If this patch job is a dry run,
instances are contacted, but the patch is not run.

.TP 2m
\fB\-\-duration\fR=\fIDURATION\fR
Total duration in which the patch job must complete. If the patch does not
complete in this time, the process times out. While some instances might still
be running the patch, they will not continue to work after completing the
current step. See $ gcloud topic datetimes for information on specifying
absolute time durations.

If unspecified, the job stays active until all instances complete the patch.

.TP 2m
\fB\-\-reboot\-config\fR=\fIREBOOT_CONFIG\fR
Post\-patch reboot settings. \fIREBOOT_CONFIG\fR must be one of:

.RS 2m
.TP 2m
\fBalways\fR
Always reboot the machine after the update completes.
.TP 2m
\fBdefault\fR
The agent decides if a reboot is necessary by checking signals such as registry
keys or '/var/run/reboot\-required'.
.TP 2m
\fBnever\fR
Never reboot the machine after the update completes.
.RE
.sp


.TP 2m
\fB\-\-retry\fR
Specifies whether to attempt to retry, within the duration window, if patching
initially fails. If omitted, the agent uses its default retry strategy.

.TP 2m

Settings for machines running Apt:

.RS 2m
.TP 2m
\fB\-\-apt\-dist\fR
If specified, machines running Apt use the \f5apt\-get dist\-upgrade\fR command;
otherwise the \f5apt\-get upgrade\fR command is used.

.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-apt\-excludes\fR=[\fIAPT_EXCLUDES\fR,...]
List of packages to exclude from update.

.TP 2m
\fB\-\-apt\-exclusive\-packages\fR=[\fIAPT_EXCLUSIVE_PACKAGES\fR,...]
An exclusive list of packages to be updated. These are the only packages that
will be updated. If these packages are not installed, they will be ignored.

.RE
.RE
.sp
.TP 2m

Post\-patch step settings for Linux machines:

.RS 2m
.TP 2m
\fB\-\-post\-patch\-linux\-executable\fR=\fIPOST_PATCH_LINUX_EXECUTABLE\fR
A set of commands to run on a Linux machine after an OS patch completes.
Commands must be supplied in a file. If the file contains a shell script,
include the shebang line.

The path to the file must be supplied in one of the following formats:

An absolute path of the file on the local filesystem.

A URI for a Google Cloud Storage object with a generation number.

.TP 2m
\fB\-\-post\-patch\-linux\-success\-codes\fR=[\fIPOST_PATCH_LINUX_SUCCESS_CODES\fR,...]
Additional exit codes that the executable can return to indicate a successful
run. The default exit code for success is 0.

.RE
.sp
.TP 2m

Post\-patch step settings for Windows machines:

.RS 2m
.TP 2m
\fB\-\-post\-patch\-windows\-executable\fR=\fIPOST_PATCH_WINDOWS_EXECUTABLE\fR
A set of commands to run on a Windows machine after an OS patch completes.
Commands must be supplied in a file. If the file contains a PowerShell script,
include the .ps1 file extension. The PowerShell script executes with flags
\f5\-NonInteractive\fR, \f5\-NoProfile\fR, and \f5\-ExecutionPolicy Bypass\fR.

The path to the file must be supplied in one of the following formats:

An absolute path of the file on the local filesystem.

A URI for a Google Cloud Storage object with a generation number.

.TP 2m
\fB\-\-post\-patch\-windows\-success\-codes\fR=[\fIPOST_PATCH_WINDOWS_SUCCESS_CODES\fR,...]
Additional exit codes that the executable can return to indicate a successful
run. The default exit code for success is 0.

.RE
.sp
.TP 2m

Pre\-patch step settings for Linux machines:

.RS 2m
.TP 2m
\fB\-\-pre\-patch\-linux\-executable\fR=\fIPRE_PATCH_LINUX_EXECUTABLE\fR
A set of commands to run on a Linux machine before an OS patch begins. Commands
must be supplied in a file. If the file contains a shell script, include the
shebang line.

The path to the file must be supplied in one of the following formats:

An absolute path of the file on the local filesystem.

A URI for a Google Cloud Storage object with a generation number.

.TP 2m
\fB\-\-pre\-patch\-linux\-success\-codes\fR=[\fIPRE_PATCH_LINUX_SUCCESS_CODES\fR,...]
Additional exit codes that the executable can return to indicate a successful
run. The default exit code for success is 0.

.RE
.sp
.TP 2m

Pre\-patch step settings for Windows machines:

.RS 2m
.TP 2m
\fB\-\-pre\-patch\-windows\-executable\fR=\fIPRE_PATCH_WINDOWS_EXECUTABLE\fR
A set of commands to run on a Windows machine before an OS patch begins.
Commands must be supplied in a file. If the file contains a PowerShell script,
include the .ps1 file extension. The PowerShell script executes with flags
\f5\-NonInteractive\fR, \f5\-NoProfile\fR, and \f5\-ExecutionPolicy Bypass\fR.

The path to the file must be supplied in one of the following formats:

An absolute path of the file on the local filesystem.

A URI for a Google Cloud Storage object with a generation number.

.TP 2m
\fB\-\-pre\-patch\-windows\-success\-codes\fR=[\fIPRE_PATCH_WINDOWS_SUCCESS_CODES\fR,...]
Additional exit codes that the executable can return to indicate a successful
run. The default exit code for success is 0.

.RE
.sp
.TP 2m

Rollout configurations for this patch job:

.RS 2m
.TP 2m
\fB\-\-rollout\-mode\fR=\fIROLLOUT_MODE\fR
Mode of the rollout. \fIROLLOUT_MODE\fR must be one of:

.RS 2m
.TP 2m
\fBconcurrent\-zones\fR
Patches are applied to VMs in all zones at the same time.
.TP 2m
\fBzone\-by\-zone\fR
Patches are applied one zone at a time. The patch job begins in the region with
the lowest number of targeted VMs. Within the region, patching begins in the
zone with the lowest number of targeted VMs. If multiple regions (or zones
within a region) have the same number of targeted VMs, a tie\-breaker is
achieved by sorting the regions or zones in alphabetical order.
.RE
.sp


.TP 2m

Disruption budget for this rollout. A running VM with an active agent is
considered disrupted if its patching operation fails anytime between the time
the agent is notified until the patch process completes. At most one of these
may be specified:

.RS 2m
.TP 2m
\fB\-\-rollout\-disruption\-budget\fR=\fIROLLOUT_DISRUPTION_BUDGET\fR
Number of VMs per zone to disrupt at any given moment.

.TP 2m
\fB\-\-rollout\-disruption\-budget\-percent\fR=\fIROLLOUT_DISRUPTION_BUDGET_PERCENT\fR
Percentage of VMs per zone to disrupt at any given moment. The number of VMs
calculated from multiplying the percentage by the total number of VMs in a zone
is rounded up.

.RE
.RE
.sp
.TP 2m

Settings for machines running Windows: At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-windows\-exclusive\-patches\fR=[\fIWINDOWS_EXCLUSIVE_PATCHES\fR,...]
An exclusive list of KBs to be updated. These are the only patches that will be
updated.

.TP 2m

Windows patch options

.RS 2m
.TP 2m
\fB\-\-windows\-classifications\fR=[\fIWINDOWS_CLASSIFICATIONS\fR,...]
List of classifications to use to restrict the Windows update. Only patches of
the given classifications are applied. If omitted, a default Windows update is
performed. For more information on classifications, see:
https://support.microsoft.com/en\-us/help/824684. \fIWINDOWS_CLASSIFICATIONS\fR
must be one of: \fBcritical\fR, \fBsecurity\fR, \fBdefinition\fR, \fBdriver\fR,
\fBfeature\-pack\fR, \fBservice\-pack\fR, \fBtool\fR, \fBupdate\-rollup\fR,
\fBupdate\fR.

.TP 2m
\fB\-\-windows\-excludes\fR=[\fIWINDOWS_EXCLUDES\fR,...]
Optional list of KBs to exclude from the update operation.

.RE
.RE
.sp
.TP 2m

Settings for machines running Yum: At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-yum\-exclusive\-packages\fR=[\fIYUM_EXCLUSIVE_PACKAGES\fR,...]
An exclusive list of packages to be updated. These are the only packages that
will be updated. If these packages are not installed, they will be ignored.

.TP 2m

Yum patch options

.RS 2m
.TP 2m
\fB\-\-yum\-excludes\fR=[\fIYUM_EXCLUDES\fR,...]
Optional list of packages to exclude from updating. If this argument is
specified, machines running Yum exclude the given list of packages using the Yum
\f5\-\-exclude\fR flag.

.TP 2m
\fB\-\-yum\-minimal\fR
If specified, machines running Yum use the command \f5yum update\-minimal\fR;
otherwise the patch uses \f5yum\-update\fR.

.TP 2m
\fB\-\-yum\-security\fR
If specified, machines running Yum append the \f5\-\-security\fR flag to the
patch command.

.RE
.RE
.sp
.TP 2m

Settings for machines running Zypper: At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-zypper\-exclusive\-patches\fR=[\fIZYPPER_EXCLUSIVE_PATCHES\fR,...]
An exclusive list of patches to be updated. These are the only patches that will
be installed using the 'zypper patch patch:<patch_name>' command.

.TP 2m

Zypper patch options

.RS 2m
.TP 2m
\fB\-\-zypper\-categories\fR=[\fIZYPPER_CATEGORIES\fR,...]
If specified, machines running Zypper install only patches with the specified
categories. Categories include security, recommended, and feature.

.TP 2m
\fB\-\-zypper\-severities\fR=[\fIZYPPER_SEVERITIES\fR,...]
If specified, machines running Zypper install only patch with the specified
severities. Severities include critical, important, moderate, and low.

.TP 2m
\fB\-\-zypper\-with\-optional\fR
If specified, machines running Zypper add the \f5\-\-with\-optional\fR flag to
\f5zypper patch\fR.

.TP 2m
\fB\-\-zypper\-with\-update\fR
If specified, machines running Zypper add the \f5\-\-with\-update\fR flag to
\f5zypper patch\fR.


.RE
.RE
.RE
.sp

.SH "GCLOUD WIDE FLAGS"

These flags are available to all commands: \-\-account, \-\-billing\-project,
\-\-configuration, \-\-flags\-file, \-\-flatten, \-\-format, \-\-help,
\-\-impersonate\-service\-account, \-\-log\-http, \-\-project, \-\-quiet,
\-\-trace\-token, \-\-user\-output\-enabled, \-\-verbosity.

Run \fB$ gcloud help\fR for details.



.SH "EXAMPLES"

To start a patch job named \f5my patch job\fR that patches all instances in the
current project, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-display\-name="my patch job" \-\-instance\-filter\-all
.RE

To patch an instance named \f5instance\-1\fR in the \f5us\-east1\-b\fR zone,
run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-names="zones/us\-east1\-b/instances/instance\-1"
.RE

To patch all instances in the \f5us\-central1\-b\fR and \f5europe\-west1\-d\fR
zones, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-zones="us\-central1\-b,europe\-west1\-d"
.RE

To patch all instances where the \f5env\fR label is \f5test\fR and \f5app\fR
label is \f5web\fR, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-group\-labels="env=test,app=web"
.RE

To patch all instances where the \f5env\fR label is \f5test\fR and \f5app\fR
label is \f5web\fR or where the \f5env\fR label is \f5staging\fR and \f5app\fR
label is \f5web\fR, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-group\-labels="env=test,app=web" \e
\-\-instance\-filter\-group\-labels="env=staging,app=web"
.RE

To apply security and critical patches to Windows instances with the prefix
\f5windows\-\fR in the instance name, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-name\-prefixes="windows\-" \e
\-\-windows\-classifications=SECURITY,CRITICAL
.RE

To update only \f5KB4339284\fR on Windows instances with the prefix
\f5windows\-\fR in the instance name, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-name\-prefixes="windows\-" \e
\-\-windows\-exclusive\-patches=KB4339284
.RE

To patch all instances in the current project and specify scripts to run
pre\-patch and post\-patch, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-all \e
\-\-pre\-patch\-linux\-executable="/bin/script" \e
\-\-pre\-patch\-linux\-success\-codes=0,200 \e
\-\-pre\-patch\-windows\-executable="C:\eUsers\euser\escript.ps1" \e
\-\-post\-patch\-linux\-executable="gs://my\-bucket/linux\-script#123" \e
\-\-post\-patch\-windows\-executable="gs://my\-bucket/windows\-script#678"
.RE

To patch all instances zone\-by\-zone with no more than 50 percent of the
instances in the same zone disrupted at a given time, run:

.RS 2m
$ gcloud alpha compute os\-config patch\-jobs execute \e
\-\-instance\-filter\-all \-\-rollout\-mode=zone\-by\-zone \e
\-\-rollout\-disruption\-budget\-percent=50
.RE



.SH "NOTES"

This command is currently in ALPHA and may change without notice. If this
command fails with API permission errors despite specifying the right project,
you may be trying to access an API with an invitation\-only early access
whitelist. These variants are also available:

.RS 2m
$ gcloud compute os\-config patch\-jobs execute
$ gcloud beta compute os\-config patch\-jobs execute
.RE

