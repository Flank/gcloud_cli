
.TH "GCLOUD_BETA_FUNCTIONS_DEPLOY" 1



.SH "NAME"
.HP
gcloud beta functions deploy \- create or update a Google Cloud Function



.SH "SYNOPSIS"
.HP
\f5gcloud beta functions deploy\fR (\fINAME\fR\ :\ \fB\-\-region\fR=\fIREGION\fR) [\fB\-\-allow\-unauthenticated\fR] [\fB\-\-egress\-settings\fR=\fIEGRESS_SETTINGS\fR] [\fB\-\-entry\-point\fR=\fIENTRY_POINT\fR] [\fB\-\-ignore\-file\fR=\fIIGNORE_FILE\fR] [\fB\-\-ingress\-settings\fR=\fIINGRESS_SETTINGS\fR] [\fB\-\-memory\fR=\fIMEMORY\fR] [\fB\-\-retry\fR] [\fB\-\-runtime\fR=\fIRUNTIME\fR] [\fB\-\-service\-account\fR=\fISERVICE_ACCOUNT\fR] [\fB\-\-source\fR=\fISOURCE\fR] [\fB\-\-stage\-bucket\fR=\fISTAGE_BUCKET\fR] [\fB\-\-timeout\fR=\fITIMEOUT\fR] [\fB\-\-update\-labels\fR=[\fIKEY\fR=\fIVALUE\fR,...]] [\fB\-\-build\-env\-vars\-file\fR=\fIFILE_PATH\fR\ |\ \fB\-\-clear\-build\-env\-vars\fR\ |\ \fB\-\-set\-build\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]\ |\ \fB\-\-remove\-build\-env\-vars\fR=[\fIKEY\fR,...]\ \fB\-\-update\-build\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]] [\fB\-\-build\-worker\-pool\fR=\fIBUILD_WORKER_POOL\fR\ |\ \fB\-\-clear\-build\-worker\-pool\fR] [\fB\-\-clear\-env\-vars\fR\ |\ \fB\-\-env\-vars\-file\fR=\fIFILE_PATH\fR\ |\ \fB\-\-set\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]\ |\ \fB\-\-remove\-env\-vars\fR=[\fIKEY\fR,...]\ \fB\-\-update\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]] [\fB\-\-clear\-labels\fR\ |\ \fB\-\-remove\-labels\fR=[\fIKEY\fR,...]] [\fB\-\-clear\-max\-instances\fR\ |\ \fB\-\-max\-instances\fR=\fIMAX_INSTANCES\fR] [\fB\-\-clear\-vpc\-connector\fR\ |\ \fB\-\-vpc\-connector\fR=\fIVPC_CONNECTOR\fR] [\fB\-\-trigger\-bucket\fR=\fITRIGGER_BUCKET\fR\ |\ \fB\-\-trigger\-http\fR\ |\ \fB\-\-trigger\-topic\fR=\fITRIGGER_TOPIC\fR\ |\ \fB\-\-trigger\-event\fR=\fIEVENT_TYPE\fR\ \fB\-\-trigger\-resource\fR=\fIRESOURCE\fR] [\fIGCLOUD_WIDE_FLAG\ ...\fR]



.SH "DESCRIPTION"

\fB(BETA)\fR Create or update a Google Cloud Function.



.SH "POSITIONAL ARGUMENTS"

.RS 2m
.TP 2m

Function resource \- The Cloud function name to deploy. The arguments in this
group can be used to specify the attributes of this resource. (NOTE) Some
attributes are not given arguments in this group but can be set in other ways.
To set the [project] attribute: provide the argument [NAME] on the command line
with a fully specified name; provide the argument [\-\-project] on the command
line; set the property [core/project]. This must be specified.

.RS 2m
.TP 2m
\fINAME\fR
ID of the function or fully qualified identifier for the function. This
positional must be specified if any of the other arguments in this group are
specified.

.TP 2m
\fB\-\-region\fR=\fIREGION\fR
The Cloud region for the function. Overrides the default \f5functions/region\fR
property value for this command invocation.


.RE
.RE
.sp

.SH "FLAGS"

.RS 2m
.TP 2m
\fB\-\-allow\-unauthenticated\fR
If set, makes this a public function. This will allow all callers, without
checking authentication.

.TP 2m
\fB\-\-egress\-settings\fR=\fIEGRESS_SETTINGS\fR
Egress settings controls what traffic is diverted through the VPC Access
Connector resource. By default \f5private\-ranges\-only\fR will be used.
\fIEGRESS_SETTINGS\fR must be one of: \fBprivate\-ranges\-only\fR, \fBall\fR.

.TP 2m
\fB\-\-entry\-point\fR=\fIENTRY_POINT\fR
Name of a Google Cloud Function (as defined in source code) that will be
executed. Defaults to the resource name suffix, if not specified. For backward
compatibility, if function with given name is not found, then the system will
try to use function named "function". For Node.js this is name of a function
exported by the module specified in \f5source_location\fR.

.TP 2m
\fB\-\-ignore\-file\fR=\fIIGNORE_FILE\fR
Override the .gcloudignore file and use the specified file instead.

.TP 2m
\fB\-\-ingress\-settings\fR=\fIINGRESS_SETTINGS\fR
Ingress settings controls what traffic can reach the function.By default
\f5all\fR will be used. \fIINGRESS_SETTINGS\fR must be one of: \fBall\fR,
\fBinternal\-only\fR, \fBinternal\-and\-gclb\fR.

.TP 2m
\fB\-\-memory\fR=\fIMEMORY\fR
Limit on the amount of memory the function can use.

Allowed values are: 128MB, 256MB, 512MB, 1024MB, and 2048MB. By default, a new
function is limited to 256MB of memory. When deploying an update to an existing
function, the function will keep its old memory limit unless you specify this
flag.

.TP 2m
\fB\-\-retry\fR
If specified, then the function will be retried in case of a failure.

.TP 2m
\fB\-\-runtime\fR=\fIRUNTIME\fR
Runtime in which to run the function.

Required when deploying a new function; optional when updating an existing
function.

Choices:

.RS 2m
.IP "\(em" 2m
\f5nodejs10\fR: Node.js 10
.IP "\(em" 2m
\f5nodejs12\fR: Node.js 12
.IP "\(em" 2m
\f5python37\fR: Python 3.7
.IP "\(em" 2m
\f5python38\fR: Python 3.8
.IP "\(em" 2m
\f5go111\fR: Go 1.11
.IP "\(em" 2m
\f5go113\fR: Go 1.13
.IP "\(em" 2m
\f5java11\fR: Java 11
.IP "\(em" 2m
\f5nodejs6\fR: Node.js 6 (deprecated)
.IP "\(em" 2m
\f5nodejs8\fR: Node.js 8 (deprecated)
.RE
.RE
.sp

.RS 2m
.TP 2m
\fB\-\-service\-account\fR=\fISERVICE_ACCOUNT\fR
The email address of the IAM service account associated with the function at
runtime. The service account represents the identity of the running function,
and determines what permissions the function has.

If not provided, the function will use the project's default service account.

.TP 2m
\fB\-\-source\fR=\fISOURCE\fR
Location of source code to deploy.

Location of the source can be one of the following three options:

.RS 2m
.IP "\(em" 2m
Source code in Google Cloud Storage (must be a \f5.zip\fR archive),
.IP "\(em" 2m
Reference to source repository or,
.IP "\(em" 2m
Local filesystem path (root directory of function source).

.RE
.RE
.sp
Note that, depending on your runtime type, Cloud Functions will look for files
with specific names for deployable functions. For Node.js, these filenames are
\f5index.js\fR or \f5function.js\fR. For Python, this is \f5main.py\fR.

If you do not specify the \f5\-\-source\fR flag:

.RS 2m
.IP "\(bu" 2m
The current directory will be used for new function deployments.
.IP "\(bu" 2m
If the function was previously deployed using a local filesystem path,
.RE
.sp
then the function's source code will be updated using the current directory.
.RS 2m
.IP "\(bu" 2m
If the function was previously deployed using a Google Cloud Storage
.RE
.sp
location or a source repository, then the function's source code will not be
updated.

The value of the flag will be interpreted as a Cloud Storage location, if it
starts with \f5gs://\fR.

The value will be interpreted as a reference to a source repository, if it
starts with \f5https://\fR.

Otherwise, it will be interpreted as the local filesystem path. When deploying
source from the local filesystem, this command skips files specified in the
\f5.gcloudignore\fR file (see \f5gcloud topic gcloudignore\fR for more
information). If the \f5.gcloudignore\fR file doesn't exist, the command will
try to create it.

The minimal source repository URL is:
\f5https://source.developers.google.com/projects/${PROJECT}/repos/${REPO}\fR

By using the URL above, sources from the root directory of the repository on the
revision tagged \f5master\fR will be used.

If you want to deploy from a revision different from \f5master\fR, append one of
the following three sources to the URL:

.RS 2m
.IP "\(bu" 2m
\f5/revisions/${REVISION}\fR,
.IP "\(bu" 2m
\f5/moveable\-aliases/${MOVEABLE_ALIAS}\fR,
.IP "\(bu" 2m
\f5/fixed\-aliases/${FIXED_ALIAS}\fR.

.RE
.sp
If you'd like to deploy sources from a directory different from the root, you
must specify a revision, a moveable alias, or a fixed alias, as above, and
append \f5/paths/${PATH_TO_SOURCES_DIRECTORY}\fR to the URL.

Overall, the URL should match the following regular expression:

.RS 2m
^https://source\e.developers\e.google\e.com/projects/
(?<accountId>[^/]+)/repos/(?<repoName>[^/]+)
(((/revisions/(?<commit>[^/]+))|(/moveable\-aliases/(?<branch>[^/]+))|
(/fixed\-aliases/(?<tag>[^/]+)))(/paths/(?<path>.*))?)?$
.RE

An example of a validly formatted source repository URL is:

.RS 2m
https://source.developers.google.com/projects/123456789/repos/testrepo/
moveable\-aliases/alternate\-branch/paths/path\-to=source
.RE


.RS 2m
.TP 2m
\fB\-\-stage\-bucket\fR=\fISTAGE_BUCKET\fR
When deploying a function from a local directory, this flag's value is the name
of the Google Cloud Storage bucket in which source code will be stored. Note
that if you set the \f5\-\-stage\-bucket\fR flag when deploying a function, you
will need to specify \f5\-\-source\fR or \f5\-\-stage\-bucket\fR in subsequent
deployments to update your source code. To use this flag successfully, the
account in use must have permissions to write to this bucket. For help granting
access, refer to this guide:
https://cloud.google.com/storage/docs/access\-control/

.TP 2m
\fB\-\-timeout\fR=\fITIMEOUT\fR
The function execution timeout, e.g. 30s for 30 seconds. Defaults to original
value for existing function or 60 seconds for new functions. Cannot be more than
540s. See $ gcloud topic datetimes for information on duration formats.

.TP 2m
\fB\-\-update\-labels\fR=[\fIKEY\fR=\fIVALUE\fR,...]
List of label KEY=VALUE pairs to update. If a label exists its value is
modified, otherwise a new label is created.

Keys must start with a lowercase character and contain only hyphens (\f5\-\fR),
underscores (\f5_\fR), lowercase characters, and numbers. Values must contain
only hyphens (\f5\-\fR), underscores (\f5_\fR), lowercase characters, and
numbers.

Label keys starting with \f5deployment\fR are reserved for use by deployment
tools and cannot be specified manually.

.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-build\-env\-vars\-file\fR=\fIFILE_PATH\fR
Path to a local YAML file with definitions for all build environment variables.
All existing build environment variables will be removed before the new build
environment variables are added.

.TP 2m
\fB\-\-clear\-build\-env\-vars\fR
Remove all build environment variables.

.TP 2m
\fB\-\-set\-build\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]
List of key\-value pairs to set as build environment variables. All existing
build environment variables will be removed first.

.TP 2m

Only \-\-update\-build\-env\-vars and \-\-remove\-build\-env\-vars can be used
together. If both are specified, \-\-remove\-build\-env\-vars will be applied
first.

.RS 2m
.TP 2m
\fB\-\-remove\-build\-env\-vars\fR=[\fIKEY\fR,...]
List of build environment variables to be removed.

.TP 2m
\fB\-\-update\-build\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]
List of key\-value pairs to set as build environment variables.

.RE
.RE
.sp
.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-build\-worker\-pool\fR=\fIBUILD_WORKER_POOL\fR
Name of the Cloud Build Custom Worker Pool that should be used to build the
function. The format of this field is
\f5projects/${PROJECT}/locations/${LOCATION}/workerPools/${WORKERPOOL}\fR where
${PROJECT} is the project id and ${LOCATION} is the location where the worker
pool is defined and ${WORKERPOOL} is the short name of the worker pool.

.TP 2m
\fB\-\-clear\-build\-worker\-pool\fR
Clears the Cloud Build Custom Worker Pool field.

.RE
.sp
.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-clear\-env\-vars\fR
Remove all environment variables.

.TP 2m
\fB\-\-env\-vars\-file\fR=\fIFILE_PATH\fR
Path to a local YAML file with definitions for all environment variables. All
existing environment variables will be removed before the new environment
variables are added.

.TP 2m
\fB\-\-set\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]
List of key\-value pairs to set as environment variables. All existing
environment variables will be removed first.

.TP 2m

Only \-\-update\-env\-vars and \-\-remove\-env\-vars can be used together. If
both are specified, \-\-remove\-env\-vars will be applied first.

.RS 2m
.TP 2m
\fB\-\-remove\-env\-vars\fR=[\fIKEY\fR,...]
List of environment variables to be removed.

.TP 2m
\fB\-\-update\-env\-vars\fR=[\fIKEY\fR=\fIVALUE\fR,...]
List of key\-value pairs to set as environment variables.

.RE
.RE
.sp
.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-clear\-labels\fR
Remove all labels. If \f5\-\-update\-labels\fR is also specified then
\f5\-\-clear\-labels\fR is applied first.

For example, to remove all labels:

.RS 2m
$ gcloud beta functions deploy \-\-clear\-labels
.RE

To set the labels to exactly "foo" and "baz":

.RS 2m
$ gcloud beta functions deploy \-\-clear\-labels \e
  \-\-update\-labels foo=bar,baz=qux
.RE

.TP 2m
\fB\-\-remove\-labels\fR=[\fIKEY\fR,...]
List of label keys to remove. If a label does not exist it is silently ignored.
If \f5\-\-update\-labels\fR is also specified then \f5\-\-remove\-labels\fR is
applied first.Label keys starting with \f5deployment\fR are reserved for use by
deployment tools and cannot be specified manually.

.RE
.sp
.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-clear\-max\-instances\fR
Clears the maximum instances setting for the function.

.TP 2m
\fB\-\-max\-instances\fR=\fIMAX_INSTANCES\fR
Sets the maximum number of instances for the function. A function execution that
would exceed max\-instances times out.

.RE
.sp
.TP 2m

At most one of these may be specified:

.RS 2m
.TP 2m
\fB\-\-clear\-vpc\-connector\fR
Clears the VPC connector field.

.TP 2m
\fB\-\-vpc\-connector\fR=\fIVPC_CONNECTOR\fR
The VPC Access connector that the function can connect to. It can be either the
fully\-qualified URI, or the short name of the VPC Access connector resource. If
the short name is used, the connector must belong to the same project. The
format of this field is either
\f5projects/${PROJECT}/locations/${LOCATION}/connectors/${CONNECTOR}\fR or
\f5${CONNECTOR}\fR, where \f5${CONNECTOR}\fR is the short name of the VPC Access
connector.

.RE
.sp
.TP 2m

If you don't specify a trigger when deploying an update to an existing function
it will keep its current trigger. You must specify \f5\-\-trigger\-topic\fR,
\f5\-\-trigger\-bucket\fR, \f5\-\-trigger\-http\fR or (\f5\-\-trigger\-event\fR
AND \f5\-\-trigger\-resource\fR) when deploying a new function. At most one of
these may be specified:

.RS 2m
.TP 2m
\fB\-\-trigger\-bucket\fR=\fITRIGGER_BUCKET\fR
Google Cloud Storage bucket name. Every change in files in this bucket will
trigger function execution.

.TP 2m
\fB\-\-trigger\-http\fR
Function will be assigned an endpoint, which you can view by using the
\f5describe\fR command. Any HTTP request (of a supported type) to the endpoint
will trigger function execution. Supported HTTP request types are: POST, PUT,
GET, DELETE, and OPTIONS.

.TP 2m
\fB\-\-trigger\-topic\fR=\fITRIGGER_TOPIC\fR
Name of Pub/Sub topic. Every message published in this topic will trigger
function execution with message contents passed as input data. Note that this
flag does not accept the format of projects/PROJECT_ID/topics/TOPIC_ID. Use this
flag to specify the final element TOPIC_ID. The PROJECT_ID will be read from the
active configuration.

.TP 2m
\fB\-\-trigger\-event\fR=\fIEVENT_TYPE\fR
Specifies which action should trigger the function. For a list of acceptable
values, call \f5gcloud functions event\-types list\fR.

.TP 2m
\fB\-\-trigger\-resource\fR=\fIRESOURCE\fR
Specifies which resource from \f5\-\-trigger\-event\fR is being observed. E.g.
if \f5\-\-trigger\-event\fR is
\f5providers/cloud.storage/eventTypes/object.change\fR,
\f5\-\-trigger\-resource\fR must be a bucket name. For a list of expected
resources, call \f5gcloud functions event\-types list\fR.


.RE
.RE
.sp

.SH "GCLOUD WIDE FLAGS"

These flags are available to all commands: \-\-account, \-\-billing\-project,
\-\-configuration, \-\-flags\-file, \-\-flatten, \-\-format, \-\-help,
\-\-impersonate\-service\-account, \-\-log\-http, \-\-project, \-\-quiet,
\-\-trace\-token, \-\-user\-output\-enabled, \-\-verbosity.

Run \fB$ gcloud help\fR for details.



.SH "EXAMPLES"

To deploy a function that is triggered by write events on the document
\f5\fI/messages/{pushId}\fR\fR, run:

.RS 2m
$ gcloud beta functions deploy my_function \-\-runtime=python37 \e
    \-\-trigger\-event=providers/cloud.firestore/eventTypes/\e
document.write \e
    \-\-trigger\-resource=projects/project_id/databases/(default)/\e
documents/messages/{pushId}
.RE

See https://cloud.google.com/functions/docs/calling for more details of using
other types of resource as triggers.



.SH "NOTES"

This command is currently in BETA and may change without notice. These variants
are also available:

.RS 2m
$ gcloud functions deploy
$ gcloud alpha functions deploy
.RE

