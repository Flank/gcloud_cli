title: dataproc metastore list metadata imports test scenario
release_tracks: [ALPHA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: |
      metastore services imports list --service foo --location us-central1
  - stdout: |
      NAME         STATE      DATABASE_TYPE  CREATE_TIME
      test-import  SUCCEEDED  MYSQL          2020-08-20T00:21:59
- execute:
  - label: list metadata imports under all services and all locations
  - command: |
      metastore services imports list --service - --location -
  - stdout: |
      NAME          STATE      DATABASE_TYPE  CREATE_TIME
      import-46da                             2020-06-30T15:32:28
      test-import1  SUCCEEDED  MYSQL          2020-08-20T02:22:47
      test-import   SUCCEEDED  MYSQL          2020-08-20T00:21:59
      test-import2  SUCCEEDED  MYSQL          2020-08-20T02:23:43
actions:
- execute_command:
    command: |
      metastore services imports list --service foo --location us-central1
    events:
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-central1/services/foo/metadataImports?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "metadataImports": [
                {
                  "name": "projects/metastore-dogfood-cp/locations/us-central1/services/test-gcloud2/metadataImports/test-import",
                  "createTime": "2020-08-20T00:21:59.430131088Z",
                  "updateTime": "2020-08-20T00:28:52.313683501Z",
                  "state": "SUCCEEDED",
                  "databaseDump": {
                    "databaseType": "MYSQL",
                    "gcsUri": "gs://test-gcloud/sql_import_target/hive_import_2_3_6_3M"
                  }
                }
              ]
            }
    - expect_stdout: |
        NAME         STATE      DATABASE_TYPE  CREATE_TIME
        test-import  SUCCEEDED  MYSQL          2020-08-20T00:21:59
    - expect_exit:
        code: 0
- execute_command:
    label: list metadata imports under all services and all locations
    command: |
      metastore services imports list --service - --location -
    events:
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/-/services/-/metadataImports?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "metadataImports": [
                {
                  "name": "projects/metastore-dogfood-cp/locations/us-central1/services/service-lyyang-test-0629-prod/metadataImports/import-46da",
                  "createTime": "2020-06-30T15:32:28.771332071Z",
                  "updateTime": "2020-06-30T15:36:02.326616707Z"
                },
                {
                  "name": "projects/metastore-dogfood-cp/locations/us-central1/services/test-gcloud3/metadataImports/test-import1",
                  "createTime": "2020-08-20T02:22:47.155565288Z",
                  "updateTime": "2020-08-20T02:30:57.076923362Z",
                  "state": "SUCCEEDED",
                  "databaseDump": {
                    "databaseType": "MYSQL",
                    "gcsUri": "gs://test-gcloud/sql_import_target/hive_import_2_3_6_3M"
                  }
                },
                {
                  "name": "projects/metastore-dogfood-cp/locations/us-central1/services/test-gcloud2/metadataImports/test-import",
                  "createTime": "2020-08-20T00:21:59.430131088Z",
                  "updateTime": "2020-08-20T00:28:52.313683501Z",
                  "state": "SUCCEEDED",
                  "databaseDump": {
                    "databaseType": "MYSQL",
                    "gcsUri": "gs://test-gcloud/sql_import_target/hive_import_2_3_6_3M"
                  }
                },
                {
                  "name": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud2/metadataImports/test-import2",
                  "createTime": "2020-08-20T02:23:43.179799843Z",
                  "updateTime": "2020-08-20T02:31:48.388200605Z",
                  "state": "SUCCEEDED",
                  "databaseDump": {
                    "databaseType": "MYSQL",
                    "gcsUri": "gs://test-gcloud/sql_import_target/hive_import_2_3_6_3M"
                  }
                }
              ]
            }
    - expect_stdout: |
        NAME          STATE      DATABASE_TYPE  CREATE_TIME
        import-46da                             2020-06-30T15:32:28
        test-import1  SUCCEEDED  MYSQL          2020-08-20T02:22:47
        test-import   SUCCEEDED  MYSQL          2020-08-20T00:21:59
        test-import2  SUCCEEDED  MYSQL          2020-08-20T02:23:43
    - expect_exit:
        code: 0
