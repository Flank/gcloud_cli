title: dataproc metastore delete service test scenario
release_tracks: [ALPHA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- set_property: metastore/location us-east4
- execute:
  - label: delete multiple services by one command
  - command: |
      metastore services delete test-gcloud test-gcloud2
  - prompt:
    - message: |
        Deleting the following services:
         - [test-gcloud] in [us-east4]
         - [test-gcloud2] in [us-east4]
    - cancel_string: Deletion aborted by user.
    - input: y
  - stderr: |
      Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042083-5aca7accb7104-7c870271-244d6a28].
  - stderr: |
      Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud2] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042732-5aca7acd55834-b8ff4e8f-88795065].
  - progress_tracker:
    - message: Waiting for [projects/fake-project/locations/us-east4/services/test-gcloud]
        to be deleted
    - status: SUCCESS
  - progress_tracker:
    - message: Waiting for [projects/fake-project/locations/us-east4/services/test-gcloud2]
        to be deleted
    - status: SUCCESS
- execute:
  - label: delete multiple services by one command, with one non-exist service
  - command: |
      metastore services delete test-gcloud3 non-exist --location=us-central1
  - prompt:
    - message: |
        Deleting the following services:
         - [test-gcloud3] in [us-central1]
         - [non-exist] in [us-central1]
    - cancel_string: Deletion aborted by user.
    - input: y
  - stderr: |
      Delete in progress for service [projects/fake-project/locations/us-central1/services/test-gcloud3] with operation [projects/metastore-dogfood-cp/locations/us-central1/operations/operation-1598225251231-5ad93d05ee7ec-791d5831-2486b7da].
  - stderr: |
      Delete in progress for service [projects/fake-project/locations/us-central1/services/non-exist].
  - progress_tracker:
    - message: Waiting for [projects/fake-project/locations/us-central1/services/test-gcloud3]
        to be deleted
    - status: SUCCESS
  - error: '1: Some requested deletions did not succeed.'
- execute:
  - label: delete non-exist service
  - command: |
      metastore services delete non-exist
  - prompt:
    - message: |
        Deleting the following services:
         - [non-exist] in [us-east4]
    - cancel_string: Deletion aborted by user.
    - input: y
  - stderr: |
      Delete in progress for service [projects/fake-project/locations/us-east4/services/non-exist].
  - error: '1: Some requested deletions did not succeed.'
- execute:
  - label: delete one service
  - command: |
      metastore services delete test-gcloud
  - prompt:
    - message: |
        Deleting the following services:
         - [test-gcloud] in [us-east4]
    - cancel_string: Deletion aborted by user.
    - input: y
  - stderr: |
      Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597985257787-5ad5befa59197-4c92614c-325a2982].
  - progress_tracker:
    - message: Waiting for [projects/fake-project/locations/us-east4/services/test-gcloud]
        to be deleted
    - status: SUCCESS
- execute:
  - label: delete one service async
  - command: |
      metastore services delete test-gcloud2 --async
  - prompt:
    - message: |
        Deleting the following services:
         - [test-gcloud2] in [us-east4]
    - cancel_string: Deletion aborted by user.
    - input: y
  - stderr: |
      Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud2] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1598222891735-5ad9343bbda36-1911203c-ce4fc55e].
actions:
- set_property:
    metastore/location: us-east4
- execute_command:
    label: delete multiple services by one command
    command: |
      metastore services delete test-gcloud test-gcloud2
    events:
    - expect_prompt_continue:
        message: |
          Deleting the following services:
           - [test-gcloud] in [us-east4]
           - [test-gcloud2] in [us-east4]
        cancel_string: Deletion aborted by user.
        user_input: y
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-east4/services/test-gcloud?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042083-5aca7accb7104-7c870271-244d6a28",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-12T05:44:02.103953979Z",
                "target": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": false
            }
    - expect_stderr: |
        Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042083-5aca7accb7104-7c870271-244d6a28].
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-east4/services/test-gcloud2?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042732-5aca7acd55834-b8ff4e8f-88795065",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-12T05:44:02.753599856Z",
                "target": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud2",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": false
            }
    - expect_stderr: |
        Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud2] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042732-5aca7acd55834-b8ff4e8f-88795065].
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042083-5aca7accb7104-7c870271-244d6a28?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042083-5aca7accb7104-7c870271-244d6a28",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-12T05:44:02.103953979Z",
                "endTime": "2020-08-12T05:44:02.513631076Z",
                "target": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.protobuf.Empty"
              }
            }
    - expect_progress_tracker:
        message: Waiting for [projects/fake-project/locations/us-east4/services/test-gcloud]
          to be deleted
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042732-5aca7acd55834-b8ff4e8f-88795065?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597211042732-5aca7acd55834-b8ff4e8f-88795065",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-12T05:44:02.753599856Z",
                "endTime": "2020-08-12T05:44:03.037560182Z",
                "target": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud2",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.protobuf.Empty"
              }
            }
    - expect_progress_tracker:
        message: Waiting for [projects/fake-project/locations/us-east4/services/test-gcloud2]
          to be deleted
        status: SUCCESS
    - expect_exit:
        code: 0
- execute_command:
    label: delete multiple services by one command, with one non-exist service
    command: |
      metastore services delete test-gcloud3 non-exist --location=us-central1
    events:
    - expect_prompt_continue:
        message: |
          Deleting the following services:
           - [test-gcloud3] in [us-central1]
           - [non-exist] in [us-central1]
        cancel_string: Deletion aborted by user.
        user_input: y
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-central1/services/test-gcloud3?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-central1/operations/operation-1598225251231-5ad93d05ee7ec-791d5831-2486b7da",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-23T23:27:31.244081538Z",
                "target": "projects/metastore-dogfood-cp/locations/us-central1/services/test-gcloud3",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": false
            }
    - expect_stderr: |
        Delete in progress for service [projects/fake-project/locations/us-central1/services/test-gcloud3] with operation [projects/metastore-dogfood-cp/locations/us-central1/operations/operation-1598225251231-5ad93d05ee7ec-791d5831-2486b7da].
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-central1/services/non-exist?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 404
          headers: {}
          body: |
            {
              "error": {
                "code": 404,
                "message": "Resource 'projects/metastore-dogfood-cp/locations/us-central1/services/non-exist' was not found",
                "status": "NOT_FOUND",
                "details": [
                  {
                    "@type": "type.googleapis.com/google.rpc.DebugInfo",
                    "stackEntries": [
                      "cloud/control2/shared/userfriendly/userfriendly.go:696 +0x28 google3/cloud/control2/shared/userfriendly/userfriendly.debugInfoWithMessage(0xc04dca0ae0, 0x1d, 0x1d, 0xc095312ae0, 0xc04ead12b0)",
                      "cloud/control2/shared/userfriendly/userfriendly.go:692 +0x54 google3/cloud/control2/shared/userfriendly/userfriendly.debugInfoWithError(0x563697262560, 0xc000f66c80, 0xc02040e928, 0x1, 0x1)",
                      "cloud/control2/shared/userfriendly/userfriendly.go:304 +0xe5 google3/cloud/control2/shared/userfriendly/userfriendly.NotFound(0x563697287fa0, 0xc080b67bc0, 0x56368dbdb191, 0x10, 0xc064f127d0, 0x46, 0x563697262560, 0xc000f66c80, 0x0)",
                      "cloud/control2/frontend/userfriendly/userfriendly_store.go:63 +0x586 google3/cloud/control2/frontend/userfriendly/userfriendlystore.ResourceErrorToUserFriendly(0x563697287fa0, 0xc080b67bc0, 0xc064f127d0, 0x46, 0x563697262560, 0xc000f66c80, 0x9)",
                      "cloud/control2/frontend/handler/handler.go:650 +0x85 google3/cloud/control2/frontend/handler/handler.storeErrorToUserFriendly(0x563697287fa0, 0xc080b67bc0, 0xc0680dfef0, 0x563697262560, 0xc000f66c80, 0x9)",
                      "cloud/control2/frontend/handler/mutate.go:99 +0x4c5 google3/cloud/control2/frontend/handler/handler.(*handler).getExistingResourceDetails(0xc0ca2e2200, 0x563697287fa0, 0xc080b67bc0, 0x563697212c60, 0xc0651c14c0, 0xc080d76540, 0xc080d765b0, 0xc0680dfef0, 0x5636959c0801, 0xc0651c14c0)",
                      "cloud/control2/frontend/handler/mutate.go:226 +0x93c google3/cloud/control2/frontend/handler/handler.(*mutationHandler).handleResourceMutation(0xc0ca2e2280, 0x563697287fa0, 0xc080b67bc0, 0xc09f6e4c40, 0xc09f6e4c80, 0x0, 0x0)",
                      "cloud/control2/frontend/handler/handler.go:338 +0x1390 google3/cloud/control2/frontend/handler/handler.HandleRequest(0x563697287fa0, 0xc080b67bc0, 0xc047fc1b20, 0xc09f6e4c40, 0xc09f6e4c80, 0xc080b67bc0)",
                      "cloud/control2/frontend/server/frontend.go:750 +0x7bc google3/cloud/control2/frontend/server/server.(*Frontend).handleRequestWithFullMethodName(0xc0005cfc00, 0x563697287fa0, 0xc080b67770, 0xc09f6e4380, 0xc0507f5940, 0xc03c29e7a0, 0xc0bd5753b0, 0x4f, 0xc0a15bd000)",
                      "cloud/control2/frontend/server/frontend.go:719 +0x777 google3/cloud/control2/frontend/server/server.(*Frontend).handleRequest(0xc0005cfc00, 0x563697287fa0, 0xc080b67770, 0xc0507f5940, 0xc03c29e7a0, 0x7fe037628e28)",
                      "cloud/control2/frontend/server/frontend.go:318 +0x54 google3/cloud/control2/frontend/server/server.(*Frontend).SetTenantServices.func1(0x563697287fa0, 0xc080b67770, 0xc0507f5940, 0xc03c29e7a0, 0xc04628f3e8, 0x5636903a343b)",
                      "cloud/control2/frontend/server/tenantservice.go:344 +0x62 google3/cloud/control2/frontend/server/server.(*TenantService).registerFrontendAPIs.func1(0x563697287fa0, 0xc080b67770, 0xc0507f5940, 0xc03c29e7a0, 0xc0a15bd001, 0x1)",
                      "cloud/control2/shared/genericrpc/service.go:123 +0x36d google3/cloud/control2/shared/genericrpc/genericrpc.(*Dispatcher).DefaultMethodHandler(0xc00073af00, 0x563697287fa0, 0xc080b67770, 0xc0507f5940, 0x28, 0x28, 0xc080b67830, 0x7fe037bce0c0)",
                      "net/rpc/go/stream.go:881 +0x6b google3/net/rpc/go/rpc.runStreamHandler(0x563697287fa0, 0xc080b67770, 0xc080b67830, 0x0, 0x0, 0x5636972a0cc0, 0xc0680dfe00)",
                      "net/goa/rpc/rpchandler.go:70 +0x22b google3/net/goa/rpc/rpchandler.ExecHandlerSubset(0x563697287fa0, 0xc080b67770, 0xc02040f998, 0x2, 0x2, 0xc04407db00, 0x563697287fa0)",
                      "net/goa/rpc/rpchandler.go:260 +0x45a google3/net/goa/rpc/rpchandler.(*closedRegistry).hook(0xc02ecca500, 0x563697287fa0, 0xc0c45d5b30, 0xc080d76380, 0x563690abdd6c, 0xc032f69188)"
                    ],
                    "detail": "generic::not_found: not found"
                  },
                  {
                    "@type": "type.googleapis.com/google.rpc.ResourceInfo",
                    "resourceName": "projects/metastore-dogfood-cp/locations/us-central1/services/non-exist"
                  }
                ]
              }
            }
    - expect_stderr: |
        Delete in progress for service [projects/fake-project/locations/us-central1/services/non-exist].
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/metastore-dogfood-cp/locations/us-central1/operations/operation-1598225251231-5ad93d05ee7ec-791d5831-2486b7da?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-central1/operations/operation-1598225251231-5ad93d05ee7ec-791d5831-2486b7da",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-23T23:27:31.244081538Z",
                "endTime": "2020-08-23T23:28:07.769767604Z",
                "target": "projects/metastore-dogfood-cp/locations/us-central1/services/test-gcloud3",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.protobuf.Empty"
              }
            }
    - expect_progress_tracker:
        message: Waiting for [projects/fake-project/locations/us-central1/services/test-gcloud3]
          to be deleted
        status: SUCCESS
    - expect_exit:
        code: 1
        message: Some requested deletions did not succeed.
- execute_command:
    label: delete non-exist service
    command: |
      metastore services delete non-exist
    events:
    - expect_prompt_continue:
        message: |
          Deleting the following services:
           - [non-exist] in [us-east4]
        cancel_string: Deletion aborted by user.
        user_input: y
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-east4/services/non-exist?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 404
          headers: {}
          body: |
            {
              "error": {
                "code": 404,
                "message": "Resource 'projects/metastore-dogfood-cp/locations/us-east4/services/non-exist' was not found",
                "status": "NOT_FOUND",
                "details": [
                  {
                    "@type": "type.googleapis.com/google.rpc.DebugInfo",
                    "stackEntries": [
                      "cloud/control2/shared/userfriendly/userfriendly.go:696 +0x28 google3/cloud/control2/shared/userfriendly/userfriendly.debugInfoWithMessage(0xc062877d00, 0x1d, 0x1d, 0xc063c6d0e0, 0xc0464ba820)",
                      "cloud/control2/shared/userfriendly/userfriendly.go:692 +0x54 google3/cloud/control2/shared/userfriendly/userfriendly.debugInfoWithError(0x56347a871560, 0xc000e00940, 0xc02e0a2928, 0x1, 0x1)",
                      "cloud/control2/shared/userfriendly/userfriendly.go:304 +0xe5 google3/cloud/control2/shared/userfriendly/userfriendly.NotFound(0x56347a896fa0, 0xc025971140, 0x5634711ea191, 0x10, 0xc048920ff0, 0x43, 0x56347a871560, 0xc000e00940, 0x0)",
                      "cloud/control2/frontend/userfriendly/userfriendly_store.go:63 +0x586 google3/cloud/control2/frontend/userfriendly/userfriendlystore.ResourceErrorToUserFriendly(0x56347a896fa0, 0xc025971140, 0xc048920ff0, 0x43, 0x56347a871560, 0xc000e00940, 0x9)",
                      "cloud/control2/frontend/handler/handler.go:650 +0x85 google3/cloud/control2/frontend/handler/handler.storeErrorToUserFriendly(0x56347a896fa0, 0xc025971140, 0xc06f54aaa0, 0x56347a871560, 0xc000e00940, 0x9)",
                      "cloud/control2/frontend/handler/mutate.go:99 +0x4c5 google3/cloud/control2/frontend/handler/handler.(*handler).getExistingResourceDetails(0xc058ef9480, 0x56347a896fa0, 0xc025971140, 0x56347a821c60, 0xc05fff3580, 0xc03029f030, 0xc03029f0a0, 0xc06f54aaa0, 0x563478fcf801, 0xc05fff3580)",
                      "cloud/control2/frontend/handler/mutate.go:226 +0x93c google3/cloud/control2/frontend/handler/handler.(*mutationHandler).handleResourceMutation(0xc05e086480, 0x56347a896fa0, 0xc025971140, 0xc094fe5440, 0xc094fe5480, 0x0, 0x0)",
                      "cloud/control2/frontend/handler/handler.go:338 +0x1390 google3/cloud/control2/frontend/handler/handler.HandleRequest(0x56347a896fa0, 0xc025971140, 0xc0434ee620, 0xc094fe5440, 0xc094fe5480, 0xc025971140)",
                      "cloud/control2/frontend/server/frontend.go:750 +0x7bc google3/cloud/control2/frontend/server/server.(*Frontend).handleRequestWithFullMethodName(0xc00447bf00, 0x56347a896fa0, 0xc025970f30, 0xc094fe4b00, 0xc01f2dd720, 0xc06dff6480, 0xc01de490e0, 0x4c, 0xc008413800)",
                      "cloud/control2/frontend/server/frontend.go:719 +0x777 google3/cloud/control2/frontend/server/server.(*Frontend).handleRequest(0xc00447bf00, 0x56347a896fa0, 0xc025970f30, 0xc01f2dd720, 0xc06dff6480, 0x7fed13200b10)",
                      "cloud/control2/frontend/server/frontend.go:318 +0x54 google3/cloud/control2/frontend/server/server.(*Frontend).SetTenantServices.func1(0x56347a896fa0, 0xc025970f30, 0xc01f2dd720, 0xc06dff6480, 0xc0316f53e8, 0x5634739b243b)",
                      "cloud/control2/frontend/server/tenantservice.go:344 +0x62 google3/cloud/control2/frontend/server/server.(*TenantService).registerFrontendAPIs.func1(0x56347a896fa0, 0xc025970f30, 0xc01f2dd720, 0xc06dff6480, 0xc008413801, 0x1)",
                      "cloud/control2/shared/genericrpc/service.go:123 +0x36d google3/cloud/control2/shared/genericrpc/genericrpc.(*Dispatcher).DefaultMethodHandler(0xc0002b7440, 0x56347a896fa0, 0xc025970f30, 0xc01f2dd720, 0x28, 0x28, 0xc025970f60, 0x7fed19670858)",
                      "net/rpc/go/stream.go:881 +0x6b google3/net/rpc/go/rpc.runStreamHandler(0x56347a896fa0, 0xc025970f30, 0xc025970f60, 0x0, 0x0, 0x56347a8afcc0, 0xc06f54aa50)",
                      "net/goa/rpc/rpchandler.go:70 +0x22b google3/net/goa/rpc/rpchandler.ExecHandlerSubset(0x56347a896fa0, 0xc025970f30, 0xc02e0a3998, 0x2, 0x2, 0xc01f2dd900, 0x56347a896fa0)",
                      "net/goa/rpc/rpchandler.go:260 +0x45a google3/net/goa/rpc/rpchandler.(*closedRegistry).hook(0xc02d471d00, 0x56347a896fa0, 0xc06e77bf80, 0xc03029eaf0, 0x5634740ccd6c, 0xc01dfb0e50)"
                    ],
                    "detail": "generic::not_found: not found"
                  },
                  {
                    "@type": "type.googleapis.com/google.rpc.ResourceInfo",
                    "resourceName": "projects/metastore-dogfood-cp/locations/us-east4/services/non-exist"
                  }
                ]
              }
            }
    - expect_stderr: |
        Delete in progress for service [projects/fake-project/locations/us-east4/services/non-exist].
    - expect_exit:
        code: 1
        message: Some requested deletions did not succeed.
- execute_command:
    label: delete one service
    command: |
      metastore services delete test-gcloud
    events:
    - expect_prompt_continue:
        message: |
          Deleting the following services:
           - [test-gcloud] in [us-east4]
        cancel_string: Deletion aborted by user.
        user_input: y
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-east4/services/test-gcloud?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597985257787-5ad5befa59197-4c92614c-325a2982",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-21T04:47:37.811109636Z",
                "target": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": false
            }
    - expect_stderr: |
        Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597985257787-5ad5befa59197-4c92614c-325a2982].
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597985257787-5ad5befa59197-4c92614c-325a2982?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1597985257787-5ad5befa59197-4c92614c-325a2982",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-21T04:47:37.811109636Z",
                "endTime": "2020-08-21T04:47:38.178412886Z",
                "target": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.protobuf.Empty"
              }
            }
    - expect_progress_tracker:
        message: Waiting for [projects/fake-project/locations/us-east4/services/test-gcloud]
          to be deleted
        status: SUCCESS
    - expect_exit:
        code: 0
- execute_command:
    label: delete one service async
    command: |
      metastore services delete test-gcloud2 --async
    events:
    - expect_prompt_continue:
        message: |
          Deleting the following services:
           - [test-gcloud2] in [us-east4]
        cancel_string: Deletion aborted by user.
        user_input: y
    - api_call:
        expect_request:
          uri: https://metastore.googleapis.com/v1alpha/projects/fake-project/locations/us-east4/services/test-gcloud2?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1598222891735-5ad9343bbda36-1911203c-ce4fc55e",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.metastore.v1alpha.OperationMetadata",
                "createTime": "2020-08-23T22:48:11.762214194Z",
                "target": "projects/metastore-dogfood-cp/locations/us-east4/services/test-gcloud2",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": false
            }
    - expect_stderr: |
        Delete in progress for service [projects/fake-project/locations/us-east4/services/test-gcloud2] with operation [projects/metastore-dogfood-cp/locations/us-east4/operations/operation-1598222891735-5ad9343bbda36-1911203c-ce4fc55e].
    - expect_exit:
        code: 0
