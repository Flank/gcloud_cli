title: artifacts docker images describe --show-all-metadata
release_tracks: [ALPHA, BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: artifacts docker images describe us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
      --show-package-vulnerability
  - stdout: |
      discovery_summary:
        discovery:
        - createTime: '2019-04-10T22:08:45.773883Z'
          discovery:
            analysisStatus: FINISHED_SUCCESS
            continousAnalysis: ACTIVE
          kind: DISCOVERY
          name: projects/fake-project/occurrences/3
          noteName: projects/analysis-project/notes/PACKAGE_VULNERABILITY
          resourceUri: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
          updateTime: '2019-04-10T22:08:45.773883Z'
      image_summary:
        digest: sha256:abcxyz
        fully_qualified_digest: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
        registry: us-west1-docker.pkg.dev
        repository: docker-repo
      package_vulnerability_summary:
        not_fixed_vulnerability_count: 1
        total_vulnerability_count: 2
        vulnerabilities:
          CRITICAL:
          - createTime: '2019-04-10T22:08:45.773883Z'
            kind: VULNERABILITY
            name: projects/fake-project/occurrences/1
            noteName: projects/vulnz-project/notes/1
            resourceUri: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
            updateTime: '2019-04-10T22:08:45.773883Z'
            vulnerability:
              cvssScore: 10.0
              packageIssues:
              - affectedCpeUri: cpe:/o:debian:debian_linux:10
                affectedPackage: tar
                affectedVersion:
                  name: 1.30+dfsg
                  revision: '6'
              severity: CRITICAL
          HIGH:
          - createTime: '2019-04-10T22:08:45.773883Z'
            kind: VULNERABILITY
            name: projects/fake-project/occurrences/2
            noteName: projects/vulnz-project/notes/1
            resourceUri: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
            updateTime: '2019-04-10T22:08:45.773883Z'
            vulnerability:
              cvssScore: 10.0
              packageIssues:
              - affectedCpeUri: cpe:/o:debian:debian_linux:10
                affectedPackage: tar
                affectedVersion:
                  name: 1.30+dfsg
                  revision: '6'
              severity: HIGH
actions:
- execute_command:
    # Describes an image with digest.
    command: artifacts docker images describe us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
      --show-package-vulnerability
    events:
    - api_call:
        expect_request:
          uri: https://artifactregistry.googleapis.com/v1beta2/projects/fake-project/locations?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            locations:
            - name: projects/fake-project/locations/us-west1
              locationId: us-west1
    - api_call:
        expect_request:
          uri: https://artifactregistry.googleapis.com/v1beta2/projects/fake-project/locations/us-west1/repositories/docker-repo?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/us-west1/repositories/docker-repo",
              "format": "DOCKER"
            }
    - api_call:
        expect_request:
          uri: https://artifactregistry.googleapis.com/v1beta2/projects/fake-project/locations/us-west1/repositories/docker-repo/packages/ubuntu/versions/sha256:abcxyz?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/us-west1/repositories/docker-repo/versions/sha256:abcxyz",
              "related_tags": {}
            }
    - api_call:
        expect_request:
          uri: https://containeranalysis.googleapis.com/v1/projects/fake-project/occurrences?alt=json&filter=%28%28kind+%3D+%22VULNERABILITY%22%29+OR+%28kind+%3D+%22DISCOVERY%22%29%29+AND+%28%28resourceUrl+%3D+%22us-west1-docker.pkg.dev%2Ffake-project%2Fdocker-repo%2Fubuntu%40sha256%3Aabcxyz%22%29%29&pageSize=1000
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "occurrences": [
                {
                  "name": "projects/fake-project/occurrences/1",
                  "resourceUri": "us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz",
                  "kind": "VULNERABILITY",
                  "updateTime": "2019-04-10T22:08:45.773883Z",
                  "createTime": "2019-04-10T22:08:45.773883Z",
                  "noteName": "projects/vulnz-project/notes/1",
                  "vulnerability": {
                    "cvssScore": 10.0,
                    "severity": "CRITICAL",
                    "packageIssues": [
                      {
                        "affectedCpeUri": "cpe:/o:debian:debian_linux:10",
                        "affectedPackage": "tar",
                        "affectedVersion": {
                          "name": "1.30+dfsg",
                          "revision": "6"
                        }
                      }
                    ]
                  }
                },
                {
                  "name": "projects/fake-project/occurrences/2",
                  "resourceUri": "us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz",
                  "kind": "VULNERABILITY",
                  "updateTime": "2019-04-10T22:08:45.773883Z",
                  "createTime": "2019-04-10T22:08:45.773883Z",
                  "noteName": "projects/vulnz-project/notes/1",
                  "vulnerability": {
                    "cvssScore": 10.0,
                    "severity": "HIGH",
                    "packageIssues": [
                      {
                        "affectedCpeUri": "cpe:/o:debian:debian_linux:10",
                        "affectedPackage": "tar",
                        "affectedVersion": {
                          "name": "1.30+dfsg",
                          "revision": "6"
                        }
                      }
                    ]
                  }
                },
                {
                  "name": "projects/fake-project/occurrences/3",
                  "resourceUri": "us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz",
                  "kind": "DISCOVERY",
                  "noteName": "projects/analysis-project/notes/PACKAGE_VULNERABILITY",
                  "updateTime": "2019-04-10T22:08:45.773883Z",
                  "createTime": "2019-04-10T22:08:45.773883Z",
                  "discovery": {
                    "continousAnalysis": "ACTIVE",
                    "analysisStatus": "FINISHED_SUCCESS"
                  }
                }
              ]
            }
    - api_call:
        expect_request:
          uri: https://containeranalysis.googleapis.com/v1/projects/fake-project/occurrences:vulnerabilitySummary?alt=json&filter=%28%28resourceUrl+%3D+%22us-west1-docker.pkg.dev%2Ffake-project%2Fdocker-repo%2Fubuntu%40sha256%3Aabcxyz%22%29%29
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "counts": [
                {
                  "severity": "SEVERITY_UNSPECIFIED",
                  "resourceUri": "us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz",
                  "fixableCount": 1,
                  "totalCount": 2
                },
                {
                  "severity": "CRITICAL",
                  "resourceUri": "us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz",
                  "fixableCount": 1,
                  "totalCount": 1
                },
                {
                  "severity": "HIGH",
                  "resourceUri": "us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz",
                  "fixableCount": 1,
                  "totalCount": 1
                }
              ]
            }
    - expect_stdout: |
        discovery_summary:
          discovery:
          - createTime: '2019-04-10T22:08:45.773883Z'
            discovery:
              analysisStatus: FINISHED_SUCCESS
              continousAnalysis: ACTIVE
            kind: DISCOVERY
            name: projects/fake-project/occurrences/3
            noteName: projects/analysis-project/notes/PACKAGE_VULNERABILITY
            resourceUri: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
            updateTime: '2019-04-10T22:08:45.773883Z'
        image_summary:
          digest: sha256:abcxyz
          fully_qualified_digest: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
          registry: us-west1-docker.pkg.dev
          repository: docker-repo
        package_vulnerability_summary:
          not_fixed_vulnerability_count: 1
          total_vulnerability_count: 2
          vulnerabilities:
            CRITICAL:
            - createTime: '2019-04-10T22:08:45.773883Z'
              kind: VULNERABILITY
              name: projects/fake-project/occurrences/1
              noteName: projects/vulnz-project/notes/1
              resourceUri: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
              updateTime: '2019-04-10T22:08:45.773883Z'
              vulnerability:
                cvssScore: 10.0
                packageIssues:
                - affectedCpeUri: cpe:/o:debian:debian_linux:10
                  affectedPackage: tar
                  affectedVersion:
                    name: 1.30+dfsg
                    revision: '6'
                severity: CRITICAL
            HIGH:
            - createTime: '2019-04-10T22:08:45.773883Z'
              kind: VULNERABILITY
              name: projects/fake-project/occurrences/2
              noteName: projects/vulnz-project/notes/1
              resourceUri: us-west1-docker.pkg.dev/fake-project/docker-repo/ubuntu@sha256:abcxyz
              updateTime: '2019-04-10T22:08:45.773883Z'
              vulnerability:
                cvssScore: 10.0
                packageIssues:
                - affectedCpeUri: cpe:/o:debian:debian_linux:10
                  affectedPackage: tar
                  affectedVersion:
                    name: 1.30+dfsg
                    revision: '6'
                severity: HIGH

    - expect_exit:
        code: 0
