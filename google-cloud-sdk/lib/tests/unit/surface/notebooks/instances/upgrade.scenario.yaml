title: notebooks instances upgrade test scenario
release_tracks: [ALPHA, BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: |
      notebooks instances upgrade projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3
  - progress_tracker:
    - message: Waiting for operation on Instance [projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3]
        to be upgraded with [projects/gogasca-autopush-notebooks/locations/europe-west3-a/operations/operation-1598313626854-5ada863f7e5ed-3b8fa3de-9b94ae44]
    - status: SUCCESS
  - stderr: |
      Updated notebooks instance projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3 [https://notebooks.googleapis.com/v1beta1/projects/gogasca-autopush-notebooks/locations/europe-west3-a/operations/operation-1598313626854-5ada863f7e5ed-3b8fa3de-9b94ae44].
  - stdout: |
      bootDiskSizeGb: '0'
      bootDiskType: DISK_TYPE_UNSPECIFIED
      createTime: '2020-08-24T22:48:48.175511248Z'
      customGpuDriverPath: ''
      dataDiskSizeGb: '0'
      dataDiskType: DISK_TYPE_UNSPECIFIED
      diskEncryption: DISK_ENCRYPTION_UNSPECIFIED
      installGpuDriver: false
      kmsKey: ''
      labels: {}
      machineType: https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/zones/europe-west3-a/machineTypes/n1-standard-1
      metadata:
        framework: R:3.6
        notebooks-api: PROD
        proxy-mode: service_account
        proxy-url: 5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com
        restriction: ''
        shutdown-script: /opt/deeplearning/bin/shutdown_script.sh
        title: R.CPU
        version: '54'
      name: projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3
      network: https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/global/networks/default
      noProxyAccess: false
      noPublicIp: false
      noRemoveDataDisk: false
      postStartupScript: ''
      proxyUri: 5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com
      serviceAccount: 634850243685-compute@developer.gserviceaccount.com
      state: ACTIVE
      subnet: https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/regions/europe-west3/subnetworks/default
      updateTime: '2020-08-25T00:00:28.410004510Z'
actions:
- execute_command:
    command: |
      notebooks instances upgrade projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3
    events:
    - api_call:
        expect_request:
          uri: https://notebooks.googleapis.com/v1beta1/projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3:upgrade?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/gogasca-autopush-notebooks/locations/europe-west3-a/operations/operation-1598313626854-5ada863f7e5ed-3b8fa3de-9b94ae44",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.notebooks.v1.OperationMetadata",
                "target": "projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3",
                "verb": "update",
                "statusMessage": "",
                "requestedCancellation": false,
                "apiVersion": "v1",
                "createTime": "2020-08-25T00:00:27.951064913Z"
              },
              "done": false
            }
    - api_call:
        expect_request:
          uri: https://notebooks.googleapis.com/v1beta1/projects/gogasca-autopush-notebooks/locations/europe-west3-a/operations/operation-1598313626854-5ada863f7e5ed-3b8fa3de-9b94ae44?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/gogasca-autopush-notebooks/locations/europe-west3-a/operations/operation-1598313626854-5ada863f7e5ed-3b8fa3de-9b94ae44",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.notebooks.v1.OperationMetadata",
                "target": "projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3",
                "verb": "update",
                "statusMessage": "",
                "requestedCancellation": false,
                "apiVersion": "v1",
                "createTime": "2020-08-25T00:00:27.951064913Z",
                "endTime": "2020-08-25T00:00:27.967902806Z"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.notebooks.v1.Instance",
                "name": "projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3",
                "postStartupScript": "",
                "proxyUri": "5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com",
                "instanceOwners": [],
                "serviceAccount": "634850243685-compute@developer.gserviceaccount.com",
                "machineType": "https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/zones/europe-west3-a/machineTypes/n1-standard-1",
                "state": "ACTIVE",
                "installGpuDriver": false,
                "customGpuDriverPath": "",
                "bootDiskType": "DISK_TYPE_UNSPECIFIED",
                "bootDiskSizeGb": "0",
                "dataDiskType": "DISK_TYPE_UNSPECIFIED",
                "dataDiskSizeGb": "0",
                "noRemoveDataDisk": false,
                "diskEncryption": "DISK_ENCRYPTION_UNSPECIFIED",
                "kmsKey": "",
                "noPublicIp": false,
                "noProxyAccess": false,
                "network": "https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/global/networks/default",
                "subnet": "https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/regions/europe-west3/subnetworks/default",
                "labels": {},
                "metadata": {
                  "version": "54",
                  "proxy-url": "5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com",
                  "framework": "R:3.6",
                  "notebooks-api": "PROD",
                  "proxy-mode": "service_account",
                  "restriction": "",
                  "shutdown-script": "/opt/deeplearning/bin/shutdown_script.sh",
                  "title": "R.CPU"
                },
                "createTime": "2020-08-24T22:48:48.175511248Z",
                "updateTime": "2020-08-25T00:00:27.952570184Z"
              }
            }
        repeatable: true
    - expect_progress_tracker:
        message: Waiting for operation on Instance [projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3]
          to be upgraded with [projects/gogasca-autopush-notebooks/locations/europe-west3-a/operations/operation-1598313626854-5ada863f7e5ed-3b8fa3de-9b94ae44]
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://notebooks.googleapis.com/v1beta1/projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3",
              "postStartupScript": "",
              "proxyUri": "5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com",
              "instanceOwners": [],
              "serviceAccount": "634850243685-compute@developer.gserviceaccount.com",
              "machineType": "https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/zones/europe-west3-a/machineTypes/n1-standard-1",
              "state": "ACTIVE",
              "installGpuDriver": false,
              "customGpuDriverPath": "",
              "bootDiskType": "DISK_TYPE_UNSPECIFIED",
              "bootDiskSizeGb": "0",
              "dataDiskType": "DISK_TYPE_UNSPECIFIED",
              "dataDiskSizeGb": "0",
              "noRemoveDataDisk": false,
              "diskEncryption": "DISK_ENCRYPTION_UNSPECIFIED",
              "kmsKey": "",
              "noPublicIp": false,
              "noProxyAccess": false,
              "network": "https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/global/networks/default",
              "subnet": "https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/regions/europe-west3/subnetworks/default",
              "labels": {},
              "metadata": {
                "shutdown-script": "/opt/deeplearning/bin/shutdown_script.sh",
                "title": "R.CPU",
                "version": "54",
                "proxy-url": "5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com",
                "framework": "R:3.6",
                "notebooks-api": "PROD",
                "proxy-mode": "service_account",
                "restriction": ""
              },
              "createTime": "2020-08-24T22:48:48.175511248Z",
              "updateTime": "2020-08-25T00:00:28.410004510Z"
            }
    - expect_stderr: |
        Updated notebooks instance projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3 [https://notebooks.googleapis.com/v1beta1/projects/gogasca-autopush-notebooks/locations/europe-west3-a/operations/operation-1598313626854-5ada863f7e5ed-3b8fa3de-9b94ae44].
    - expect_stdout: |
        bootDiskSizeGb: '0'
        bootDiskType: DISK_TYPE_UNSPECIFIED
        createTime: '2020-08-24T22:48:48.175511248Z'
        customGpuDriverPath: ''
        dataDiskSizeGb: '0'
        dataDiskType: DISK_TYPE_UNSPECIFIED
        diskEncryption: DISK_ENCRYPTION_UNSPECIFIED
        installGpuDriver: false
        kmsKey: ''
        labels: {}
        machineType: https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/zones/europe-west3-a/machineTypes/n1-standard-1
        metadata:
          framework: R:3.6
          notebooks-api: PROD
          proxy-mode: service_account
          proxy-url: 5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com
          restriction: ''
          shutdown-script: /opt/deeplearning/bin/shutdown_script.sh
          title: R.CPU
          version: '54'
        name: projects/gogasca-autopush-notebooks/locations/europe-west3-a/instances/test-europe-west3
        network: https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/global/networks/default
        noProxyAccess: false
        noPublicIp: false
        noRemoveDataDisk: false
        postStartupScript: ''
        proxyUri: 5e4b2ba811fdbcef-dot-europe-west3.notebooks.googleusercontent.com
        serviceAccount: 634850243685-compute@developer.gserviceaccount.com
        state: ACTIVE
        subnet: https://www.googleapis.com/compute/v1/projects/gogasca-autopush-notebooks/regions/europe-west3/subnetworks/default
        updateTime: '2020-08-25T00:00:28.410004510Z'
    - expect_exit:
        code: 0
