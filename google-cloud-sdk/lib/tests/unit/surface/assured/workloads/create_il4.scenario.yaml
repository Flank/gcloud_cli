title: assured workloads create il4 test
release_tracks: [BETA, ALPHA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: assured workloads create --organization=919698206570 --location=us-central1
      --display-name=Test-Workload --compliance-regime=IL4 --billing-account=billingAccounts/0172AD-FDF25F-A4A2E9
      --next-rotation-time=2020-12-30T10:15:00.00Z --rotation-period=172800s --external-identifier=external-id
      --labels labelkey1=labelvalue1
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - progress_tracker:
    - message: Creating Assured Workloads environment
    - status: SUCCESS
  - stderr: |
      Created Assured Workloads environment [organizations/919698206570/locations/us-central1/workloads/00-f7a80bad-b45c-41f7-83c5-00a].
actions:
- execute_command:
    command: assured workloads create --organization=919698206570 --location=us-central1
      --display-name=Test-Workload --compliance-regime=IL4 --billing-account=billingAccounts/0172AD-FDF25F-A4A2E9
      --next-rotation-time=2020-12-30T10:15:00.00Z --rotation-period=172800s --external-identifier=external-id
      --labels labelkey1=labelvalue1
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/919698206570/locations/us-central1/workloads?alt=json&externalId=external-id
          method: POST
          body:
            json:
              billingAccount: billingAccounts/0172AD-FDF25F-A4A2E9
              complianceRegime: IL4
              displayName: Test-Workload
              il4Settings:
                kmsSettings:
                  nextRotationTime: '2020-12-30T10:15:00.00Z'
                  rotationPeriod: 172800s
              labels:
                labelkey1: labelvalue1
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "organizations/919698206570/locations/us-central1/operations/a4214960-381d-4acf-b66c-9d3f43612709",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata",
                "createTime": "2020-08-26T11:03:28.516942Z",
                "displayName": "Test-Workload",
                "parent": "organizations/919698206570/locations/us-central1",
                "complianceRegime": "IL4"
              }
            }
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/919698206570/locations/us-central1/operations/a4214960-381d-4acf-b66c-9d3f43612709?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "organizations/919698206570/locations/us-central1/operations/fed073ae-7969-41b7-8d93-e052b1b348bb",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata",
                "createTime": "2020-08-27T15:26:33.111154Z",
                "displayName": "Test-Workload",
                "parent": "organizations/919698206570/locations/us-central1",
                "complianceRegime": "IL4"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload",
                "name": "organizations/919698206570/locations/us-central1/workloads/00-f7a80bad-b45c-41f7-83c5-00a",
                "displayName": "Test-Workload",
                "resources": [
                  {
                    "resourceId": "244609923800"
                  },
                  {
                    "resourceId": "42181463432"
                  }
                ],
                "complianceRegime": "IL4",
                "createTime": "2020-08-27T15:27:13.571Z",
                "etag": "-330653335",
                "labels": {
                  "goog-aw-external-identifier": "external-id",
                  "labelkey1": "labelvalue1"
                }
              }
            }
    - expect_progress_tracker:
        message: Creating Assured Workloads environment
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/919698206570/locations/us-central1/workloads/00-f7a80bad-b45c-41f7-83c5-00a?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "organizations/919698206570/locations/us-central1/workloads/00-f7a80bad-b45c-41f7-83c5-00a",
              "displayName": "Test-Workload",
              "resources": [
                {
                  "resourceId": "244609923800"
                },
                {
                  "resourceId": "42181463432"
                }
              ],
              "complianceRegime": "IL4",
              "createTime": "2020-08-27T15:27:13.571Z",
              "etag": "-330653335",
              "labels": {
                "goog-aw-external-identifier": "external-id",
                "labelkey1": "labelvalue1"
              }
            }
    - expect_stderr: |
        Created Assured Workloads environment [organizations/919698206570/locations/us-central1/workloads/00-f7a80bad-b45c-41f7-83c5-00a].
    - expect_exit:
        code: 0
