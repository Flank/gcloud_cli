title: assured workloads delete test
release_tracks: [BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: assured workloads delete organizations/919698206570/locations/us-central1/workloads/123
  - prompt:
    - message: You are about to delete Workload [organizations/919698206570/locations/us-central1/workloads/123]
    - input: y
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - error: |-
      1: NOT_FOUND: Requested entity was not found.
      - '@type': type.googleapis.com/google.rpc.ErrorInfo
        domain: assuredworkloads.googleapis.com
        reason: ERROR_CODE_WORKLOAD_NOT_FOUND
      - '@type': type.googleapis.com/google.rpc.DebugInfo
        detail: '[ORIGINAL ERROR] generic::not_found: com.google.cloud.security.assurant.mudbray.exceptions.AssurantWorkloadsException:
          No workload found with the provided id [google.rpc.error_details_ext] { details
          { type_url: "type.googleapis.com/google.rpc.ErrorInfo" value: "\n\035ERROR_CODE_WORKLOAD_NOT_FOUND\022\037assuredworkloads.googleapis.com"
          } }'
actions:
- execute_command:
    command: assured workloads delete organizations/919698206570/locations/us-central1/workloads/123
    events:
    - expect_prompt_continue:
        message: You are about to delete Workload [organizations/919698206570/locations/us-central1/workloads/123]
        user_input: y
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/919698206570/locations/us-central1/workloads/123?alt=json
          method: DELETE
          body: null
        return_response:
          headers:
            status: '404'
          body: |
            {
              "error": {
                "code": 404,
                "message": "Requested entity was not found.",
                "status": "NOT_FOUND",
                "details": [
                  {
                    "@type": "type.googleapis.com/google.rpc.ErrorInfo",
                    "reason": "ERROR_CODE_WORKLOAD_NOT_FOUND",
                    "domain": "assuredworkloads.googleapis.com"
                  },
                  {
                    "@type": "type.googleapis.com/google.rpc.DebugInfo",
                    "detail": "[ORIGINAL ERROR] generic::not_found: com.google.cloud.security.assurant.mudbray.exceptions.AssurantWorkloadsException: No workload found with the provided id [google.rpc.error_details_ext] { details { type_url: \"type.googleapis.com/google.rpc.ErrorInfo\" value: \"\\n\\035ERROR_CODE_WORKLOAD_NOT_FOUND\\022\\037assuredworkloads.googleapis.com\" } }"
                  }
                ]
              }
            }
    - expect_exit:
        code: 1
        message: |-
          NOT_FOUND: Requested entity was not found.
          - '@type': type.googleapis.com/google.rpc.ErrorInfo
            domain: assuredworkloads.googleapis.com
            reason: ERROR_CODE_WORKLOAD_NOT_FOUND
          - '@type': type.googleapis.com/google.rpc.DebugInfo
            detail: '[ORIGINAL ERROR] generic::not_found: com.google.cloud.security.assurant.mudbray.exceptions.AssurantWorkloadsException:
              No workload found with the provided id [google.rpc.error_details_ext] { details
              { type_url: "type.googleapis.com/google.rpc.ErrorInfo" value: "\n\035ERROR_CODE_WORKLOAD_NOT_FOUND\022\037assuredworkloads.googleapis.com"
              } }'
