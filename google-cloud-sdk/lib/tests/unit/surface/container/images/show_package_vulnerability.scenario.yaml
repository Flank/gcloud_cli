title: container images describe test to show vulnerability metadata
release_tracks: [ALPHA]

summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: container images describe gcr.io/foobar/baz@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
      --show-package-vulnerability
  - stdout: |
      discovery_summary:
        discovery:
        - createTime: '2018-07-20T20:16:26.311342Z'
          discovered:
            analysisStatus: FINISHED_SUCCESS
            continuousAnalysis: ACTIVE
          kind: DISCOVERY
          name: projects/foodbar/occurrences/a38095a0-23ff-49ea-9a1b-2e58f850df07
          noteName: projects/goog-analysis/notes/PACKAGE_VULNERABILITY
          resourceUrl: https://gcr.io/foobar/bax@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
          updateTime: '2018-07-20T21:21:44.626013Z'
      image_summary:
        digest: sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
        fully_qualified_digest: gcr.io/foobar/baz@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
        registry: gcr.io
        repository: foobar/baz
      package_vulnerability_summary:
        not_fixed_vulnerability_count: 1
        total_vulnerability_found: 1
        vulnerabilities:
          MEDIUM:
          - createTime: '2017-09-14T18:22:06.330010Z'
            kind: PACKAGE_VULNERABILITY
            name: projects/argo-integration-testing/occurrences/1125a717-b31e-49a3-90db-fa201ef53389
            resourceUrl: https://gcr.io/foobar/bax@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
            updateTime: '2017-09-14T18:22:18.301523Z'
            vulnerabilityDetails:
              packageIssue:
              - affectedLocation:
                  cpeUri: cpe:/o:canonical:ubuntu_linux:18.04
                  package: ncurses
                  version:
                    name: '6.1'
                    revision: 1ubuntu1.18.04
                fixedLocation:
                  cpeUri: cpe:/o:canonical:ubuntu_linux:18.04
                  package: ncurses
                  version:
                    kind: MAXIMUM
                severityName: LOW
              severity: MEDIUM
actions:
- execute_command:
    command: container images describe gcr.io/foobar/baz@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
      --show-package-vulnerability
    events:
    - api_call:
        expect_request:
          uri: https://containeranalysis.googleapis.com/v1alpha1/projects/foobar/occurrences?alt=json&filter=%28kind+%3D+%22PACKAGE_VULNERABILITY%22+OR+kind+%3D+%22DISCOVERY%22%29+AND+%28resource_url%3D%22https%3A%2F%2Fgcr.io%2Ffoobar%2Fbaz%40sha256%3A0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921%22%29&pageSize=1000
          method: GET
          headers:
            accept: application/json
            accept-encoding: gzip, deflate
          body: null
        return_response:
          headers:
            status: '200'
          body: {occurrences: [{createTime: '2017-09-14T18:22:06.330010Z', kind: PACKAGE_VULNERABILITY,
                name: projects/argo-integration-testing/occurrences/1125a717-b31e-49a3-90db-fa201ef53389,
                resourceUrl: https://gcr.io/foobar/bax@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921,
                vulnerabilityDetails: {severity: MEDIUM, packageIssue: {affectedLocation: {
                      cpeUri: cpe:/o:canonical:ubuntu_linux:18.04, package: ncurses,
                      version: {name: '6.1', revision: 1ubuntu1.18.04}}, fixedLocation: {
                      cpeUri: cpe:/o:canonical:ubuntu_linux:18.04, package: ncurses,
                      version: {kind: MAXIMUM}}, severityName: LOW}}, updateTime: '2017-09-14T18:22:18.301523Z'},
              {createTime: '2018-07-20T20:16:26.311342Z', discovered: {analysisStatus: FINISHED_SUCCESS,
                  continuousAnalysis: ACTIVE}, kind: DISCOVERY, name: projects/foodbar/occurrences/a38095a0-23ff-49ea-9a1b-2e58f850df07,
                noteName: projects/goog-analysis/notes/PACKAGE_VULNERABILITY, resourceUrl: https://gcr.io/foobar/bax@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921,
                updateTime: '2018-07-20T21:21:44.626013Z'}]}
    - expect_stdout: |
        discovery_summary:
          discovery:
          - createTime: '2018-07-20T20:16:26.311342Z'
            discovered:
              analysisStatus: FINISHED_SUCCESS
              continuousAnalysis: ACTIVE
            kind: DISCOVERY
            name: projects/foodbar/occurrences/a38095a0-23ff-49ea-9a1b-2e58f850df07
            noteName: projects/goog-analysis/notes/PACKAGE_VULNERABILITY
            resourceUrl: https://gcr.io/foobar/bax@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
            updateTime: '2018-07-20T21:21:44.626013Z'
        image_summary:
          digest: sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
          fully_qualified_digest: gcr.io/foobar/baz@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
          registry: gcr.io
          repository: foobar/baz
        package_vulnerability_summary:
          not_fixed_vulnerability_count: 1
          total_vulnerability_found: 1
          vulnerabilities:
            MEDIUM:
            - createTime: '2017-09-14T18:22:06.330010Z'
              kind: PACKAGE_VULNERABILITY
              name: projects/argo-integration-testing/occurrences/1125a717-b31e-49a3-90db-fa201ef53389
              resourceUrl: https://gcr.io/foobar/bax@sha256:0422a02d982780308b998f12f9235d1afb26a3e736cafc04adb44c71a612d921
              updateTime: '2017-09-14T18:22:18.301523Z'
              vulnerabilityDetails:
                packageIssue:
                - affectedLocation:
                    cpeUri: cpe:/o:canonical:ubuntu_linux:18.04
                    package: ncurses
                    version:
                      name: '6.1'
                      revision: 1ubuntu1.18.04
                  fixedLocation:
                    cpeUri: cpe:/o:canonical:ubuntu_linux:18.04
                    package: ncurses
                    version:
                      kind: MAXIMUM
                  severityName: LOW
                severity: MEDIUM
    - expect_exit:
        code: 0
