title: build-artifacts repositories create
release_tracks: [ALPHA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: build-artifacts repositories create my-repo --project=my-project --repository-format=maven
      --location us-east1 --description="My test repo" --async
  - stderr: |
      Create request issued for: [my-repo]
      Check operation [$$operation$$] for status.
- execute:
  - command: build-artifacts repositories create my-repo --project=my-project --repository-format=maven
      --location us-east1  --description="My test repo"
  - stderr: |
      Create request issued for: [my-repo]
  - progress_tracker:
    - message: Waiting for operation [$$operation$$] to complete
    - status: SUCCESS
  - stderr: |
      Created repository [my-repo].
- execute:
  - command: build-artifacts repositories create my-repo --project=my-project --repository-format=maven
      --location=invalid-location --async
  - error: '1: invalid-location is not a valid location. Valid locations are [us-central1,
      us-east1, europe-west1, europe-west2, asia-east2, asia-northeast1, us].'
actions:
- execute_command:
    command: build-artifacts repositories create my-repo --project=my-project --repository-format=maven
      --location us-east1 --description="My test repo" --async
    events:
    - api_call:
        poll_operation: true
        expect_request:
          uri: https://buildartifacts.googleapis.com/v1alpha2/projects/my-project/repositories?alt=json&repositoryId=my-repo
          method: POST
          headers: {}
          body:
            json:
              name: projects/my-project/repositories/my-repo
              format: MAVEN
              description: My test repo
              location: us-east1
        return_response:
          headers:
            status: '200'
          body: |
            {
              "done": false,
              "name": "projects/my-project/operations/e5e345ac-712c-4a5b-be92-fb0c1ffa5c38",
              "response": {
                "@type": "type.googleapis.com/google.devtools.buildartifacts.v1alpha2.Repository",
                "name": "projects/my-project/repositories/my-repo",
                "format": "MAVEN",
                "description": "My test repo",
                "location": "us-east1"
              }
            }
    - expect_stderr: |
        Create request issued for: [my-repo]
        Check operation [$$operation$$] for status.
    - expect_exit:
        code: 0
- execute_command:
    command: build-artifacts repositories create my-repo --project=my-project --repository-format=maven
      --location us-east1  --description="My test repo"
    events:
    - api_call:
        poll_operation: true
        expect_request:
          uri: https://buildartifacts.googleapis.com/v1alpha2/projects/my-project/repositories?alt=json&repositoryId=my-repo
          method: POST
          headers: {}
          body:
            json:
              name: projects/my-project/repositories/my-repo
              format: MAVEN
              description: My test repo
              location: us-east1
        return_response:
          headers:
            status: '200'
          body: |
            {
              "done": false,
              "name": "projects/my-project/operations/e5e345ac-712c-4a5b-be92-fb0c1ffa5c38",
              "response": {
                "@type": "type.googleapis.com/google.devtools.buildartifacts.v1alpha2.Repository",
                "name": "projects/my-project/repositories/my-repo",
                "format": "MAVEN",
                "description": "My test repo",
                "location": "us-east1"
              }
            }
    - expect_stderr: |
        Create request issued for: [my-repo]
    - expect_progress_tracker:
        message: Waiting for operation [$$operation$$] to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://buildartifacts.googleapis.com/v1alpha2/projects/my-project/repositories/my-repo?alt=json
          method: GET
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "repository":
                {
                  "createTime": "2019-05-23T19:35:43.114453Z",
                  "format": "MAVEN",
                  "description": "My test repo",
                  "location": "us-east1",
                  "name": "projects/my-repo/repositories/my-repo",
                  "updateTime": "2019-05-23T19:35:43.114453Z"
                }
            }
    - expect_stderr: |
        Created repository [my-repo].
    - expect_exit:
        code: 0

- execute_command:
    command: build-artifacts repositories create my-repo --project=my-project --repository-format=maven
      --location=invalid-location --async
    events:
    - expect_exit:
        code: 1
        message: invalid-location is not a valid location. Valid locations are [us-central1,
          us-east1, europe-west1, europe-west2, asia-east2, asia-northeast1, us].
