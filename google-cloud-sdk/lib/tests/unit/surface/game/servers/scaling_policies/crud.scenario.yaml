title: Cloud Game Servers scalingPolicies crud test
release_tracks: [ALPHA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size 70 --max-replicas 100
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --match-clusters=label_a=value1,label_b=value2
      --schedule=^::^cron-spec="10 0 1-7 5,12 *"::cron-job-duration=3600s::start-time=2019-10-01T10:00:00Z::end-time=2020-10-01T10:00:00Z
      --schedule start-time=2021-09-25T10:11:00Z --labels a=x,b=y
  - stderr: |
      Create request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Created scaling policy [my-policy].
- execute:
  - command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size 70 --max-replicas 100
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --schedule=^::^cron-spec="10 0 1-7 5,12 *"::cron-job-duration=3600s::start-time=2019-10-01T10:00:00Z::end-time=2020-10-01T10:00:00Z
      --schedule start-time=2021-09-25T10:11:00Z --labels a=x,b=y
  - stderr: |
      Create request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Created scaling policy [my-policy].
- execute:
  - command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size 70 --max-replicas 100
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --match-clusters=label_a=value1,label_b=value2 --match-clusters=label_c=value3
  - stderr: |
      Create request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Created scaling policy [my-policy].
- execute:
  - command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size-percent 20
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --match-clusters=label_a=value1,label_b=value2
      --schedule=^::^cron-spec="10 0 1-7 5,12 *"::cron-job-duration=3600s::start-time=2019-10-01T10:00:00Z::end-time=2020-10-01T10:00:00Z
      --schedule start-time=2021-09-25T10:11:00Z --labels a=x,b=y
  - stderr: |
      Create request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Created scaling policy [my-policy].
- execute:
  - command: |
      game servers scaling-policies describe my-policy --location global
  - stdout: |
      bufferSizeAbsolute: 70
      clusterSelectors:
      - labels:
          label_a: value1
          label_b: value2
      createTime: '2019-05-25T00:04:16.538552853Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      labels:
        a: x
        b: y
      name: projects/fake-project0/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - startTime: '2021-09-25T10:11:00Z'
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      updateTime: '2019-05-25T00:04:16.676911471Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --priority 50
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --match-clusters=label_a=value1,label_b=value2 --match-clusters=label_c=value3
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      clusterSelectors:
      - labels:
          label_c: value3
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --clear-match-clusters --match-clusters=label_a=value1,label_b=value2 --match-clusters=label_c=value3
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      clusterSelectors:
      - labels:
          label_c: value3
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --clear-match-clusters
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --clear-match-clusters --buffer-size-percent 60
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      createTime: '2019-06-17T17:23:01.872363533Z'
      fleetAutoscalerSettings:
        bufferSizePercentage: 60
        maxReplicas: '100'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --buffer-size-percent 60
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      createTime: '2019-06-17T17:23:01.872363533Z'
      fleetAutoscalerSettings:
        bufferSizePercentage: 60
        maxReplicas: '100'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --update-labels "key1=val1"
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      clusterSelectors:
      - labels:
          label_a: value1
          label_b: value2
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      labels:
        key1: val1
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --priority 100 --update-labels "key1=val1" --location global
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      clusterSelectors:
      - labels:
          label_a: value1
          label_b: value2
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      labels:
        key1: val1
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 100
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --clear-labels
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      clusterSelectors:
      - labels:
          label_a: value1
          label_b: value2
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies update my-policy --location global --clear-labels
  - stderr: |
      Request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Updated scaling policy [my-policy].
  - stdout: |
      clusterSelectors:
      - labels:
          label_a: value1
          label_b: value2
      createTime: '2019-06-17T17:23:01.872363533Z'
      gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
      labels:
        key2: val2
      name: projects/fake-project/locations/global/scalingPolicies/my-policy
      priority: 50
      schedules:
      - cronJobDuration: 3600s
        cronSpec: 10 0 1-7 5,12 *
        endTime: '2020-10-01T10:00:00Z'
        startTime: '2019-10-01T10:00:00Z'
      - startTime: '2021-09-25T10:11:00Z'
      updateTime: '2019-06-17T17:32:20.531596844Z'
- execute:
  - command: |
      game servers scaling-policies list --location global
  - stdout: |
      NAME         LOCATION  DESCRIPTION  CREATE_TIME  UPDATE_TIME  PRIORITY  DEPLOYMENT  BUFFER_SIZE  BUFFER_SIZE_PERCENT  MIN_REPLICAS  MAX_REPLICAS  MATCH_CLUSTERS  SCHEDULES  LABELS
      my-policy-1  global                                           1
      my-policy-2  global                                           2
      my-policy-3  global                                           3
      my-policy-4  global                                           4
      my-policy-5  global                                           5
- execute:
  - command: |
      game servers scaling-policies list
  - stdout: |
      NAME         LOCATION  DESCRIPTION  CREATE_TIME  UPDATE_TIME  PRIORITY  DEPLOYMENT  BUFFER_SIZE  BUFFER_SIZE_PERCENT  MIN_REPLICAS  MAX_REPLICAS  MATCH_CLUSTERS  SCHEDULES  LABELS
      my-policy-1  global                                           1
      my-policy-2  global                                           2
      my-policy-3  global                                           3
      my-policy-4  global                                           4
      my-policy-5  global                                           5
- execute:
  - command: |
      game servers scaling-policies delete my-policy --location global
  - prompt:
    - message: You are about to delete scaling policy [my-policy]
    - input: y
  - stderr: |
      Delete request issued for: [my-policy]
  - progress_tracker:
    - message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
        to complete
    - status: SUCCESS
  - stderr: |
      Deleted scaling policy [my-policy].
actions:
- execute_command:
    command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size 70 --max-replicas 100
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --match-clusters=label_a=value1,label_b=value2
      --schedule=^::^cron-spec="10 0 1-7 5,12 *"::cron-job-duration=3600s::start-time=2019-10-01T10:00:00Z::end-time=2020-10-01T10:00:00Z
      --schedule start-time=2021-09-25T10:11:00Z --labels a=x,b=y
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies?alt=json&scalingPolicyId=my-policy
          method: POST
          headers: {}
          body:
            json:
              clusterSelectors:
              - labels:
                  label_a: value1
                  label_b: value2
              priority: 50
              gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
              labels:
                a: x
                b: y
              fleetAutoscalerSettings:
                bufferSizeAbsolute: '70'
                maxReplicas: '100'
              schedules:
              - cronJobDuration: 3600s
                cronSpec: 10 0 1-7 5,12 *
                endTime: '2020-10-01T10:00:00Z'
                startTime: '2019-10-01T10:00:00Z'
              - startTime: '2021-09-25T10:11:00Z'
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Create request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T06:36:40.690252867Z",
                "endTime": "2019-06-17T06:36:55.212325164Z",
                "target": "projects/fake-project/locations/global/gameServerDeployments/my-deployment",
                "verb": "create",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    }
                  }
                ],
                "labels": {
                  "a": "x",
                  "b": "y"
                },
                "fleetAutoscalerSettings": {
                  "bufferSizeAbsolute": 70,
                   "maxReplicas": 100
                },
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: null
    - expect_stderr: |
        Created scaling policy [my-policy].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size 70 --max-replicas 100
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --schedule=^::^cron-spec="10 0 1-7 5,12 *"::cron-job-duration=3600s::start-time=2019-10-01T10:00:00Z::end-time=2020-10-01T10:00:00Z
      --schedule start-time=2021-09-25T10:11:00Z --labels a=x,b=y
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies?alt=json&scalingPolicyId=my-policy
          method: POST
          headers: {}
          body:
            json:
              priority: 50
              gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
              labels:
                a: x
                b: y
              fleetAutoscalerSettings:
                bufferSizeAbsolute: '70'
                maxReplicas: '100'
              schedules:
              - cronJobDuration: 3600s
                cronSpec: 10 0 1-7 5,12 *
                endTime: '2020-10-01T10:00:00Z'
                startTime: '2019-10-01T10:00:00Z'
              - startTime: '2021-09-25T10:11:00Z'
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Create request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T06:36:40.690252867Z",
                "endTime": "2019-06-17T06:36:55.212325164Z",
                "target": "projects/fake-project/locations/global/gameServerDeployments/my-deployment",
                "verb": "create",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "labels": {
                  "a": "x",
                  "b": "y"
                },
                "fleetAutoscalerSettings": {
                  "bufferSizeAbsolute": 70,
                   "maxReplicas": 100
                },
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: null
    - expect_stderr: |
        Created scaling policy [my-policy].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size 70 --max-replicas 100
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --match-clusters=label_a=value1,label_b=value2 --match-clusters=label_c=value3
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies?alt=json&scalingPolicyId=my-policy
          method: POST
          headers: {}
          body:
            json:
              clusterSelectors:
              - labels:
                  label_a: value1
                  label_b: value2
              - labels:
                  label_c: value3
              priority: 50
              gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
              fleetAutoscalerSettings:
                bufferSizeAbsolute: '70'
                maxReplicas: '100'
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Create request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T06:36:40.690252867Z",
                "endTime": "2019-06-17T06:36:55.212325164Z",
                "target": "projects/fake-project/locations/global/gameServerDeployments/my-deployment",
                "verb": "create",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    },
                    "labels": {
                      "label_c": "value3"
                    }
                  }
                ],
                "fleetAutoscalerSettings": {
                  "bufferSizeAbsolute": 70,
                   "maxReplicas": 100
                }
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: null
    - expect_stderr: |
        Created scaling policy [my-policy].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies create my-policy --location global --priority 50
      --buffer-size-percent 20
      --deployment projects/my-project/locations/global/gameServerDeployments/my-deployment
      --match-clusters=label_a=value1,label_b=value2
      --schedule=^::^cron-spec="10 0 1-7 5,12 *"::cron-job-duration=3600s::start-time=2019-10-01T10:00:00Z::end-time=2020-10-01T10:00:00Z
      --schedule start-time=2021-09-25T10:11:00Z --labels a=x,b=y
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies?alt=json&scalingPolicyId=my-policy
          method: POST
          headers: {}
          body:
            json:
              clusterSelectors:
              - labels:
                  label_a: value1
                  label_b: value2
              priority: 50
              fleetAutoscalerSettings:
                bufferSizePercentage: 20
              gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
              labels:
                a: x
                b: y
              schedules:
              - cronJobDuration: 3600s
                cronSpec: 10 0 1-7 5,12 *
                endTime: '2020-10-01T10:00:00Z'
                startTime: '2019-10-01T10:00:00Z'
              - startTime: '2021-09-25T10:11:00Z'
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Create request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T06:36:40.690252867Z",
                "endTime": "2019-06-17T06:36:55.212325164Z",
                "target": "projects/fake-project/locations/global/gameServerDeployments/my-deployment",
                "verb": "create",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    }
                  }
                ],
                "labels": {
                  "a": "x",
                  "b": "y"
                },
                "fleetAutoscalerSettings": {
                  "bufferSizePercentage": 20
                },
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: null
    - expect_stderr: |
        Created scaling policy [my-policy].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies describe my-policy --location global
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-05-25T00:04:16.538552853Z",
              "updateTime": "2019-05-25T00:04:16.676911471Z",
              "priority": 50,
              "bufferSizeAbsolute": 70,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_a": "value1",
                    "label_b": "value2"
                  }
                }
              ],
              "labels": {
                "a": "x",
                "b": "y"
              },
              "schedules": [
                {
                  "startTime": "2021-09-25T10:11:00Z"
                },
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                }
              ]
            }
    - expect_stdout: |
        bufferSizeAbsolute: 70
        clusterSelectors:
        - labels:
            label_a: value1
            label_b: value2
        createTime: '2019-05-25T00:04:16.538552853Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        labels:
          a: x
          b: y
        name: projects/fake-project0/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - startTime: '2021-09-25T10:11:00Z'
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        updateTime: '2019-05-25T00:04:16.676911471Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --priority 50
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=priority
          method: PATCH
          headers: {}
          body:
            json:
              priority: 50
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 30,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --match-clusters=label_a=value1,label_b=value2 --match-clusters=label_c=value3
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=cluster_selectors.labels
          method: PATCH
          headers: {}
          body:
            json: {}
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 30,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_1": "v1",
                      "label_2": "v2"
                    }
                  }
                ],
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    },
                    "labels": {
                      "label_c": "value3"
                    }
                  }
                ],
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        clusterSelectors:
        - labels:
            label_c: value3
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --clear-match-clusters --match-clusters=label_a=value1,label_b=value2 --match-clusters=label_c=value3
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=cluster_selectors.labels
          method: PATCH
          headers: {}
          body:
            json:
              clusterSelectors:
              - labels:
                  label_a: value1
                  label_b: value2
              - labels:
                  label_c: value3
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 30,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_a": "v1",
                      "label_b": "v2"
                    },
                    "labels": {
                      "label_c": "v3"
                    }
                  }
                ],
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    },
                    "labels": {
                      "label_c": "value3"
                    }
                  }
                ],
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        clusterSelectors:
        - labels:
            label_c: value3
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --clear-match-clusters
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=cluster_selectors.labels
          method: PATCH
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 30,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_1": "v1",
                      "label_2": "v2"
                    }
                  }
                ],
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --clear-match-clusters --buffer-size-percent 60
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=fleetAutoscalerSettings.bufferSizePercentage%2Ccluster_selectors.labels
          method: PATCH
          headers: {}
          body:
            json:
              fleetAutoscalerSettings:
                bufferSizePercentage: 60.0
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 30,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "fleetAutoscalerSettings": {
                  "bufferSizeAbsolute": 70,
                   "maxReplicas": 100
                },
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_1": "v1",
                      "label_2": "v2"
                    }
                  }
                ],
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "fleetAutoscalerSettings": {
                  "bufferSizePercentage": 60,
                   "maxReplicas": 100
                },
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        createTime: '2019-06-17T17:23:01.872363533Z'
        fleetAutoscalerSettings:
          bufferSizePercentage: 60
          maxReplicas: '100'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --buffer-size-percent 60
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=fleetAutoscalerSettings.bufferSizePercentage
          method: PATCH
          headers: {}
          body:
            json:
              fleetAutoscalerSettings:
                bufferSizePercentage: 60.0
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 30,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "fleetAutoscalerSettings": {
                  "bufferSizeAbsolute": 70,
                   "maxReplicas": 100
                },
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "fleetAutoscalerSettings": {
                  "bufferSizePercentage": 60,
                   "maxReplicas": 100
                },
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        createTime: '2019-06-17T17:23:01.872363533Z'
        fleetAutoscalerSettings:
          bufferSizePercentage: 60
          maxReplicas: '100'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --update-labels "key1=val1"
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
        repeatable: true
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=labels
          method: PATCH
          headers: {}
          body:
            json:
              labels:
                key1: val1
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    }
                  }
                ],
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ],
              "labels": {
                "key1": "val1"
              }
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        clusterSelectors:
        - labels:
            label_a: value1
            label_b: value2
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        labels:
          key1: val1
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --priority 100 --update-labels "key1=val1" --location global
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
        repeatable: true
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=priority%2Clabels
          method: PATCH
          headers: {}
          body:
            json:
              priority: 100
              labels:
                key1: val1
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    }
                  }
                ],
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 100,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ],
              "labels": {
                "key1": "val1"
              }
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        clusterSelectors:
        - labels:
            label_a: value1
            label_b: value2
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        labels:
          key1: val1
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 100
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --clear-labels
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ],
              "labels": {
                "key1": "val1",
                "key2": "val2"
              }
            }
        repeatable: true
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=labels
          method: PATCH
          headers: {}
          body:
            json: {}
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    }
                  }
                ],
                "labels": {
                  "key1": "val1",
                  "key2": "val2"
                },
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ]
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        clusterSelectors:
        - labels:
            label_a: value1
            label_b: value2
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies update my-policy --location global --clear-labels
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ],
              "labels": {
                "key1": "val1",
                "key2": "val2"
              }
            }
        repeatable: true
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json&updateMask=labels
          method: PATCH
          headers: {}
          body:
            json: {}
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:32:20.521003447Z",
                "endTime": "2019-06-17T17:32:20.983129956Z",
                "target": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "verb": "update",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.ScalingPolicy",
                "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
                "createTime": "2019-06-17T17:23:01.872363533Z",
                "updateTime": "2019-06-17T17:32:20.531596844Z",
                "priority": 50,
                "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
                "clusterSelectors": [
                  {
                    "labels": {
                      "label_b": "value2",
                      "label_a": "value1"
                    }
                  }
                ],
                "labels": {
                  "key1": "val1",
                  "key2": "val2"
                },
                "schedules": [
                  {
                    "startTime": "2019-10-01T10:00:00Z",
                    "endTime": "2020-10-01T10:00:00Z",
                    "cronJobDuration": "3600s",
                    "cronSpec": "10 0 1-7 5,12 *"
                  },
                  {
                    "startTime": "2021-09-25T10:11:00Z"
                  }
                ]
              }
            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/global/scalingPolicies/my-policy",
              "createTime": "2019-06-17T17:23:01.872363533Z",
              "updateTime": "2019-06-17T17:32:20.531596844Z",
              "priority": 50,
              "gameServerDeployment": "projects/my-project/locations/global/gameServerDeployments/my-deployment",
              "clusterSelectors": [
                {
                  "labels": {
                    "label_b": "value2",
                    "label_a": "value1"
                  }
                }
              ],
              "schedules": [
                {
                  "startTime": "2019-10-01T10:00:00Z",
                  "endTime": "2020-10-01T10:00:00Z",
                  "cronJobDuration": "3600s",
                  "cronSpec": "10 0 1-7 5,12 *"
                },
                {
                  "startTime": "2021-09-25T10:11:00Z"
                }
              ],
              "labels": {
                "key2": "val2"
              }
            }
    - expect_stderr: |
        Updated scaling policy [my-policy].
    - expect_stdout: |
        clusterSelectors:
        - labels:
            label_a: value1
            label_b: value2
        createTime: '2019-06-17T17:23:01.872363533Z'
        gameServerDeployment: projects/my-project/locations/global/gameServerDeployments/my-deployment
        labels:
          key2: val2
        name: projects/fake-project/locations/global/scalingPolicies/my-policy
        priority: 50
        schedules:
        - cronJobDuration: 3600s
          cronSpec: 10 0 1-7 5,12 *
          endTime: '2020-10-01T10:00:00Z'
          startTime: '2019-10-01T10:00:00Z'
        - startTime: '2021-09-25T10:11:00Z'
        updateTime: '2019-06-17T17:32:20.531596844Z'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies list --location global
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            scalingPolicies:
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-1
              priority: 1
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-2
              priority: 2
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-3
              priority: 3
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-4
              priority: 4
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-5
              priority: 5
    - expect_stdout: |
        NAME         LOCATION  DESCRIPTION  CREATE_TIME  UPDATE_TIME  PRIORITY  DEPLOYMENT  BUFFER_SIZE  BUFFER_SIZE_PERCENT  MIN_REPLICAS  MAX_REPLICAS  MATCH_CLUSTERS  SCHEDULES  LABELS
        my-policy-1  global                                           1
        my-policy-2  global                                           2
        my-policy-3  global                                           3
        my-policy-4  global                                           4
        my-policy-5  global                                           5
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies list
    events:
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/-/scalingPolicies?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            scalingPolicies:
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-1
              priority: 1
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-2
              priority: 2
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-3
              priority: 3
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-4
              priority: 4
            - name: projects/fake-project/locations/global/scalingPolicies/my-policy-5
              priority: 5
    - expect_stdout: |
        NAME         LOCATION  DESCRIPTION  CREATE_TIME  UPDATE_TIME  PRIORITY  DEPLOYMENT  BUFFER_SIZE  BUFFER_SIZE_PERCENT  MIN_REPLICAS  MAX_REPLICAS  MATCH_CLUSTERS  SCHEDULES  LABELS
        my-policy-1  global                                           1
        my-policy-2  global                                           2
        my-policy-3  global                                           3
        my-policy-4  global                                           4
        my-policy-5  global                                           5
    - expect_exit:
        code: 0
- execute_command:
    command: |
      game servers scaling-policies delete my-policy --location global
    events:
    - expect_prompt_continue:
        message: You are about to delete scaling policy [my-policy]
        user_input: y
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project/locations/global/scalingPolicies/my-policy?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "done": true
             }
    - expect_stderr: |
        Delete request issued for: [my-policy]
    - api_call:
        expect_request:
          uri: https://gameservices.googleapis.com/v1alpha/projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/us-central1/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.gaming.v1alpha.OperationMetadata",
                "createTime": "2019-06-17T17:12:16.623096375Z",
                "target": "projects/fake-project/locations/us-central1/scalingPolicies/my-policy",
                "verb": "delete",
                "requestedCancellation": false,
                "apiVersion": "v1alpha"
              },
              "done": true

            }
    - expect_progress_tracker:
        message: Waiting for operation [projects/fake-project0/locations/global/operations/operation-1558742656533-589ab0e56c425-e8213bbe-2096b5aa]
          to complete
        status: SUCCESS
    - expect_stderr: |
        Deleted scaling policy [my-policy].
    - expect_exit:
        code: 0
