title: cloud domains search-domains test scenario
release_tracks: [ALPHA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: |
      domains registrations search-domains example.com
  - stdout: |
      DOMAIN        AVAILABILITY  YEARLY_PRICE  NOTICES
      example.com   UNAVAILABLE
      example.net   UNAVAILABLE
      example.org   UNAVAILABLE
      example.info  AVAILABLE     12.00 USD
      example.app   AVAILABLE     14.00 USD     HSTS_PRELOADED
      music.info    AVAILABLE     12.00 USD
      xmpl.design   AVAILABLE     40.00 USD
- execute:
  - command: |
      domains registrations search-domains ÜniCode
  - stdout: |
      DOMAIN       AVAILABILITY  YEARLY_PRICE  NOTICES
      unicode.com  UNAVAILABLE
      ?nicode.com  AVAILABLE     12.00 USD
- execute:
  - command: |
      domains registrations search-domains registry-down.com
  - stdout: |
      DOMAIN             AVAILABILITY  YEARLY_PRICE  NOTICES
      registry-down.net  UNKNOWN
- execute:
  - command: |
      domains registrations search-domains nothing
  - stdout: |+
      DOMAIN  AVAILABILITY  YEARLY_PRICE  NOTICES

actions:
- execute_command:
    command: |
      domains registrations search-domains example.com
    events:
    - api_call:
        expect_request:
          uri: https://domains.googleapis.com/v1alpha2/projects/fake-project/locations/global/registrations:searchDomains?alt=json&query=example.com
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "registerParameters": [
                {
                  "domainName": "example.com",
                  "availability": "UNAVAILABLE"
                },
                {
                  "domainName": "example.net",
                  "availability": "UNAVAILABLE"
                },
                {
                  "domainName": "example.org",
                  "availability": "UNAVAILABLE"
                },
                {
                  "domainName": "example.info",
                  "availability": "AVAILABLE",
                  "supportedPrivacy": [
                    "PUBLIC_CONTACT_DATA",
                    "REDACTED_CONTACT_DATA",
                    "PRIVATE_CONTACT_DATA"
                  ],
                  "yearlyPrice": {
                    "currencyCode": "USD",
                    "units": "12"
                  }
                },
                {
                  "domainName": "example.app",
                  "availability": "AVAILABLE",
                  "supportedPrivacy": [
                    "REDACTED_CONTACT_DATA",
                    "PRIVATE_CONTACT_DATA"
                  ],
                  "domainNotices": [
                    "HSTS_PRELOADED"
                  ],
                  "yearlyPrice": {
                    "currencyCode": "USD",
                    "units": "14"
                  }
                },
                {
                  "domainName": "music.info",
                  "availability": "AVAILABLE",
                  "supportedPrivacy": [
                    "REDACTED_CONTACT_DATA",
                    "PRIVATE_CONTACT_DATA"
                  ],
                  "yearlyPrice": {
                    "currencyCode": "USD",
                    "units": "12"
                  }
                },
                {
                  "domainName": "xmpl.design",
                  "availability": "AVAILABLE",
                  "supportedPrivacy": [
                    "REDACTED_CONTACT_DATA",
                    "PRIVATE_CONTACT_DATA"
                  ],
                  "yearlyPrice": {
                    "currencyCode": "USD",
                    "units": "40"
                  }
                }
              ]
            }

    - expect_stdout: |
        DOMAIN        AVAILABILITY  YEARLY_PRICE  NOTICES
        example.com   UNAVAILABLE
        example.net   UNAVAILABLE
        example.org   UNAVAILABLE
        example.info  AVAILABLE     12.00 USD
        example.app   AVAILABLE     14.00 USD     HSTS_PRELOADED
        music.info    AVAILABLE     12.00 USD
        xmpl.design   AVAILABLE     40.00 USD
    - expect_exit:
        code: 0
- execute_command:
    command: |
      domains registrations search-domains ÜniCode
    events:
    - api_call:
        expect_request:
          uri: https://domains.googleapis.com/v1alpha2/projects/fake-project/locations/global/registrations:searchDomains?alt=json&query=%C3%9CniCode
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "registerParameters": [
                {
                  "domainName": "unicode.com",
                  "availability": "UNAVAILABLE"
                },
                {
                  "domainName": "xn--nicode-2ya.com",
                  "availability": "AVAILABLE",
                  "supportedPrivacy": [
                    "REDACTED_CONTACT_DATA",
                    "PRIVATE_CONTACT_DATA"
                  ],
                  "yearlyPrice": {
                    "currencyCode": "USD",
                    "units": "12"
                  }
                }
              ]
            }

    - expect_stdout: |
        DOMAIN       AVAILABILITY  YEARLY_PRICE  NOTICES
        unicode.com  UNAVAILABLE
        ?nicode.com  AVAILABLE     12.00 USD
    - expect_exit:
        code: 0
- execute_command:
    command: |
      domains registrations search-domains registry-down.com
    events:
    - api_call:
        expect_request:
          uri: https://domains.googleapis.com/v1alpha2/projects/fake-project/locations/global/registrations:searchDomains?alt=json&query=registry-down.com
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "registerParameters": [
                {
                  "domainName": "registry-down.net",
                  "availability": "UNKNOWN"
                }
              ]
            }

    - expect_stdout: |
        DOMAIN             AVAILABILITY  YEARLY_PRICE  NOTICES
        registry-down.net  UNKNOWN
    - expect_exit:
        code: 0
- execute_command:
    command: |
      domains registrations search-domains nothing
    events:
    - api_call:
        expect_request:
          uri: https://domains.googleapis.com/v1alpha2/projects/fake-project/locations/global/registrations:searchDomains?alt=json&query=nothing
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "registerParameters": [
              ]
            }

    - expect_stdout: |+
        DOMAIN  AVAILABILITY  YEARLY_PRICE  NOTICES

    - expect_exit:
        code: 0
