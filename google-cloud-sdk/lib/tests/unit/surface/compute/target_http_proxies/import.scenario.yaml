title: compute target-http-proxies import tests.
release_tracks: [ALPHA, BETA, GA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- set_property: core/project test-project
- execute:
  - command: compute target-http-proxies import test-target-http-proxy --source='test-target-http-proxy.yaml'
      --global
- execute:
  - command: compute target-http-proxies import regional-test-target-http-proxy --source='regional-test-target-http-proxy.yaml'
      --region=us-central1
actions:
- define_reference:
    reference: api-version
    track_values:
      GA: v1
      BETA: beta
      ALPHA: alpha

- write_file:
    path: test-target-http-proxy.yaml
    contents: |
      name: test-target-http-proxy
      description: This is a test Target Http Proxy
      kind: compute#targetHttpsProxy
      urlMap: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/global/urlMaps/test-url-map

- set_property:
    core/project: test-project

- execute_command:
    command: compute target-http-proxies import test-target-http-proxy --source='test-target-http-proxy.yaml' --global
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/global/targetHttpProxies/test-target-http-proxy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '404'
            body: |
              {
                "error": {
                  "code": "404",
                  "message": "Resource 'projects/test-project/global/targetHttpProxies/test-target-http-proxy' was not found",
                  "status": "NOT_FOUND",
                }
              }
    - api_call:
        poll_operation: true
        expect_request:
          uri: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/global/targetHttpProxies?alt=json
          method: POST
          headers: {}
          body: |
            {
              name: test-target-http-proxy
              description: This is a test Target Http Proxy
              kind: compute#targetHttpsProxy
              urlMap: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/global/urlMaps/test-url-map
              proxyBind: true
            }
        return_response:
          headers:
            status: '200'
          body: |
            {
              "id": "5349501985481528505",
              "name": "operation-1601317462132-5b063c680c630-c80d5556-78e0659b",
              "operationType": "insert",
              "targetLink": "https://www.googleapis.com/compute/$$api-version$$/projects/test-project/global/targetHttpProxies/test-target-http-proxy",
              "targetId": "5275351067333203129",
              "status": "RUNNING",
              "user": "user@google.com",
              "progress": 0,
              "insertTime": "2020-09-28T11:24:22.609-07:00",
              "startTime": "2020-09-28T11:24:22.629-07:00",
              "selfLink": "https://www.googleapis.com/compute/$$api-version$$/projects/test-project/global/operations/operation-1601317462132-5b063c680c630-c80d5556-78e0659b",
              "kind": "compute#operation"
            }
    - expect_exit:
        code: 0
- write_file:
    path: regional-test-target-http-proxy.yaml
    contents: |
      name: test-target-http-proxy
      description: This is a test Regional Target Http Proxy
      kind: compute#targetHttpProxy
      urlMap: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/regions/us-central1/urlMaps/test-url-map

- execute_command:
    command: compute target-http-proxies import regional-test-target-http-proxy --source='regional-test-target-http-proxy.yaml'
      --region=us-central1
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/regions/us-central1/targetHttpProxies/regional-test-target-http-proxy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '404'
            body: |
              {
                "error": {
                  "code": "404",
                  "message": "Resource 'projects/test-project/global/targetHttpProxies/test-target-http-proxy' was not found",
                  "status": "NOT_FOUND",
                }
              }
    - api_call:
        poll_operation: true
        expect_request:
          uri: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/regions/us-central1/targetHttpProxies?alt=json
          method: POST
          headers: {}
          body:
            json:
              description: This is a test Regional Target Http Proxy
              kind: compute#targetHttpProxy
              name: test-target-http-proxy
              urlMap: https://compute.googleapis.com/compute/$$api-version$$/projects/test-project/regions/us-central1/urlMaps/test-url-map
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "id": "5349501985481528505",
              "name": "operation-1601317462132-5b063c680c630-c80d5556-78e0659b",
              "operationType": "insert",
              "targetLink": "https://www.googleapis.com/compute/$$api-version$$/projects/test-project/us-central1/targetHttpProxies/test-target-http-proxy",
              "targetId": "5275351067333203129",
              "status": "RUNNING",
              "user": "user@google.com",
              "progress": 0,
              "insertTime": "2020-09-28T11:24:22.609-07:00",
              "startTime": "2020-09-28T11:24:22.629-07:00",
              "selfLink": "https://www.googleapis.com/compute/$$api-version$$/projects/test-project/us-central1/operations/operation-1601317462132-5b063c680c630-c80d5556-78e0659b",
              "kind": "compute#operation"
            }
    - expect_exit:
        code: 0
