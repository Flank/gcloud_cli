title: secrets describe test
release_tracks: [ALPHA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - label: describe
  - command: secrets describe my-secret
  - stdout: |
      createTime: '2019-06-25T17:43:10.059026374Z'
      name: projects/462803083913/secrets/my-secret
      policy:
        replicaLocations:
        - us-central1
- execute:
  - label: describe with --project
  - command: secrets describe my-secret --project other-project
  - stdout: |
      createTime: '2019-06-25T17:43:10.059026374Z'
      name: projects/1234/secrets/my-secret
      policy:
        replicaLocations:
        - us-central1
- execute:
  - label: describe with full resource name
  - command: secrets describe projects/other-project/secrets/my-secret
  - stdout: |
      createTime: '2019-06-25T17:43:10.059026374Z'
      name: projects/1234/secrets/my-secret
      policy:
        replicaLocations:
        - us-central1
- execute:
  - label: describe with no secret fails
  - command: secrets describe
  - stderr: |
      ERROR: (gcloud.alpha.secrets.describe) argument SECRET: Must be specified.
      Usage: gcloud alpha secrets describe SECRET [optional flags]
        optional flags may be  --help

      For detailed information on this command and its flags, run:
        gcloud alpha secrets describe --help
  - error: '1: argument SECRET: Must be specified.'
actions:
- execute_command:
    label: describe
    command: secrets describe my-secret
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/fake-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/462803083913/secrets/my-secret",
              "policy": {
                "replicaLocations": [
                  "us-central1"
                ]
              },
              "createTime": "2019-06-25T17:43:10.059026374Z"
            }
    - expect_stdout: |
        createTime: '2019-06-25T17:43:10.059026374Z'
        name: projects/462803083913/secrets/my-secret
        policy:
          replicaLocations:
          - us-central1
    - expect_exit:
        code: 0
- execute_command:
    label: describe with --project
    command: secrets describe my-secret --project other-project
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/other-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/1234/secrets/my-secret",
              "policy": {
                "replicaLocations": [
                  "us-central1"
                ]
              },
              "createTime": "2019-06-25T17:43:10.059026374Z"
            }
    - expect_stdout: |
        createTime: '2019-06-25T17:43:10.059026374Z'
        name: projects/1234/secrets/my-secret
        policy:
          replicaLocations:
          - us-central1
    - expect_exit:
        code: 0
- execute_command:
    label: describe with full resource name
    command: secrets describe projects/other-project/secrets/my-secret
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/other-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/1234/secrets/my-secret",
              "policy": {
                "replicaLocations": [
                  "us-central1"
                ]
              },
              "createTime": "2019-06-25T17:43:10.059026374Z"
            }
    - expect_stdout: |
        createTime: '2019-06-25T17:43:10.059026374Z'
        name: projects/1234/secrets/my-secret
        policy:
          replicaLocations:
          - us-central1
    - expect_exit:
        code: 0
- execute_command:
    label: describe with no secret fails
    command: secrets describe
    events:
    - expect_stderr: |
        ERROR: (gcloud.alpha.secrets.describe) argument SECRET: Must be specified.
        Usage: gcloud alpha secrets describe SECRET [optional flags]
          optional flags may be  --help

        For detailed information on this command and its flags, run:
          gcloud alpha secrets describe --help
    - expect_exit:
        code: 1
        message: 'argument SECRET: Must be specified.'
