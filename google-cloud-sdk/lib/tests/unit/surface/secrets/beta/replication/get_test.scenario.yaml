title: secrets beta replication get test
release_tracks: [BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - label: get a non-cmek automatic replication policy
  - command: secrets replication get my-secret
  - stdout: |
      automatic: {}
- execute:
  - label: get a non-cmek user managed replication policy
  - command: secrets replication get my-secret
  - stdout: |
      userManaged:
        replicas:
        - location: us-central1
        - location: us-east1
- execute:
  - label: get a json formatted non-cmek user managed replication policy
  - command: secrets replication get my-secret --format=json
  - stdout: |
      {
        "userManaged": {
          "replicas": [
            {
              "location": "us-central1"
            },
            {
              "location": "us-east1"
            }
          ]
        }
      }
- execute:
  - label: get a json formatted non-cmek user managed replication policy specifying
      a yaml format
  - command: secrets replication get my-secret --format=yaml
  - stdout: |
      userManaged:
        replicas:
        - location: us-central1
        - location: us-east1
- execute:
  - label: get a replication policy for a nonexistent secret
  - command: secrets replication get my-secret
  - error: '1: Invalid value for [secret]: Cannot get replication for secret [my-secret]
      because it does not exist. Please use the create command to create a new secret.'
- execute:
  - label: get a replication policy without passing in a secret
  - command: secrets replication get
  - stderr: |
      ERROR: (gcloud.beta.secrets.replication.get) argument SECRET: Must be specified.
      Usage: gcloud beta secrets replication get SECRET [optional flags]
        optional flags may be  --help

      For detailed information on this command and its flags, run:
        gcloud beta secrets replication get --help
  - error: '1: argument SECRET: Must be specified.'
actions:
- execute_command:
    label: get a non-cmek automatic replication policy
    command: secrets replication get my-secret
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1/projects/fake-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/462803083913/secrets/my-secret",
              "replication": {
                "automatic": {}
              },
              "createTime": "2019-07-09T14:15:37.370737171Z"
            }
    - expect_stdout: |
        automatic: {}
    - expect_exit:
        code: 0
- execute_command:
    label: get a non-cmek user managed replication policy
    command: secrets replication get my-secret
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1/projects/fake-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/462803083913/secrets/my-secret",
              "replication": {
                "userManaged": {
                  "replicas": [
                    {
                      "location":"us-central1"
                    },
                    {
                      "location":"us-east1"
                    }
                  ]
                }
              },
              "createTime": "2019-07-09T14:15:37.370737171Z"
            }
    - expect_stdout: |
        userManaged:
          replicas:
          - location: us-central1
          - location: us-east1
    - expect_exit:
        code: 0
- execute_command:
    label: get a json formatted non-cmek user managed replication policy
    command: secrets replication get my-secret --format=json
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1/projects/fake-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/462803083913/secrets/my-secret",
              "replication": {
                "userManaged": {
                  "replicas": [
                    {
                      "location":"us-central1"
                    },
                    {
                      "location":"us-east1"
                    }
                  ]
                }
              },
              "createTime": "2019-07-09T14:15:37.370737171Z"
            }
    - expect_stdout: |
        {
          "userManaged": {
            "replicas": [
              {
                "location": "us-central1"
              },
              {
                "location": "us-east1"
              }
            ]
          }
        }
    - expect_exit:
        code: 0
- execute_command:
    label: get a json formatted non-cmek user managed replication policy specifying
      a yaml format
    command: secrets replication get my-secret --format=yaml
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1/projects/fake-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/462803083913/secrets/my-secret",
              "replication": {
                "userManaged": {
                  "replicas": [
                    {
                      "location":"us-central1"
                    },
                    {
                      "location":"us-east1"
                    }
                  ]
                }
              },
              "createTime": "2019-07-09T14:15:37.370737171Z"
            }
    - expect_stdout: |
        userManaged:
          replicas:
          - location: us-central1
          - location: us-east1
    - expect_exit:
        code: 0
- execute_command:
    label: get a replication policy for a nonexistent secret
    command: secrets replication get my-secret
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1/projects/fake-project/secrets/my-secret?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '404'
          body: null
    - expect_exit:
        code: 1
        message: 'Invalid value for [secret]: Cannot get replication for secret [my-secret]
          because it does not exist. Please use the create command to create a new
          secret.'
- execute_command:
    label: get a replication policy without passing in a secret
    command: secrets replication get
    events:
    - expect_stderr: |
        ERROR: (gcloud.beta.secrets.replication.get) argument SECRET: Must be specified.
        Usage: gcloud beta secrets replication get SECRET [optional flags]
          optional flags may be  --help

        For detailed information on this command and its flags, run:
          gcloud beta secrets replication get --help
    - expect_exit:
        code: 1
        message: 'argument SECRET: Must be specified.'
