title: cloud recaptcha create key test scenario
release_tracks: [ALPHA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: |
      recaptcha keys create --labels=foo=bar --display-name=testkey --web --domains=test.com.mx --integration-type=score --security-preference=security
  - stderr: |
      Created.
- execute:
  - command: |
      recaptcha keys create --display-name=testkey --web --domains=test.com.mx --integration-type=score --security-preference=balance
  - stderr: |
      Created.
- execute:
  - command: |
      recaptcha keys create --display-name=testkey --web --domains=test.com.mx --integration-type=score --security-preference=usability
  - stderr: |
      Created.
- execute:
  - command: |
      recaptcha keys create --display-name=testkey --web --domains=test.com.mx --integration-type=invisible --security-preference=usability
  - stderr: |
      Created.
- execute:
  - command: |
      recaptcha keys create --display-name=testkey --ios --bundle-ids=com.test.app.v1
  - stderr: |
      Created.
- execute:
  - command: |
      recaptcha keys create --display-name=testkey --android --package-names=com.test.app.v1
  - stderr: |
      Created.
- execute:
  - command: |
      recaptcha keys create --labels=foo=bar --display-name=testkey --web --allow-all-domains --allow-amp-traffic --integration-type=score --security-preference=security
  - stderr: |
      Created.
actions:
- execute_command:
    command: |
      recaptcha keys create --labels=foo=bar --display-name=testkey --web --domains=test.com.mx --integration-type=score --security-preference=security
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/fake-project?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            projectNumber: '123456789'
            projectId: fake-project
            lifecycleState: ACTIVE
            name: Fake Project
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'
    - api_call:
        expect_request:
          uri: https://recaptchaenterprise.googleapis.com/v1/projects/123456789/keys?alt=json
          method: POST
          headers: {}
          body:
            json:
              displayName: testkey
              labels:
                foo: bar
              webSettings:
                allowedDomains:
                - test.com.mx
                challengeSecurityPreference: SECURITY
                integrationType: SCORE
        return_response:
          headers:
            status: '200'
          body:
            json:
              displayName: testkey
              labels:
                foo: bar
              webSettings:
                allowedDomains:
                - test.com.mx
                challengeSecurityPreference: SECURITY
                integrationType: SCORE
    - expect_stderr: |
        Created.
    - expect_exit:
        code: 0
- execute_command:
    command: |
      recaptcha keys create --display-name=testkey --web --domains=test.com.mx --integration-type=score --security-preference=balance
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/fake-project?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            projectNumber: '123456789'
            projectId: fake-project
            lifecycleState: ACTIVE
            name: Fake Project
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'

    - api_call:
        expect_request:
          uri: https://recaptchaenterprise.googleapis.com/v1/projects/123456789/keys?alt=json
          method: POST
          headers: {}
          body:
            json:
              displayName: testkey
              webSettings:
                allowedDomains:
                - test.com.mx
                integrationType: SCORE
                challengeSecurityPreference: BALANCE
        return_response:
          headers:
            status: '200'
          body:
            json:
              name: projects/123456789/keys/testKey
              displayName: testkey
              webSettings:
                allowedDomains:
                - test.com.mx
                integrationType: SCORE
                challengeSecurityPreference: BALANCE
    - expect_stderr: |
        Created.
    - expect_exit:
        code: 0
- execute_command:
    command: |
      recaptcha keys create --display-name=testkey --web --domains=test.com.mx --integration-type=score --security-preference=usability
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/fake-project?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            projectNumber: '123456789'
            projectId: fake-project
            lifecycleState: ACTIVE
            name: Fake Project
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'

    - api_call:
        expect_request:
          uri: https://recaptchaenterprise.googleapis.com/v1/projects/123456789/keys?alt=json
          method: POST
          headers: {}
          body:
            json:
              displayName: testkey
              webSettings:
                allowedDomains:
                - test.com.mx
                integrationType: SCORE
                challengeSecurityPreference: USABILITY
        return_response:
          headers:
            status: '200'
          body:
            json:
              name: projects/123456789/keys/testKey
              displayName: testkey
              webSettings:
                allowedDomains:
                - test.com.mx
                integrationType: SCORE
                challengeSecurityPreference: USABILITY
    - expect_stderr: |
        Created.
    - expect_exit:
        code: 0
- execute_command:
    command: |
      recaptcha keys create --display-name=testkey --web --domains=test.com.mx --integration-type=invisible --security-preference=usability
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/fake-project?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            projectNumber: '123456789'
            projectId: fake-project
            lifecycleState: ACTIVE
            name: Fake Project
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'

    - api_call:
        expect_request:
          uri: https://recaptchaenterprise.googleapis.com/v1/projects/123456789/keys?alt=json
          method: POST
          headers: {}
          body:
            json:
              displayName: testkey
              webSettings:
                allowedDomains:
                - test.com.mx
                integrationType: INVISIBLE
                challengeSecurityPreference: USABILITY
        return_response:
          headers:
            status: '200'
          body:
            json:
              name: projects/123456789/keys/testKey
              displayName: testkey
              webSettings:
                allowedDomains:
                - test.com.mx
                integrationType: INVISIBLE
                challengeSecurityPreference: USABILITY
    - expect_stderr: |
        Created.
    - expect_exit:
        code: 0
- execute_command:
    command: |
      recaptcha keys create --display-name=testkey --ios --bundle-ids=com.test.app.v1
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/fake-project?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            projectNumber: '123456789'
            projectId: fake-project
            lifecycleState: ACTIVE
            name: Fake Project
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'

    - api_call:
        expect_request:
          uri: https://recaptchaenterprise.googleapis.com/v1/projects/123456789/keys?alt=json
          method: POST
          headers: {}
          body:
            json:
              displayName: testkey
              iosSettings:
                allowedBundleIds:
                - com.test.app.v1
        return_response:
          headers:
            status: '200'
          body:
            json:
              name: projects/123456789/keys/testKey
              displayName: testkey
              iosSettings:
                allowedBundleIds:
                - com.test.app.v1
    - expect_stderr: |
        Created.
    - expect_exit:
        code: 0
- execute_command:
    command: |
      recaptcha keys create --display-name=testkey --android --package-names=com.test.app.v1
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/fake-project?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            projectNumber: '123456789'
            projectId: fake-project
            lifecycleState: ACTIVE
            name: Fake Project
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'

    - api_call:
        expect_request:
          uri: https://recaptchaenterprise.googleapis.com/v1/projects/123456789/keys?alt=json
          method: POST
          headers: {}
          body:
            json:
              displayName: testkey
              androidSettings:
                allowedPackageNames:
                - com.test.app.v1
        return_response:
          headers:
            status: '200'
          body:
            json:
              name: projects/123456789/keys/testKey
              displayName: testkey
              androidSettings:
                allowedPackageNames:
                - com.test.app.v1
    - expect_stderr: |
        Created.
    - expect_exit:
        code: 0
- execute_command:
    command: |
      recaptcha keys create --labels=foo=bar --display-name=testkey --web --allow-all-domains --allow-amp-traffic --integration-type=score --security-preference=security
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/fake-project?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            projectNumber: '123456789'
            projectId: fake-project
            lifecycleState: ACTIVE
            name: Fake Project
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'
    - api_call:
        expect_request:
          uri: https://recaptchaenterprise.googleapis.com/v1/projects/123456789/keys?alt=json
          method: POST
          headers: {}
          body:
            json:
              displayName: testkey
              labels:
                foo: bar
              webSettings:
                allowAmpTraffic: true
                challengeSecurityPreference: SECURITY
                integrationType: SCORE
        return_response:
          headers:
            status: '200'
          body:
            json:
              displayName: testkey
              labels:
                foo: bar
              webSettings:
                allowAllDomains: true
                allowAmpTraffic: true
                challengeSecurityPreference: SECURITY
                integrationType: SCORE
    - expect_stderr: |
        Created.
    - expect_exit:
        code: 0
