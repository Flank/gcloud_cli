title: database-migration migration-jobs promote scenario test.
release_tracks: [ALPHA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: database-migration migration-jobs promote test-job --region=us-central1
  - stdout: |
      done: true
      metadata:
        '@type': type.googleapis.com/google.cloud.clouddms.v1alpha2.OperationMetadata
        apiVersion: v1alpha2
        createTime: '2020-08-28T15:22:13.652238849Z'
        endTime: '2020-08-28T15:22:45.406958245Z'
        requestedCancellation: false
        target: projects/fake-project/locations/us-central1/migrationJobs/test-job
        verb: promote
      name: projects/fake-project/locations/us-central1/operations/operation-1598628133554-5adf19e074914-455c0890-0ff22644
      response:
        '@type': type.googleapis.com/google.cloud.clouddms.v1alpha2.MigrationJob
        createTime: '2020-08-28T15:03:29.837678798Z'
        destination: projects/fake-project/locations/us-central1/connectionProfiles/fake-dest
        destinationDatabase:
          provider: CLOUDSQL
        displayName: test-job
        endTime: '2020-08-28T15:22:45Z'
        name: projects/fake-project/locations/us-central1/migrationJobs/test-job
        source: projects/fake-project/locations/us-central1/connectionProfiles/fake-source
        sourceDatabase:
          engine: MYSQL
          provider: CLOUDSQL
        state: COMPLETED
        type: ONE_TIME
        updateTime: '2020-08-28T15:22:13.658370830Z'
        vpcPeeringConnectivity:
          vpc: projects/fake-project/global/networks/fake-vpc
actions:
- execute_command:
    command: database-migration migration-jobs promote test-job --region=us-central1
    events:
    - api_call:
        expect_request:
          uri: https://datamigration.googleapis.com/v1alpha2/projects/fake-project/locations/us-central1/migrationJobs/test-job:promote?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: |
            {
              "name": "projects/fake-project/locations/us-central1/operations/operation-1598628133554-5adf19e074914-455c0890-0ff22644",
              "metadata": {
                "@type": "type.googleapis.com/google.cloud.clouddms.v1alpha2.OperationMetadata",
                "createTime": "2020-08-28T15:22:13.652238849Z",
                "endTime": "2020-08-28T15:22:45.406958245Z",
                "target": "projects/fake-project/locations/us-central1/migrationJobs/test-job",
                "verb": "promote",
                "requestedCancellation": false,
                "apiVersion": "v1alpha2"
              },
              "done": true,
              "response": {
                "@type": "type.googleapis.com/google.cloud.clouddms.v1alpha2.MigrationJob",
                "name": "projects/fake-project/locations/us-central1/migrationJobs/test-job",
                "createTime": "2020-08-28T15:03:29.837678798Z",
                "updateTime": "2020-08-28T15:22:13.658370830Z",
                "displayName": "test-job",
                "state": "COMPLETED",
                "type": "ONE_TIME",
                "source": "projects/fake-project/locations/us-central1/connectionProfiles/fake-source",
                "destination": "projects/fake-project/locations/us-central1/connectionProfiles/fake-dest",
                "sourceDatabase": {
                  "provider": "CLOUDSQL",
                  "engine": "MYSQL"
                },
                "destinationDatabase": {
                  "provider": "CLOUDSQL"
                },
                "endTime": "2020-08-28T15:22:45Z",
                "vpcPeeringConnectivity": {
                  "vpc": "projects/fake-project/global/networks/fake-vpc"
                }
              }
            }
    - expect_stdout: |
        done: true
        metadata:
          '@type': type.googleapis.com/google.cloud.clouddms.v1alpha2.OperationMetadata
          apiVersion: v1alpha2
          createTime: '2020-08-28T15:22:13.652238849Z'
          endTime: '2020-08-28T15:22:45.406958245Z'
          requestedCancellation: false
          target: projects/fake-project/locations/us-central1/migrationJobs/test-job
          verb: promote
        name: projects/fake-project/locations/us-central1/operations/operation-1598628133554-5adf19e074914-455c0890-0ff22644
        response:
          '@type': type.googleapis.com/google.cloud.clouddms.v1alpha2.MigrationJob
          createTime: '2020-08-28T15:03:29.837678798Z'
          destination: projects/fake-project/locations/us-central1/connectionProfiles/fake-dest
          destinationDatabase:
            provider: CLOUDSQL
          displayName: test-job
          endTime: '2020-08-28T15:22:45Z'
          name: projects/fake-project/locations/us-central1/migrationJobs/test-job
          source: projects/fake-project/locations/us-central1/connectionProfiles/fake-source
          sourceDatabase:
            engine: MYSQL
            provider: CLOUDSQL
          state: COMPLETED
          type: ONE_TIME
          updateTime: '2020-08-28T15:22:13.658370830Z'
          vpcPeeringConnectivity:
            vpc: projects/fake-project/global/networks/fake-vpc
    - expect_exit:
        code: 0
