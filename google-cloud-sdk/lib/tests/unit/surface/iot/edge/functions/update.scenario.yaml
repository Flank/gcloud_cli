title: cloud iot edge functions update test scenario
release_tracks: [ALPHA]
description: tests full Edge Container creation
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - label: Base case
  - command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --source gcr.io/cloud-iot-edge/samples/ml-camera-python:armhf
  - stderr: |
      Updated function [foo].
  - stdout: |
      dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:armhf
      functionType: ON_DEMAND
      inputTopics:
      - topic: /function/foo/input
      name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
      outputTopics:
      - topic: /function/foo/output
      requestTimeout: 540s
      updateTime: '2019-03-03T12:42:32.400213831Z'
      version: '2'
- execute:
  - label: Full update
  - command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --source gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
      --env-vars KEY1=VALUE1,KEY2=VALUE2,KEY3=VALUE3 --input-topic foo:input/topic/1,bar:input/topic2 --output-topic foo:output/topic/1,bar:output/topic2
      --device-binding /dev/video0:/dev/video1,/dev/gpio/1:r --volume-binding /tmp:ro,/tmp/data:/data --description "edge function"
      --memory 1GB
  - stderr: |
      Updated function [foo].
  - stdout: |
      availableMemoryMb: 1024
      description: edge function
      deviceBindings:
      - cgroupPermissions: rwm
        destination: /dev/video1
        source: /dev/video0
      - cgroupPermissions: r
        destination: /dev/gpio/1
        source: /dev/gpio/1
      dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
      environmentVariables:
        KEY1: VALUE1
        KEY2: VALUE2
        KEY3: VALUE3
      functionType: ON_DEMAND
      inputTopics:
      - topic: /function/foo/input
      - id: foo
        topic: input/topic/1
      - id: bar
        topic: input/topic2
      name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
      outputTopics:
      - topic: /function/foo/output
      - id: foo
        topic: output/topic/1
      - id: bar
        topic: output/topic2
      requestTimeout: 540s
      updateTime: '2019-03-03T12:45:13.424999839Z'
      version: '3'
      volumeBindings:
      - destination: /tmp
        readOnly: true
        source: /tmp
      - destination: /data
        source: /tmp/data
- execute:
  - label: Clear env vars
  - command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --clear-env-vars
  - stderr: |
      Updated function [foo].
  - stdout: |
      availableMemoryMb: 1024
      description: edge function
      deviceBindings:
      - cgroupPermissions: rwm
        destination: /dev/video1
        source: /dev/video0
      - cgroupPermissions: r
        destination: /dev/gpio/1
        source: /dev/gpio/1
      dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
      functionType: ON_DEMAND
      inputTopics:
      - topic: /function/foo/input
      - id: foo
        topic: input/topic/1
      - id: bar
        topic: input/topic2
      name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
      outputTopics:
      - topic: /function/foo/output
      - id: foo
        topic: output/topic/1
      - id: bar
        topic: output/topic2
      requestTimeout: 540s
      updateTime: '2019-03-03T12:46:13.082837606Z'
      version: '4'
      volumeBindings:
      - destination: /tmp
        readOnly: true
        source: /tmp
      - destination: /data
        source: /tmp/data
- execute:
  - label: Remove and update env vars
  - command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --remove-env-vars KEY1,KEY2 --update-env-vars KEY1=NEW_VALUE,KEY4=FOO
  - stderr: |
      Updated function [foo].
  - stdout: |
      availableMemoryMb: 1024
      description: edge function
      deviceBindings:
      - cgroupPermissions: rwm
        destination: /dev/video1
        source: /dev/video0
      - cgroupPermissions: r
        destination: /dev/gpio/1
        source: /dev/gpio/1
      dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
      environmentVariables:
        KEY1: NEW_VALUE
        KEY3: VALUE3
        KEY4: FOO
      functionType: ON_DEMAND
      inputTopics:
      - topic: /function/foo/input
      - id: foo
        topic: input/topic/1
      - id: bar
        topic: input/topic2
      name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
      outputTopics:
      - topic: /function/foo/output
      - id: foo
        topic: output/topic/1
      - id: bar
        topic: output/topic2
      requestTimeout: 540s
      updateTime: '2019-03-03T12:57:47.615063197Z'
      version: '7'
      volumeBindings:
      - destination: /tmp
        readOnly: true
        source: /tmp
      - destination: /data
        source: /tmp/data
actions:
- execute_command:
    label: Base case
    command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --source gcr.io/cloud-iot-edge/samples/ml-camera-python:armhf
    events:
    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64",
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:42:11.985538108Z",
              "version": "1"
            }
    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json&updateMask=dockerImageUri
          method: PATCH
          headers: {}
          body:
            json:
              dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:armhf
              functionType: ON_DEMAND
              inputTopics:
              - topic: /function/foo/input
              - topic: /function/foo/input
              outputTopics:
              - topic: /function/foo/output
              - topic: /function/foo/output
              requestTimeout: 540s
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:armhf",
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:42:32.400213831Z",
              "version": "2"
            }
    - expect_stderr: |
        Updated function [foo].
    - expect_stdout: |
        dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:armhf
        functionType: ON_DEMAND
        inputTopics:
        - topic: /function/foo/input
        name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
        outputTopics:
        - topic: /function/foo/output
        requestTimeout: 540s
        updateTime: '2019-03-03T12:42:32.400213831Z'
        version: '2'
    - expect_exit:
        code: 0
- execute_command:
    label: Full update
    command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --source gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
      --env-vars KEY1=VALUE1,KEY2=VALUE2,KEY3=VALUE3 --input-topic foo:input/topic/1,bar:input/topic2 --output-topic foo:output/topic/1,bar:output/topic2
      --device-binding /dev/video0:/dev/video1,/dev/gpio/1:r --volume-binding /tmp:ro,/tmp/data:/data --description "edge function"
      --memory 1GB
    events:
    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:armhf",
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:42:32.400213831Z",
              "version": "2"
            }
    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json&updateMask=description%2CdeviceBindings%2CenvironmentVariables%2CinputTopics%2CavailableMemoryMb%2CoutputTopics%2CdockerImageUri%2CvolumeBindings
          method: PATCH
          headers: {}
          body:
            json:
              availableMemoryMb: 1024
              description: edge function
              deviceBindings:
              - cgroupPermissions: rwm
                destination: /dev/video1
                source: /dev/video0
              - cgroupPermissions: r
                destination: /dev/gpio/1
                source: /dev/gpio/1
              dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
              environmentVariables:
                KEY1: VALUE1
                KEY2: VALUE2
                KEY3: VALUE3
              functionType: ON_DEMAND
              inputTopics:
              - topic: /function/foo/input
              - id: foo
                topic: input/topic/1
              - id: bar
                topic: input/topic2
              name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
              outputTopics:
              - topic: /function/foo/output
              - id: foo
                topic: output/topic/1
              - id: bar
                topic: output/topic2
              requestTimeout: 540s
              updateTime: '2019-03-03T12:42:32.400213831Z'
              version: '2'
              volumeBindings:
              - destination: /tmp
                readOnly: true
                source: /tmp
              - destination: /data
                readOnly: false
                source: /tmp/data
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "description": "edge function",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64",
              "environmentVariables": {
                "KEY3": "VALUE3",
                "KEY2": "VALUE2",
                "KEY1": "VALUE1"
              },
              "availableMemoryMb": 1024,
              "volumeBindings": [
                {
                  "source": "/tmp",
                  "destination": "/tmp",
                  "readOnly": true
                },
                {
                  "source": "/tmp/data",
                  "destination": "/data"
                }
              ],
              "deviceBindings": [
                {
                  "source": "/dev/video0",
                  "destination": "/dev/video1",
                  "cgroupPermissions": "rwm"
                },
                {
                  "source": "/dev/gpio/1",
                  "destination": "/dev/gpio/1",
                  "cgroupPermissions": "r"
                }
              ],
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                },
                {
                  "topic": "input/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "input/topic2",
                  "id": "bar"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                },
                {
                  "topic": "output/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "output/topic2",
                  "id": "bar"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:45:13.424999839Z",
              "version": "3"
            }


    - expect_stderr: |
        Updated function [foo].
    - expect_stdout: |
        availableMemoryMb: 1024
        description: edge function
        deviceBindings:
        - cgroupPermissions: rwm
          destination: /dev/video1
          source: /dev/video0
        - cgroupPermissions: r
          destination: /dev/gpio/1
          source: /dev/gpio/1
        dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
        environmentVariables:
          KEY1: VALUE1
          KEY2: VALUE2
          KEY3: VALUE3
        functionType: ON_DEMAND
        inputTopics:
        - topic: /function/foo/input
        - id: foo
          topic: input/topic/1
        - id: bar
          topic: input/topic2
        name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
        outputTopics:
        - topic: /function/foo/output
        - id: foo
          topic: output/topic/1
        - id: bar
          topic: output/topic2
        requestTimeout: 540s
        updateTime: '2019-03-03T12:45:13.424999839Z'
        version: '3'
        volumeBindings:
        - destination: /tmp
          readOnly: true
          source: /tmp
        - destination: /data
          source: /tmp/data
    - expect_exit:
        code: 0
- execute_command:
    label: Clear env vars
    command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --clear-env-vars
    events:
    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "description": "edge function",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64",
              "environmentVariables": {
                "KEY3": "VALUE3",
                "KEY2": "VALUE2",
                "KEY1": "VALUE1"
              },
              "availableMemoryMb": 1024,
              "volumeBindings": [
                {
                  "source": "/tmp",
                  "destination": "/tmp",
                  "readOnly": true
                },
                {
                  "source": "/tmp/data",
                  "destination": "/data"
                }
              ],
              "deviceBindings": [
                {
                  "source": "/dev/video0",
                  "destination": "/dev/video1",
                  "cgroupPermissions": "rwm"
                },
                {
                  "source": "/dev/gpio/1",
                  "destination": "/dev/gpio/1",
                  "cgroupPermissions": "r"
                }
              ],
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                },
                {
                  "topic": "input/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "input/topic2",
                  "id": "bar"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                },
                {
                  "topic": "output/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "output/topic2",
                  "id": "bar"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:45:13.424999839Z",
              "version": "3"
            }

    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json&updateMask=environmentVariables
          method: PATCH
          headers: {}
          body:
            json:
              availableMemoryMb: 1024
              description: edge function
              deviceBindings:
              - cgroupPermissions: rwm
                destination: /dev/video1
                source: /dev/video0
              - cgroupPermissions: r
                destination: /dev/gpio/1
                source: /dev/gpio/1
              dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
              environmentVariables: {}
              functionType: ON_DEMAND
              inputTopics:
              - topic: /function/foo/input
              - topic: /function/foo/input
              - id: foo
                topic: input/topic/1
              - id: bar
                topic: input/topic2
              name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
              outputTopics:
              - topic: /function/foo/output
              - topic: /function/foo/output
              - id: foo
                topic: output/topic/1
              - id: bar
                topic: output/topic2
              requestTimeout: 540s
              updateTime: '2019-03-03T12:45:13.424999839Z'
              version: '3'
              volumeBindings:
              - destination: /tmp
                readOnly: true
                source: /tmp
              - destination: /data
                source: /tmp/data
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "description": "edge function",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64",
              "availableMemoryMb": 1024,
              "volumeBindings": [
                {
                  "source": "/tmp",
                  "destination": "/tmp",
                  "readOnly": true
                },
                {
                  "source": "/tmp/data",
                  "destination": "/data"
                }
              ],
              "deviceBindings": [
                {
                  "source": "/dev/video0",
                  "destination": "/dev/video1",
                  "cgroupPermissions": "rwm"
                },
                {
                  "source": "/dev/gpio/1",
                  "destination": "/dev/gpio/1",
                  "cgroupPermissions": "r"
                }
              ],
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                },
                {
                  "topic": "input/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "input/topic2",
                  "id": "bar"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                },
                {
                  "topic": "output/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "output/topic2",
                  "id": "bar"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:46:13.082837606Z",
              "version": "4"
            }
    - expect_stderr: |
        Updated function [foo].
    - expect_stdout: |
        availableMemoryMb: 1024
        description: edge function
        deviceBindings:
        - cgroupPermissions: rwm
          destination: /dev/video1
          source: /dev/video0
        - cgroupPermissions: r
          destination: /dev/gpio/1
          source: /dev/gpio/1
        dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
        functionType: ON_DEMAND
        inputTopics:
        - topic: /function/foo/input
        - id: foo
          topic: input/topic/1
        - id: bar
          topic: input/topic2
        name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
        outputTopics:
        - topic: /function/foo/output
        - id: foo
          topic: output/topic/1
        - id: bar
          topic: output/topic2
        requestTimeout: 540s
        updateTime: '2019-03-03T12:46:13.082837606Z'
        version: '4'
        volumeBindings:
        - destination: /tmp
          readOnly: true
          source: /tmp
        - destination: /data
          source: /tmp/data
    - expect_exit:
        code: 0
- execute_command:
    label: Remove and update env vars
    command: |
      iot edge functions update foo --region asia-east1 --registry my-registry --device my-device --remove-env-vars KEY1,KEY2 --update-env-vars KEY1=NEW_VALUE,KEY4=FOO
    events:
    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "description": "edge function",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64",
              "environmentVariables": {
                "KEY3": "VALUE3",
                "KEY2": "VALUE2",
                "KEY1": "VALUE1"
              },
              "availableMemoryMb": 1024,
              "volumeBindings": [
                {
                  "source": "/tmp",
                  "destination": "/tmp",
                  "readOnly": true
                },
                {
                  "source": "/tmp/data",
                  "destination": "/data"
                }
              ],
              "deviceBindings": [
                {
                  "source": "/dev/video0",
                  "destination": "/dev/video1",
                  "cgroupPermissions": "rwm"
                },
                {
                  "source": "/dev/gpio/1",
                  "destination": "/dev/gpio/1",
                  "cgroupPermissions": "r"
                }
              ],
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                },
                {
                  "topic": "input/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "input/topic2",
                  "id": "bar"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                },
                {
                  "topic": "output/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "output/topic2",
                  "id": "bar"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:57:38.549252483Z",
              "version": "6"
            }


    - api_call:
        expect_request:
          uri: https://edge.googleapis.com/v1alpha1/projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo?alt=json&updateMask=environmentVariables
          method: PATCH
          headers: {}
          body:
            json:
              availableMemoryMb: 1024
              description: edge function
              deviceBindings:
              - cgroupPermissions: rwm
                destination: /dev/video1
                source: /dev/video0
              - cgroupPermissions: r
                destination: /dev/gpio/1
                source: /dev/gpio/1
              dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
              environmentVariables:
                KEY1: NEW_VALUE
                KEY3: VALUE3
                KEY4: FOO
              functionType: ON_DEMAND
              inputTopics:
              - topic: /function/foo/input
              - topic: /function/foo/input
              - id: foo
                topic: input/topic/1
              - id: bar
                topic: input/topic2
              name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
              outputTopics:
              - topic: /function/foo/output
              - topic: /function/foo/output
              - id: foo
                topic: output/topic/1
              - id: bar
                topic: output/topic2
              requestTimeout: 540s
              updateTime: '2019-03-03T12:57:38.549252483Z'
              version: '6'
              volumeBindings:
              - destination: /tmp
                readOnly: true
                source: /tmp
              - destination: /data
                source: /tmp/data
        return_response:
          headers:
            status: '200'
          body: |
            {
              "name": "projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo",
              "description": "edge function",
              "dockerImageUri": "gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64",
              "environmentVariables": {
                "KEY3": "VALUE3",
                "KEY4": "FOO",
                "KEY1": "NEW_VALUE"
              },
              "availableMemoryMb": 1024,
              "volumeBindings": [
                {
                  "source": "/tmp",
                  "destination": "/tmp",
                  "readOnly": true
                },
                {
                  "source": "/tmp/data",
                  "destination": "/data"
                }
              ],
              "deviceBindings": [
                {
                  "source": "/dev/video0",
                  "destination": "/dev/video1",
                  "cgroupPermissions": "rwm"
                },
                {
                  "source": "/dev/gpio/1",
                  "destination": "/dev/gpio/1",
                  "cgroupPermissions": "r"
                }
              ],
              "inputTopics": [
                {
                  "topic": "/function/foo/input"
                },
                {
                  "topic": "input/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "input/topic2",
                  "id": "bar"
                }
              ],
              "outputTopics": [
                {
                  "topic": "/function/foo/output"
                },
                {
                  "topic": "output/topic/1",
                  "id": "foo"
                },
                {
                  "topic": "output/topic2",
                  "id": "bar"
                }
              ],
              "functionType": "ON_DEMAND",
              "requestTimeout": "540s",
              "updateTime": "2019-03-03T12:57:47.615063197Z",
              "version": "7"
            }
    - expect_stderr: |
        Updated function [foo].
    - expect_stdout: |
        availableMemoryMb: 1024
        description: edge function
        deviceBindings:
        - cgroupPermissions: rwm
          destination: /dev/video1
          source: /dev/video0
        - cgroupPermissions: r
          destination: /dev/gpio/1
          source: /dev/gpio/1
        dockerImageUri: gcr.io/cloud-iot-edge/samples/ml-camera-python:x86_64
        environmentVariables:
          KEY1: NEW_VALUE
          KEY3: VALUE3
          KEY4: FOO
        functionType: ON_DEMAND
        inputTopics:
        - topic: /function/foo/input
        - id: foo
          topic: input/topic/1
        - id: bar
          topic: input/topic2
        name: projects/fake-project/locations/asia-east1/registries/my-registry/devices/my-device/functions/foo
        outputTopics:
        - topic: /function/foo/output
        - id: foo
          topic: output/topic/1
        - id: bar
          topic: output/topic2
        requestTimeout: 540s
        updateTime: '2019-03-03T12:57:47.615063197Z'
        version: '7'
        volumeBindings:
        - destination: /tmp
          readOnly: true
          source: /tmp
        - destination: /data
          source: /tmp/data
    - expect_exit:
        code: 0
