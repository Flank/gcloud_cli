title: spanner operations list test
release_tracks: [GA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - label: List operations with no results
  - command: spanner operations list --instance=test-instance
  - stderr: |
      Listed 0 items.
- execute:
  - label: List instance operations
  - command: spanner operations list --instance=test-instance
  - stdout: |
      OPERATION_ID      STATEMENTS  DONE   @TYPE
      bbe68c05fd6ec0af              False  CreateInstanceMetadata
- execute:
  - label: List database operations
  - command: spanner operations list --instance=test-instance --database=test-database
  - stdout: |
      OPERATION_ID               STATEMENTS                           DONE   @TYPE
      _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64  False  UpdateDatabaseDdlMetadata
      _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                  True   UpdateDatabaseDdlMetadata
                                   a INT64,
                                   b INT64,
                                   c INT64,
                                 ) PRIMARY KEY(a)
- execute:
  - label: List all backup operations for given instance
  - command: spanner operations list --instance=test-instance --type=BACKUP
  - stdout: |
      OPERATION_ID               DONE   @TYPE                 BACKUP         SOURCE_DATABASE  START_TIME                   END_TIME
      _auto_op_52d1df14a15ed86d  False  CreateBackupMetadata  test-backup0   test-database    2020-02-13T16:37:11.348462Z
      _auto_op_3dc1c2b33738c7cb  True   CreateBackupMetadata  test-backup14  test-database    2020-02-12T16:55:14.989469Z  2020-02-12T16:57:28.162651Z
      _auto_op_da00c3d035b5e6c0  True   CreateBackupMetadata  test-backup13  test-database    2020-02-12T16:37:23.189930Z  2020-02-12T16:40:33.171305Z
      _auto_op_cc199b8f43cabc58  True   CreateBackupMetadata  test-backup    test-database    2020-02-11T20:30:26.504913Z  2020-02-11T20:33:03.249201Z
      _auto_op_30cd280a71b70f1c  True   CreateBackupMetadata  test123        test-database3   2020-02-11T20:17:51.088047Z  2020-02-11T20:20:14.412660Z
      _auto_op_32de6d9d230d9f5d  True   CreateBackupMetadata  test-backup1   test-database2   2020-02-07T20:41:56.271289Z  2020-02-07T20:45:05.918358Z
- execute:
  - label: List all backup operations for given database
  - command: spanner operations list --instance=test-instance --database=test-database
      --type=BACKUP
  - stdout: |
      OPERATION_ID               DONE  @TYPE                 BACKUP   SOURCE_DATABASE  START_TIME                   END_TIME
      _auto_op_30cd280a71b70f1c  True  CreateBackupMetadata  test123  test-database    2020-02-11T20:17:51.088047Z  2020-02-11T20:20:14.412660Z
      _auto_op_9723dc48a1904f04  True  CreateBackupMetadata  test09   test-database    2020-02-07T20:02:36.699241Z  2020-02-07T20:03:38.266867Z
- execute:
  - label: List all restore operations for given instance
  - command: spanner operations list --instance=test-instance --type=DATABASE_RESTORE
  - stdout: |
      OPERATION_ID               DONE   @TYPE                             RESTORED_DATABASE  SOURCE_BACKUP  START_TIME                   END_TIME
      _auto_op_4d4f0c46edfaa926  False  RestoreDatabaseMetadata           restore-test13     test-backup0   2020-02-13T16:54:30.611532Z
      _auto_op_135ddb7caafb9623  True   OptimizeRestoredDatabaseMetadata  restored-db                       2020-02-12T20:32:17.208912Z  2020-02-12T20:32:59.787763Z
      _auto_op_49a13a3a7cc9bd68  True   RestoreDatabaseMetadata           restored-db        test-backup5   2020-02-12T20:25:04.536870Z  2020-02-12T20:32:17.208912Z
- execute:
  - label: List all restore operations for given database
  - command: spanner operations list --instance=test-instance --database=restored-db
      --type=DATABASE_RESTORE
  - stdout: |
      OPERATION_ID               DONE  @TYPE                             RESTORED_DATABASE  SOURCE_BACKUP  START_TIME                   END_TIME
      _auto_op_135ddb7caafb9623  True  OptimizeRestoredDatabaseMetadata  restored-db                       2020-02-12T20:32:17.208912Z  2020-02-12T20:32:59.787763Z
      _auto_op_49a13a3a7cc9bd68  True  RestoreDatabaseMetadata           restored-db        test-backup5   2020-02-12T20:25:04.536870Z  2020-02-12T20:32:17.208912Z
- execute:
  - label: List update DDL operations for given instance
  - command: spanner operations list --instance=test-instance --type=DATABASE_UPDATE_DDL
  - stdout: |
      OPERATION_ID               STATEMENTS                                DONE  @TYPE                      DATABASE_ID
      _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64       True  UpdateDatabaseDdlMetadata  test-database
      _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                       True  UpdateDatabaseDdlMetadata  test-database
                                   a INT64,
                                   b INT64,
                                   c INT64,
                                 ) PRIMARY KEY(a)
      _auto_op_59d936b85022f046  DROP TABLE testtable                      True  UpdateDatabaseDdlMetadata  test-database2
      _auto_op_b5aaca2b99248259  ALTER TABLE testtable ADD COLUMN d INT64  True  UpdateDatabaseDdlMetadata  test-database2
      _auto_op_5589af2dbfe2d546  CREATE TABLE testtable (                  True  UpdateDatabaseDdlMetadata  test-database2
                                   a INT64,
                                   b INT64,
                                   c INT64,
                                 ) PRIMARY KEY(a)
- execute:
  - label: List update DDL operations for given database
  - command: spanner operations list --instance=test-instance --database=test-database
      --type=DATABASE_UPDATE_DDL
  - stdout: |
      OPERATION_ID               STATEMENTS                           DONE  @TYPE                      DATABASE_ID
      _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64  True  UpdateDatabaseDdlMetadata  test-database
      _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                  True  UpdateDatabaseDdlMetadata  test-database
                                   a INT64,
                                   b INT64,
                                   c INT64,
                                 ) PRIMARY KEY(a)
- execute:
  - label: List create database operations for given instance
  - command: spanner operations list --instance=test-instance --type=DATABASE_CREATE
  - stdout: |
      OPERATION_ID               STATEMENTS  DONE  @TYPE                   DATABASE_ID
      _auto_op_b40fb5e5bb1a6944              True  CreateDatabaseMetadata  test-database2
      _auto_op_38996da93f1b41f6              True  CreateDatabaseMetadata  test-database
- execute:
  - label: List create database operations for given database
  - command: spanner operations list --instance=test-instance --database=test-database
      --type=DATABASE_CREATE
  - stdout: |
      OPERATION_ID               STATEMENTS  DONE  @TYPE                   DATABASE_ID
      _auto_op_38996da93f1b41f6              True  CreateDatabaseMetadata  test-database
- execute:
  - label: List all database operations for given instance
  - command: spanner operations list --instance=test-instance --type=DATABASE
  - stdout: |
      OPERATION_ID               STATEMENTS                                                                                                      DONE  @TYPE                             DATABASE_ID
      _auto_op_b40fb5e5bb1a6944                                                                                                                  True  CreateDatabaseMetadata            test-database2
      _auto_op_38996da93f1b41f6                                                                                                                  True  CreateDatabaseMetadata            test-database
      _auto_op_8007eeccc39a7fcf                                                                                                                  True  OptimizeRestoredDatabaseMetadata  fdas
      _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64                                                                             True  UpdateDatabaseDdlMetadata         test-database
      _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                                                                                             True  UpdateDatabaseDdlMetadata         test-database
                                   a INT64,
                                   b INT64,
                                   c INT64,
                                 ) PRIMARY KEY(a)
      _auto_op_5589af2dbfe2d546  CREATE TABLE testtable (                                                                                        True  UpdateDatabaseDdlMetadata         aaa-restore-test-1578502374347
                                   a INT64,
                                   b INT64,
                                   c INT64,
                                 ) PRIMARY KEY(a)
      _auto_op_99e95a2f18784652  CREATE TABLE Customers (                                                                                        True  UpdateDatabaseDdlMetadata         awbergs-del4
                                   CustomerId INT64 NOT NULL,
                                   Address STRING(MAX),
                                   Email STRING(MAX) NOT NULL,
                                   Name STRING(200),
                                 ) PRIMARY KEY(CustomerId)
                                 CREATE TABLE Products (
                                   ProductId INT64 NOT NULL,
                                   ProductName STRING(MAX) NOT NULL,
                                   Price INT64,
                                   Category ARRAY<STRING(100)>,
                                   Description STRING(1000) NOT NULL,
                                 ) PRIMARY KEY(ProductId, ProductName DESC)
                                 CREATE TABLE Orders3 (
                                   OrderId INT64 NOT NULL,
                                   Count INT64,
                                   CustomerId INT64,
                                   ProductId INT64 NOT NULL,
                                   ProductName STRING(122) NOT NULL,
                                   CONSTRAINT FKOrders3Product FOREIGN KEY(ProductId, ProductName) REFERENCES Products(ProductId, ProductName),
                                 ) PRIMARY KEY(OrderId)
- execute:
  - label: List all database operations for given database
  - command: spanner operations list --instance=test-instance --database=test-database
      --type=DATABASE
  - stdout: |
      OPERATION_ID               STATEMENTS  DONE  @TYPE                   DATABASE_ID
      _auto_op_38996da93f1b41f6              True  CreateDatabaseMetadata  test-database
actions:
- execute_command:
    command: spanner operations list --instance=test-instance
    label: List operations with no results
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/operations?alt=json&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: {}
    - expect_stderr: |
        Listed 0 items.
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance
    label: List instance operations
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/operations?alt=json&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/operations/bbe68c05fd6ec0af",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.instance.v1.CreateInstanceMetadata",
                    "instance": {
                      "name": "projects/fake-project/instances/test-instance",
                      "config": "projects/fake-project/instanceConfigs/staging-config",
                      "displayName": "deleteme",
                      "nodeCount": 1,
                      "state": "READY"
                    },
                    "startTime": "2020-02-13T16:27:17.916014Z"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID      STATEMENTS  DONE   @TYPE
        bbe68c05fd6ec0af              False  CreateInstanceMetadata
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --database=test-database
    label: List database operations
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databases/test-database/operations?alt=json&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_aa784c70a52de9fc",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "ALTER TABLE test ADD COLUMN d INT64"
                    ]
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_fe64c3bc88bafd0e",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "CREATE TABLE test (\n  a INT64,\n  b INT64,\n  c INT64,\n) PRIMARY KEY(a)"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:35:04.725976Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               STATEMENTS                           DONE   @TYPE
        _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64  False  UpdateDatabaseDdlMetadata
        _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                  True   UpdateDatabaseDdlMetadata
                                     a INT64,
                                     b INT64,
                                     c INT64,
                                   ) PRIMARY KEY(a)
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --type=BACKUP
    label: List all backup operations for given instance
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/backupOperations?alt=json&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/backups/test-backup0/operations/_auto_op_52d1df14a15ed86d",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/backups/test-backup0",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "progress": {
                      "startTime": "2020-02-13T16:37:11.348462Z"
                    }
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/backups/test-backup14/operations/_auto_op_3dc1c2b33738c7cb",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/backups/test-backup14",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-12T16:55:14.989469Z",
                      "endTime": "2020-02-12T16:57:28.162651Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Backup",
                    "name": "projects/fake-project/instances/test-instance/backups/test-backup14",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "expireTime": "2020-02-26T16:55:14.589155Z",
                    "createTime": "2020-02-12T16:55:14.989469Z",
                    "sizeBytes": "190",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/backups/test-backup13/operations/_auto_op_da00c3d035b5e6c0",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/backups/test-backup13",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-12T16:37:23.189930Z",
                      "endTime": "2020-02-12T16:40:33.171305Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Backup",
                    "name": "projects/fake-project/instances/test-instance/backups/test-backup13",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "expireTime": "2020-03-29T10:00:00Z",
                    "createTime": "2020-02-12T16:37:23.189930Z",
                    "sizeBytes": "190",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/backups/test-backup/operations/_auto_op_cc199b8f43cabc58",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/backups/test-backup",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-11T20:30:26.504913Z",
                      "endTime": "2020-02-11T20:33:03.249201Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Backup",
                    "name": "projects/fake-project/instances/test-instance/backups/test-backup",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "expireTime": "2020-03-29T10:00:00Z",
                    "createTime": "2020-02-11T20:30:26.504913Z",
                    "sizeBytes": "190",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/backups/test123/operations/_auto_op_30cd280a71b70f1c",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/backups/test123",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database3",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-11T20:17:51.088047Z",
                      "endTime": "2020-02-11T20:20:14.412660Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Backup",
                    "name": "projects/fake-project/instances/test-instance/backups/test123",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database3",
                    "expireTime": "2020-02-12T20:17:50Z",
                    "createTime": "2020-02-11T20:17:51.088047Z",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-backup1/operations/_auto_op_32de6d9d230d9f5d",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/databases/test-backup1",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database2",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-07T20:41:56.271289Z",
                      "endTime": "2020-02-07T20:45:05.918358Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Backup",
                    "name": "projects/fake-project/instances/test-instance/databases/test-backup1",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database2",
                    "expireTime": "2020-02-08T20:41:56Z",
                    "createTime": "2020-02-07T20:41:56.271289Z",
                    "sizeBytes": "212",
                    "state": "READY"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               DONE   @TYPE                 BACKUP         SOURCE_DATABASE  START_TIME                   END_TIME
        _auto_op_52d1df14a15ed86d  False  CreateBackupMetadata  test-backup0   test-database    2020-02-13T16:37:11.348462Z
        _auto_op_3dc1c2b33738c7cb  True   CreateBackupMetadata  test-backup14  test-database    2020-02-12T16:55:14.989469Z  2020-02-12T16:57:28.162651Z
        _auto_op_da00c3d035b5e6c0  True   CreateBackupMetadata  test-backup13  test-database    2020-02-12T16:37:23.189930Z  2020-02-12T16:40:33.171305Z
        _auto_op_cc199b8f43cabc58  True   CreateBackupMetadata  test-backup    test-database    2020-02-11T20:30:26.504913Z  2020-02-11T20:33:03.249201Z
        _auto_op_30cd280a71b70f1c  True   CreateBackupMetadata  test123        test-database3   2020-02-11T20:17:51.088047Z  2020-02-11T20:20:14.412660Z
        _auto_op_32de6d9d230d9f5d  True   CreateBackupMetadata  test-backup1   test-database2   2020-02-07T20:41:56.271289Z  2020-02-07T20:45:05.918358Z
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --database=test-database
      --type=BACKUP
    label: List all backup operations for given database
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/backupOperations?alt=json&filter=metadata.database%3A%22projects%2Ffake-project%2Finstances%2Ftest-instance%2Fdatabases%2Ftest-database%22&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/backups/test123/operations/_auto_op_30cd280a71b70f1c",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/backups/test123",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-11T20:17:51.088047Z",
                      "endTime": "2020-02-11T20:20:14.412660Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Backup",
                    "name": "projects/fake-project/instances/test-instance/backups/test123",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "expireTime": "2020-02-12T20:17:50Z",
                    "createTime": "2020-02-11T20:17:51.088047Z",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/backups/test09/operations/_auto_op_9723dc48a1904f04",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateBackupMetadata",
                    "name": "projects/fake-project/instances/test-instance/backups/test09",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-07T20:02:36.699241Z",
                      "endTime": "2020-02-07T20:03:38.266867Z"
                    },
                    "cancelTime": "2020-02-07T20:03:37.624837Z"
                  },
                  "done": true,
                  "error": {
                    "code": 1,
                    "message": "Backup creation for backup projects/fake-project/instances/test-instance/backups/test09 was cancelled by the user."
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               DONE  @TYPE                 BACKUP   SOURCE_DATABASE  START_TIME                   END_TIME
        _auto_op_30cd280a71b70f1c  True  CreateBackupMetadata  test123  test-database    2020-02-11T20:17:51.088047Z  2020-02-11T20:20:14.412660Z
        _auto_op_9723dc48a1904f04  True  CreateBackupMetadata  test09   test-database    2020-02-07T20:02:36.699241Z  2020-02-07T20:03:38.266867Z
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --type=DATABASE_RESTORE
    label: List all restore operations for given instance
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databaseOperations?alt=json&filter=%28metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.OptimizeRestoredDatabaseMetadata%29+OR+%28metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.RestoreDatabaseMetadata%29&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/restore-test13/operations/_auto_op_4d4f0c46edfaa926",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.RestoreDatabaseMetadata",
                    "name": "projects/fake-project/instances/test-instance/databases/restore-test13",
                    "sourceType": "BACKUP",
                    "backupInfo": {
                      "backup": "projects/fake-project/instances/test-instance/backups/test-backup0",
                      "createTime": "2020-02-13T16:37:11.348462Z",
                      "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                    },
                    "progress": {
                      "startTime": "2020-02-13T16:54:30.611532Z"
                    }
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/restored-db/operations/_auto_op_135ddb7caafb9623",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.OptimizeRestoredDatabaseMetadata",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-12T20:32:17.208912Z",
                      "endTime": "2020-02-12T20:32:59.787763Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "state": "READY",
                    "createTime": "2020-02-12T20:25:04.536870Z",
                    "restoreInfo": {
                      "sourceType": "BACKUP",
                      "backupInfo": {
                        "backup": "projects/fake-project/instances/test-instance/backups/test-backup5",
                        "createTime": "2020-01-14T22:00:11.573548Z",
                        "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                      }
                    }
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/restored-db/operations/_auto_op_49a13a3a7cc9bd68",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.RestoreDatabaseMetadata",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "sourceType": "BACKUP",
                    "backupInfo": {
                      "backup": "projects/fake-project/instances/test-instance/backups/test-backup5",
                      "createTime": "2020-01-14T22:00:11.573548Z",
                      "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                    },
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-12T20:25:04.536870Z",
                      "endTime": "2020-02-12T20:32:17.208912Z"
                    },
                    "optimizeDatabaseOperationName": "projects/fake-project/instances/test-instance/databases/restored-db/operations/_auto_op_135ddb7caafb9623"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "state": "READY_OPTIMIZING",
                    "createTime": "2020-02-12T20:25:04.536870Z",
                    "restoreInfo": {
                      "sourceType": "BACKUP",
                      "backupInfo": {
                        "backup": "projects/fake-project/instances/test-instance/backups/test-backup5",
                        "createTime": "2020-01-14T22:00:11.573548Z",
                        "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                      }
                    }
                  }
                }
              ]
            }

    - expect_stdout: |
        OPERATION_ID               DONE   @TYPE                             RESTORED_DATABASE  SOURCE_BACKUP  START_TIME                   END_TIME
        _auto_op_4d4f0c46edfaa926  False  RestoreDatabaseMetadata           restore-test13     test-backup0   2020-02-13T16:54:30.611532Z
        _auto_op_135ddb7caafb9623  True   OptimizeRestoredDatabaseMetadata  restored-db                       2020-02-12T20:32:17.208912Z  2020-02-12T20:32:59.787763Z
        _auto_op_49a13a3a7cc9bd68  True   RestoreDatabaseMetadata           restored-db        test-backup5   2020-02-12T20:25:04.536870Z  2020-02-12T20:32:17.208912Z
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --database=restored-db
      --type=DATABASE_RESTORE
    label: List all restore operations for given database
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databases/restored-db/operations?alt=json&filter=%28metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.OptimizeRestoredDatabaseMetadata%29+OR+%28metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.RestoreDatabaseMetadata%29&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/restored-db/operations/_auto_op_135ddb7caafb9623",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.OptimizeRestoredDatabaseMetadata",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-12T20:32:17.208912Z",
                      "endTime": "2020-02-12T20:32:59.787763Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "state": "READY",
                    "createTime": "2020-02-12T20:25:04.536870Z",
                    "restoreInfo": {
                      "sourceType": "BACKUP",
                      "backupInfo": {
                        "backup": "projects/fake-project/instances/test-instance/backups/test-backup5",
                        "createTime": "2020-01-14T22:00:11.573548Z",
                        "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                      }
                    }
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/restored-db/operations/_auto_op_49a13a3a7cc9bd68",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.RestoreDatabaseMetadata",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "sourceType": "BACKUP",
                    "backupInfo": {
                      "backup": "projects/fake-project/instances/test-instance/backups/test-backup5",
                      "createTime": "2020-01-14T22:00:11.573548Z",
                      "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                    },
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-12T20:25:04.536870Z",
                      "endTime": "2020-02-12T20:32:17.208912Z"
                    },
                    "optimizeDatabaseOperationName": "projects/fake-project/instances/test-instance/databases/restored-db/operations/_auto_op_135ddb7caafb9623"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/restored-db",
                    "state": "READY_OPTIMIZING",
                    "createTime": "2020-02-12T20:25:04.536870Z",
                    "restoreInfo": {
                      "sourceType": "BACKUP",
                      "backupInfo": {
                        "backup": "projects/fake-project/instances/test-instance/backups/test-backup5",
                        "createTime": "2020-01-14T22:00:11.573548Z",
                        "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                      }
                    }
                  }
                }
              ]
            }

    - expect_stdout: |
        OPERATION_ID               DONE  @TYPE                             RESTORED_DATABASE  SOURCE_BACKUP  START_TIME                   END_TIME
        _auto_op_135ddb7caafb9623  True  OptimizeRestoredDatabaseMetadata  restored-db                       2020-02-12T20:32:17.208912Z  2020-02-12T20:32:59.787763Z
        _auto_op_49a13a3a7cc9bd68  True  RestoreDatabaseMetadata           restored-db        test-backup5   2020-02-12T20:25:04.536870Z  2020-02-12T20:32:17.208912Z
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --type=DATABASE_UPDATE_DDL
    label: List update DDL operations for given instance
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databaseOperations?alt=json&filter=metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.UpdateDatabaseDdlMetadata&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_aa784c70a52de9fc",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "ALTER TABLE test ADD COLUMN d INT64"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:35:21.146615Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_fe64c3bc88bafd0e",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "CREATE TABLE test (\n  a INT64,\n  b INT64,\n  c INT64,\n) PRIMARY KEY(a)"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:35:04.725976Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database2/operations/_auto_op_59d936b85022f046",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database2",
                    "statements": [
                      "DROP TABLE testtable"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:34:39.211999Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database2/operations/_auto_op_b5aaca2b99248259",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database2",
                    "statements": [
                      "ALTER TABLE testtable ADD COLUMN d INT64"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:34:21.540293Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database2/operations/_auto_op_5589af2dbfe2d546",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database2",
                    "statements": [
                      "CREATE TABLE testtable (\n  a INT64,\n  b INT64,\n  c INT64,\n) PRIMARY KEY(a)"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:33:50.032195Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               STATEMENTS                                DONE  @TYPE                      DATABASE_ID
        _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64       True  UpdateDatabaseDdlMetadata  test-database
        _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                       True  UpdateDatabaseDdlMetadata  test-database
                                     a INT64,
                                     b INT64,
                                     c INT64,
                                   ) PRIMARY KEY(a)
        _auto_op_59d936b85022f046  DROP TABLE testtable                      True  UpdateDatabaseDdlMetadata  test-database2
        _auto_op_b5aaca2b99248259  ALTER TABLE testtable ADD COLUMN d INT64  True  UpdateDatabaseDdlMetadata  test-database2
        _auto_op_5589af2dbfe2d546  CREATE TABLE testtable (                  True  UpdateDatabaseDdlMetadata  test-database2
                                     a INT64,
                                     b INT64,
                                     c INT64,
                                   ) PRIMARY KEY(a)
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --database=test-database
      --type=DATABASE_UPDATE_DDL
    label: List update DDL operations for given database
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databases/test-database/operations?alt=json&filter=metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.UpdateDatabaseDdlMetadata&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_aa784c70a52de9fc",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "ALTER TABLE test ADD COLUMN d INT64"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:35:21.146615Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_fe64c3bc88bafd0e",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "CREATE TABLE test (\n  a INT64,\n  b INT64,\n  c INT64,\n) PRIMARY KEY(a)"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:35:04.725976Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               STATEMENTS                           DONE  @TYPE                      DATABASE_ID
        _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64  True  UpdateDatabaseDdlMetadata  test-database
        _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                  True  UpdateDatabaseDdlMetadata  test-database
                                     a INT64,
                                     b INT64,
                                     c INT64,
                                   ) PRIMARY KEY(a)
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --type=DATABASE_CREATE
    label: List create database operations for given instance
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databaseOperations?alt=json&filter=metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.CreateDatabaseMetadata&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database2/operations/_auto_op_b40fb5e5bb1a6944",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateDatabaseMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database2"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/test-database2",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_38996da93f1b41f6",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateDatabaseMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/test-database",
                    "state": "READY"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               STATEMENTS  DONE  @TYPE                   DATABASE_ID
        _auto_op_b40fb5e5bb1a6944              True  CreateDatabaseMetadata  test-database2
        _auto_op_38996da93f1b41f6              True  CreateDatabaseMetadata  test-database
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --database=test-database
      --type=DATABASE_CREATE
    label: List create database operations for given database
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databases/test-database/operations?alt=json&filter=metadata.%40type%3Atype.googleapis.com%2Fgoogle.spanner.admin.database.v1.CreateDatabaseMetadata&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_38996da93f1b41f6",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateDatabaseMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/test-database",
                    "state": "READY"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               STATEMENTS  DONE  @TYPE                   DATABASE_ID
        _auto_op_38996da93f1b41f6              True  CreateDatabaseMetadata  test-database
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --type=DATABASE
    label: List all database operations for given instance
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databaseOperations?alt=json&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database2/operations/_auto_op_b40fb5e5bb1a6944",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateDatabaseMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database2"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/test-database2",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_38996da93f1b41f6",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateDatabaseMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/test-database",
                    "state": "READY"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/fdas/operations/_auto_op_8007eeccc39a7fcf",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.OptimizeRestoredDatabaseMetadata",
                    "name": "projects/fake-project/instances/test-instance/databases/fdas",
                    "progress": {
                      "progressPercent": 100,
                      "startTime": "2020-02-13T20:27:22.071592Z",
                      "endTime": "2020-02-13T20:27:59.007164Z"
                    }
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/fdas",
                    "state": "READY",
                    "createTime": "2020-02-13T20:21:48.445317Z",
                    "restoreInfo": {
                      "sourceType": "BACKUP",
                      "backupInfo": {
                        "backup": "projects/fake-project/instances/test-instance/backups/test-backup0",
                        "createTime": "2020-02-13T16:37:11.348462Z",
                        "sourceDatabase": "projects/fake-project/instances/test-instance/databases/test-database"
                      }
                    }
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_aa784c70a52de9fc",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "ALTER TABLE test ADD COLUMN d INT64"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:35:21.146615Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_fe64c3bc88bafd0e",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database",
                    "statements": [
                      "CREATE TABLE test (\n  a INT64,\n  b INT64,\n  c INT64,\n) PRIMARY KEY(a)"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:35:04.725976Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/aaa-restore-test-1578502374347/operations/_auto_op_5589af2dbfe2d546",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/aaa-restore-test-1578502374347",
                    "statements": [
                      "CREATE TABLE testtable (\n  a INT64,\n  b INT64,\n  c INT64,\n) PRIMARY KEY(a)"
                    ],
                    "commitTimestamps": [
                      "2020-02-13T16:33:50.032195Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                },
                {
                  "name": "projects/fake-project/instances/test-instance/databases/awbergs-del4/operations/_auto_op_99e95a2f18784652",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.UpdateDatabaseDdlMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/awbergs-del4",
                    "statements": [
                      "CREATE TABLE Customers (\n  CustomerId INT64 NOT NULL,\n  Address STRING(MAX),\n  Email STRING(MAX) NOT NULL,\n  Name STRING(200),\n) PRIMARY KEY(CustomerId)",
                      "CREATE TABLE Products (\n  ProductId INT64 NOT NULL,\n  ProductName STRING(MAX) NOT NULL,\n  Price INT64,\n  Category ARRAY\u003cSTRING(100)\u003e,\n  Description STRING(1000) NOT NULL,\n) PRIMARY KEY(ProductId, ProductName DESC)",
                      "CREATE TABLE Orders3 (\n  OrderId INT64 NOT NULL,\n  Count INT64,\n  CustomerId INT64,\n  ProductId INT64 NOT NULL,\n  ProductName STRING(122) NOT NULL,\n  CONSTRAINT FKOrders3Product FOREIGN KEY(ProductId, ProductName) REFERENCES Products(ProductId, ProductName),\n) PRIMARY KEY(OrderId)"
                    ],
                    "commitTimestamps": [
                      "2020-02-07T21:02:38.943019Z",
                      "2020-02-07T21:02:38.943019Z",
                      "2020-02-07T21:02:38.943019Z"
                    ]
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.protobuf.Empty"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               STATEMENTS                                                                                                      DONE  @TYPE                             DATABASE_ID
        _auto_op_b40fb5e5bb1a6944                                                                                                                  True  CreateDatabaseMetadata            test-database2
        _auto_op_38996da93f1b41f6                                                                                                                  True  CreateDatabaseMetadata            test-database
        _auto_op_8007eeccc39a7fcf                                                                                                                  True  OptimizeRestoredDatabaseMetadata  fdas
        _auto_op_aa784c70a52de9fc  ALTER TABLE test ADD COLUMN d INT64                                                                             True  UpdateDatabaseDdlMetadata         test-database
        _auto_op_fe64c3bc88bafd0e  CREATE TABLE test (                                                                                             True  UpdateDatabaseDdlMetadata         test-database
                                     a INT64,
                                     b INT64,
                                     c INT64,
                                   ) PRIMARY KEY(a)
        _auto_op_5589af2dbfe2d546  CREATE TABLE testtable (                                                                                        True  UpdateDatabaseDdlMetadata         aaa-restore-test-1578502374347
                                     a INT64,
                                     b INT64,
                                     c INT64,
                                   ) PRIMARY KEY(a)
        _auto_op_99e95a2f18784652  CREATE TABLE Customers (                                                                                        True  UpdateDatabaseDdlMetadata         awbergs-del4
                                     CustomerId INT64 NOT NULL,
                                     Address STRING(MAX),
                                     Email STRING(MAX) NOT NULL,
                                     Name STRING(200),
                                   ) PRIMARY KEY(CustomerId)
                                   CREATE TABLE Products (
                                     ProductId INT64 NOT NULL,
                                     ProductName STRING(MAX) NOT NULL,
                                     Price INT64,
                                     Category ARRAY<STRING(100)>,
                                     Description STRING(1000) NOT NULL,
                                   ) PRIMARY KEY(ProductId, ProductName DESC)
                                   CREATE TABLE Orders3 (
                                     OrderId INT64 NOT NULL,
                                     Count INT64,
                                     CustomerId INT64,
                                     ProductId INT64 NOT NULL,
                                     ProductName STRING(122) NOT NULL,
                                     CONSTRAINT FKOrders3Product FOREIGN KEY(ProductId, ProductName) REFERENCES Products(ProductId, ProductName),
                                   ) PRIMARY KEY(OrderId)
    - expect_exit:
        code: 0
- execute_command:
    command: spanner operations list --instance=test-instance --database=test-database
      --type=DATABASE
    label: List all database operations for given database
    events:
    - api_call:
        expect_request:
          uri: https://spanner.googleapis.com/v1/projects/fake-project/instances/test-instance/databases/test-database/operations?alt=json&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body: |-
            {
              "operations": [
                {
                  "name": "projects/fake-project/instances/test-instance/databases/test-database/operations/_auto_op_38996da93f1b41f6",
                  "metadata": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.CreateDatabaseMetadata",
                    "database": "projects/fake-project/instances/test-instance/databases/test-database"
                  },
                  "done": true,
                  "response": {
                    "@type": "type.googleapis.com/google.spanner.admin.database.v1.Database",
                    "name": "projects/fake-project/instances/test-instance/databases/test-database",
                    "state": "READY"
                  }
                }
              ]
            }
    - expect_stdout: |
        OPERATION_ID               STATEMENTS  DONE  @TYPE                   DATABASE_ID
        _auto_op_38996da93f1b41f6              True  CreateDatabaseMetadata  test-database
    - expect_exit:
        code: 0
