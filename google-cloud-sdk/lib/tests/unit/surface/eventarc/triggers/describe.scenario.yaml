title: eventarc triggers describe test scenario
release_tracks: [BETA]

summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: |
      eventarc triggers describe fake-trigger1 --location global
  - stdout: |
      destination:
        cloudRunService:
          path: fake/destination/path
          region: us-central1
          service: fake-service1
      matchingCriteria:
      - attribute: type
        value: google.cloud.audit.log.v1.written
      - attribute: serviceName
        value: storage.googleapis.com
      - attribute: methodName
        value: storage.buckets.create
      name: projects/fake-project/locations/global/triggers/fake-trigger1
      serviceAccount: projects/fake-project/serviceAccounts/fake-service-account
      updateTime: '2000-01-01T00:00:00Z'
- execute:
  - command: |
      eventarc triggers describe fake-trigger2 --location us-central1
  - stdout: |
      destination:
        cloudRunService:
          service: fake-service2
      matchingCriteria:
      - attribute: type
        value: google.cloud.pubsub.topic.v1.messagePublished
      name: projects/fake-project/locations/us-central1/triggers/fake-trigger2
      updateTime: '3000-01-01T00:00:00Z'
- execute:
  - command: |
      eventarc triggers describe fake-trigger3 --location us-central1
  - stdout: |
      destination:
        cloudRunService:
          service: fake-service3
      matchingCriteria:
      - attribute: type
        value: google.cloud.audit.log.v1.written
      - attribute: serviceName
        value: storage.googleapis.com
      - attribute: methodName
        value: storage.buckets.create
      name: projects/fake-project/locations/us-central1/triggers/fake-trigger3
      updateTime: '3000-01-01T00:00:00Z'
  - stderr: |-
      WARNING: The trigger was recently modified and will become active by ..:10:00.
      $

actions:
- execute_command:
    command: |
      eventarc triggers describe fake-trigger1 --location global
    events:
    - api_call:
        expect_request:
          uri: https://eventarc.googleapis.com/v1beta1/projects/fake-project/locations/global/triggers/fake-trigger1?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            destination:
              cloudRunService:
                path: fake/destination/path
                region: us-central1
                service: fake-service1
            matchingCriteria:
            - attribute: type
              value: google.cloud.audit.log.v1.written
            - attribute: serviceName
              value: storage.googleapis.com
            - attribute: methodName
              value: storage.buckets.create
            name: projects/fake-project/locations/global/triggers/fake-trigger1
            serviceAccount: projects/fake-project/serviceAccounts/fake-service-account
            updateTime: '2000-01-01T00:00:00Z'
    - expect_stdout: |
        destination:
          cloudRunService:
            path: fake/destination/path
            region: us-central1
            service: fake-service1
        matchingCriteria:
        - attribute: type
          value: google.cloud.audit.log.v1.written
        - attribute: serviceName
          value: storage.googleapis.com
        - attribute: methodName
          value: storage.buckets.create
        name: projects/fake-project/locations/global/triggers/fake-trigger1
        serviceAccount: projects/fake-project/serviceAccounts/fake-service-account
        updateTime: '2000-01-01T00:00:00Z'
    - expect_exit:
        code: 0

- execute_command:
    command: |
      eventarc triggers describe fake-trigger2 --location us-central1
    events:
    - api_call:
        expect_request:
          uri: https://eventarc.googleapis.com/v1beta1/projects/fake-project/locations/us-central1/triggers/fake-trigger2?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            destination:
              cloudRunService:
                service: fake-service2
            matchingCriteria:
            - attribute: type
              value: google.cloud.pubsub.topic.v1.messagePublished
            name: projects/fake-project/locations/us-central1/triggers/fake-trigger2
            updateTime: '3000-01-01T00:00:00Z'
    - expect_stdout: |
        destination:
          cloudRunService:
            service: fake-service2
        matchingCriteria:
        - attribute: type
          value: google.cloud.pubsub.topic.v1.messagePublished
        name: projects/fake-project/locations/us-central1/triggers/fake-trigger2
        updateTime: '3000-01-01T00:00:00Z'
    - expect_exit:
        code: 0

- execute_command:
    command: |
      eventarc triggers describe fake-trigger3 --location us-central1
    events:
    - api_call:
        expect_request:
          uri: https://eventarc.googleapis.com/v1beta1/projects/fake-project/locations/us-central1/triggers/fake-trigger3?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            destination:
              cloudRunService:
                service: fake-service3
            matchingCriteria:
            - attribute: type
              value: google.cloud.audit.log.v1.written
            - attribute: serviceName
              value: storage.googleapis.com
            - attribute: methodName
              value: storage.buckets.create
            name: projects/fake-project/locations/us-central1/triggers/fake-trigger3
            updateTime: '3000-01-01T00:00:00Z'
    - expect_stdout: |
        destination:
          cloudRunService:
            service: fake-service3
        matchingCriteria:
        - attribute: type
          value: google.cloud.audit.log.v1.written
        - attribute: serviceName
          value: storage.googleapis.com
        - attribute: methodName
          value: storage.buckets.create
        name: projects/fake-project/locations/us-central1/triggers/fake-trigger3
        updateTime: '3000-01-01T00:00:00Z'
    - expect_stderr:
        matches: |
          WARNING: The trigger was recently modified and will become active by ..:10:00.
    - expect_exit:
        code: 0
