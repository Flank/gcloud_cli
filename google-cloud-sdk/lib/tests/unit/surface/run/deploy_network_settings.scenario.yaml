title: Tests configuring network settings while deploying.
release_tracks: [ALPHA, BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- set_property: run/region us-central1
- set_property: run/platform managed
- set_property: core/project fake-project
- execute:
  - command: run deploy test --image gcr.io/cloudrun/hello --clear-vpc-connector --vpc-egress=private-ranges-only
      --no-allow-unauthenticated
  - stderr: |
      Deploying container to Cloud Run service [test] in project [fake-project] region [us-central1]
  - staged_progress_tracker:
    - message: Deploying...
    - status: SUCCESS
  - stderr: |
      Service [test] revision [test-00003-tey] has been deployed and is serving 100 percent of traffic.
      Service URL: https://test-uc.a.run.app
- execute:
  - command: run deploy test --image gcr.io/cloudrun/hello --clear-vpc-connector --vpc-egress=all
      --no-allow-unauthenticated
  - prompt:
    - message: Removing the VPC connector from this service will clear the VPC egress
        setting and route outbound traffic to the public internet.
    - input: y
  - stderr: |
      Deploying container to Cloud Run service [test] in project [fake-project] region [us-central1]
  - staged_progress_tracker:
    - message: Deploying...
    - status: SUCCESS
  - stderr: |
      Service [test] revision [test-00003-tey] has been deployed and is serving 100 percent of traffic.
      Service URL: https://test-uc.a.run.app
- execute:
  - command: run deploy test --image gcr.io/cloudrun/hello --clear-vpc-connector --no-allow-unauthenticated
  - prompt:
    - message: Removing the VPC connector from this service will clear the VPC egress
        setting and route outbound traffic to the public internet.
    - input: y
  - stderr: |
      Deploying container to Cloud Run service [test] in project [fake-project] region [us-central1]
  - staged_progress_tracker:
    - message: Deploying...
    - status: SUCCESS
  - stderr: |
      Service [test] revision [test-00003-tey] has been deployed and is serving 100 percent of traffic.
      Service URL: https://test-uc.a.run.app
actions:
- define_reference:
    reference: launch-stage
    track_values:
      ALPHA: ALPHA
      BETA: BETA
- set_property:
    run/region: us-central1
    run/platform: managed
    core/project: fake-project
- execute_command:
    command: run deploy test --image gcr.io/cloudrun/hello --clear-vpc-connector --vpc-egress=private-ranges-only
      --no-allow-unauthenticated
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 2
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    run.googleapis.com/vpc-access-connector: test-connector
                    run.googleapis.com/vpc-access-egress: all
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-rev02
              latestReadyRevisionName: test-rev02
              observedGeneration: 2
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-rev02
    - expect_stderr: |
        Deploying container to Cloud Run service [test] in project [fake-project] region [us-central1]
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: PUT
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                annotations:
                  client.knative.dev/user-image: gcr.io/cloudrun/hello
                  run.googleapis.com/client-name: gcloud
                  run.googleapis.com/launch-stage: $$launch-stage$$
                creationTimestamp: '2019-07-23T18:13:29Z'
                generation: 2
                name: test
                namespace: fake-project
                resourceVersion: '51639050'
              spec:
                template:
                  metadata:
                    annotations:
                      client.knative.dev/user-image: gcr.io/cloudrun/hello
                      run.googleapis.com/client-name: gcloud
                  spec:
                    containers:
                    - image: gcr.io/cloudrun/hello
                traffic:
                - configurationName: test
                  percent: 100
              status:
                conditions:
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: ConfigurationsReady
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: Ready
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: RoutesReady
                latestCreatedRevisionName: test-rev02
                latestReadyRevisionName: test-rev02
                observedGeneration: 2
                traffic:
                - latestRevision: true
                  percent: 100
                  revisionName: test-rev02
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 2
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/fake-project/locations/us-central1/services/test:getIamPolicy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: {}
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/fake-project/locations/us-central1/services/test:setIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              policy: {}
        return_response:
          status: 200
          headers: {}
          body: {}
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 3
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying...
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 3
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
              url: https://test-uc.a.run.app
    - expect_stderr: |
        Service [test] revision [test-00003-tey] has been deployed and is serving 100 percent of traffic.
        Service URL: https://test-uc.a.run.app
    - expect_exit:
        code: 0
- execute_command:
    command: run deploy test --image gcr.io/cloudrun/hello --clear-vpc-connector --vpc-egress=all
      --no-allow-unauthenticated
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 2
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    run.googleapis.com/vpc-access-connector: test-connector
                    run.googleapis.com/vpc-access-egress: private-ranges-only
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-rev02
              latestReadyRevisionName: test-rev02
              observedGeneration: 2
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-rev02
    - expect_prompt_continue:
        message: Removing the VPC connector from this service will clear the VPC egress
          setting and route outbound traffic to the public internet.
        user_input: y
    - expect_stderr: |
        Deploying container to Cloud Run service [test] in project [fake-project] region [us-central1]
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: PUT
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                annotations:
                  client.knative.dev/user-image: gcr.io/cloudrun/hello
                  run.googleapis.com/client-name: gcloud
                  run.googleapis.com/launch-stage: $$launch-stage$$
                creationTimestamp: '2019-07-23T18:13:29Z'
                generation: 2
                name: test
                namespace: fake-project
                resourceVersion: '51639050'
              spec:
                template:
                  metadata:
                    annotations:
                      client.knative.dev/user-image: gcr.io/cloudrun/hello
                      run.googleapis.com/client-name: gcloud
                  spec:
                    containers:
                    - image: gcr.io/cloudrun/hello
                traffic:
                - configurationName: test
                  percent: 100
              status:
                conditions:
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: ConfigurationsReady
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: Ready
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: RoutesReady
                latestCreatedRevisionName: test-rev02
                latestReadyRevisionName: test-rev02
                observedGeneration: 2
                traffic:
                - latestRevision: true
                  percent: 100
                  revisionName: test-rev02
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 2
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/fake-project/locations/us-central1/services/test:getIamPolicy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: {}
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/fake-project/locations/us-central1/services/test:setIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              policy: {}
        return_response:
          status: 200
          headers: {}
          body: {}
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 3
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying...
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 3
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
              url: https://test-uc.a.run.app
    - expect_stderr: |
        Service [test] revision [test-00003-tey] has been deployed and is serving 100 percent of traffic.
        Service URL: https://test-uc.a.run.app
    - expect_exit:
        code: 0
- execute_command:
    command: run deploy test --image gcr.io/cloudrun/hello --clear-vpc-connector --no-allow-unauthenticated
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 2
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    run.googleapis.com/vpc-access-connector: test-connector
                    run.googleapis.com/vpc-access-egress: all
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-rev02
              latestReadyRevisionName: test-rev02
              observedGeneration: 2
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-rev02
    - expect_prompt_continue:
        message: Removing the VPC connector from this service will clear the VPC egress
          setting and route outbound traffic to the public internet.
        user_input: y
    - expect_stderr: |
        Deploying container to Cloud Run service [test] in project [fake-project] region [us-central1]
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: PUT
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                annotations:
                  client.knative.dev/user-image: gcr.io/cloudrun/hello
                  run.googleapis.com/client-name: gcloud
                  run.googleapis.com/launch-stage: $$launch-stage$$
                creationTimestamp: '2019-07-23T18:13:29Z'
                generation: 2
                name: test
                namespace: fake-project
                resourceVersion: '51639050'
              spec:
                template:
                  metadata:
                    annotations:
                      client.knative.dev/user-image: gcr.io/cloudrun/hello
                      run.googleapis.com/client-name: gcloud
                  spec:
                    containers:
                    - image: gcr.io/cloudrun/hello
                traffic:
                - configurationName: test
                  percent: 100
              status:
                conditions:
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: ConfigurationsReady
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: Ready
                - lastTransitionTime: '2019-07-23T20:10:04Z'
                  status: 'True'
                  type: RoutesReady
                latestCreatedRevisionName: test-rev02
                latestReadyRevisionName: test-rev02
                observedGeneration: 2
                traffic:
                - latestRevision: true
                  percent: 100
                  revisionName: test-rev02
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:04Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 2
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/fake-project/locations/us-central1/services/test:getIamPolicy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body: {}
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/fake-project/locations/us-central1/services/test:setIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              policy: {}
        return_response:
          status: 200
          headers: {}
          body: {}
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 3
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying...
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/fake-project/services/test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers: {}
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              annotations:
                client.knative.dev/user-image: gcr.io/cloudrun/hello
                run.googleapis.com/client-name: gcloud
                run.googleapis.com/launch-stage: $$launch-stage$$
              creationTimestamp: '2019-07-23T18:13:29Z'
              generation: 3
              name: test
              namespace: fake-project
              resourceVersion: '51639050'
            spec:
              template:
                metadata:
                  annotations:
                    client.knative.dev/user-image: gcr.io/cloudrun/hello
                    run.googleapis.com/client-name: gcloud
                  name: test-00003-tey
                spec:
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - configurationName: test
                percent: 100
            status:
              conditions:
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: ConfigurationsReady
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: Ready
              - lastTransitionTime: '2019-07-23T20:10:05Z'
                status: 'True'
                type: RoutesReady
              latestCreatedRevisionName: test-00003-tey
              latestReadyRevisionName: test-00003-tey
              observedGeneration: 3
              traffic:
              - latestRevision: true
                percent: 100
                revisionName: test-00003-tey
              url: https://test-uc.a.run.app
    - expect_stderr: |
        Service [test] revision [test-00003-tey] has been deployed and is serving 100 percent of traffic.
        Service URL: https://test-uc.a.run.app
    - expect_exit:
        code: 0
