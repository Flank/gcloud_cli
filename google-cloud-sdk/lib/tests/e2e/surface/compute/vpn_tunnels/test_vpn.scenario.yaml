title: VPN Test
release_tracks: [ALPHA, BETA, GA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute networks create --range 10.120.0.0/16 --subnet-mode LEGACY $$network$$
      --format "text(name)"
  - stderr: |+
      Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
      WARNING: Some requests generated warnings:
       - Creation of legacy mode networks is deprecated. Please consider using subnet mode networks instead.

  - stdout: |
      ---
      name: $$network$$
- execute:
  - command: compute target-vpn-gateways create --region $$my-region$$ --network $$network$$
      $$vpn-gateway$$ --format "text(name,network,region)"
  - stderr: |
      Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
  - stdout: |
      ---
      name:    $$vpn-gateway$$
      network: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
      region:  https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
- execute:
  - command: compute addresses create --region $$my-region$$ $$address$$
  - stderr: |
      Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
- execute:
  - command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      ESP --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-esp$$
  - stderr: |
      Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
- execute:
  - command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-udp500$$
  - stderr: |
      Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
- execute:
  - command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 4500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$
      $$fwd-rule-udp4500$$
  - stderr: |
      Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
- execute:
  - command: compute vpn-tunnels create --region $$my-region$$ --peer-address 8.8.8.8
      --shared-secret 'whatever' --target-vpn-gateway $$vpn-gateway$$ $$vpn-tunnel$$
      --format "text(name,region,gateway)"
  - progress_tracker:
    - message: Creating VPN tunnel
    - status: SUCCESS
  - stdout: |
      ---
      name:   $$vpn-tunnel$$
      region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
- execute:
  - command: compute routes create --next-hop-vpn-tunnel-region $$my-region$$ --network
      $$network$$ --next-hop-vpn-tunnel $$vpn-tunnel$$ --destination-range 192.168.100.0/24
      $$route$$ --format "text(route,network)"
  - stderr: |
      Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
  - stdout: |
      ---
      network: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
- execute:
  - command: compute routes delete $$route$$ --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
- execute:
  - command: compute vpn-tunnels delete $$vpn-tunnel$$ --region $$my-region$$ --quiet
  - progress_tracker:
    - message: Deleting VPN tunnel
    - status: SUCCESS
- execute:
  - command: compute forwarding-rules delete $$fwd-rule-esp$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
- execute:
  - command: compute forwarding-rules delete $$fwd-rule-udp500$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
- execute:
  - command: compute forwarding-rules delete $$fwd-rule-udp4500$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
- execute:
  - command: compute addresses delete $$address$$ --region $$my-region$$ --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
- execute:
  - command: compute target-vpn-gateways delete $$vpn-gateway$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
- execute:
  - command: compute networks delete $$network$$ --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
actions:
- define_reference:
    reference: compute-uri
    value: www.googleapis.com/compute
- define_reference:
    reference: api-version
    track_values:
      GA: v1
      BETA: beta
      ALPHA: alpha

- define_reference:
    reference: my-region
    value: us-central1

- generate_resource_id:
    reference: network
    prefix: compute-vpn-test

- generate_resource_id:
    reference: vpn-gateway
    prefix: compute-vpn-test

- generate_resource_id:
    reference: address
    prefix: compute-vpn-test

- generate_resource_id:
    reference: fwd-rule-esp
    prefix: compute-vpn-test

- generate_resource_id:
    reference: fwd-rule-udp500
    prefix: compute-vpn-test

- generate_resource_id:
    reference: fwd-rule-udp4500
    prefix: compute-vpn-test

- generate_resource_id:
    reference: vpn-tunnel
    prefix: compute-vpn-test

- generate_resource_id:
    reference: route
    prefix: compute-vpn-test

- execute_command:
    command: compute networks create --range 10.120.0.0/16 --subnet-mode LEGACY $$network$$
      --format "text(name)"
    validation_only: true
    events:
    - expect_stderr: |+
        Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
        WARNING: Some requests generated warnings:
         - Creation of legacy mode networks is deprecated. Please consider using subnet mode networks instead.

    - expect_stdout: |
        ---
        name: $$network$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute target-vpn-gateways create --region $$my-region$$ --network $$network$$
      $$vpn-gateway$$ --format "text(name,network,region)"
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
    - expect_stdout: |
        ---
        name:    $$vpn-gateway$$
        network: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
        region:  https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses create --region $$my-region$$ $$address$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      ESP --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-esp$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-udp500$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 4500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$
      $$fwd-rule-udp4500$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels create --region $$my-region$$ --peer-address 8.8.8.8
      --shared-secret 'whatever' --target-vpn-gateway $$vpn-gateway$$ $$vpn-tunnel$$
      --format "text(name,region,gateway)"
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$vpn-tunnel$$
              peerIp: 8.8.8.8
              sharedSecret: whatever
              targetVpnGateway: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
        return_response:
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '871'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            status: '200'
          body:
            kind: compute#operation
            id: '7699798146735507070'
            name: operation-1556887696786-587fb2a1f42f0-79f7dce0-ac20a782
            operationType: insert
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            targetId: '6789128182195914366'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:48:17.961-07:00'
            startTime: '2019-05-03T05:48:17.980-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1556887696786-587fb2a1f42f0-79f7dce0-ac20a782
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_progress_tracker:
        message: Creating VPN tunnel
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '907'
            content-type: application/json; charset=UTF-8
            etag: '"4hJEFPq446NBZZ2Oz11xBgL_toI=/joUAHS1JuXiNEXUVwLnKyqBgwpM="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '6789128182195914366'
            creationTimestamp: '2019-05-03T05:48:17.951-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: AG-DgdeWMjhxpiUY1H3w_atUCY9X
            status: WAITING_FOR_FULL_CONFIG
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Waiting for route configuration.
            localTrafficSelector:
            - 10.120.0.0/16
    - expect_stdout: |
        ---
        name:   $$vpn-tunnel$$
        region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute routes create --next-hop-vpn-tunnel-region $$my-region$$ --network
      $$network$$ --next-hop-vpn-tunnel $$vpn-tunnel$$ --destination-range 192.168.100.0/24
      $$route$$ --format "text(route,network)"
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
    - expect_stdout: |
        ---
        network: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute routes delete $$route$$ --quiet
    cleanup_for: route
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '730'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3014647176566507091'
            name: operation-1556887739776-587fb2caf3e73-b25eb7c6-2adb9b99
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$
            targetId: '8179075565930776138'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:49:00.278-07:00'
            startTime: '2019-05-03T05:49:00.292-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/operations/operation-1556887739776-587fb2caf3e73-b25eb7c6-2adb9b99
        poll_operation: true
    - expect_stderr: |
        Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels delete $$vpn-tunnel$$ --region $$my-region$$ --quiet
    cleanup_for: vpn-tunnel
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '871'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            status: '200'
          body:
            kind: compute#operation
            id: '4260590667713054268'
            name: operation-1556887762284-587fb2e06af1f-dc232bbb-80e16f11
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            targetId: '6789128182195914366'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:49:23.733-07:00'
            startTime: '2019-05-03T05:49:23.757-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1556887762284-587fb2e06af1f-dc232bbb-80e16f11
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_progress_tracker:
        message: Deleting VPN tunnel
        status: SUCCESS
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules delete $$fwd-rule-esp$$ --region $$my-region$$
      --quiet
    cleanup_for: fwd-rule-esp
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '876'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5733544547915499059'
            name: operation-1556887771768-587fb2e9765d4-b9fa6169-ced32eb1
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$
            targetId: '2555004831725094539'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:49:32.358-07:00'
            startTime: '2019-05-03T05:49:32.404-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1556887771768-587fb2e9765d4-b9fa6169-ced32eb1
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules delete $$fwd-rule-udp500$$ --region $$my-region$$
      --quiet
    cleanup_for: fwd-rule-udp500
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '876'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3332998145480164870'
            name: operation-1556887785143-587fb2f637d00-ff16eb45-b582e89d
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$
            targetId: '8628101494645819033'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:49:45.553-07:00'
            startTime: '2019-05-03T05:49:45.572-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1556887785143-587fb2f637d00-ff16eb45-b582e89d
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules delete $$fwd-rule-udp4500$$ --region $$my-region$$
      --quiet
    cleanup_for: fwd-rule-udp4500
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '876'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3606141160514487834'
            name: operation-1556887797084-587fb3019b241-ef86a50f-6c6cf315
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$
            targetId: '4871699969165330028'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:49:57.544-07:00'
            startTime: '2019-05-03T05:49:57.562-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1556887797084-587fb3019b241-ef86a50f-6c6cf315
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses delete $$address$$ --region $$my-region$$ --quiet
    cleanup_for: address
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '870'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3979815302520211433'
            name: operation-1556887814284-587fb3120268b-c3a5bf19-a9b34310
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$
            targetId: '5168801857964967601'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:50:14.837-07:00'
            startTime: '2019-05-03T05:50:14.856-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1556887814284-587fb3120268b-c3a5bf19-a9b34310
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute target-vpn-gateways delete $$vpn-gateway$$ --region $$my-region$$
      --quiet
    cleanup_for: vpn-gateway
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '878'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '6942084702184507360'
            name: operation-1556887822000-587fb3195e1a0-1833229c-f50764db
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            targetId: '8713277555188270778'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:50:23.170-07:00'
            startTime: '2019-05-03T05:50:23.186-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1556887822000-587fb3195e1a0-1833229c-f50764db
            region: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute networks delete $$network$$ --quiet
    cleanup_for: network
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '732'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5938963440589703160'
            name: operation-1556887831026-587fb321f9ad7-e466aeb2-3a858670
            operationType: delete
            targetLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
            targetId: '5860135925826291421'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-03T05:50:31.408-07:00'
            startTime: '2019-05-03T05:50:31.425-07:00'
            selfLink: https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/operations/operation-1556887831026-587fb321f9ad7-e466aeb2-3a858670
        poll_operation: true
    - expect_stderr: |
        Deleted [https://$$compute-uri$$/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
    - expect_exit:
        code: 0
