skip: !!omap
- bug: b/121155171
- reason: Failing
title: VPN test labels
release_tracks: [ALPHA, BETA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute networks create --range 10.120.0.0/16 --subnet-mode LEGACY $$network$$
      --format "text(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
  - stdout: |
      ---
      name: $$network$$
- execute:
  - command: compute target-vpn-gateways create --region $$my-region$$ --network $$network$$
      $$vpn-gateway$$ --format "text(name,network,region)"
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
  - stdout: |
      ---
      name:    $$vpn-gateway$$
      network: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
      region:  https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
- execute:
  - command: compute addresses create --region $$my-region$$ $$address$$
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
- execute:
  - command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      ESP --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-esp$$
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
- execute:
  - command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-udp500$$
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
- execute:
  - command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 4500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$
      $$fwd-rule-udp4500$$
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
- execute:
  - command: compute vpn-tunnels create --region $$my-region$$ --peer-address 8.8.8.8
      --shared-secret 'whatever' --target-vpn-gateway $$vpn-gateway$$ $$vpn-tunnel$$
      --format "text(name,region,gateway)"
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$].
  - stdout: |
      ---
      name:   $$vpn-tunnel$$
      region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
- execute:
  - command: compute routes create --next-hop-vpn-tunnel-region $$my-region$$ --network
      $$network$$ --next-hop-vpn-tunnel $$vpn-tunnel$$ --destination-range 192.168.100.0/24
      $$route$$ --format "text(route,network)"
  - stderr: |
      Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
  - stdout: |
      ---
      network: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
- execute:
  - command: compute vpn-tunnels update $$vpn-tunnel$$ --region $$my-region$$ --update-labels
      x=y,abc=xyz
  - progress_tracker:
    - message: Updating labels of VPN tunnel [$$vpn-tunnel$$]
    - status: SUCCESS
- execute:
  - command: compute vpn-tunnels describe $$vpn-tunnel$$ --region $$my-region$$ --format
      "text(name,labels)"
  - stdout: |
      labels.abc: xyz
      labels.x:   y
      name:       $$vpn-tunnel$$
- execute:
  - command: compute vpn-tunnels update $$vpn-tunnel$$ --region $$my-region$$ --update-labels
      x=a,abc=xyz,t123=t7890 --remove-labels abc
  - progress_tracker:
    - message: Updating labels of VPN tunnel [$$vpn-tunnel$$]
    - status: SUCCESS
- execute:
  - command: compute vpn-tunnels describe $$vpn-tunnel$$ --region $$my-region$$ --format
      "text(name,labels)"
  - stdout: |
      labels.t123: t7890
      labels.x:    a
      name:        $$vpn-tunnel$$
- execute:
  - command: compute routes delete $$route$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
- execute:
  - command: compute vpn-tunnels delete $$vpn-tunnel$$ --region $$my-region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$].
- execute:
  - command: compute forwarding-rules delete $$fwd-rule-esp$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
- execute:
  - command: compute forwarding-rules delete $$fwd-rule-udp500$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
- execute:
  - command: compute forwarding-rules delete $$fwd-rule-udp4500$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
- execute:
  - command: compute addresses delete $$address$$ --region $$my-region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
- execute:
  - command: compute target-vpn-gateways delete $$vpn-gateway$$ --region $$my-region$$
      --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
- execute:
  - command: compute networks delete $$network$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
actions:
- define_reference:
    reference: api-version
    track_values:
      GA: v1
      BETA: beta
      ALPHA: alpha

- define_reference:
    reference: my-region
    value: us-central1

- generate_resource_id:
    reference: network
    prefix: compute-vpn-test

- generate_resource_id:
    reference: vpn-gateway
    prefix: compute-vpn-test

- generate_resource_id:
    reference: address
    prefix: compute-vpn-test

- generate_resource_id:
    reference: fwd-rule-esp
    prefix: compute-vpn-test

- generate_resource_id:
    reference: fwd-rule-udp500
    prefix: compute-vpn-test

- generate_resource_id:
    reference: fwd-rule-udp4500
    prefix: compute-vpn-test

- generate_resource_id:
    reference: vpn-tunnel
    prefix: compute-vpn-test

- generate_resource_id:
    reference: route
    prefix: compute-vpn-test

- execute_command:
    command: compute networks create --range 10.120.0.0/16 --subnet-mode LEGACY $$network$$
      --format "text(name)"
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
    - expect_stdout: |
        ---
        name: $$network$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute target-vpn-gateways create --region $$my-region$$ --network $$network$$
      $$vpn-gateway$$ --format "text(name,network,region)"
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
    - expect_stdout: |
        ---
        name:    $$vpn-gateway$$
        network: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
        region:  https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses create --region $$my-region$$ $$address$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      ESP --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-esp$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$ $$fwd-rule-udp500$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules create --region $$my-region$$ --ip-protocol
      UDP --ports 4500 --address $$address$$ --target-vpn-gateway $$vpn-gateway$$
      $$fwd-rule-udp4500$$
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels create --region $$my-region$$ --peer-address 8.8.8.8
      --shared-secret 'whatever' --target-vpn-gateway $$vpn-gateway$$ $$vpn-tunnel$$
      --format "text(name,region,gateway)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$vpn-tunnel$$
              peerIp: 8.8.8.8
              sharedSecret: whatever
              targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '829'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '864886070669980294'
            name: operation-1541016680539-5798be7d6237c-b595027b-74562b47
            operationType: insert
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            targetId: '8493593744735974022'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:11:21.442-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016680539-5798be7d6237c-b595027b-74562b47
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '950'
            Content-Type: application/json; charset=UTF-8
            ETag: '"UQ0_SYiTPzioKrmBP58J-cv-w30=/c4qYZrlzqToILmo4SOHVn9MKKqY="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '8493593744735974022'
            creationTimestamp: '2018-10-31T13:11:21.427-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: ABGZnDXhs3PG1J2pobn4h8xmwcef
            status: WAITING_FOR_FULL_CONFIG
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Waiting for route configuration.
            localTrafficSelector:
            - 10.120.0.0/16
            labelFingerprint: 42WmSpB8rSM=
    - expect_stdout: |
        ---
        name:   $$vpn-tunnel$$
        region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute routes create --next-hop-vpn-tunnel-region $$my-region$$ --network
      $$network$$ --next-hop-vpn-tunnel $$vpn-tunnel$$ --destination-range 192.168.100.0/24
      $$route$$ --format "text(route,network)"
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
    - expect_stdout: |
        ---
        network: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels update $$vpn-tunnel$$ --region $$my-region$$ --update-labels
      x=y,abc=xyz
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body:
        return_response:
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '933'
            content-type: application/json; charset=UTF-8
            etag: '"Pr2h1_Q66pE2078LR0d3GChq4ME=/0IORcrSxnQJ0Dj29S9PIamc1xVg="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '8493593744735974022'
            creationTimestamp: '2018-10-31T13:11:21.427-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: ABGZnDXhs3PG1J2pobn4h8xmwcef
            status: REJECTED
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Cannot send packets to peer IP
            localTrafficSelector:
            - 10.120.0.0/16
            labelFingerprint: 42WmSpB8rSM=
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$/setLabels?alt=json
          method: POST
          headers: {}
          body:
            json:
              labelFingerprint: 42WmSpB8rSM=
              labels:
                abc: xyz
                x: y
        return_response:
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '924'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            status: '200'
          body:
            kind: compute#operation
            id: '2099841296011604599'
            name: operation-1541016727024-5798bea9b7181-b5506fd0-2971767d
            operationType: setLabels
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            targetId: '8493593744735974022'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-10-31T13:12:08.034-07:00'
            startTime: '2018-10-31T13:12:08.039-07:00'
            endTime: '2018-10-31T13:12:08.039-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016727024-5798bea9b7181-b5506fd0-2971767d
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_progress_tracker:
        message: Updating labels of VPN tunnel [$$vpn-tunnel$$]
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body:
        return_response:
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '977'
            content-type: application/json; charset=UTF-8
            etag: '"_O9CpeGdW-y2PuE_UZPCH5MSpmM=/ygw_wbiiunLqvg4P3ogncnb-txc="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '8493593744735974022'
            creationTimestamp: '2018-10-31T13:11:21.427-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: ABGZnDXhs3PG1J2pobn4h8xmwcef
            status: REJECTED
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Cannot send packets to peer IP
            localTrafficSelector:
            - 10.120.0.0/16
            labels:
              abc: xyz
              x: y
            labelFingerprint: ecVX6WS0TtA=
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels describe $$vpn-tunnel$$ --region $$my-region$$ --format
      "text(name,labels)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '977'
            Content-Type: application/json; charset=UTF-8
            ETag: '"51O8GnYpFO-TgHh8Fc6fYNuNSqk=/_GQSVn8V6n9Y4V8quuts5eOSLO8="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '8493593744735974022'
            creationTimestamp: '2018-10-31T13:11:21.427-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: ABGZnDXhs3PG1J2pobn4h8xmwcef
            status: REJECTED
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Cannot send packets to peer IP
            localTrafficSelector:
            - 10.120.0.0/16
            labels:
              abc: xyz
              x: y
            labelFingerprint: ecVX6WS0TtA=
    - expect_stdout: |
        labels.abc: xyz
        labels.x:   y
        name:       $$vpn-tunnel$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels update $$vpn-tunnel$$ --region $$my-region$$ --update-labels
      x=a,abc=xyz,t123=t7890 --remove-labels abc
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body:
        return_response:
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '977'
            content-type: application/json; charset=UTF-8
            etag: '"VB81hor40qJ_rGlZw3Jozym2j_8=/G6ptcvtJ2v8FWfwumEFzLgrG1PU="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '8493593744735974022'
            creationTimestamp: '2018-10-31T13:11:21.427-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: ABGZnDXhs3PG1J2pobn4h8xmwcef
            status: REJECTED
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Cannot send packets to peer IP
            localTrafficSelector:
            - 10.120.0.0/16
            labels:
              abc: xyz
              x: y
            labelFingerprint: ecVX6WS0TtA=
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$/setLabels?alt=json
          method: POST
          headers: {}
          body:
            json:
              labelFingerprint: ecVX6WS0TtA=
              labels:
                t123: t7890
                x: a
        return_response:
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '923'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            status: '200'
          body:
            kind: compute#operation
            id: '580470845247828596'
            name: operation-1541016731073-5798bead939e8-8308437d-78a8ff46
            operationType: setLabels
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            targetId: '8493593744735974022'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-10-31T13:12:11.704-07:00'
            startTime: '2018-10-31T13:12:11.708-07:00'
            endTime: '2018-10-31T13:12:11.708-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016731073-5798bead939e8-8308437d-78a8ff46
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_progress_tracker:
        message: Updating labels of VPN tunnel [$$vpn-tunnel$$]
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body:
        return_response:
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '980'
            content-type: application/json; charset=UTF-8
            etag: '"s3c8hexXUJwXh51KTJKDDY7PIVg=/JSopvm9VqM8qlpaKMtqjj4F-Vh8="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '8493593744735974022'
            creationTimestamp: '2018-10-31T13:11:21.427-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: ABGZnDXhs3PG1J2pobn4h8xmwcef
            status: REJECTED
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Cannot send packets to peer IP
            localTrafficSelector:
            - 10.120.0.0/16
            labels:
              t123: t7890
              x: a
            labelFingerprint: KCoiqxISIcU=
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels describe $$vpn-tunnel$$ --region $$my-region$$ --format
      "text(name,labels)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: GET
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '980'
            Content-Type: application/json; charset=UTF-8
            ETag: '"N_m_pTOzNTwoaNfUMxkrFrVyEgE=/esIuVoiy5v5ZkJ478fH2MK5b3zs="'
            status: '200'
          body:
            kind: compute#vpnTunnel
            id: '8493593744735974022'
            creationTimestamp: '2018-10-31T13:11:21.427-07:00'
            name: $$vpn-tunnel$$
            description: ''
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            targetVpnGateway: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            peerIp: 8.8.8.8
            sharedSecret: '*************'
            sharedSecretHash: ABGZnDXhs3PG1J2pobn4h8xmwcef
            status: REJECTED
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            ikeVersion: 2
            detailedStatus: Cannot send packets to peer IP
            localTrafficSelector:
            - 10.120.0.0/16
            labels:
              t123: t7890
              x: a
            labelFingerprint: KCoiqxISIcU=
    - expect_stdout: |
        labels.t123: t7890
        labels.x:    a
        name:        $$vpn-tunnel$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute routes delete $$route$$ --quiet
    cleanup_for: route
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '687'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2631912195511267953'
            name: operation-1541016734279-5798beb0a2559-d4faa0e6-694d1d6d
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$
            targetId: '8091557983759610479'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:12:14.695-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/operations/operation-1541016734279-5798beb0a2559-d4faa0e6-694d1d6d
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/routes/$$route$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute vpn-tunnels delete $$vpn-tunnel$$ --region $$my-region$$ --quiet
    cleanup_for: vpn-tunnel
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '830'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '1905110343554151002'
            name: operation-1541016756901-5798bec635489-16bbb575-e393f5ec
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$
            targetId: '8493593744735974022'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:12:37.483-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016756901-5798bec635489-16bbb575-e393f5ec
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/vpnTunnels/$$vpn-tunnel$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules delete $$fwd-rule-esp$$ --region $$my-region$$
      --quiet
    cleanup_for: fwd-rule-esp
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '835'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7214210836518646312'
            name: operation-1541016774546-5798bed709251-26d7e9f8-82f35052
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$
            targetId: '2595780160363410092'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:12:55.010-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016774546-5798bed709251-26d7e9f8-82f35052
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-esp$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules delete $$fwd-rule-udp500$$ --region $$my-region$$
      --quiet
    cleanup_for: fwd-rule-udp500
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '835'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5192731517414519345'
            name: operation-1541016798136-5798beed886c2-ba252ac6-711ff8b8
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$
            targetId: '5025674310555513504'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:13:18.622-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016798136-5798beed886c2-ba252ac6-711ff8b8
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute forwarding-rules delete $$fwd-rule-udp4500$$ --region $$my-region$$
      --quiet
    cleanup_for: fwd-rule-udp4500
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '835'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3697305122778886661'
            name: operation-1541016810216-5798bef90da40-db051e43-8a925ec1
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$
            targetId: '1247347239021949619'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:13:30.628-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016810216-5798bef90da40-db051e43-8a925ec1
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/forwardingRules/$$fwd-rule-udp4500$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses delete $$address$$ --region $$my-region$$ --quiet
    cleanup_for: address
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '829'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '8687142417250890259'
            name: operation-1541016827617-5798bf09a5ee8-db21f50b-bef02819
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$
            targetId: '5162433722891875025'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:13:48.120-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016827617-5798bf09a5ee8-db21f50b-bef02819
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute target-vpn-gateways delete $$vpn-gateway$$ --region $$my-region$$
      --quiet
    cleanup_for: vpn-gateway
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '837'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '1461261572712674284'
            name: operation-1541016835348-5798bf1105621-ab3104ff-44ac4d7b
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$
            targetId: '8356474096312627930'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:13:55.841-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1541016835348-5798bf1105621-ab3104ff-44ac4d7b
            region: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/regions/$$my-region$$/targetVpnGateways/$$vpn-gateway$$].
    - expect_exit:
        code: 0
- execute_command:
    command: compute networks delete $$network$$ --quiet
    cleanup_for: network
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$?alt=json
          method: DELETE
          headers: {}
          body:
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '689'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '1288526277354435556'
            name: operation-1541016843221-5798bf1887808-bedfbd10-67a2f3cd
            operationType: delete
            targetLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$
            targetId: '2302369916213768946'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-10-31T13:14:03.567-07:00'
            selfLink: https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/operations/operation-1541016843221-5798bf1887808-bedfbd10-67a2f3cd
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/$$api-version$$/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
    - expect_exit:
        code: 0
