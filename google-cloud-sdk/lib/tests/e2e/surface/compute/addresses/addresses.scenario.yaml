title: AddressesTest
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: |
      compute instances create $$instance1$$ --zone $$my-zone$$ --format "text(status)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
  - stdout: |
      ---
      status: RUNNING
- execute:
  - command: compute addresses create $$address1$$ --region $$my-region$$
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$].
- execute:
  - command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status)"
  - stdout: |
      address: $$my-ip-address$$
      status:  RESERVED
- execute:
  - command: compute instances delete-access-config $$instance1$$ --zone $$my-zone$$
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
- execute:
  - command: compute instances add-access-config $$instance1$$ --zone $$my-zone$$
      --address $$my-ip-address$$
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
- execute:
  - command: compute instances describe $$instance1$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
  - stdout: |
      networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address$$
      status:                                      RUNNING
- execute:
  - command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status,users)"
  - stdout: |
      address:  $$my-ip-address$$
      status:   IN_USE
      users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
- execute:
  - command: compute addresses delete $$address1$$ --region $$my-region$$ -q
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$].
- execute:
  - command: compute instances delete $$instance1$$ --zone $$my-zone$$ -q
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses create $$address2$$ --region $$my-region$$
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$].
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status)"
  - stdout: |
      address: $$my-ip-address2$$
      status:  RESERVED
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute instances create $$instance2$$ --zone $$my-zone$$ --address $$my-ip-address2$$
      --format "text(status)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$].
  - stdout: |
      ---
      status: RUNNING
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute instances describe $$instance2$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
  - stdout: |
      networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address2$$
      status:                                      RUNNING
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status,users)"
  - stdout: |
      address:  $$my-ip-address2$$
      status:   IN_USE
      users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses delete $$address2$$ --region $$my-region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$].
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute instances delete $$instance2$$ --zone $$my-zone$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$].
- execute:
  - label: Test assign IP Version
  - command: compute addresses create $$address3$$ --global --ip-version ipv4
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$].
- execute:
  - label: Test assign IP Version
  - command: compute addresses describe $$address3$$ --global --format "text(status,ipVersion)"
  - stdout: |
      ipVersion: IPV4
      status:    RESERVED
- execute:
  - label: Test assign IP Version
  - command: compute addresses delete $$address3$$ --global --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$].
actions:
- define_reference:
    reference: my-zone
    value: us-central1-f
- define_reference:
    reference: my-region
    value: us-central1
- generate_resource_id:
    reference: instance1
    prefix: gcloud-compute-test
- generate_resource_id:
    reference: address1
    prefix: gcloud-compute-test-address
- generate_resource_id:
    reference: instance2
    prefix: gcloud-compute-test
- generate_resource_id:
    reference: address2
    prefix: gcloud-compute-test-address
- generate_resource_id:
    reference: address3
    prefix: gcloud-compute-test-address
- execute_command:
    command: |
      compute instances create $$instance1$$ --zone $$my-zone$$ --format "text(status)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"ZpbtAE7HJG4pPuChVyALfXtnqgc=/EpgttyThEsSds_vl4-skpf4tmAQ="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: $$my-zone$$
            description: $$my-zone$$
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          omit_fields:
          - commonInstanceMetadata
          - quotas
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '387140'
            Content-Type: application/json; charset=UTF-8
            ETag: '"wGhmMAf9JE6IBRws3H2DpJ2j3YU=/JIauRumDNgXtIJm0is474Y4fjtQ="'
            status: '200'
          body:
            kind: compute#project
            id: '17966956004057981335'
            creationTimestamp: '2014-09-30T07:55:22.502-07:00'
            name: cloud-sdk-integration-testing
            usageExportLocation:
              bucketName: cloud-sdk-integration-test-usage
              reportNamePrefix: ''
            enabledFeatures:
            - alpha-api
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing
            defaultServiceAccount: 462803083913-compute@developer.gserviceaccount.com
            xpnProjectStatus: UNSPECIFIED_XPN_PROJECT_STATUS
            defaultNetworkTier: PREMIUM
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances?alt=json
          method: POST
          headers: {}
          body:
            json:
              canIpForward: false
              deletionProtection: false
              disks:
              - autoDelete: true
                boot: true
                initializeParams:
                  sourceImage: https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/family/debian-9
                mode: READ_WRITE
                type: PERSISTENT
              machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
              metadata: {}
              name: $$instance1$$
              networkInterfaces:
              - accessConfigs:
                - name: external-nat
                  type: ONE_TO_ONE_NAT
                network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              scheduling:
                automaticRestart: true
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '824'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2296735692212318186'
            name: operation-1542131971362-57a8f94598cd2-a1db11f9-75ccd5da
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            targetId: '1173538960476385260'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T09:59:33.737-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1542131971362-57a8f94598cd2-a1db11f9-75ccd5da
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2562'
            Content-Type: application/json; charset=UTF-8
            ETag: '"H_zhJcKFPy3RN-EH61KoSYd18cw=/CtLXQMAlmqhcC_6C0409jmqhYjY="'
            status: '200'
          body:
            kind: compute#instance
            id: '1173538960476385260'
            creationTimestamp: '2018-11-13T09:59:33.529-08:00'
            name: $$instance1$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.20
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.192.18.2
                networkTier: PREMIUM
              fingerprint: q12zAoXNlf4=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance1$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_stdout: |
        ---
        status: RUNNING
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses create $$address1$$ --region $$my-region$$
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$address1$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '834'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '6939207765634494412'
            name: operation-1542132002423-57a8f963380d9-4f1cbf2c-4f012391
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$
            targetId: '5662803438711779276'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:00:03.630-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1542132002423-57a8f963380d9-4f1cbf2c-4f012391
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          extract_references:
          - field: address
            reference: my-ip-address
          body:
            json:
              kind: compute#address
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '559'
            Content-Type: application/json; charset=UTF-8
            ETag: '"Jjp0P9TWEkuzMImEV_0AWwi-tiA=/2FBKCY-tfJr1TV8ibVbypZobgl0="'
            status: '200'
          body:
            kind: compute#address
            id: '5662803438711779276'
            creationTimestamp: '2018-11-13T10:00:03.625-08:00'
            name: $$address1$$
            description: ''
            address: 35.226.62.233
            status: RESERVED
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$
            networkTier: PREMIUM
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '559'
            Content-Type: application/json; charset=UTF-8
            ETag: '"TgR7pDukTLjf63SHUQhFlCUCb0w=/zaerRQkwciWwiTtOL12_6ya-qXo="'
            status: '200'
          body:
            kind: compute#address
            id: '5662803438711779276'
            creationTimestamp: '2018-11-13T10:00:03.625-08:00'
            name: $$address1$$
            description: ''
            address: 35.226.62.233
            status: RESERVED
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$
            networkTier: PREMIUM
    - expect_stdout: |
        address: $$my-ip-address$$
        status:  RESERVED
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances delete-access-config $$instance1$$ --zone $$my-zone$$
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$/deleteAccessConfig?accessConfig=external-nat&alt=json&networkInterface=nic0
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '836'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2334753531535732677'
            name: operation-1542132009194-57a8f969ad212-e58b8156-1a5fbfb6
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: deleteAccessConfig
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            targetId: '1173538960476385260'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:00:10.519-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1542132009194-57a8f969ad212-e58b8156-1a5fbfb6
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2366'
            Content-Type: application/json; charset=UTF-8
            ETag: '"hf-KIpAJqccLu0qAhmVsolUhhpI=/fxuiMufut21pvDuaHKV36p-xGZU="'
            status: '200'
          body:
            kind: compute#instance
            id: '1173538960476385260'
            creationTimestamp: '2018-11-13T09:59:33.529-08:00'
            name: $$instance1$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.20
              name: nic0
              fingerprint: r2BVP2aLF4o=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance1$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances add-access-config $$instance1$$ --zone $$my-zone$$
      --address $$my-ip-address$$
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$/addAccessConfig?alt=json&networkInterface=nic0
          method: POST
          headers: {}
          body:
            json:
              name: external-nat
              natIP: $$my-ip-address$$
              type: ONE_TO_ONE_NAT
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '832'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '956442318012329901'
            name: operation-1542132033920-57a8f98141c05-c38e9851-3b3eea06
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: addAccessConfig
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            targetId: '1173538960476385260'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:00:34.526-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1542132033920-57a8f98141c05-c38e9851-3b3eea06
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2564'
            Content-Type: application/json; charset=UTF-8
            ETag: '"qdp8ZF0NfVDY3YcBYAV2wshClvM=/w4h3R4njSd53J6LsmCkpTUph34U="'
            status: '200'
          body:
            kind: compute#instance
            id: '1173538960476385260'
            creationTimestamp: '2018-11-13T09:59:33.529-08:00'
            name: $$instance1$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.20
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.226.62.233
                networkTier: PREMIUM
              fingerprint: i--9-0E1xB8=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance1$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances describe $$instance1$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2564'
            Content-Type: application/json; charset=UTF-8
            ETag: '"J9MwRWSbxj-e8_SkSe_TFXQwI2Q=/RQPmZvHmRkowF2_dAihDuflV64M="'
            status: '200'
          body:
            kind: compute#instance
            id: '1173538960476385260'
            creationTimestamp: '2018-11-13T09:59:33.529-08:00'
            name: $$instance1$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.20
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.226.62.233
                networkTier: PREMIUM
              fingerprint: i--9-0E1xB8=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance1$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_stdout: |
        networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address$$
        status:                                      RUNNING
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status,users)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '725'
            Content-Type: application/json; charset=UTF-8
            ETag: '"uHj75C8dK-pi_cpPC0cQD4LP9qI=/HBaAo9638DCOXvQuV_9F6_tM86U="'
            status: '200'
          body:
            kind: compute#address
            id: '5662803438711779276'
            creationTimestamp: '2018-11-13T10:00:03.625-08:00'
            name: $$address1$$
            description: ''
            address: 35.226.62.233
            status: IN_USE
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$
            users:
            - https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            networkTier: PREMIUM
    - expect_stdout: |
        address:  $$my-ip-address$$
        status:   IN_USE
        users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: address1
    command: compute addresses delete $$address1$$ --region $$my-region$$ -q
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '834'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7062997012392095678'
            name: operation-1542132049314-57a8f98ff00d1-d4fcf319-61511715
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$
            targetId: '5662803438711779276'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:00:49.836-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1542132049314-57a8f98ff00d1-d4fcf319-61511715
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$].
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: instance1
    command: compute instances delete $$instance1$$ --zone $$my-zone$$ -q
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '824'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7972549181628133305'
            name: operation-1542132054357-57a8f994bf40d-be90efcb-6d015ab9
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            targetId: '1173538960476385260'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:00:54.870-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1542132054357-57a8f994bf40d-be90efcb-6d015ab9
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$].
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute addresses create $$address2$$ --region $$my-region$$
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$address2$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '834'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '4569426862480469840'
            name: operation-1542132158022-57a8f9f79c171-b17f9ac1-c07e92a8
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            targetId: '4040240158074122064'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:02:39.053-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1542132158022-57a8f9f79c171-b17f9ac1-c07e92a8
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '560'
            Content-Type: application/json; charset=UTF-8
            ETag: '"f76uRIW_8QVXvhyMN32W_UZvdjs=/OSodUtgBvwyK95_KdPY8TxtFc1Y="'
            status: '200'
          body:
            kind: compute#address
            id: '4040240158074122064'
            creationTimestamp: '2018-11-13T10:02:39.046-08:00'
            name: $$address2$$
            description: ''
            address: 35.238.215.155
            status: RESERVED
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            networkTier: PREMIUM
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          extract_references:
          - field: address
            reference: my-ip-address2
          body:
            json:
              kind: compute#address
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '560'
            Content-Type: application/json; charset=UTF-8
            ETag: '"DE4ycWOmPjn6PAs9DO_60MAXPd0=/XrzOyHgv_IhayT9gHGNiyG-d_4o="'
            status: '200'
          body:
            kind: compute#address
            id: '4040240158074122064'
            creationTimestamp: '2018-11-13T10:02:39.046-08:00'
            name: $$address2$$
            description: ''
            address: 35.238.215.155
            status: RESERVED
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            networkTier: PREMIUM
    - expect_stdout: |
        address: $$my-ip-address2$$
        status:  RESERVED
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute instances create $$instance2$$ --zone $$my-zone$$ --address $$my-ip-address2$$
      --format "text(status)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"gXFIpyV2sChrUB3sP-EmJ_g-weg=/QJBx2Y5XYvCAXt57Kia3TymwZc0="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: $$my-zone$$
            description: $$my-zone$$
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          omit_fields:
          - commonInstanceMetadata
          - quotas
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '387140'
            Content-Type: application/json; charset=UTF-8
            ETag: '"Mv19AuXdUvBocelbEpUgzfZUo4w=/NFQjY1nzXi4QxOunzku4vLzQSgA="'
            status: '200'
          body:
            kind: compute#project
            id: '17966956004057981335'
            creationTimestamp: '2014-09-30T07:55:22.502-07:00'
            name: cloud-sdk-integration-testing
            usageExportLocation:
              bucketName: cloud-sdk-integration-test-usage
              reportNamePrefix: ''
            enabledFeatures:
            - alpha-api
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing
            defaultServiceAccount: 462803083913-compute@developer.gserviceaccount.com
            xpnProjectStatus: UNSPECIFIED_XPN_PROJECT_STATUS
            defaultNetworkTier: PREMIUM
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances?alt=json
          method: POST
          headers: {}
          body:
            json:
              canIpForward: false
              deletionProtection: false
              disks:
              - autoDelete: true
                boot: true
                initializeParams:
                  sourceImage: https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/family/debian-9
                mode: READ_WRITE
                type: PERSISTENT
              machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
              metadata: {}
              name: $$instance2$$
              networkInterfaces:
              - accessConfigs:
                - name: external-nat
                  natIP: $$my-ip-address2$$
                  type: ONE_TO_ONE_NAT
                network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              scheduling:
                automaticRestart: true
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '824'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2873000009891491621'
            name: operation-1542132165479-57a8f9feb8a58-eeaddbc4-1e2d03db
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
            targetId: '6033696224321122089'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:02:51.408-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1542132165479-57a8f9feb8a58-eeaddbc4-1e2d03db
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2565'
            Content-Type: application/json; charset=UTF-8
            ETag: '"qGSG66AhD4MMLTLukkrTo-sBX_w=/ce-DdRI_7jcyj2qupb-v2Vg02E4="'
            status: '200'
          body:
            kind: compute#instance
            id: '6033696224321122089'
            creationTimestamp: '2018-11-13T10:02:50.473-08:00'
            name: $$instance2$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.28
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.238.215.155
                networkTier: PREMIUM
              fingerprint: cwIx_PB2OUU=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance2$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_stdout: |
        ---
        status: RUNNING
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute instances describe $$instance2$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2565'
            Content-Type: application/json; charset=UTF-8
            ETag: '"yCDljuFNcL2k4YspqtxZm_lgDBI=/jj8lC23rYdWy0Z1HHv_B9RE5g3Y="'
            status: '200'
          body:
            kind: compute#instance
            id: '6033696224321122089'
            creationTimestamp: '2018-11-13T10:02:50.473-08:00'
            name: $$instance2$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.28
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.238.215.155
                networkTier: PREMIUM
              fingerprint: cwIx_PB2OUU=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance2$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_stdout: |
        networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address2$$
        status:                                      RUNNING
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status,users)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '726'
            Content-Type: application/json; charset=UTF-8
            ETag: '"GSf8M5I53G3eiB_r14w8SnB1uhI=/kTEUSdYRXjWz98J4qc6JrhzquII="'
            status: '200'
          body:
            kind: compute#address
            id: '4040240158074122064'
            creationTimestamp: '2018-11-13T10:02:39.046-08:00'
            name: $$address2$$
            description: ''
            address: 35.238.215.155
            status: IN_USE
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            users:
            - https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
            networkTier: PREMIUM
    - expect_stdout: |
        address:  $$my-ip-address2$$
        status:   IN_USE
        users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    cleanup_for: address2
    command: compute addresses delete $$address2$$ --region $$my-region$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '834'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2879690160189386523'
            name: operation-1542132211851-57a8fa2af1ef9-b5337989-9a7c9522
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            targetId: '4040240158074122064'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:03:32.609-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1542132211851-57a8fa2af1ef9-b5337989-9a7c9522
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$].
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    cleanup_for: instance2
    command: compute instances delete $$instance2$$ --zone $$my-zone$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '824'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5145353990867169043'
            name: operation-1542132220067-57a8fa32c7cb8-3998d348-509da992
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
            targetId: '6033696224321122089'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:03:41.019-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1542132220067-57a8fa32c7cb8-3998d348-509da992
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$].
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign IP Version
    command: compute addresses create $$address3$$ --global --ip-version ipv4
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses?alt=json
          method: POST
          headers: {}
          body:
            json:
              ipVersion: IPV4
              name: $$address3$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '697'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '6690393777531956374'
            name: operation-1542132344976-57a8faa9e7280-f338b585-e0cc3ba7
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$
            targetId: '2636953460616375446'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:05:45.677-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/operations/operation-1542132344976-57a8faa9e7280-f338b585-e0cc3ba7
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '458'
            Content-Type: application/json; charset=UTF-8
            ETag: '"CObdHpzc3MzyLwKsCSoTk0S_hpQ=/kmHdC7xCSKcR6vwgwgTJmjyS7FY="'
            status: '200'
          body:
            kind: compute#address
            id: '2636953460616375446'
            creationTimestamp: '2018-11-13T10:05:45.493-08:00'
            name: $$address3$$
            description: ''
            address: 35.244.255.187
            status: RESERVED
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$
            networkTier: PREMIUM
            ipVersion: IPV4
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign IP Version
    command: compute addresses describe $$address3$$ --global --format "text(status,ipVersion)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '458'
            Content-Type: application/json; charset=UTF-8
            ETag: '"zdFE3fx_dZTcJfh39GbPWp8KGs8=/sc_HroYf5DKLsCUYEZg0yXAO0sA="'
            status: '200'
          body:
            kind: compute#address
            id: '2636953460616375446'
            creationTimestamp: '2018-11-13T10:05:45.493-08:00'
            name: $$address3$$
            description: ''
            address: 35.244.255.187
            status: RESERVED
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$
            networkTier: PREMIUM
            ipVersion: IPV4
    - expect_stdout: |
        ipVersion: IPV4
        status:    RESERVED
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign IP Version
    cleanup_for: address3
    command: compute addresses delete $$address3$$ --global --quiet
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '697'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7933441752051395689'
            name: operation-1542132358160-57a8fab679e82-f77ebd07-cdbfe84c
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$
            targetId: '2636953460616375446'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-13T10:05:58.848-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/operations/operation-1542132358160-57a8fab679e82-f77ebd07-cdbfe84c
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$].
    - expect_exit:
        code: 0
