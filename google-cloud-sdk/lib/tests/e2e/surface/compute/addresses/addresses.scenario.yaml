title: AddressesTest
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: |
      compute instances create $$instance1$$ --zone $$my-zone$$ --format "text(status)"
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
      $
  - stdout: |
      ---
      status: RUNNING
- execute:
  - command: compute addresses create $$address1$$ --region $$my-region$$
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$\].
      $
- execute:
  - command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status)"
  - stdout: |
      address: $$my-ip-address$$
      status:  RESERVED
- execute:
  - command: compute instances delete-access-config $$instance1$$ --zone $$my-zone$$
  - stderr: |-
      Updated \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
      $
- execute:
  - command: compute instances add-access-config $$instance1$$ --zone $$my-zone$$
      --address $$my-ip-address$$
  - stderr: |-
      Updated \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
      $
- execute:
  - command: compute instances describe $$instance1$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
  - stdout: |
      networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address$$
      status:                                      RUNNING
- execute:
  - command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status,users)"
  - stdout: |
      address:  $$my-ip-address$$
      status:   IN_USE
      users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
- execute:
  - command: compute addresses delete $$address1$$ --region $$my-region$$ -q
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$\].
      $
- execute:
  - command: compute instances delete $$instance1$$ --zone $$my-zone$$ -q
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
      $
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses create $$address2$$ --region $$my-region$$
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$\].
      $
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status)"
  - stdout: |
      address: $$my-ip-address2$$
      status:  RESERVED
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute instances create $$instance2$$ --zone $$my-zone$$ --address $$my-ip-address2$$
      --format "text(status)"
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$\].
      $
  - stdout: |
      ---
      status: RUNNING
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute instances describe $$instance2$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
  - stdout: |
      networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address2$$
      status:                                      RUNNING
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status,users)"
  - stdout: |
      address:  $$my-ip-address2$$
      status:   IN_USE
      users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute addresses delete $$address2$$ --region $$my-region$$ --quiet
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$\].
      $
- execute:
  - label: Test assign external address to instance upon creation
  - command: compute instances delete $$instance2$$ --zone $$my-zone$$ --quiet
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$\].
      $
- execute:
  - label: Test assign IP Version
  - command: compute addresses create $$address3$$ --global --ip-version ipv4
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$\].
      $
- execute:
  - label: Test assign IP Version
  - command: compute addresses describe $$address3$$ --global --format "text(status,ipVersion)"
  - stdout: |
      ipVersion: IPV4
      status:    RESERVED
- execute:
  - label: Test assign IP Version
  - command: compute addresses delete $$address3$$ --global --quiet
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$\].
      $
actions:
- define_reference:
    reference: compute-uri
    value: compute.googleapis.com/compute
- define_reference:
    reference: my-zone
    value: us-central1-f
- define_reference:
    reference: my-region
    value: us-central1
- generate_resource_id:
    reference: instance1
    prefix: gcloud-compute-test
- generate_resource_id:
    reference: address1
    prefix: gcloud-compute-test-address
- generate_resource_id:
    reference: instance2
    prefix: gcloud-compute-test
- generate_resource_id:
    reference: address2
    prefix: gcloud-compute-test-address
- generate_resource_id:
    reference: address3
    prefix: gcloud-compute-test-address
- execute_command:
    command: |
      compute instances create $$instance1$$ --zone $$my-zone$$ --format "text(status)"
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"L6xbZiKnxYslsvQM-MQD88jhk-k=/fh5zEwofMvEmg0r0kLzGV4LThs8="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: $$my-zone$$
            description: $$my-zone$$
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          omit_fields:
          - commonInstanceMetadata
          - quotas
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '468942'
            Content-Type: application/json; charset=UTF-8
            ETag: '"K4I9gcRuqdZhMLvvpxWoOp82tK0=/7PtgQj1ZdoQ8mq_KI7ImY8wmm2Q="'
            status: '200'
          body:
            kind: compute#project
            id: '17966956004057981335'
            creationTimestamp: '2014-09-30T07:55:22.502-07:00'
            name: cloud-sdk-integration-testing
            usageExportLocation:
              bucketName: cloud-sdk-integration-test-usage
              reportNamePrefix: ''
            enabledFeatures:
            - alpha-api
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing
            defaultServiceAccount: 462803083913-compute@developer.gserviceaccount.com
            xpnProjectStatus: UNSPECIFIED_XPN_PROJECT_STATUS
            defaultNetworkTier: PREMIUM
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances?alt=json
          method: POST
          headers: {}
          body:
            json:
              canIpForward: false
              deletionProtection: false
              disks:
              - autoDelete: true
                boot: true
                initializeParams:
                  sourceImage: https://$$compute-uri$$/v1/projects/debian-cloud/global/images/family/debian-9
                mode: READ_WRITE
                type: PERSISTENT
              machineType: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
              metadata: {}
              name: $$instance1$$
              networkInterfaces:
              - accessConfigs:
                - name: external-nat
                  type: ONE_TO_ONE_NAT
                network: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/global/networks/default
              scheduling:
                automaticRestart: true
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '871'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7533831264570296940'
            name: operation-1557951618100-588f2e0c62e46-ac6db56d-a3c0e0a0
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            targetId: '2162478046738762349'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-15T13:20:19.520-07:00'
            startTime: '2019-05-15T13:20:19.523-07:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1557951618100-588f2e0c62e46-ac6db56d-a3c0e0a0
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2561'
            Content-Type: application/json; charset=UTF-8
            ETag: '"zivLPgV6LqKJCK5Ga9__MpO4f0g=/jgTN870gYADy7Aoo8rxrhI3rV0U="'
            status: '200'
          body:
            kind: compute#instance
            id: '2162478046738762349'
            creationTimestamp: '2019-05-15T13:20:19.416-07:00'
            name: $$instance1$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.77
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.225.75.111
                networkTier: PREMIUM
              fingerprint: 7qBUvLjcd2A=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance1$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Haswell
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_stdout: |
        ---
        status: RUNNING
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses create $$address1$$ --region $$my-region$$
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$address1$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '880'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '480066793423096394'
            name: operation-1557951652414-588f2e2d1c57b-e6c48e0e-c1e81083
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$
            targetId: '6321158256545876554'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-15T13:20:53.060-07:00'
            startTime: '2019-05-15T13:20:53.077-07:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1557951652414-588f2e2d1c57b-e6c48e0e-c1e81083
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          extract_references:
          - field: address
            reference: my-ip-address
          body:
            json:
              kind: compute#address
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '586'
            Content-Type: application/json; charset=UTF-8
            ETag: '"v7pnJDxX7GyMrnj5K8yRdQPEYg8=/355r1nEIge2tfVjwm98UOvKaEDo="'
            status: '200'
          body:
            kind: compute#address
            id: '6321158256545876554'
            creationTimestamp: '2019-05-15T13:20:53.053-07:00'
            name: $$address1$$
            description: ''
            address: 35.226.16.84
            status: RESERVED
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$
            networkTier: PREMIUM
            addressType: EXTERNAL
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status)"
    validation_only: true
    events:
    - expect_stdout: |
        address: $$my-ip-address$$
        status:  RESERVED
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances delete-access-config $$instance1$$ --zone $$my-zone$$
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$/deleteAccessConfig?accessConfig=external-nat&alt=json&networkInterface=nic0
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '883'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '9065958528412404290'
            name: operation-1557951661293-588f2e35940ca-bd05d482-dceb35af
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: deleteAccessConfig
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            targetId: '2162478046738762349'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-15T13:21:01.793-07:00'
            startTime: '2019-05-15T13:21:01.801-07:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1557951661293-588f2e35940ca-bd05d482-dceb35af
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2363'
            Content-Type: application/json; charset=UTF-8
            ETag: '"-5fMilxDrEfx0Xky1Znjv2wqEzc=/UUqoDpbRnQO-zFq7TChlrWtx_78="'
            status: '200'
          body:
            kind: compute#instance
            id: '2162478046738762349'
            creationTimestamp: '2019-05-15T13:20:19.416-07:00'
            name: $$instance1$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.77
              name: nic0
              fingerprint: eklZ99KUohY=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance1$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Haswell
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances add-access-config $$instance1$$ --zone $$my-zone$$
      --address $$my-ip-address$$
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$/addAccessConfig?alt=json&networkInterface=nic0
          method: POST
          headers: {}
          body:
            json:
              name: external-nat
              natIP: $$my-ip-address$$
              type: ONE_TO_ONE_NAT
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '880'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3508691187247729232'
            name: operation-1557951678711-588f2e46307a6-bdace8c7-db5f3bb9
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: addAccessConfig
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            targetId: '2162478046738762349'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-15T13:21:19.340-07:00'
            startTime: '2019-05-15T13:21:19.350-07:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1557951678711-588f2e46307a6-bdace8c7-db5f3bb9
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2560'
            Content-Type: application/json; charset=UTF-8
            ETag: '"Djv8Z7U17cD3fRYSawql62k7R0o=/CdyrqUfP016kftu-hT8Npf23Fr0="'
            status: '200'
          body:
            kind: compute#instance
            id: '2162478046738762349'
            creationTimestamp: '2019-05-15T13:20:19.416-07:00'
            name: $$instance1$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.0.77
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.226.16.84
                networkTier: PREMIUM
              fingerprint: nsuPdanVKLU=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance1$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Haswell
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances describe $$instance1$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
    validation_only: true
    events:
    - expect_stdout: |
        networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address$$
        status:                                      RUNNING
    - expect_exit:
        code: 0
- execute_command:
    command: compute addresses describe $$address1$$ --region $$my-region$$ --format
      "text(address,status,users)"
    validation_only: true
    events:
    - expect_stdout: |
        address:  $$my-ip-address$$
        status:   IN_USE
        users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: address1
    command: compute addresses delete $$address1$$ --region $$my-region$$ -q
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address1$$\].
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: instance1
    command: compute instances delete $$instance1$$ --zone $$my-zone$$ -q
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance1$$\].
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute addresses create $$address2$$ --region $$my-region$$
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$address2$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '881'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '1763977731041774576'
            name: operation-1557951775038-588f2ea20db03-8b2f09d7-820e57b7
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            targetId: '5847904275580177392'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-15T13:22:55.750-07:00'
            startTime: '2019-05-15T13:22:55.766-07:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/operations/operation-1557951775038-588f2ea20db03-8b2f09d7-820e57b7
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '587'
            Content-Type: application/json; charset=UTF-8
            ETag: '"-bfnaMeZ1O5-DGd8GfutZWgC2BM=/f73IaTtQbG3yOf8jBpX-O4s6-k4="'
            status: '200'
          body:
            kind: compute#address
            id: '5847904275580177392'
            creationTimestamp: '2019-05-15T13:22:55.743-07:00'
            name: $$address2$$
            description: ''
            address: 35.225.39.234
            status: RESERVED
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            networkTier: PREMIUM
            addressType: EXTERNAL
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status)"
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          extract_references:
          - field: address
            reference: my-ip-address2
          body:
            json:
              kind: compute#address
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '560'
            Content-Type: application/json; charset=UTF-8
            ETag: '"DE4ycWOmPjn6PAs9DO_60MAXPd0=/XrzOyHgv_IhayT9gHGNiyG-d_4o="'
            status: '200'
          body:
            kind: compute#address
            id: '4040240158074122064'
            creationTimestamp: '2018-11-13T10:02:39.046-08:00'
            name: $$address2$$
            description: ''
            address: 35.238.215.155
            status: RESERVED
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$
            networkTier: PREMIUM
    - expect_stdout: |
        address: $$my-ip-address2$$
        status:  RESERVED
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute instances create $$instance2$$ --zone $$my-zone$$ --address $$my-ip-address2$$
      --format "text(status)"
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"4IDA6vQRYLk7QuO3H35W3BOuFV4=/YK0178Zb4ThmiGj0YUCJs21xsNg="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: $$my-zone$$
            description: $$my-zone$$
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          omit_fields:
          - commonInstanceMetadata
          - quotas
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '469508'
            Content-Type: application/json; charset=UTF-8
            ETag: '"YriJ1gvtaQN45uEIBtymBclymFg=/wb1ean9O9GKU97SnNN31-MenQ58="'
            status: '200'
          body:
            kind: compute#project
            id: '17966956004057981335'
            creationTimestamp: '2014-09-30T07:55:22.502-07:00'
            name: cloud-sdk-integration-testing
            usageExportLocation:
              bucketName: cloud-sdk-integration-test-usage
              reportNamePrefix: ''
            enabledFeatures:
            - alpha-api
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing
            defaultServiceAccount: 462803083913-compute@developer.gserviceaccount.com
            xpnProjectStatus: UNSPECIFIED_XPN_PROJECT_STATUS
            defaultNetworkTier: PREMIUM
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances?alt=json
          method: POST
          headers: {}
          body:
            json:
              canIpForward: false
              deletionProtection: false
              disks:
              - autoDelete: true
                boot: true
                initializeParams:
                  sourceImage: https://$$compute-uri$$/v1/projects/debian-cloud/global/images/family/debian-9
                mode: READ_WRITE
                type: PERSISTENT
              machineType: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
              metadata: {}
              name: $$instance2$$
              networkInterfaces:
              - accessConfigs:
                - name: external-nat
                  natIP: $$my-ip-address2$$
                  type: ONE_TO_ONE_NAT
                network: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/global/networks/default
              scheduling:
                automaticRestart: true
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '870'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '8128296833311165382'
            name: operation-1557951784593-588f2eab2a75b-cfff4098-37420d56
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
            targetId: '596456554559032262'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-15T13:23:05.997-07:00'
            startTime: '2019-05-15T13:23:05.999-07:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/operations/operation-1557951784593-588f2eab2a75b-cfff4098-37420d56
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2561'
            Content-Type: application/json; charset=UTF-8
            ETag: '"LNyQjZr1YLiqm27ds5CFm18wPVg=/oKxbSX3KWJbHsdvKASG6py1zoFw="'
            status: '200'
          body:
            kind: compute#instance
            id: '596456554559032262'
            creationTimestamp: '2019-05-15T13:23:05.855-07:00'
            name: $$instance2$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$
            canIpForward: false
            networkInterfaces:
            - kind: compute#networkInterface
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              networkIP: 10.240.1.127
              name: nic0
              accessConfigs:
              - kind: compute#accessConfig
                type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.225.39.234
                networkTier: PREMIUM
              fingerprint: YBmAk_wI2NU=
            disks:
            - kind: compute#attachedDisk
              type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/disks/$$instance2$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
            metadata:
              kind: compute#metadata
              fingerprint: 4_QxQ57NQak=
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Haswell
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
    - expect_stdout: |
        ---
        status: RUNNING
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute instances describe $$instance2$$ --zone $$my-zone$$ --format
      "text(status,networkInterfaces[0].accessConfigs[0].natIP)"
    validation_only: true
    events:
    - expect_stdout: |
        networkInterfaces[0].accessConfigs[0].natIP: $$my-ip-address2$$
        status:                                      RUNNING
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    command: compute addresses describe $$address2$$ --region $$my-region$$ --format
      "text(address,status,users)"
    validation_only: true
    events:
    - expect_stdout: |
        address:  $$my-ip-address2$$
        status:   IN_USE
        users[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    cleanup_for: address2
    validation_only: true
    command: compute addresses delete $$address2$$ --region $$my-region$$ --quiet
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$my-region$$/addresses/$$address2$$\].
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign external address to instance upon creation
    cleanup_for: instance2
    validation_only: true
    command: compute instances delete $$instance2$$ --zone $$my-zone$$ --quiet
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/$$my-zone$$/instances/$$instance2$$\].
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign IP Version
    command: compute addresses create $$address3$$ --global --ip-version ipv4
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/global/addresses?alt=json
          method: POST
          headers: {}
          body:
            json:
              ipVersion: IPV4
              name: $$address3$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '744'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '4223267217228286758'
            name: operation-1557951944632-588f2f43ca9f1-2508d46c-18d304ff
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$
            targetId: '1758355610261375782'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-05-15T13:25:45.240-07:00'
            startTime: '2019-05-15T13:25:45.271-07:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/operations/operation-1557951944632-588f2f43ca9f1-2508d46c-18d304ff
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '485'
            Content-Type: application/json; charset=UTF-8
            ETag: '"zX3PdK6vjYNqpDHK8UUXyMr7GVw=/-QpF2_hN8W0v1T_vNjrlQ7uLRQA="'
            status: '200'
          body:
            kind: compute#address
            id: '1758355610261375782'
            creationTimestamp: '2019-05-15T13:25:45.235-07:00'
            name: $$address3$$
            description: ''
            address: 35.241.41.184
            status: RESERVED
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$
            networkTier: PREMIUM
            ipVersion: IPV4
            addressType: EXTERNAL
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign IP Version
    command: compute addresses describe $$address3$$ --global --format "text(status,ipVersion)"
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '485'
            Content-Type: application/json; charset=UTF-8
            ETag: '"oG1V10AurNuO4CcVloRoU8xefaY=/bDFye4fchV6alxWtYPEpSEhFqM0="'
            status: '200'
          body:
            kind: compute#address
            id: '1758355610261375782'
            creationTimestamp: '2019-05-15T13:25:45.235-07:00'
            name: $$address3$$
            description: ''
            address: 35.241.41.184
            status: RESERVED
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$
            networkTier: PREMIUM
            ipVersion: IPV4
            addressType: EXTERNAL
    - expect_stdout: |
        ipVersion: IPV4
        status:    RESERVED
    - expect_exit:
        code: 0
- execute_command:
    label: Test assign IP Version
    cleanup_for: address3
    validation_only: true
    command: compute addresses delete $$address3$$ --global --quiet
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/addresses/$$address3$$\].
    - expect_exit:
        code: 0
