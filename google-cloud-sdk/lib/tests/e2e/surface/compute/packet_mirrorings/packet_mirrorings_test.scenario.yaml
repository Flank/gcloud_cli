title: gcloud compute packet mirroring test
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute networks create $$network$$ --subnet-mode custom --format "text(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
  - stdout: |
      ---
      name: $$network$$
- execute:
  - command: |
      compute networks subnets create $$subnet$$ --network $$network$$ --region $$region$$
      --range 10.2.0.0/16 --format "text(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$].
  - stdout: |
      ---
      name: $$subnet$$
- execute:
  - command: |
      compute health-checks create http $$health-check$$ --region $$region$$ --port 80
      --format "text(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$].
  - stdout: |
      ---
      name: $$health-check$$
- execute:
  - command: |
      compute backend-services create $$backend-service$$ --region $$region$$
      --load-balancing-scheme internal --health-checks $$health-check$$
      --health-checks-region $$region$$ --format "text(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$].
  - stdout: |
      ---
      name: $$backend-service$$
- execute:
  - command: |
      compute forwarding-rules create $$forwarding-rule-name$$ --region $$region$$
      --load-balancing-scheme internal --backend-service $$backend-service$$ --ports
      80 --network $$network$$ --subnet $$subnet$$ --is-mirroring-collector --format
      "text(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$].
  - stdout: |
      ---
      name: $$forwarding-rule-name$$
- execute:
  - command: |
      compute packet-mirrorings create $$packet-mirroring$$ --network $$network$$
      --region $$region$$ --mirrored-tags t1,t2 --mirrored-subnets $$subnet$$ --collector-ilb
      $$forwarding-rule-name$$ --format "text(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$].
  - stdout: |
      ---
      name: $$packet-mirroring$$
- execute:
  - command: |
      compute packet-mirrorings list --format "table[no-heading](name,region)"
      --filter "name:$$packet-mirroring$$"
  - stdout: |
      $$packet-mirroring$$  $$region$$
- execute:
  - command: |
      compute packet-mirrorings describe $$packet-mirroring$$ --region $$region$$
      --format "text(enable,name)"
  - stdout: |
      ---
      enable: TRUE
      name:   $$packet-mirroring$$
- execute:
  - command: |
      compute packet-mirrorings update $$packet-mirroring$$ --region $$region$$
      --add-mirrored-tags t3 --clear-mirrored-subnets --no-enable
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$].
- execute:
  - command: |
      compute packet-mirrorings describe $$packet-mirroring$$ --region $$region$$
      --format text("name,priority,mirroredResources)"
  - stdout: |
      ---
      mirroredResources.tags[0]: t1
      mirroredResources.tags[1]: t2
      mirroredResources.tags[2]: t3
      name:                      $$packet-mirroring$$
      priority:                  1000
- execute:
  - command: |
      compute packet-mirrorings delete $$packet-mirroring$$ --region $$region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$].
- execute:
  - command: |
      compute forwarding-rules delete $$forwarding-rule-name$$ --region $$region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$].
- execute:
  - command: |
      compute backend-services delete $$backend-service$$ --region $$region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$].
- execute:
  - command: |
      compute health-checks delete $$health-check$$ --region $$region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$].
- execute:
  - command: |
      compute networks subnets delete $$subnet$$ --region $$region$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$].
- execute:
  - command: compute networks delete $$network$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
actions:
- define_reference:
    reference: region
    value: us-central1
- generate_resource_id:
    reference: network
    prefix: packet-mirrorings-test-network
- generate_resource_id:
    reference: subnet
    prefix: packet-mirrorings-test-subnet
- generate_resource_id:
    reference: health-check
    prefix: packet-mirrorings-test-health-check
- generate_resource_id:
    reference: backend-service
    prefix: packet-mirrorings-test-backend-service
- generate_resource_id:
    reference: forwarding-rule-name
    prefix: packet-mirrorings-test-forwarding-rule
- generate_resource_id:
    reference: packet-mirroring
    prefix: packet-mirrorings-test-pm

- execute_command:
    command: compute networks create $$network$$ --subnet-mode custom --format "text(name)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks?alt=json
          method: POST
          headers: {}
          body:
            json:
              autoCreateSubnetworks: false
              name: $$network$$
              routingConfig:
                routingMode: REGIONAL
        expect_response:
          extract_references:
          - field: targetId
            reference: target-network-id
          body:
            json: {}
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '744'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '532250280966567228'
            name: operation-1580239827395-59d3841926441-7a7d0e48-7ccdcf33
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
            targetId: '214802131358397756'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:30:27.928-08:00'
            startTime: '2020-01-28T11:30:27.942-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/operations/operation-1580239827395-59d3841926441-7a7d0e48-7ccdcf33
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '425'
            Content-Type: application/json; charset=UTF-8
            ETag: '"W8BFnbvIyCNyq4AZlssjl7w1j-M=/yuv64bwNSgOvzDjmZZuZlqKzCPw="'
            status: '200'
          body:
            kind: compute#network
            id: '214802131358397756'
            creationTimestamp: '2020-01-28T11:30:27.781-08:00'
            name: $$network$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
            autoCreateSubnetworks: false
            routingConfig:
              routingMode: REGIONAL
    - expect_stdout: |
        ---
        name: $$network$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks subnets create $$subnet$$ --network $$network$$ --region $$region$$
      --range 10.2.0.0/16 --format "text(name)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks?alt=json
          method: POST
          headers: {}
          body:
            json:
              ipCidrRange: 10.2.0.0/16
              name: $$subnet$$
              network: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
              privateIpGoogleAccess: false
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '885'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '8493912289493988617'
            name: operation-1580239845461-59d3842a60d33-fe016d41-edcaf3f9
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
            targetId: '6437945130327291145'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:30:46.229-08:00'
            startTime: '2020-01-28T11:30:46.245-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239845461-59d3842a60d33-fe016d41-edcaf3f9
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$].
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '779'
            Content-Type: application/json; charset=UTF-8
            ETag: '"VbSR4mSX6-5Moxx8FxFOvArwDTo=/tUZR41kNzbqEP0b8QaI46zdgpeM="'
            status: '200'
          body:
            kind: compute#subnetwork
            id: '6437945130327291145'
            creationTimestamp: '2020-01-28T11:30:46.197-08:00'
            name: $$subnet$$
            network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
            ipCidrRange: 10.2.0.0/16
            gatewayAddress: 10.2.0.1
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
            privateIpGoogleAccess: false
            fingerprint: StiqnX4vi8w=
            purpose: PRIVATE
    - expect_stdout: |
        ---
        name: $$subnet$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute health-checks create http $$health-check$$ --region $$region$$ --port 80
      --format "text(name)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks?alt=json
          method: POST
          headers: {}
          body:
            json:
              checkIntervalSec: 5
              healthyThreshold: 2
              httpHealthCheck:
                port: 80
                portSpecification: USE_FIXED_PORT
                proxyHeader: NONE
                requestPath: /
              name: $$health-check$$
              timeoutSec: 5
              type: HTTP
              unhealthyThreshold: 2
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '892'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2707146789661521170'
            name: operation-1580239869243-59d384410f24c-5732b5be-6d5c701b
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$
            targetId: '9214337274657715474'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:31:09.711-08:00'
            startTime: '2020-01-28T11:31:09.729-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239869243-59d384410f24c-5732b5be-6d5c701b
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$].
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '719'
            Content-Type: application/json; charset=UTF-8
            ETag: '"53DBvuEO6yE1lGmxrBd0hAtsBLM=/HBSwTIXByU6IcExPVGJQEYcr-8s="'
            status: '200'
          body:
            kind: compute#healthCheck
            id: '9214337274657715474'
            creationTimestamp: '2020-01-28T11:31:09.679-08:00'
            name: $$health-check$$
            checkIntervalSec: 5
            timeoutSec: 5
            unhealthyThreshold: 2
            healthyThreshold: 2
            type: HTTP
            httpHealthCheck:
              port: 80
              portSpecification: USE_FIXED_PORT
              requestPath: /
              proxyHeader: NONE
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
    - expect_stdout: |
        ---
        name: $$health-check$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute backend-services create $$backend-service$$ --region $$region$$
      --load-balancing-scheme internal --health-checks $$health-check$$
      --health-checks-region $$region$$ --format "text(name)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices?alt=json
          method: POST
          headers: {}
          body:
            json:
              healthChecks:
              - https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$
              loadBalancingScheme: INTERNAL
              name: $$backend-service$$
              protocol: TCP
              timeoutSec: 30
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '897'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '788450010795422447'
            name: operation-1580239872255-59d38443ee47d-50910ad6-0cb3619d
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$
            targetId: '3308435828780118767'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:31:12.812-08:00'
            startTime: '2020-01-28T11:31:12.829-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239872255-59d38443ee47d-50910ad6-0cb3619d
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$].
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '899'
            Content-Type: application/json; charset=UTF-8
            ETag: '"KCEe3HRC6oAi_75Qk1HPbS3gGGo=/DlajAjcAEcGPLznS8C38xYp8QXY="'
            status: '200'
          body:
            kind: compute#backendService
            id: '3308435828780118767'
            creationTimestamp: '2020-01-28T11:31:12.782-08:00'
            name: $$backend-service$$
            description: ''
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$
            healthChecks:
            - https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$
            timeoutSec: 30
            protocol: TCP
            fingerprint: fpla2inUnZg=
            sessionAffinity: NONE
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            loadBalancingScheme: INTERNAL
            connectionDraining:
              drainingTimeoutSec: 0
    - expect_stdout: |
        ---
        name: $$backend-service$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute forwarding-rules create $$forwarding-rule-name$$ --region $$region$$
      --load-balancing-scheme internal --backend-service $$backend-service$$ --ports
      80 --network $$network$$ --subnet $$subnet$$ --is-mirroring-collector --format
      "text(name)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules?alt=json
          method: POST
          headers: {}
          body:
            json:
              backendService: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$
              isMirroringCollector: true
              loadBalancingScheme: INTERNAL
              name: $$forwarding-rule-name$$
              network: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
              ports:
              - '80'
              subnetwork: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
        expect_response:
          body:
            json: {}
          extract_references:
          - field: targetId
            reference: forwarding-rule-target-id
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '898'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2667148175845700329'
            name: operation-1580239877555-59d38448fc631-94256c2f-1d37fef7
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
            targetId: '1797187831187976937'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:31:18.376-08:00'
            startTime: '2020-01-28T11:31:18.402-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239877555-59d38448fc631-94256c2f-1d37fef7
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$].
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1245'
            Content-Type: application/json; charset=UTF-8
            ETag: '"bGHk7HkULBR6kRM9sDw-9zREnp4=/QBgS3TWhK3NKgYjH4Ih6WWMdlp8="'
            status: '200'
          body:
            kind: compute#forwardingRule
            id: '1797187831187976937'
            creationTimestamp: '2020-01-28T11:31:18.343-08:00'
            name: $$forwarding-rule-name$$
            description: ''
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            IPAddress: 10.2.0.2
            IPProtocol: TCP
            ports:
            - '80'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
            loadBalancingScheme: INTERNAL
            subnetwork: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
            network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
            backendService: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$
            networkTier: PREMIUM
            fingerprint: w3Hb7L9cX_Y=
            isMirroringCollector: true
    - expect_stdout: |
        ---
        name: $$forwarding-rule-name$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute packet-mirrorings create $$packet-mirroring$$ --network $$network$$
      --region $$region$$ --mirrored-tags t1,t2 --mirrored-subnets $$subnet$$ --collector-ilb
      $$forwarding-rule-name$$ --format "text(name)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings?alt=json
          method: POST
          headers: {}
          body:
            json:
              collectorIlb:
                url: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
              enable: 'TRUE'
              filter: {}
              mirroredResources:
                subnetworks:
                - url: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
                tags:
                - t1
                - t2
              name: $$packet-mirroring$$
              network:
                url: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
        expect_response:
          extract_references:
          - field: targetId
            reference: pm-target-id
          body:
            json: {}
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '885'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5617382724959285984'
            name: operation-1580239886586-59d38451990e0-6dc72d48-87c4ac90
            operationType: insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            targetId: '498531987374289632'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:31:27.336-08:00'
            startTime: '2020-01-28T11:31:27.357-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239886586-59d38451990e0-6dc72d48-87c4ac90
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$].
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          body:
            json: {}
          extract_references:
          - field: creationTimestamp
            reference: pm-create-timestamp
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1596'
            Content-Type: application/json; charset=UTF-8
            ETag: '"fr68If_BABGwWN-fFo613AftrCI=/dLO3o3cTovVQCFCZZJN3SNh0OnI="'
            status: '200'
          body:
            kind: compute#packetMirroring
            id: '498531987374289632'
            creationTimestamp: '2020-01-28T11:31:27.325-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            name: $$packet-mirroring$$
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            network:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/214802131358397756
            priority: 1000
            collectorIlb:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/1797187831187976937
            mirroredResources:
              subnetworks:
              - url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
                canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/6437945130327291145
              tags:
              - t1
              - t2
            enable: 'TRUE'
    - expect_stdout: |
        ---
        name: $$packet-mirroring$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute packet-mirrorings list --format "table[no-heading](name,region)"
      --filter "name:$$packet-mirroring$$"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/aggregated/packetMirrorings?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '7976'
            Content-Type: application/json; charset=UTF-8
            ETag: '"o-JOo9yiWwyCffzKSTlqslBDzKI=/4NspK3wROcexVM7GKpHHw-YMBUA="'
            status: '200'
          body:
            kind: compute#packetMirroringAggregatedList
            id: projects/cloud-sdk-integration-testing/aggregated/packetMirrorings
            items:
              regions/us-central1:
                packetMirrorings:
                - kind: compute#packetMirroring
                  id: '498531987374289632'
                  creationTimestamp: '2020-01-28T11:31:27.325-08:00'
                  selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
                  name: $$packet-mirroring$$
                  region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
                  network:
                    url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
                    canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/214802131358397756
                  priority: 1000
                  collectorIlb:
                    url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
                    canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/1797187831187976937
                  mirroredResources:
                    subnetworks:
                    - url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
                      canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/6437945130327291145
                    tags:
                    - t1
                    - t2
                  enable: 'TRUE'
              regions/us-central2:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/us-central2' on
                    this page.
                  data:
                  - key: scope
                    value: regions/us-central2
              regions/europe-west1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/europe-west1' on
                    this page.
                  data:
                  - key: scope
                    value: regions/europe-west1
              regions/us-west1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/us-west1' on this
                    page.
                  data:
                  - key: scope
                    value: regions/us-west1
              regions/asia-east1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/asia-east1' on
                    this page.
                  data:
                  - key: scope
                    value: regions/asia-east1
              regions/us-east1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/us-east1' on this
                    page.
                  data:
                  - key: scope
                    value: regions/us-east1
              regions/us-east2:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/us-east2' on this
                    page.
                  data:
                  - key: scope
                    value: regions/us-east2
              regions/asia-northeast1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/asia-northeast1'
                    on this page.
                  data:
                  - key: scope
                    value: regions/asia-northeast1
              regions/asia-southeast1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/asia-southeast1'
                    on this page.
                  data:
                  - key: scope
                    value: regions/asia-southeast1
              regions/us-east4:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/us-east4' on this
                    page.
                  data:
                  - key: scope
                    value: regions/us-east4
              regions/australia-southeast1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/australia-southeast1'
                    on this page.
                  data:
                  - key: scope
                    value: regions/australia-southeast1
              regions/europe-west2:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/europe-west2' on
                    this page.
                  data:
                  - key: scope
                    value: regions/europe-west2
              regions/europe-west3:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/europe-west3' on
                    this page.
                  data:
                  - key: scope
                    value: regions/europe-west3
              regions/southamerica-east1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/southamerica-east1'
                    on this page.
                  data:
                  - key: scope
                    value: regions/southamerica-east1
              regions/asia-south1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/asia-south1' on
                    this page.
                  data:
                  - key: scope
                    value: regions/asia-south1
              regions/northamerica-northeast1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/northamerica-northeast1'
                    on this page.
                  data:
                  - key: scope
                    value: regions/northamerica-northeast1
              regions/europe-west4:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/europe-west4' on
                    this page.
                  data:
                  - key: scope
                    value: regions/europe-west4
              regions/europe-north1:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/europe-north1'
                    on this page.
                  data:
                  - key: scope
                    value: regions/europe-north1
              regions/us-west2:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/us-west2' on this
                    page.
                  data:
                  - key: scope
                    value: regions/us-west2
              regions/asia-east2:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/asia-east2' on
                    this page.
                  data:
                  - key: scope
                    value: regions/asia-east2
              regions/europe-west6:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/europe-west6' on
                    this page.
                  data:
                  - key: scope
                    value: regions/europe-west6
              regions/asia-northeast2:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/asia-northeast2'
                    on this page.
                  data:
                  - key: scope
                    value: regions/asia-northeast2
              regions/asia-northeast3:
                warning:
                  code: NO_RESULTS_ON_PAGE
                  message: There are no results for scope 'regions/asia-northeast3'
                    on this page.
                  data:
                  - key: scope
                    value: regions/asia-northeast3
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/aggregated/packetMirrorings
    - expect_stdout: |
        $$packet-mirroring$$  $$region$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute packet-mirrorings describe $$packet-mirroring$$ --region $$region$$
      --format "text(enable,name)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1596'
            Content-Type: application/json; charset=UTF-8
            ETag: '"BRLFwk-FWvXUKijY8n5f-rE_Oa0=/5r1BR4Mtf1DgAxDV_GL5GAHiXQQ="'
            status: '200'
          body:
            kind: compute#packetMirroring
            id: '498531987374289632'
            creationTimestamp: '2020-01-28T11:31:27.325-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            name: $$packet-mirroring$$
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            network:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/214802131358397756
            priority: 1000
            collectorIlb:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/1797187831187976937
            mirroredResources:
              subnetworks:
              - url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
                canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/6437945130327291145
              tags:
              - t1
              - t2
            enable: 'TRUE'
    - expect_stdout: |
        ---
        enable: TRUE
        name:   $$packet-mirroring$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute packet-mirrorings update $$packet-mirroring$$ --region $$region$$
      --add-mirrored-tags t3 --clear-mirrored-subnets --no-enable
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1596'
            Content-Type: application/json; charset=UTF-8
            ETag: '"pIQtrgMc2sf11v0F2zV7gOduC08=/NSPc2VzFawShU1Z0j-z8VwIedaQ="'
            status: '200'
          body:
            kind: compute#packetMirroring
            id: '498531987374289632'
            creationTimestamp: '2020-01-28T11:31:27.325-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            name: $$packet-mirroring$$
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            network:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/214802131358397756
            priority: 1000
            collectorIlb:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/1797187831187976937
            mirroredResources:
              subnetworks:
              - url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
                canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/6437945130327291145
              tags:
              - t1
              - t2
            enable: 'TRUE'
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              network:
                url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
                canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$target-network-id$$
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
              name: $$packet-mirroring$$
              priority: 1000
              collectorIlb:
                url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
                canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-target-id$$
              id: $$pm-target-id$$
              mirroredResources:
                subnetworks: []
                tags:
                - t1
                - t2
                - t3
              region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
              enable: 'FALSE'
              creationTimestamp: $$pm-create-timestamp$$
              kind: compute#packetMirroring
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '884'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '4554541682575356662'
            name: operation-1580239896987-59d3845b848e6-216f2619-d0c4a076
            operationType: patch
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            targetId: '498531987374289632'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:31:37.895-08:00'
            startTime: '2020-01-28T11:31:37.953-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239896987-59d3845b848e6-216f2619-d0c4a076
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$].
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1247'
            Content-Type: application/json; charset=UTF-8
            ETag: '"cTRLKek5ng0SbdtsFOHLBTjkpCc=/9nXY3iVtARv4wQJ_s6EG7uzLCvg="'
            status: '200'
          body:
            kind: compute#packetMirroring
            id: '498531987374289632'
            creationTimestamp: '2020-01-28T11:31:27.325-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            name: $$packet-mirroring$$
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            network:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/214802131358397756
            priority: 1000
            collectorIlb:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/1797187831187976937
            mirroredResources:
              tags:
              - t1
              - t2
              - t3
            enable: 'FALSE'
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute packet-mirrorings describe $$packet-mirroring$$ --region $$region$$
      --format text("name,priority,mirroredResources)"
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1247'
            Content-Type: application/json; charset=UTF-8
            ETag: '"gcvywL-gT4nVpFMX75M5rAihQ3s=/hgVKn4Io43I7hQhR9MhUvpvfwhw="'
            status: '200'
          body:
            kind: compute#packetMirroring
            id: '498531987374289632'
            creationTimestamp: '2020-01-28T11:31:27.325-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            name: $$packet-mirroring$$
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
            network:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/214802131358397756
            priority: 1000
            collectorIlb:
              url: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
              canonicalUrl: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/1797187831187976937
            mirroredResources:
              tags:
              - t1
              - t2
              - t3
            enable: 'FALSE'
    - expect_stdout: |
        ---
        mirroredResources.tags[0]: t1
        mirroredResources.tags[1]: t2
        mirroredResources.tags[2]: t3
        name:                      $$packet-mirroring$$
        priority:                  1000
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: packet-mirroring
    command: |
      compute packet-mirrorings delete $$packet-mirroring$$ --region $$region$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '884'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '673667632580080332'
            name: operation-1580239906676-59d38464c1fb0-06810a9b-18ad9f99
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$
            targetId: '498531987374289632'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:31:47.449-08:00'
            startTime: '2020-01-28T11:31:47.474-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239906676-59d38464c1fb0-06810a9b-18ad9f99
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/packetMirrorings/$$packet-mirroring$$].
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: forwarding-rule-name
    command: |
      compute forwarding-rules delete $$forwarding-rule-name$$ --region $$region$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '898'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3484548609110520515'
            name: operation-1580239915695-59d3846d5bdcc-4451b87c-7cec6faa
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$
            targetId: '1797187831187976937'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:31:56.167-08:00'
            startTime: '2020-01-28T11:31:56.185-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239915695-59d3846d5bdcc-4451b87c-7cec6faa
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/forwardingRules/$$forwarding-rule-name$$].
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: backend-service
    command: |
      compute backend-services delete $$backend-service$$ --region $$region$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '898'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '8003737984217985751'
            name: operation-1580239928165-59d38479402de-db343d01-c0d20c20
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$
            targetId: '3308435828780118767'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:32:08.910-08:00'
            startTime: '2020-01-28T11:32:08.926-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239928165-59d38479402de-db343d01-c0d20c20
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/backendServices/$$backend-service$$].
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: health-check
    command: |
      compute health-checks delete $$health-check$$ --region $$region$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '892'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2424769324357858002'
            name: operation-1580239933417-59d3847e4271c-8167d746-e015d850
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$
            targetId: '9214337274657715474'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:32:13.984-08:00'
            startTime: '2020-01-28T11:32:13.995-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239933417-59d3847e4271c-8167d746-e015d850
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/healthChecks/$$health-check$$].
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: subnet
    command: |
      compute networks subnets delete $$subnet$$ --region $$region$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '885'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '4459494034840040111'
            name: operation-1580239936153-59d38480de79b-681165a2-63c657c1
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$
            targetId: '6437945130327291145'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:32:16.997-08:00'
            startTime: '2020-01-28T11:32:17.014-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/operations/operation-1580239936153-59d38480de79b-681165a2-63c657c1
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/$$region$$/subnetworks/$$subnet$$].
    - expect_exit:
        code: 0
- execute_command:
    cleanup_for: network
    command: compute networks delete $$network$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://compute.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '745'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2922522374305559223'
            name: operation-1580239959809-59d384976df66-9832c367-29afddb2
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$
            targetId: '214802131358397756'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2020-01-28T11:32:40.151-08:00'
            startTime: '2020-01-28T11:32:40.159-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/operations/operation-1580239959809-59d384976df66-9832c367-29afddb2
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$network$$].
    - expect_exit:
        code: 0
