title: Configure and update AutoHealingPolicies for regional Managed Instance Group
release_tracks: [ALPHA, BETA, GA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute instance-templates create $$my-template$$ --machine-type n1-standard-1
      --format 'value(name)'
  - stderr: |
      Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$\].
  - stdout: |
      $$my-template$$
- execute:
  - command: compute health-checks create tcp $$my-health-check$$ $$global_hc$$ --format
      'value(name)'
  - stderr: |
      Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$\].
  - stdout: |
      $$my-health-check$$
- execute:
  - command: compute http-health-checks create $$my-http-health-check$$ --format 'value(name)'
      --port 12345 --request-path /healthz
  - stderr: |
      Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpHealthChecks/$$my-http-health-check$$\].
  - stdout: |
      $$my-http-health-check$$
- execute:
  - command: compute https-health-checks create $$my-https-health-check$$ --format
      'value(name)' --port 12345 --request-path /healthz
  - stderr: |
      Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpsHealthChecks/$$my-https-health-check$$\].
  - stdout: |
      $$my-https-health-check$$
- execute:
  - command: compute instance-groups managed create $$my-mig$$ --region us-central1
      --size 0 --template $$my-template$$ --health-check $$my-health-check$$ --initial-delay
      3m --format 'value(name)'
  - stderr: |
      Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
  - stdout: |
      $$my-mig$$
- execute:
  - command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --http-health-check $$my-http-health-check$$ --initial-delay 10m --format disable
  - stderr: |
      WARNING: HttpHealthCheck is deprecated. Use --health-check instead.
  - stderr: |
      Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
- execute:
  - command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --https-health-check $$my-https-health-check$$ --initial-delay 15m --format
      disable
  - stderr: |
      WARNING: HttpsHealthCheck is deprecated. Use --health-check instead.
  - stderr: |
      Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
- execute:
  - command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --health-check $$my-health-check$$ --format disable
  - stderr: |
      Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
- execute:
  - command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --clear-autohealing --format disable
  - stderr: |
      Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
- execute:
  - command: compute -q instance-groups managed delete $$my-mig$$ --region us-central1
  - stderr: |
      Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
  - progress_tracker:
    - message: Deleting Managed Instance Group
    - status: SUCCESS
- execute:
  - command: compute -q instance-templates delete $$my-template$$
  - stderr: |
      Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$\].
- execute:
  - command: compute -q http-health-checks delete $$my-http-health-check$$
  - stderr: |
      Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpHealthChecks/$$my-http-health-check$$\].
- execute:
  - command: compute -q https-health-checks delete $$my-https-health-check$$
  - stderr: |
      Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpsHealthChecks/$$my-https-health-check$$\].
- execute:
  - command: compute -q health-checks delete $$my-health-check$$ $$global_hc$$
  - stderr: |
      Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$\].
actions:
- define_reference:
    reference: compute-uri
    value: compute.googleapis.com/compute
- define_reference:
    reference: global_hc
    track_values:
      ALPHA: --global
      BETA: --global
      GA: ''
- define_reference:
    reference: api_version
    track_values:
      ALPHA: alpha
      BETA: beta
      GA: v1
- generate_resource_id:
    reference: my-template
    prefix: managed-instance-group-auto-healing
- execute_command:
    command: compute instance-templates create $$my-template$$ --machine-type n1-standard-1
      --format 'value(name)'
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$\].
    - expect_stdout: |
        $$my-template$$
    - expect_exit:
        code: 0

- generate_resource_id:
    reference: my-health-check
    prefix: managed-instance-group-auto-healing
- execute_command:
    command: compute health-checks create tcp $$my-health-check$$ $$global_hc$$ --format
      'value(name)'
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$\].
    - expect_stdout: |
        $$my-health-check$$
    - expect_exit:
        code: 0

- generate_resource_id:
    reference: my-http-health-check
    prefix: managed-instance-group-auto-healing
- execute_command:
    command: compute http-health-checks create $$my-http-health-check$$ --format 'value(name)'
      --port 12345 --request-path /healthz
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpHealthChecks/$$my-http-health-check$$\].
    - expect_stdout: |
        $$my-http-health-check$$
    - expect_exit:
        code: 0

- generate_resource_id:
    reference: my-https-health-check
    prefix: managed-instance-group-auto-healing
- execute_command:
    command: compute https-health-checks create $$my-https-health-check$$ --format
      'value(name)' --port 12345 --request-path /healthz
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpsHealthChecks/$$my-https-health-check$$\].
    - expect_stdout: |
        $$my-https-health-check$$
    - expect_exit:
        code: 0

- generate_resource_id:
    reference: my-mig
    prefix: managed-instance-group-auto-healing
- execute_command:
    command: compute instance-groups managed create $$my-mig$$ --region us-central1
      --size 0 --template $$my-template$$ --health-check $$my-health-check$$ --initial-delay
      3m --format 'value(name)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers?alt=json
          method: POST
          body:
            json:
              autoHealingPolicies:
              - healthCheck: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$
                initialDelaySec: 180
              instanceTemplate: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              name: $$my-mig$$
              region: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
              targetSize: 0
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '931'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3541196590690511937'
            name: operation-1564676781272-58f10b3bc6eb9-ba590b60-85aaba3f
            operationType: compute.instanceGroupManagers.insert
            targetLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            targetId: '6209112017336183873'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-08-01T09:26:22.832-07:00'
            startTime: '2019-08-01T09:26:22.848-07:00'
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1564676781272-58f10b3bc6eb9-ba590b60-85aaba3f
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2336'
            Content-Type: application/json; charset=UTF-8
            ETag: '"7Cbs8eG1T9s39PgYotxarndyGOg=/bOV7LF5y7F64RzLezwZ7uZAZAjQ="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: K1Ne6kicuh8=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$
              initialDelaySec: 180
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '9903'
            Content-Type: application/json; charset=UTF-8
            ETag: '"-bomBNXKIXq-RC41seJKeKfCoc8=/I7i0Nt31pThCthTFgQzIZO-VoL4="'
            status: '200'
          body:
            kind: compute#regionInstanceGroupList
            id: projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups
            items:
            - kind: compute#instanceGroup
              id: '7784550062103639413'
              creationTimestamp: '2019-08-01T08:56:10.074-07:00'
              name: managed-instance-group-auto-healing-20190801-155608-2f83
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'managed-instance-group-auto-healing-20190801-155608-2f83'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/managed-instance-group-auto-healing-20190801-155608-2f83
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '7020267297569682011'
              creationTimestamp: '2019-08-01T09:00:52.946-07:00'
              name: managed-instance-group-auto-healing-20190801-160051-lp4b
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'managed-instance-group-auto-healing-20190801-160051-lp4b'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/managed-instance-group-auto-healing-20190801-160051-lp4b
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '1134568703542602888'
              creationTimestamp: '2019-08-01T09:25:11.917-07:00'
              name: managed-instance-group-auto-healing-20190801-162510-uh82
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'managed-instance-group-auto-healing-20190801-162510-uh82'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/managed-instance-group-auto-healing-20190801-162510-uh82
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '2000049040828312641'
              creationTimestamp: '2019-08-01T09:26:22.781-07:00'
              name: $$my-mig$$
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager '$$my-mig$$'. To modify instances in this group, use\
                \ the Regional Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '7278921485244084468'
              creationTimestamp: '2019-08-01T09:06:51.513-07:00'
              name: mig-instance-configs-regional-20190801-160650-dc9c
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-instance-configs-regional-20190801-160650-dc9c'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-instance-configs-regional-20190801-160650-dc9c
              size: 1
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '7055961980492754143'
              creationTimestamp: '2019-08-01T09:24:16.035-07:00'
              name: mig-instance-configs-regional-20190801-162414-dqej
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-instance-configs-regional-20190801-162414-dqej'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-instance-configs-regional-20190801-162414-dqej
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '4316646484942433358'
              creationTimestamp: '2019-08-01T09:26:09.473-07:00'
              name: mig-instance-configs-regional-20190801-162606-nj2p
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-instance-configs-regional-20190801-162606-nj2p'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-instance-configs-regional-20190801-162606-nj2p
              size: 1
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '6167198075739615074'
              creationTimestamp: '2019-08-01T09:21:33.329-07:00'
              name: mig-replacer-regional-20190801-162131-yc64
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-replacer-regional-20190801-162131-yc64'. To modify\
                \ instances in this group, use the Regional Instance Group Manager\
                \ API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-replacer-regional-20190801-162131-yc64
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '9190310158212705507'
              creationTimestamp: '2019-08-01T09:23:40.394-07:00'
              name: mig-restart-switch-regional-20190801-162337-gvnx
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-restart-switch-regional-20190801-162337-gvnx'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-restart-switch-regional-20190801-162337-gvnx
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '1321979202071604302'
              creationTimestamp: '2019-08-01T09:26:09.913-07:00'
              name: mig-stateful-policy-regional-20190801-162608-p8pu
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-stateful-policy-regional-20190801-162608-p8pu'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-stateful-policy-regional-20190801-162608-p8pu
              size: 0
              region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '250'
            Content-Type: application/json; charset=UTF-8
            ETag: '"gq68fy2i4RJdHtllWMn7bo1P034=/g_joaJerG3Dy17XhD03hh9XxOO8="'
            status: '200'
          body:
            kind: compute#regionAutoscalerList
            id: projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers
    - expect_stdout: |
        $$my-mig$$
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --http-health-check $$my-http-health-check$$ --initial-delay 10m --format disable
    events:
    - expect_stderr:
        matches: |
          WARNING: HttpHealthCheck is deprecated. Use --health-check instead.
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2336'
            Content-Type: application/json; charset=UTF-8
            ETag: '"SF5h8jV_ZCUo_aExpKlcVSjnhGI=/adudO2aE9ly7sGoBPLnslZBh2HQ="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: K1Ne6kicuh8=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$
              initialDelaySec: 180
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              autoHealingPolicies:
              - healthCheck: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpHealthChecks/$$my-http-health-check$$
                initialDelaySec: 600
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '900'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2509145369987689511'
            name: operation-1564676806460-58f10b53cc551-c9b24474-b7e4a6ef
            operationType: patch
            targetLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            targetId: '6209112017336183873'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-08-01T09:26:48.071-07:00'
            startTime: '2019-08-01T09:26:48.091-07:00'
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1564676806460-58f10b53cc551-c9b24474-b7e4a6ef
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2340'
            Content-Type: application/json; charset=UTF-8
            ETag: '"43Hhfd0xiaT5F2LiA-YCHuGu9P0=/zsLt14NqXqxlbXxuy_5v4eBt9sU="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: 51ilXwYH03k=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpHealthChecks/$$my-http-health-check$$
              initialDelaySec: 600
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --https-health-check $$my-https-health-check$$ --initial-delay 15m --format
      disable
    events:
    - expect_stderr:
        matches: |
          WARNING: HttpsHealthCheck is deprecated. Use --health-check instead.
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2340'
            Content-Type: application/json; charset=UTF-8
            ETag: '"RGKRv9HoJJ1DajiAYab-_VXnlWc=/SdYaXBYekrw4l5RhsyCNYNVbn9w="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: 51ilXwYH03k=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpHealthChecks/$$my-http-health-check$$
              initialDelaySec: 600
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              autoHealingPolicies:
              - healthCheck: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpsHealthChecks/$$my-https-health-check$$
                initialDelaySec: 900
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '900'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '4140066699933035568'
            name: operation-1564676830699-58f10b6aea19b-015899ca-a178ff93
            operationType: patch
            targetLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            targetId: '6209112017336183873'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-08-01T09:27:11.992-07:00'
            startTime: '2019-08-01T09:27:12.008-07:00'
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1564676830699-58f10b6aea19b-015899ca-a178ff93
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2341'
            Content-Type: application/json; charset=UTF-8
            ETag: '"85Y1mQmraNH6NKTqoin_wWBj6K4=/yfNnh39iCd-o-Lv8Dyy4iQKyfqE="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: 7cjGBUtmFcg=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpsHealthChecks/$$my-https-health-check$$
              initialDelaySec: 900
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --health-check $$my-health-check$$ --format disable
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2341'
            Content-Type: application/json; charset=UTF-8
            ETag: '"DTBrAZ9cydOemBUGWuEhSTQOjEs=/mwSk9LFYvddxqye4iR8ssfd1qAU="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: 7cjGBUtmFcg=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpsHealthChecks/$$my-https-health-check$$
              initialDelaySec: 900
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              autoHealingPolicies:
              - healthCheck: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$
                initialDelaySec: 900    # Initial delay currently set on MIG.
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '900'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3319606592096087058'
            name: operation-1564676860062-58f10b86ea951-dd344dfb-5dfdf853
            operationType: patch
            targetLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            targetId: '6209112017336183873'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-08-01T09:27:41.283-07:00'
            startTime: '2019-08-01T09:27:41.299-07:00'
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1564676860062-58f10b86ea951-dd344dfb-5dfdf853
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2336'
            Content-Type: application/json; charset=UTF-8
            ETag: '"EXR4VNvyt8TagKPI_S3TJoXbgNw=/JlS-zB2gh3jh5UOW2NH0VHhocMA="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: Vppk9-yPyyc=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$
              initialDelaySec: 900
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed update $$my-mig$$ --region us-central1
      --clear-autohealing --format disable
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2336'
            Content-Type: application/json; charset=UTF-8
            ETag: '"AnuTG_eeSsjMR_r8h-0IbsyBKRA=/vlCtqPBszz5fcmiQHSrW6CNQiY0="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: Vppk9-yPyyc=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            autoHealingPolicies:
            - healthCheck: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$
              initialDelaySec: 900
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              autoHealingPolicies: [{}]
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '900'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7049090440841047541'
            name: operation-1564676889094-58f10ba29ab4f-194be941-c12ede78
            operationType: patch
            targetLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            targetId: '6209112017336183873'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-08-01T09:28:10.590-07:00'
            startTime: '2019-08-01T09:28:10.614-07:00'
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1564676889094-58f10ba29ab4f-194be941-c12ede78
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2097'
            Content-Type: application/json; charset=UTF-8
            ETag: '"ZNbDwJ64EqBSXO7o3gLiAdUfav4=/4Js0iXJC2V3vRnfqvkHg-Q1ii7k="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '6209112017336183873'
            creationTimestamp: '2019-08-01T09:26:22.742-07:00'
            name: $$my-mig$$
            region: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
            versions:
            - instanceTemplate: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$
              targetSize:
                calculated: 0
            instanceGroup: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$my-mig$$
            baseInstanceName: managed-instance-group-auto-healing-20190801-162621-50
            fingerprint: qqI-wdORcIk=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            status:
              isStable: true
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
    - expect_exit:
        code: 0

- execute_command:
    command: compute -q instance-groups managed delete $$my-mig$$ --region us-central1
    cleanup_for: my-mig
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$my-mig$$\].
    - expect_progress_tracker:
        message: Deleting Managed Instance Group
        status: SUCCESS
    - expect_exit:
        code: 0

- execute_command:
    command: compute -q instance-templates delete $$my-template$$
    cleanup_for: my-template
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$my-template$$\].
    - expect_exit:
        code: 0

- execute_command:
    command: compute -q http-health-checks delete $$my-http-health-check$$
    cleanup_for: my-http-health-check
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpHealthChecks/$$my-http-health-check$$\].
    - expect_exit:
        code: 0

- execute_command:
    command: compute -q https-health-checks delete $$my-https-health-check$$
    cleanup_for: my-https-health-check
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/httpsHealthChecks/$$my-https-health-check$$\].
    - expect_exit:
        code: 0

- execute_command:
    command: compute -q health-checks delete $$my-health-check$$ $$global_hc$$
    cleanup_for: my-health-check
    validation_only: true
    events:
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/$$api_version$$/projects/cloud-sdk-integration-testing/global/healthChecks/$$my-health-check$$\].
    - expect_exit:
        code: 0
