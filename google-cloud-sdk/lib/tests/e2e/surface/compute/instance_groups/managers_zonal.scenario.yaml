title: Basic tests of a zonal managed instance group.
release_tracks: [GA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute instance-templates create $$template1$$ --machine-type n1-standard-1
      --format 'text(name,properties.machineType)'
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$].
  - stdout: |
      ---
      name:                   $$template1$$
      properties.machineType: n1-standard-1
- execute:
  - command: compute instance-templates create $$template2$$ --machine-type f1-micro
      --format 'text(name,properties.machineType)'
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$].
  - stdout: |
      ---
      name:                   $$template2$$
      properties.machineType: f1-micro
- execute:
  - command: compute instance-groups managed create $$manager$$ --zone us-central1-f
      --base-instance-name $$manager$$ --size 0 --template $$template1$$ --format
      'text(name,zone,targetSize)'
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
  - stdout: |
      ---
      name:       $$manager$$
      targetSize: 0
      zone:       https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
- execute:
  - command: compute instance-groups managed resize $$manager$$ --zone us-central1-f
      --size 3 --format 'text(name,zone,targetSize)'
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
  - stdout: |
      ---
      name:       $$manager$$
      targetSize: 3
      zone:       https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
- execute:
  - command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
- execute:
  - command: compute instance-groups managed list-instances $$manager$$ --zone us-central1-f
      --format 'text(instanceStatus,version.name)'
  - stdout: |
      ---
      instanceStatus: RUNNING
      ---
      instanceStatus: RUNNING
      ---
      instanceStatus: RUNNING
- execute:
  - command: compute instances describe $$instance1$$ --format 'text(machineType)'
  - stdout: |
      machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
- execute:
  - command: compute instance-groups managed set-instance-template $$manager$$ --zone
      us-central1-f --template $$template2$$ --format none
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
- execute:
  - command: compute instance-groups managed recreate-instances $$manager$$ --zone
      us-central1-f --instances $$instance1$$ --format text
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
  - stdout: |
      ---
      selfLink: $$instance1$$
      status:   SUCCESS
- execute:
  - command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
- execute:
  - command: compute instances describe $$instance1$$ --format 'text(machineType)'
  - stdout: |
      machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/f1-micro
- execute:
  - command: compute instance-groups managed delete-instances $$manager$$ --zone us-central1-f
      --instances $$instance1$$ --format none
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
- execute:
  - command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
- execute:
  - command: compute instance-groups managed list-instances $$manager$$ --zone us-central1-f
      --format 'text(instanceStatus,version.name)'
  - stdout: |
      ---
      instanceStatus: RUNNING
      ---
      instanceStatus: RUNNING
- execute:
  - command: compute instance-groups managed abandon-instances $$manager$$ --zone
      us-central1-f --instances $$instance2$$ --format none
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
- execute:
  - command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
- execute:
  - command: compute instance-groups managed list-instances $$manager$$ --zone us-central1-f
      --format 'text(instanceStatus,version.name)'
  - stdout: |
      ---
      instanceStatus: RUNNING
- execute:
  - command: compute instance-groups managed set-named-ports $$manager$$ --zone us-central1-f
      --named-ports my-service:1234
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$].
- execute:
  - command: compute instance-groups managed get-named-ports $$manager$$ --zone us-central1-f
      --format text
  - stdout: |
      ---
      name: my-service
      port: 1234
- execute:
  - command: compute target-pools create $$targetpool$$ --region us-central1 --format
      none
  - stderr: |
      Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$].
- execute:
  - command: compute instance-groups managed set-target-pools $$manager$$ --zone us-central1-f
      --target-pools $$targetpool$$ --format 'text(targetPools)'
  - stderr: |
      Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
  - stdout: |
      ---
      targetPools[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$
- execute:
  - command: compute target-pools delete $$targetpool$$ --region us-central1 --format
      none
  - prompt:
    - message: |
        The following target pools will be deleted:
         - [$$targetpool$$] in [us-central1]
    - input: y
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$].
- execute:
  - command: compute instance-groups managed delete $$manager$$ --zone us-central1-f
  - prompt:
    - message: |
        The following instance group managers will be deleted:
         - [$$manager$$] in [us-central1-f]
    - input: y
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
  - progress_tracker:
    - message: Deleting Managed Instance Group
    - status: SUCCESS
- execute:
  - command: compute instance-templates delete $$template2$$
  - prompt:
    - message: |
        The following instance templates will be deleted:
         - [$$template2$$]
    - input: y
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$].
- execute:
  - command: compute instance-templates delete $$template1$$
  - prompt:
    - message: |
        The following instance templates will be deleted:
         - [$$template1$$]
    - input: y
  - stderr: |
      Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$].
actions:

- generate_resource_id:
    reference: template1
    prefix: mig-zonal
- execute_command:
    command: compute instance-templates create $$template1$$ --machine-type n1-standard-1
      --format 'text(name,properties.machineType)'
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$].
    - expect_stdout: |
        ---
        name:                   $$template1$$
        properties.machineType: n1-standard-1
    - expect_exit:
        code: 0

- generate_resource_id:
    reference: template2
    prefix: mig-zonal
- execute_command:
    command: compute instance-templates create $$template2$$ --machine-type f1-micro
      --format 'text(name,properties.machineType)'
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$].
    - expect_stdout: |
        ---
        name:                   $$template2$$
        properties.machineType: f1-micro
    - expect_exit:
        code: 0


- generate_resource_id:
    reference: manager
    prefix: mig-zonal
- execute_command:
    # Create an empty MIG from template 1.
    command: compute instance-groups managed create $$manager$$ --zone us-central1-f
      --base-instance-name $$manager$$ --size 0 --template $$template1$$ --format
      'text(name,zone,targetSize)'
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"SC-FXfs-S4rBbWIpVSBG1PXtXWs=/vqn2iSSbnQOEJOD9xfZOGHtFqbY="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: us-central1-f
            description: us-central1-f
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers?alt=json
          method: POST
          headers: {}
          body:
            json:
              baseInstanceName: $$manager$$
              instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              name: $$manager$$
              targetSize: 0
              zone: us-central1-f
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '856'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '6511832105590587540'
            name: operation-1545322106518-57d765738f9f1-714b9869-47f12746
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.insert
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-20T08:08:27.523-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322106518-57d765738f9f1-714b9869-47f12746
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1069'
            Content-Type: application/json; charset=UTF-8
            ETag: '"f-vUZwNmrNYk884xoI9utymxZbE=/JF8F-O_quYic8N-it8VTN4YafXU="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            instanceGroup: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: cbnz20wBovg=
            currentActions:
              none: 0
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            targetSize: 0
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '28547'
            Content-Type: application/json; charset=UTF-8
            ETag: '"QBMnK04zlVNWvFT6hfe4CM4wt3s=/tUfFM2sOncSnHS5bd0yZOn1jr40="'
            status: '200'
          body:
            kind: compute#instanceGroupList
            id: projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups
            items:
            - kind: compute#instanceGroup
              id: '2853933052293677230'
              creationTimestamp: '2018-12-20T08:07:29.481-08:00'
              name: compute-backend-ig-20181220-160727-ctjh
              description: ''
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/compute-backend-ig-20181220-160727-ctjh
              size: 1
            - kind: compute#instanceGroup
              id: '2661952906130227378'
              creationTimestamp: '2018-12-20T08:07:57.675-08:00'
              name: compute-backend-ig-20181220-160756-a31n
              description: ''
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/compute-backend-ig-20181220-160756-a31n
              size: 1
            - kind: compute#instanceGroup
              id: '730381155340933491'
              creationTimestamp: '2018-12-12T21:01:16.721-08:00'
              name: gke-test-pool-20181213-0-default-pool-23dde5d2-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181213-0-default-pool-23dde5d2-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181213-0-default-pool-23dde5d2-grp
              size: 1
            - kind: compute#instanceGroup
              id: '2003041082530355675'
              creationTimestamp: '2018-12-12T20:59:32.785-08:00'
              name: gke-test-pool-20181213-0-default-pool-5556adba-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181213-0-default-pool-5556adba-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181213-0-default-pool-5556adba-grp
              size: 1
            - kind: compute#instanceGroup
              id: '8013154485301696886'
              creationTimestamp: '2018-12-12T21:01:13.497-08:00'
              name: gke-test-pool-20181213-0-default-pool-59f02e2b-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181213-0-default-pool-59f02e2b-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181213-0-default-pool-59f02e2b-grp
              size: 1
            - kind: compute#instanceGroup
              id: '5485111888490289600'
              creationTimestamp: '2018-12-12T20:59:27.924-08:00'
              name: gke-test-pool-20181213-0-default-pool-d411f2b9-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181213-0-default-pool-d411f2b9-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181213-0-default-pool-d411f2b9-grp
              size: 1
            - kind: compute#instanceGroup
              id: '8499582277720644559'
              creationTimestamp: '2018-12-13T19:36:00.641-08:00'
              name: gke-test-pool-20181214-0-default-pool-2c080447-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-2c080447-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-2c080447-grp
              size: 1
            - kind: compute#instanceGroup
              id: '6596321813179834568'
              creationTimestamp: '2018-12-13T19:06:15.558-08:00'
              name: gke-test-pool-20181214-0-default-pool-36a5b595-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-36a5b595-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-36a5b595-grp
              size: 1
            - kind: compute#instanceGroup
              id: '4975755675154948250'
              creationTimestamp: '2018-12-13T19:07:33.539-08:00'
              name: gke-test-pool-20181214-0-default-pool-57d8e509-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-57d8e509-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-57d8e509-grp
              size: 1
            - kind: compute#instanceGroup
              id: '5585665615579750537'
              creationTimestamp: '2018-12-13T19:07:18.976-08:00'
              name: gke-test-pool-20181214-0-default-pool-637cff43-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-637cff43-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-637cff43-grp
              size: 1
            - kind: compute#instanceGroup
              id: '6545331295721791714'
              creationTimestamp: '2018-12-13T19:05:49.246-08:00'
              name: gke-test-pool-20181214-0-default-pool-7c1482f0-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-7c1482f0-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-7c1482f0-grp
              size: 1
            - kind: compute#instanceGroup
              id: '3833482008655231778'
              creationTimestamp: '2018-12-13T21:55:25.247-08:00'
              name: gke-test-pool-20181214-0-default-pool-81db6b58-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-81db6b58-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-81db6b58-grp
              size: 1
            - kind: compute#instanceGroup
              id: '6007573361306018018'
              creationTimestamp: '2018-12-13T19:05:49.246-08:00'
              name: gke-test-pool-20181214-0-default-pool-a0fe8799-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-a0fe8799-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-a0fe8799-grp
              size: 1
            - kind: compute#instanceGroup
              id: '8497507636717986621'
              creationTimestamp: '2018-12-13T19:04:50.888-08:00'
              name: gke-test-pool-20181214-0-default-pool-ecf03b6c-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-ecf03b6c-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-ecf03b6c-grp
              size: 1
            - kind: compute#instanceGroup
              id: '5827726768336706425'
              creationTimestamp: '2018-12-13T19:37:58.786-08:00'
              name: gke-test-pool-20181214-0-default-pool-fb5e3008-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-fb5e3008-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-fb5e3008-grp
              size: 1
            - kind: compute#instanceGroup
              id: '6915857724915753744'
              creationTimestamp: '2018-12-13T19:05:35.079-08:00'
              name: gke-test-pool-20181214-0-default-pool-fc2a5eb0-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-20181214-0-default-pool-fc2a5eb0-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-20181214-0-default-pool-fc2a5eb0-grp
              size: 1
            - kind: compute#instanceGroup
              id: '6350410973861290121'
              creationTimestamp: '2018-12-13T19:07:18.977-08:00'
              name: gke-test-pool-region-201-default-pool-043b13c9-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-043b13c9-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-043b13c9-grp
              size: 1
            - kind: compute#instanceGroup
              id: '7407173847247247739'
              creationTimestamp: '2018-12-12T21:01:08.036-08:00'
              name: gke-test-pool-region-201-default-pool-353164d7-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-353164d7-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-353164d7-grp
              size: 1
            - kind: compute#instanceGroup
              id: '3863302726800398709'
              creationTimestamp: '2018-12-12T21:01:14.645-08:00'
              name: gke-test-pool-region-201-default-pool-3b04eb56-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-3b04eb56-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-3b04eb56-grp
              size: 1
            - kind: compute#instanceGroup
              id: '7406834918493168140'
              creationTimestamp: '2018-12-13T19:00:51.503-08:00'
              name: gke-test-pool-region-201-default-pool-41215d1b-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-41215d1b-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-41215d1b-grp
              size: 1
            - kind: compute#instanceGroup
              id: '8479128432276167028'
              creationTimestamp: '2018-12-12T21:01:15.212-08:00'
              name: gke-test-pool-region-201-default-pool-bea8cbeb-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-bea8cbeb-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-bea8cbeb-grp
              size: 1
            - kind: compute#instanceGroup
              id: '2144083771261886661'
              creationTimestamp: '2018-12-13T19:06:18.893-08:00'
              name: gke-test-pool-region-201-default-pool-c1b50795-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-c1b50795-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-c1b50795-grp
              size: 1
            - kind: compute#instanceGroup
              id: '6697366218807878461'
              creationTimestamp: '2018-12-13T19:04:51.022-08:00'
              name: gke-test-pool-region-201-default-pool-c2e4e22f-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-c2e4e22f-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-c2e4e22f-grp
              size: 1
            - kind: compute#instanceGroup
              id: '109457703293590477'
              creationTimestamp: '2018-12-13T19:36:02.738-08:00'
              name: gke-test-pool-region-201-default-pool-c6b24c74-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-c6b24c74-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-c6b24c74-grp
              size: 1
            - kind: compute#instanceGroup
              id: '5595313293242572936'
              creationTimestamp: '2018-12-13T19:07:19.111-08:00'
              name: gke-test-pool-region-201-default-pool-c6f29fc8-grp
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gke-test-pool-region-201-default-pool-c6f29fc8-grp'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gke-test-pool-region-201-default-pool-c6f29fc8-grp
              size: 1
            - kind: compute#instanceGroup
              id: '8244730239909232805'
              creationTimestamp: '2018-12-20T08:07:38.545-08:00'
              name: mig-instance-configs-zonal-20181220-160736-c02q
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-instance-configs-zonal-20181220-160736-c02q'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-instance-configs-zonal-20181220-160736-c02q
              size: 1
            - kind: compute#instanceGroup
              id: '6052275299317842109'
              creationTimestamp: '2018-12-20T08:07:46.111-08:00'
              name: mig-instance-configs-zonal-20181220-160745-0fl8
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-instance-configs-zonal-20181220-160745-0fl8'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-instance-configs-zonal-20181220-160745-0fl8
              size: 1
            - kind: compute#instanceGroup
              id: '5778087108287004819'
              creationTimestamp: '2018-12-20T08:08:28.990-08:00'
              name: mig-instance-configs-zonal-20181220-160827-ml49
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-instance-configs-zonal-20181220-160827-ml49'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-instance-configs-zonal-20181220-160827-ml49
              size: 0
            - kind: compute#instanceGroup
              id: '2940243151705997422'
              creationTimestamp: '2018-12-20T08:08:33.851-08:00'
              name: mig-stateful-policy-zonal-20181220-160830-jv7r
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-stateful-policy-zonal-20181220-160830-jv7r'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-stateful-policy-zonal-20181220-160830-jv7r
              size: 0
            - kind: compute#instanceGroup
              id: '5667368284529754295'
              creationTimestamp: '2018-12-20T08:07:52.775-08:00'
              name: mig-stop-zonal-20181220-160750-qcy9
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-stop-zonal-20181220-160750-qcy9'. To modify instances in this\
                \ group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-stop-zonal-20181220-160750-qcy9
              size: 3
            - kind: compute#instanceGroup
              id: '5358678908972957844'
              creationTimestamp: '2018-12-20T08:08:27.433-08:00'
              name: $$manager$$
              description: "This instance group is controlled by Instance Group Manager\
                \ '$$manager$$'. To modify instances in this group, use the Instance\
                \ Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
              size: 0
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '244'
            Content-Type: application/json; charset=UTF-8
            ETag: '"_eg_pzubGcY3g-q5D9X1W_RSdIk=/JeWZ0bB1UJWNbCqbNGMOzE7kunI="'
            status: '200'
          body:
            kind: compute#autoscalerList
            id: projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
    - expect_stdout: |
        ---
        name:       $$manager$$
        targetSize: 0
        zone:       https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
    - expect_exit:
        code: 0


- execute_command:
    # Increase the size to 3.
    command: compute instance-groups managed resize $$manager$$ --zone us-central1-f
      --size 3 --format 'text(name,zone,targetSize)'
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$/resize?alt=json&size=3
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '946'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '781670662651904099'
            name: operation-1545322124139-57d765845d9f9-f673bfaa-00981522
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.resize
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-12-20T08:08:44.854-08:00'
            startTime: '2018-12-20T08:08:44.858-08:00'
            endTime: '2018-12-20T08:08:44.858-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322124139-57d765845d9f9-f673bfaa-00981522
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1069'
            Content-Type: application/json; charset=UTF-8
            ETag: '"8GjpOS8bUSgodVWKY1LrVmmkO3w=/sHFBVVqQ3QqZ9t-9334bkMq_bds="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            instanceGroup: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: cbnz20wBovg=
            currentActions:
              none: 0
              creating: 3
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            targetSize: 3
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
    - expect_stdout: |
        ---
        name:       $$manager$$
        targetSize: 3
        zone:       https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
    - expect_exit:
        code: 0
- execute_command:
    command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
    validation_only: true
    events:
    - expect_exit:
        code: 0


- execute_command:
    # Check that there are 3 instances and extract 2 of the ids.
    command: compute instance-groups managed list-instances $$manager$$ --zone us-central1-f
      --format 'text(instanceStatus,version.name)'
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$/listManagedInstances?alt=json&maxResults=500
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '811'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            managedInstances:
            - instance: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/mig-zonal-20181220-160826-53nb-73hz
              id: '6151293614253539424'
              instanceStatus: RUNNING
              currentAction: NONE
            - instance: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/mig-zonal-20181220-160826-53nb-b2kb
              id: '286799419795701857'
              instanceStatus: RUNNING
              currentAction: NONE
            - instance: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$manager$$-vl37
              id: '7747443503150792800'
              instanceStatus: RUNNING
              currentAction: NONE
        expect_response:
          extract_references:
          - field: managedInstances[0].instance
            reference: instance1
          - field: managedInstances[1].instance
            reference: instance2
          body:
            json: {}
    - expect_stdout: |
        ---
        instanceStatus: RUNNING
        ---
        instanceStatus: RUNNING
        ---
        instanceStatus: RUNNING
    - expect_exit:
        code: 0


- execute_command:
    # Check that the instance is on the old machine type.
    command: compute instances describe $$instance1$$ --format 'text(machineType)'
    validation_only: true
    events:
    - expect_stdout: |
        machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
    - expect_exit:
        code: 0


- execute_command:
    # Change to template 2.
    command: compute instance-groups managed set-instance-template $$manager$$ --zone
      us-central1-f --template $$template2$$ --format none
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$/setInstanceTemplate?alt=json
          method: POST
          headers: {}
          body:
            json:
              instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '869'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7331992523494522975'
            name: operation-1545322159529-57d765a61dc29-9ff54779-c38b0537
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.setInstanceTemplate
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-20T08:09:20.265-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322159529-57d765a61dc29-9ff54779-c38b0537
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1069'
            Content-Type: application/json; charset=UTF-8
            ETag: '"hpVoTpGZWyQ5pj11Yu0h_gA-38I=/oYutD0Wcv3oDrF0uVt-fGHtIrzg="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            instanceGroup: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: w0r7eiedX28=
            currentActions:
              none: 3
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            targetSize: 3
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
    - expect_exit:
        code: 0
- execute_command:
    # Recreate the instance so it will come up at the new machine type.
    command: compute instance-groups managed recreate-instances $$manager$$ --zone
      us-central1-f --instances $$instance1$$ --format text
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$/recreateInstances?alt=json
          method: POST
          headers: {}
          body:
            json:
              instances:
              - $$instance1$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '958'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5321299525128028246'
            name: operation-1545322168490-57d765aea9812-a778f56c-dab8c1f2
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.recreateInstances
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-12-20T08:09:30.325-08:00'
            startTime: '2018-12-20T08:09:30.328-08:00'
            endTime: '2018-12-20T08:09:30.328-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322168490-57d765aea9812-a778f56c-dab8c1f2
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1069'
            Content-Type: application/json; charset=UTF-8
            ETag: '"yEtYDgsNn5YdBOSqj-avu1VdSJw=/E30tQYQ7pVEl1KS3VyybnKbyucA="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            instanceGroup: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: w0r7eiedX28=
            currentActions:
              none: 2
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 1
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            targetSize: 3
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
    - expect_stdout: |
        ---
        selfLink: $$instance1$$
        status:   SUCCESS
    - expect_exit:
        code: 0
- execute_command:
    command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
    validation_only: true
    events:
    - expect_exit:
        code: 0
- execute_command:
    # Check that the instance is on the new machine type.
    command: compute instances describe $$instance1$$ --format 'text(machineType)'
    validation_only: true
    events:
    - expect_stdout: |
        machineType: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/f1-micro
    - expect_exit:
        code: 0


- execute_command:
    # Delete the instance.
    command: compute instance-groups managed delete-instances $$manager$$ --zone us-central1-f
      --instances $$instance1$$ --format none
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$/deleteInstances?alt=json
          method: POST
          headers: {}
          body:
            json:
              instances:
              - $$instance1$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '956'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '6753080066419589578'
            name: operation-1545322277014-57d76616289f1-af5dc062-e735921f
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.deleteInstances
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-12-20T08:11:17.606-08:00'
            startTime: '2018-12-20T08:11:17.609-08:00'
            endTime: '2018-12-20T08:11:17.609-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322277014-57d76616289f1-af5dc062-e735921f
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1069'
            Content-Type: application/json; charset=UTF-8
            ETag: '"K-YjFoNMjd_FzH7fLfp-ZkvHoMI=/EJtqQKzpaKxfVKeAaT-0AwUOXsA="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            instanceGroup: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: w0r7eiedX28=
            currentActions:
              none: 2
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 1
              abandoning: 0
              restarting: 0
              refreshing: 0
            targetSize: 2
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
    validation_only: true
    events:
    - expect_exit:
        code: 0
- execute_command:
    # Check that there are only 2 instances now.
    command: compute instance-groups managed list-instances $$manager$$ --zone us-central1-f
      --format 'text(instanceStatus,version.name)'
    validation_only: true
    events:
    - expect_stdout: |
        ---
        instanceStatus: RUNNING
        ---
        instanceStatus: RUNNING
    - expect_exit:
        code: 0


- execute_command:
    # Abandon an instance.
    command: compute instance-groups managed abandon-instances $$manager$$ --zone
      us-central1-f --instances $$instance2$$ --format none
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$/abandonInstances?alt=json
          method: POST
          headers: {}
          body:
            json:
              instances:
              - $$instance2$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '957'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '3531903230629249438'
            name: operation-1545322353140-57d7665ec2122-a3c8492a-6cba4df4
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.abandonInstances
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-12-20T08:12:33.742-08:00'
            startTime: '2018-12-20T08:12:33.745-08:00'
            endTime: '2018-12-20T08:12:33.745-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322353140-57d7665ec2122-a3c8492a-6cba4df4
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1069'
            Content-Type: application/json; charset=UTF-8
            ETag: '"QBMnK04zlVNWvFT6hfe4CM4wt3s=/cVe9YbXrL2qqOJxBSzyF_RMJNbk="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            instanceGroup: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: w0r7eiedX28=
            currentActions:
              none: 1
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 1
              restarting: 0
              refreshing: 0
            targetSize: 1
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute instance-groups managed wait-until-stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
    validation_only: true
    events:
    - expect_exit:
        code: 0
- execute_command:
    # Check that there is only 1 instance now.
    command: compute instance-groups managed list-instances $$manager$$ --zone us-central1-f
      --format 'text(instanceStatus,version.name)'
    validation_only: true
    events:
    - expect_stdout: |
        ---
        instanceStatus: RUNNING
    - expect_exit:
        code: 0


- execute_command:
    # Set some ports
    command: compute instance-groups managed set-named-ports $$manager$$ --zone us-central1-f
      --named-ports my-service:1234
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '854'
            Content-Type: application/json; charset=UTF-8
            ETag: '"YOeuW3v66_zEobLDMIOnE3t1t1o=/sCW4M2atI2AZbpCAQEL4jHdtttE="'
            status: '200'
          body:
            kind: compute#instanceGroup
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            description: "This instance group is controlled by Instance Group Manager\
              \ '$$manager$$'. To modify instances in this group, use the Instance\
              \ Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
            network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
            fingerprint: 42WmSpB8rSM=
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            size: 1
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$/setNamedPorts?alt=json
          method: POST
          headers: {}
          body:
            json:
              fingerprint: 42WmSpB8rSM=
              namedPorts:
              - name: my-service
                port: 1234
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '940'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5873948626555109776'
            name: operation-1545322366838-57d7666bd24f0-214acd10-658921c3
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroups.setNamedPorts
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            targetId: '5358678908972957844'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-12-20T08:12:47.260-08:00'
            startTime: '2018-12-20T08:12:47.263-08:00'
            endTime: '2018-12-20T08:12:47.263-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322366838-57d7666bd24f0-214acd10-658921c3
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '924'
            Content-Type: application/json; charset=UTF-8
            ETag: '"BhvoklJKb_4Uik5svtvUu8d1hAA=/AG-mKIMRw5IW1P0OCyn45-nJg8c="'
            status: '200'
          body:
            kind: compute#instanceGroup
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            description: "This instance group is controlled by Instance Group Manager\
              \ '$$manager$$'. To modify instances in this group, use the Instance\
              \ Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
            namedPorts:
            - name: my-service
              port: 1234
            network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
            fingerprint: ggTjPYfVy0U=
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            size: 1
    - expect_exit:
        code: 0
- execute_command:
    # Check the ports.
    command: compute instance-groups managed get-named-ports $$manager$$ --zone us-central1-f
      --format text
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '924'
            Content-Type: application/json; charset=UTF-8
            ETag: '"0Si-tpuLIdk6zxXUxjkVLTs1G9o=/t1lr11_Pt1zHhGaRXJnby92uT2g="'
            status: '200'
          body:
            kind: compute#instanceGroup
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            description: "This instance group is controlled by Instance Group Manager\
              \ '$$manager$$'. To modify instances in this group, use the Instance\
              \ Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
            namedPorts:
            - name: my-service
              port: 1234
            network: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/default
            fingerprint: ggTjPYfVy0U=
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            size: 1
    - expect_stdout: |
        ---
        name: my-service
        port: 1234
    - expect_exit:
        code: 0


- generate_resource_id:
    reference: targetpool
    prefix: mig-zonal
- execute_command:
    command: compute target-pools create $$targetpool$$ --region us-central1 --format
      none
    validation_only: true
    events:
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$].
    - expect_exit:
        code: 0
- execute_command:
    # Set the target pool
    command: compute instance-groups managed set-target-pools $$manager$$ --zone us-central1-f
      --target-pools $$targetpool$$ --format 'text(targetPools)'
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              targetPools:
              - https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '825'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2615924647857095011'
            name: operation-1545322378123-57d76676956f8-24d24e8a-57bedf69
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: patch
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-20T08:13:01.188-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322378123-57d76676956f8-24d24e8a-57bedf69
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1305'
            Content-Type: application/json; charset=UTF-8
            ETag: '"4LQsT2Rqcj38X9yfvYWMpmiqftc=/JQTwggYR_vQc3GabmfCg_dE4YRc="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '5358678908972957844'
            creationTimestamp: '2018-12-20T08:08:27.433-08:00'
            name: $$manager$$
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            instanceGroup: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            targetPools:
            - https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$
            baseInstanceName: $$manager$$
            fingerprint: GznzUwrqiO8=
            currentActions:
              none: 1
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            targetSize: 1
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            namedPorts:
            - name: my-service
              port: 1234
    - expect_stdout: |
        ---
        targetPools[0]: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$
    - expect_exit:
        code: 0


- execute_command:
    command: compute target-pools delete $$targetpool$$ --region us-central1 --format
      none
    validation_only: true
    cleanup_for: targetpool
    events:
    - expect_prompt_continue:
        message: |
          The following target pools will be deleted:
           - [$$targetpool$$] in [us-central1]
        user_input: y
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/targetPools/$$targetpool$$].
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed delete $$manager$$ --zone us-central1-f
    cleanup_for: manager
    events:
    - expect_prompt_continue:
        message: |
          The following instance group managers will be deleted:
           - [$$manager$$] in [us-central1-f]
        user_input: y
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '244'
            Content-Type: application/json; charset=UTF-8
            ETag: '"BhvoklJKb_4Uik5svtvUu8d1hAA=/qDJzn1MDUUuZNzUwyDP1lt7Zmms="'
            status: '200'
          body:
            kind: compute#autoscalerList
            id: projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '856'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2811882462017618253'
            name: operation-1545322402420-57d7668dc1520-3a1451b8-769eebba
            zone: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '5358678908972957844'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-20T08:13:22.853-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1545322402420-57d7668dc1520-3a1451b8-769eebba
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$].
    - expect_progress_tracker:
        message: Deleting Managed Instance Group
        status: SUCCESS
    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-templates delete $$template2$$
    cleanup_for: template2
    validation_only: true
    events:
    - expect_prompt_continue:
        message: |
          The following instance templates will be deleted:
           - [$$template2$$]
        user_input: y
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$].
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-templates delete $$template1$$
    cleanup_for: template1
    validation_only: true
    events:
    - expect_prompt_continue:
        message: |
          The following instance templates will be deleted:
           - [$$template1$$]
        user_input: y
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$].
    - expect_exit:
        code: 0
