title: Creates a regional MIG, starts a proactive update, and then stop it.
release_tracks: [BETA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute instance-templates create $$template1$$ --machine-type n1-standard-1
      --format 'text(name,properties.machineType)'
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
      $
  - stdout: |
      ---
      name:                   $$template1$$
      properties.machineType: n1-standard-1
- execute:
  - command: compute instance-templates create $$template2$$ --machine-type f1-micro
      --format 'text(name,properties.machineType)'
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
      $
  - stdout: |
      ---
      name:                   $$template2$$
      properties.machineType: f1-micro
- execute:
  - command: compute instance-groups managed create $$manager$$ --region us-central1
      --base-instance-name $$manager$$ --size 5 --template $$template1$$ --format
      'text(name,region,targetSize)'
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
      $
  - stdout: |-
      ---
      name:       $$manager$$
      region:     https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1
      targetSize: 5
      $
- execute:
  - command: compute instance-groups managed wait-until --stable $$manager$$ --timeout
      600 --region us-central1 --no-user-output-enabled
- execute:
  - command: compute instance-groups managed rolling-action start-update $$manager$$
      --type proactive --canary-version template=$$template2$$,target-size=3 --version
      template=$$template1$$ --region us-central1 --format=disable
  - stderr: |-
      Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
      $
- execute:
  - command: compute instance-groups managed rolling-action stop-proactive-update
      $$manager$$ --region us-central1 --format=disable
  - stderr: |-
      Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
      $
- execute:
  - command: compute instance-groups managed delete $$manager$$ --region us-central1
  - prompt:
    - message: |
        The following region instance group managers will be deleted:
         - [$$manager$$] in [us-central1]
    - input: y
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
      $
  - progress_tracker:
    - message: Deleting Managed Instance Group
    - status: SUCCESS
- execute:
  - command: compute instance-templates delete $$template1$$
  - prompt:
    - message: |
        The following instance templates will be deleted:
         - [$$template1$$]
    - input: y
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
      $
- execute:
  - command: compute instance-templates delete $$template2$$
  - prompt:
    - message: |
        The following instance templates will be deleted:
         - [$$template2$$]
    - input: y
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
      $
actions:
- define_reference:
    reference: compute-uri
    value: compute.googleapis.com/compute
- generate_resource_id:
    reference: template1
    prefix: mig-stop-regional
- execute_command:
    command: compute instance-templates create $$template1$$ --machine-type n1-standard-1
      --format 'text(name,properties.machineType)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '795'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#image
            id: '4955978089489385925'
            creationTimestamp: '2018-12-11T09:43:06.700-08:00'
            name: debian-9-stretch-v20181210
            description: Debian, Debian GNU/Linux, 9 (stretch), amd64 built on 20181210
            sourceType: RAW
            rawDisk:
              source: ''
              containerType: TAR
            status: READY
            archiveSizeBytes: '10291069440'
            diskSizeGb: '10'
            licenses:
            - https://$$compute-uri$$/beta/projects/debian-cloud/global/licenses/debian-9-stretch
            family: debian-9
            selfLink: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/debian-9-stretch-v20181210
            labelFingerprint: 42WmSpB8rSM=
            guestOsFeatures:
            - type: VIRTIO_SCSI_MULTIQUEUE
            licenseCodes:
            - '1000205'
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$template1$$
              properties:
                canIpForward: false
                disks:
                - autoDelete: true
                  boot: true
                  initializeParams:
                    sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10
                  mode: READ_WRITE
                  type: PERSISTENT
                machineType: n1-standard-1
                metadata: {}
                networkInterfaces:
                - accessConfigs:
                  - name: external-nat
                    type: ONE_TO_ONE_NAT
                  network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                scheduling:
                  automaticRestart: true
                serviceAccounts:
                - email: default
                  scopes:
                  - https://www.googleapis.com/auth/devstorage.read_only
                  - https://www.googleapis.com/auth/logging.write
                  - https://www.googleapis.com/auth/monitoring.write
                  - https://www.googleapis.com/auth/pubsub
                  - https://www.googleapis.com/auth/service.management.readonly
                  - https://www.googleapis.com/auth/servicecontrol
                  - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '725'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7191386972237832964'
            name: operation-1547050474650-57f08c1fdb990-6e8ae154-5dd872e2
            operationType: compute.instanceTemplates.insert
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            targetId: '7279919438052958980'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:14:35.343-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1547050474650-57f08c1fdb990-6e8ae154-5dd872e2
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1842'
            Content-Type: application/json; charset=UTF-8
            ETag: '"kAoUS6FSxiov2bAuEO8DUsIQ_0c=/4MiXowqoYFf8GZKX2QIX9JYMqfE="'
            status: '200'
          body:
            kind: compute#instanceTemplate
            id: '7279919438052958980'
            creationTimestamp: '2019-01-09T08:14:35.327-08:00'
            name: $$template1$$
            description: ''
            properties:
              machineType: n1-standard-1
              canIpForward: false
              networkInterfaces:
              - kind: compute#networkInterface
                network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                accessConfigs:
                - kind: compute#accessConfig
                  type: ONE_TO_ONE_NAT
                  name: external-nat
                  networkTier: PREMIUM
              disks:
              - kind: compute#attachedDisk
                type: PERSISTENT
                mode: READ_WRITE
                deviceName: persistent-disk-0
                index: 0
                boot: true
                initializeParams:
                  sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-9
                autoDelete: true
              metadata:
                kind: compute#metadata
                fingerprint: 4_QxQ57NQak=
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
              scheduling:
                onHostMaintenance: MIGRATE
                automaticRestart: true
                preemptible: false
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
    - expect_stdout: |
        ---
        name:                   $$template1$$
        properties.machineType: n1-standard-1
    - expect_exit:
        code: 0


- generate_resource_id:
    reference: template2
    prefix: mig-stop-regional
- execute_command:
    command: compute instance-templates create $$template2$$ --machine-type f1-micro
      --format 'text(name,properties.machineType)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '795'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#image
            id: '4955978089489385925'
            creationTimestamp: '2018-12-11T09:43:06.700-08:00'
            name: debian-9-stretch-v20181210
            description: Debian, Debian GNU/Linux, 9 (stretch), amd64 built on 20181210
            sourceType: RAW
            rawDisk:
              source: ''
              containerType: TAR
            status: READY
            archiveSizeBytes: '10291069440'
            diskSizeGb: '10'
            licenses:
            - https://$$compute-uri$$/beta/projects/debian-cloud/global/licenses/debian-9-stretch
            family: debian-9
            selfLink: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/debian-9-stretch-v20181210
            labelFingerprint: 42WmSpB8rSM=
            guestOsFeatures:
            - type: VIRTIO_SCSI_MULTIQUEUE
            licenseCodes:
            - '1000205'
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$template2$$
              properties:
                canIpForward: false
                disks:
                - autoDelete: true
                  boot: true
                  initializeParams:
                    sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10
                  mode: READ_WRITE
                  type: PERSISTENT
                machineType: f1-micro
                metadata: {}
                networkInterfaces:
                - accessConfigs:
                  - name: external-nat
                    type: ONE_TO_ONE_NAT
                  network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                scheduling:
                  automaticRestart: true
                serviceAccounts:
                - email: default
                  scopes:
                  - https://www.googleapis.com/auth/devstorage.read_only
                  - https://www.googleapis.com/auth/logging.write
                  - https://www.googleapis.com/auth/monitoring.write
                  - https://www.googleapis.com/auth/pubsub
                  - https://www.googleapis.com/auth/service.management.readonly
                  - https://www.googleapis.com/auth/servicecontrol
                  - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '725'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7078996594453619487'
            name: operation-1547050479963-57f08c24ecb79-692e6866-a0b1c0ab
            operationType: compute.instanceTemplates.insert
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            targetId: '2402425169350730527'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:14:40.708-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1547050479963-57f08c24ecb79-692e6866-a0b1c0ab
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1837'
            Content-Type: application/json; charset=UTF-8
            ETag: '"mv6iebVrmwrRj0V5ADBjf1sxCG4=/TBZFr5WJUH-6j4T-E4ebnFO-K6s="'
            status: '200'
          body:
            kind: compute#instanceTemplate
            id: '2402425169350730527'
            creationTimestamp: '2019-01-09T08:14:40.616-08:00'
            name: $$template2$$
            description: ''
            properties:
              machineType: f1-micro
              canIpForward: false
              networkInterfaces:
              - kind: compute#networkInterface
                network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                accessConfigs:
                - kind: compute#accessConfig
                  type: ONE_TO_ONE_NAT
                  name: external-nat
                  networkTier: PREMIUM
              disks:
              - kind: compute#attachedDisk
                type: PERSISTENT
                mode: READ_WRITE
                deviceName: persistent-disk-0
                index: 0
                boot: true
                initializeParams:
                  sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-9
                autoDelete: true
              metadata:
                kind: compute#metadata
                fingerprint: 4_QxQ57NQak=
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
              scheduling:
                onHostMaintenance: MIGRATE
                automaticRestart: true
                preemptible: false
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
    - expect_stdout: |
        ---
        name:                   $$template2$$
        properties.machineType: f1-micro
    - expect_exit:
        code: 0


- generate_resource_id:
    reference: manager
    prefix: mig-stop-regional
- execute_command:
    command: compute instance-groups managed create $$manager$$ --region us-central1
      --base-instance-name $$manager$$ --size 5 --template $$template1$$ --format
      'text(name,region,targetSize)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers?alt=json
          method: POST
          headers: {}
          body:
            json:
              baseInstanceName: $$manager$$
              instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              name: $$manager$$
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
              targetSize: 5
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '872'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '7696860225900094233'
            name: operation-1547050484943-57f08c29ac89b-ebb17a7d-512c0ee3
            operationType: compute.instanceGroupManagers.insert
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            targetId: '7387019691733787417'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:14:46.423-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1547050484943-57f08c29ac89b-ebb17a7d-512c0ee3
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2193'
            Content-Type: application/json; charset=UTF-8
            ETag: '"v6mFIiV-dWG4osdPEPYmzfaIftk=/ngh_oqhiEjSo9ptFeTp3pqhFl5w="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7387019691733787417'
            creationTimestamp: '2019-01-09T08:14:46.255-08:00'
            name: $$manager$$
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 5
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: FW92mORn8p0=
            currentActions:
              none: 0
              creating: 5
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 0
              deleting: 0
              recreating: 0
              restarting: 0
            status:
              isStable: false
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '12717'
            Content-Type: application/json; charset=UTF-8
            ETag: '"Mp4ean3Lfu_HpVp2qg8GlzT0kRY=/LTDro1Opdz8jD1Yy7Cm2cSDM3c0="'
            status: '200'
          body:
            kind: compute#regionInstanceGroupList
            id: projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups
            items:
            - kind: compute#instanceGroup
              id: '3449539166778139399'
              creationTimestamp: '2019-01-09T08:14:32.520-08:00'
              name: managed-instance-group-auto-healing-20190109-161431-w386
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'managed-instance-group-auto-healing-20190109-161431-w386'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/managed-instance-group-auto-healing-20190109-161431-w386
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '6948153306293969787'
              creationTimestamp: '2019-01-09T08:13:08.292-08:00'
              name: mig-instance-configs-regional-20190109-161304-vm5x
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-instance-configs-regional-20190109-161304-vm5x'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-instance-configs-regional-20190109-161304-vm5x
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '1669425988823130959'
              creationTimestamp: '2019-01-09T08:13:20.800-08:00'
              name: mig-instance-configs-regional-20190109-161317-j2zc
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-instance-configs-regional-20190109-161317-j2zc'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-instance-configs-regional-20190109-161317-j2zc
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '1163359759091082062'
              creationTimestamp: '2019-01-09T08:13:21.773-08:00'
              name: mig-instance-configs-regional-20190109-161320-x50i
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-instance-configs-regional-20190109-161320-x50i'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-instance-configs-regional-20190109-161320-x50i
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '533163318032704143'
              creationTimestamp: '2019-01-09T08:08:00.267-08:00'
              name: mig-regional-20190109-160758-d8qk
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-regional-20190109-160758-d8qk'. To modify instances\
                \ in this group, use the Regional Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              namedPorts:
              - name: my-service
                port: 1234
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: ggTjPYfVy0U=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-regional-20190109-160758-d8qk
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '5768980471947698993'
              creationTimestamp: '2019-01-09T08:14:22.606-08:00'
              name: mig-replacer-regional-20190109-161421-rymb
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-replacer-regional-20190109-161421-rymb'. To modify\
                \ instances in this group, use the Regional Instance Group Manager\
                \ API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-replacer-regional-20190109-161421-rymb
              size: 8
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '9162886353918862100'
              creationTimestamp: '2019-01-09T08:14:51.868-08:00'
              name: mig-replacer-regional-20190109-161450-ywd9
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-replacer-regional-20190109-161450-ywd9'. To modify\
                \ instances in this group, use the Regional Instance Group Manager\
                \ API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-replacer-regional-20190109-161450-ywd9
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '3705822433720902519'
              creationTimestamp: '2019-01-09T08:13:13.062-08:00'
              name: mig-restart-switch-regional-20190109-161311-po5s
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-restart-switch-regional-20190109-161311-po5s'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-restart-switch-regional-20190109-161311-po5s
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '1161139961078719245'
              creationTimestamp: '2019-01-09T08:14:26.500-08:00'
              name: mig-restart-switch-regional-20190109-161423-vj28
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-restart-switch-regional-20190109-161423-vj28'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-restart-switch-regional-20190109-161423-vj28
              size: 7
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '2640388888947565314'
              creationTimestamp: '2019-01-09T08:14:37.374-08:00'
              name: mig-stateful-policy-regional-20190109-161433-h6d8
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-stateful-policy-regional-20190109-161433-h6d8'.\
                \ To modify instances in this group, use the Regional Instance Group\
                \ Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-stateful-policy-regional-20190109-161433-h6d8
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '7387019691733787417'
              creationTimestamp: '2019-01-09T08:14:46.332-08:00'
              name: $$manager$$
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager '$$manager$$'. To modify instances in this group,\
                \ use the Regional Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$manager$$
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '4103498871611302743'
              creationTimestamp: '2019-01-09T08:13:44.478-08:00'
              name: mig-updater-regional-20190109-161343-qg5y
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-updater-regional-20190109-161343-qg5y'. To modify\
                \ instances in this group, use the Regional Instance Group Manager\
                \ API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-updater-regional-20190109-161343-qg5y
              size: 10
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            - kind: compute#instanceGroup
              id: '2850524849713685277'
              creationTimestamp: '2019-01-09T08:14:42.983-08:00'
              name: mig-updater-regional-20190109-161438-de0m
              description: "This instance group is controlled by Regional Instance\
                \ Group Manager 'mig-updater-regional-20190109-161438-de0m'. To modify\
                \ instances in this group, use the Regional Instance Group Manager\
                \ API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/mig-updater-regional-20190109-161438-de0m
              size: 0
              region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '252'
            Content-Type: application/json; charset=UTF-8
            ETag: '"ACVUdHZJwMQJyehR6KNh89xxTzc=/h2AZ1Pt1uB6P1Xwl1_G6iHsSUxM="'
            status: '200'
          body:
            kind: compute#regionAutoscalerList
            id: projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers
    - expect_stdout:
        matches: |
          ---
          name:       $$manager$$
          region:     https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1
          targetSize: 5
    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-groups managed wait-until --stable $$manager$$ --timeout
      600 --region us-central1 --no-user-output-enabled
    validation_only: true
    events:
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed rolling-action start-update $$manager$$
      --type proactive --canary-version template=$$template2$$,target-size=3 --version
      template=$$template1$$ --region us-central1 --format=disable
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2192'
            Content-Type: application/json; charset=UTF-8
            ETag: '"V9_AB7v0uHOrvZuvGhjCef_01Eg=/3rSZrc0SM0Hs_Mr-kIsUfS7Fy4U="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7387019691733787417'
            creationTimestamp: '2019-01-09T08:14:46.255-08:00'
            name: $$manager$$
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 5
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: FW92mORn8p0=
            currentActions:
              none: 5
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 0
              deleting: 0
              recreating: 0
              restarting: 0
            status:
              isStable: true
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$/listPerInstanceConfigs?alt=json&maxResults=500
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body: null
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              updatePolicy:
                minimalAction: REPLACE
                type: PROACTIVE
              versions:
              - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              - targetSize: {}
                instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '986'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '1875027958773293253'
            name: operation-1547050537224-57f08c5b88742-253bbe90-2c1e0016
            operationType: patch
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            targetId: '7387019691733787417'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:15:38.709-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1547050537224-57f08c5b88742-253bbe90-2c1e0016
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          body:
            json:
              targetSize: 5
              updatePolicy.maxSurge.calculated: 3
              updatePolicy.maxUnavailable.calculated: 3
              updatePolicy.type: PROACTIVE
              updatePolicy.minimalAction: REPLACE
              versions[0].targetSize.calculated: 2
              versions[1].targetSize.calculated: 3
              versions[1].targetSize.fixed: 3
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2260'
            Content-Type: application/json; charset=UTF-8
            ETag: '"2BPFl1ir73-3s-9IziicRJn5aB8=/C7qGcCDJaccT-1MmtbMUg92ngEE="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7387019691733787417'
            creationTimestamp: '2019-01-09T08:14:46.255-08:00'
            name: $$manager$$
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 2
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
              targetSize:
                fixed: 3
                calculated: 3
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: _jVkQuu98cU=
            currentActions:
              none: 3
              creating: 2
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 2
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 1
              deleting: 1
              recreating: 0
              restarting: 0
            status:
              isStable: false
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: PROACTIVE
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com

    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-groups managed rolling-action stop-proactive-update
      $$manager$$ --region us-central1 --format=disable
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              updatePolicy:
                type: OPPORTUNISTIC
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '840'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '261442233526100183'
            name: operation-1547050550801-57f08c687b269-8c87e852-9325527a
            operationType: patch
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            targetId: '7387019691733787417'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:15:52.324-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1547050550801-57f08c687b269-8c87e852-9325527a
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          body:
            json:
              targetSize: 5
              updatePolicy.type: OPPORTUNISTIC
              versions[0].targetSize.calculated: 2
              versions[1].targetSize.calculated: 3
              versions[1].targetSize.fixed: 3
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '2264'
            Content-Type: application/json; charset=UTF-8
            ETag: '"j_7xIigNxvJ5EHckSwlUXjEdkg0=/28bbq33JkdjJ8RotTvi5xJJR5FQ="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7387019691733787417'
            creationTimestamp: '2019-01-09T08:14:46.255-08:00'
            name: $$manager$$
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            distributionPolicy:
              zones:
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-b
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-c
              - zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 2
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
              targetSize:
                fixed: 3
                calculated: 3
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: uatUmU14abc=
            currentActions:
              none: 2
              creating: 3
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 3
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 0
              deleting: 0
              recreating: 0
              restarting: 0
            status:
              isStable: false
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 3
                calculated: 3
              maxUnavailable:
                fixed: 3
                calculated: 3
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com
    - expect_exit:
        code: 0
- execute_command:
    command: compute instance-groups managed delete $$manager$$ --region us-central1
    cleanup_for: manager
    events:
    - expect_prompt_continue:
        message: |
          The following region instance group managers will be deleted:
           - [$$manager$$] in [us-central1]
        user_input: y
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '252'
            Content-Type: application/json; charset=UTF-8
            ETag: '"J474gpNF9QCLYcPvKAN1b2UpqNM=/W4LiqCOSWAjrgSWrfoHceq5SaD0="'
            status: '200'
          body:
            kind: compute#regionAutoscalerList
            id: projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/autoscalers
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '872'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '8804156142597677226'
            name: operation-1547050564844-57f08c75df9e0-0a0608fa-4f8a9ff6
            operationType: compute.instanceGroupManagers.delete
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$
            targetId: '7387019691733787417'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:16:05.457-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1547050564844-57f08c75df9e0-0a0608fa-4f8a9ff6
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/regions/us-central1/instanceGroupManagers/$$manager$$\].
    - expect_progress_tracker:
        message: Deleting Managed Instance Group
        status: SUCCESS
    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-templates delete $$template1$$
    cleanup_for: template1
    events:
    - expect_prompt_continue:
        message: |
          The following instance templates will be deleted:
           - [$$template1$$]
        user_input: y
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '698'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '355475633324400650'
            name: operation-1547050725481-57f08d0f11a2a-9e21c8ea-c2a02a1d
            operationType: delete
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            targetId: '7279919438052958980'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:18:45.995-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1547050725481-57f08d0f11a2a-9e21c8ea-c2a02a1d
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-templates delete $$template2$$
    cleanup_for: template2
    events:
    - expect_prompt_continue:
        message: |
          The following instance templates will be deleted:
           - [$$template2$$]
        user_input: y
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '699'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5090727293922025474'
            name: operation-1547050733304-57f08d16878c2-28a30105-837a1ede
            operationType: delete
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            targetId: '2402425169350730527'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-01-09T08:18:53.743-08:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1547050733304-57f08d16878c2-28a30105-837a1ede
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
    - expect_exit:
        code: 0
