title: Creates a zonal MIG, starts a proactive update, and then stop it.
release_tracks: [BETA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute instance-templates create $$template1$$ --machine-type n1-standard-1
      --format 'text(name,properties.machineType)'
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
      $
  - stdout: |
      ---
      name:                   $$template1$$
      properties.machineType: n1-standard-1
- execute:
  - command: compute instance-templates create $$template2$$ --machine-type f1-micro
      --format 'text(name,properties.machineType)'
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
      $
  - stdout: |
      ---
      name:                   $$template2$$
      properties.machineType: f1-micro
- execute:
  - command: compute instance-groups managed create $$manager$$ --zone us-central1-f
      --base-instance-name $$manager$$ --size 5 --template $$template1$$ --format
      'text(name,region,targetSize)'
  - stderr: |-
      Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
      $
  - stdout: |
      ---
      name:       $$manager$$
      targetSize: 5
- execute:
  - command: compute instance-groups managed wait-until --stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
- execute:
  - command: compute instance-groups managed rolling-action start-update $$manager$$
      --type proactive --canary-version template=$$template2$$,target-size=3 --version
      template=$$template1$$ --zone us-central1-f --format=disable
  - stderr: |-
      Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
      $
- execute:
  - command: compute instance-groups managed rolling-action stop-proactive-update
      $$manager$$ --zone us-central1-f --format=disable
  - stderr: |-
      Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
      $
- execute:
  - command: compute instance-groups managed delete $$manager$$ --zone us-central1-f
  - prompt:
    - message: |
        The following instance group managers will be deleted:
         - [$$manager$$] in [us-central1-f]
    - input: y
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
      $
  - progress_tracker:
    - message: Deleting Managed Instance Group
    - status: SUCCESS
- execute:
  - command: compute instance-templates delete $$template1$$
  - prompt:
    - message: |
        The following instance templates will be deleted:
         - [$$template1$$]
    - input: y
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
      $
- execute:
  - command: compute instance-templates delete $$template2$$
  - prompt:
    - message: |
        The following instance templates will be deleted:
         - [$$template2$$]
    - input: y
  - stderr: |-
      Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
      $
actions:
- define_reference:
    reference: compute-uri
    value: compute.googleapis.com/compute
- generate_resource_id:
    reference: template1
    prefix: mig-stop-zonal
- execute_command:
    command: compute instance-templates create $$template1$$ --machine-type n1-standard-1
      --format 'text(name,properties.machineType)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '995'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#image
            id: '1464844176702362429'
            creationTimestamp: '2019-06-18T16:03:47.268-07:00'
            name: debian-9-stretch-v20190618
            description: Debian, Debian GNU/Linux, 9 (stretch), amd64 built on 20190618
            sourceType: RAW
            rawDisk:
              source: ''
              containerType: TAR
            status: READY
            archiveSizeBytes: '10705167360'
            diskSizeGb: '10'
            licenses:
            - https://$$compute-uri$$/beta/projects/debian-cloud/global/licenses/debian-9-stretch
            family: debian-9
            selfLink: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/debian-9-stretch-v20190618
            labelFingerprint: 42WmSpB8rSM=
            guestOsFeatures:
            - type: VIRTIO_SCSI_MULTIQUEUE
            licenseCodes:
            - '1000205'
            storageLocations:
            - asia
            - asia
            - eu
            - eu
            - us
            - asia
            - us
            - us
            - eu
            - us
            - eu
            - asia
            - us
            - us
            - asia
            - asia
            - eu
            - eu
            - us
            - asia
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$template1$$
              properties:
                canIpForward: false
                disks:
                - autoDelete: true
                  boot: true
                  initializeParams:
                    sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10
                  mode: READ_WRITE
                  type: PERSISTENT
                machineType: n1-standard-1
                metadata: {}
                networkInterfaces:
                - accessConfigs:
                  - name: external-nat
                    type: ONE_TO_ONE_NAT
                  network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                scheduling:
                  automaticRestart: true
                serviceAccounts:
                - email: default
                  scopes:
                  - https://www.googleapis.com/auth/devstorage.read_only
                  - https://www.googleapis.com/auth/logging.write
                  - https://www.googleapis.com/auth/monitoring.write
                  - https://www.googleapis.com/auth/pubsub
                  - https://www.googleapis.com/auth/service.management.readonly
                  - https://www.googleapis.com/auth/servicecontrol
                  - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '768'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5962715820939775192'
            name: operation-1561997878475-58ca0f8afbc52-cbf80d2e-f827e31b
            operationType: compute.instanceTemplates.insert
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            targetId: '836637447964560600'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:17:59.272-07:00'
            startTime: '2019-07-01T09:17:59.285-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1561997878475-58ca0f8afbc52-cbf80d2e-f827e31b
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1835'
            Content-Type: application/json; charset=UTF-8
            ETag: '"CGdbN1Ci4zMgAPht-fU-DTALj44=/rWSeQ-_Vc4MTia8PBY-Rh-QZPkY="'
            status: '200'
          body:
            kind: compute#instanceTemplate
            id: '836637447964560600'
            creationTimestamp: '2019-07-01T09:17:59.205-07:00'
            name: $$template1$$
            description: ''
            properties:
              machineType: n1-standard-1
              canIpForward: false
              networkInterfaces:
              - kind: compute#networkInterface
                network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                accessConfigs:
                - kind: compute#accessConfig
                  type: ONE_TO_ONE_NAT
                  name: external-nat
                  networkTier: PREMIUM
              disks:
              - kind: compute#attachedDisk
                type: PERSISTENT
                mode: READ_WRITE
                deviceName: persistent-disk-0
                index: 0
                boot: true
                initializeParams:
                  sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-9
                autoDelete: true
              metadata:
                kind: compute#metadata
                fingerprint: 4_QxQ57NQak=
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
              scheduling:
                onHostMaintenance: MIGRATE
                automaticRestart: true
                preemptible: false
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
    - expect_stdout: |
        ---
        name:                   $$template1$$
        properties.machineType: n1-standard-1
    - expect_exit:
        code: 0


- generate_resource_id:
    reference: template2
    prefix: mig-stop-zonal
- execute_command:
    command: compute instance-templates create $$template2$$ --machine-type f1-micro
      --format 'text(name,properties.machineType)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '995'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#image
            id: '1464844176702362429'
            creationTimestamp: '2019-06-18T16:03:47.268-07:00'
            name: debian-9-stretch-v20190618
            description: Debian, Debian GNU/Linux, 9 (stretch), amd64 built on 20190618
            sourceType: RAW
            rawDisk:
              source: ''
              containerType: TAR
            status: READY
            archiveSizeBytes: '10705167360'
            diskSizeGb: '10'
            licenses:
            - https://$$compute-uri$$/beta/projects/debian-cloud/global/licenses/debian-9-stretch
            family: debian-9
            selfLink: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/debian-9-stretch-v20190618
            labelFingerprint: 42WmSpB8rSM=
            guestOsFeatures:
            - type: VIRTIO_SCSI_MULTIQUEUE
            licenseCodes:
            - '1000205'
            storageLocations:
            - asia
            - asia
            - eu
            - eu
            - us
            - asia
            - us
            - us
            - eu
            - us
            - eu
            - asia
            - us
            - us
            - asia
            - asia
            - eu
            - eu
            - us
            - asia
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$template2$$
              properties:
                canIpForward: false
                disks:
                - autoDelete: true
                  boot: true
                  initializeParams:
                    sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-10
                  mode: READ_WRITE
                  type: PERSISTENT
                machineType: f1-micro
                metadata: {}
                networkInterfaces:
                - accessConfigs:
                  - name: external-nat
                    type: ONE_TO_ONE_NAT
                  network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                scheduling:
                  automaticRestart: true
                serviceAccounts:
                - email: default
                  scopes:
                  - https://www.googleapis.com/auth/devstorage.read_only
                  - https://www.googleapis.com/auth/logging.write
                  - https://www.googleapis.com/auth/monitoring.write
                  - https://www.googleapis.com/auth/pubsub
                  - https://www.googleapis.com/auth/service.management.readonly
                  - https://www.googleapis.com/auth/servicecontrol
                  - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '769'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '1085266902797225135'
            name: operation-1561997887772-58ca0f93d95ea-01c38a12-fddfcfa6
            operationType: compute.instanceTemplates.insert
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            targetId: '7139669020482440367'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:18:08.677-07:00'
            startTime: '2019-07-01T09:18:08.692-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1561997887772-58ca0f93d95ea-01c38a12-fddfcfa6
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1831'
            Content-Type: application/json; charset=UTF-8
            ETag: '"kQxMSvyUrUlNBjQ6IBOqfr77U3w=/pk-rgLfov_977yqevC7fPXL8L2Q="'
            status: '200'
          body:
            kind: compute#instanceTemplate
            id: '7139669020482440367'
            creationTimestamp: '2019-07-01T09:18:08.535-07:00'
            name: $$template2$$
            description: ''
            properties:
              machineType: f1-micro
              canIpForward: false
              networkInterfaces:
              - kind: compute#networkInterface
                network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
                accessConfigs:
                - kind: compute#accessConfig
                  type: ONE_TO_ONE_NAT
                  name: external-nat
                  networkTier: PREMIUM
              disks:
              - kind: compute#attachedDisk
                type: PERSISTENT
                mode: READ_WRITE
                deviceName: persistent-disk-0
                index: 0
                boot: true
                initializeParams:
                  sourceImage: https://$$compute-uri$$/beta/projects/debian-cloud/global/images/family/debian-9
                autoDelete: true
              metadata:
                kind: compute#metadata
                fingerprint: 4_QxQ57NQak=
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
              scheduling:
                onHostMaintenance: MIGRATE
                automaticRestart: true
                preemptible: false
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
    - expect_stdout: |
        ---
        name:                   $$template2$$
        properties.machineType: f1-micro
    - expect_exit:
        code: 0


- generate_resource_id:
    reference: manager
    prefix: mig-stop-zonal
- execute_command:
    command: compute instance-groups managed create $$manager$$ --zone us-central1-f
      --base-instance-name $$manager$$ --size 5 --template $$template1$$ --format
      'text(name,region,targetSize)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '538'
            Content-Type: application/json; charset=UTF-8
            ETag: '"1IccM7gxuzkwApkHR5nbGYdSQ4E=/VK77B41xKop1j4FfyWqRRveJTWw="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: us-central1-f
            description: us-central1-f
            status: UP
            region: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            availableCpuPlatforms:
            - Intel Cascade Lake
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers?alt=json
          method: POST
          headers: {}
          body:
            json:
              baseInstanceName: $$manager$$
              instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              name: $$manager$$
              zone: us-central1-f
              targetSize: 5
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '914'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '6828593197887229094'
            name: operation-1561997896439-58ca0f9c1d684-68dce102-892426c4
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.insert
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '7056225871869742246'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:18:17.581-07:00'
            startTime: '2019-07-01T09:18:17.589-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1561997896439-58ca0f9c1d684-68dce102-892426c4
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1803'
            Content-Type: application/json; charset=UTF-8
            ETag: '"BUBheBWelOZI-6PHUC22AZIki6E=/NQ_2YiitEQ26MZKTaPFqQILJt9g="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7056225871869742246'
            creationTimestamp: '2019-07-01T09:18:17.486-07:00'
            name: $$manager$$
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 5
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: jwFBC4GLJo8=
            currentActions:
              none: 0
              creating: 5
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 0
              deleting: 0
              recreating: 0
              restarting: 0
            status:
              isStable: false
              versionTarget:
                isReached: true
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 1
                calculated: 1
              maxUnavailable:
                fixed: 1
                calculated: 1
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '10135'
            Content-Type: application/json; charset=UTF-8
            ETag: '"hjGz53A5NdHe5RlJ4znqFJYuGEU=/3sDRtloEUrG9kcEx9Eku3lD2sR4="'
            status: '200'
          body:
            kind: compute#instanceGroupList
            id: projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups
            items:
            - kind: compute#instanceGroup
              id: '6048301823225729520'
              creationTimestamp: '2019-07-01T09:04:47.778-07:00'
              name: compute-internal-lb-test-instance-group-20190701-160445-xkjg
              description: ''
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/compute-internal-lb-test-instance-group-20190701-160445-xkjg
              size: 1
            - kind: compute#instanceGroup
              id: '6286935493296230155'
              creationTimestamp: '2019-07-01T09:16:36.400-07:00'
              name: gcloud-compute-test-20190701-161626-99nb
              description: "This instance group is controlled by Instance Group Manager\
                \ 'gcloud-compute-test-20190701-161626-99nb'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/gcloud-compute-test-20190701-161626-99nb
              size: 0
            - kind: compute#instanceGroup
              id: '874545950305520813'
              creationTimestamp: '2019-07-01T09:18:10.695-07:00'
              name: managed-instance-group-autoscaling-20190701-161808-owqv
              description: "This instance group is controlled by Instance Group Manager\
                \ 'managed-instance-group-autoscaling-20190701-161808-owqv'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/managed-instance-group-autoscaling-20190701-161808-owqv
              size: 0
            - kind: compute#instanceGroup
              id: '7447426620064239370'
              creationTimestamp: '2019-07-01T09:16:37.929-07:00'
              name: mig-instance-configs-zonal-20190701-161635-a6rv
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-instance-configs-zonal-20190701-161635-a6rv'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-instance-configs-zonal-20190701-161635-a6rv
              size: 0
            - kind: compute#instanceGroup
              id: '1591893630056369325'
              creationTimestamp: '2019-07-01T09:18:10.718-07:00'
              name: mig-instance-configs-zonal-20190701-161809-h91z
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-instance-configs-zonal-20190701-161809-h91z'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-instance-configs-zonal-20190701-161809-h91z
              size: 0
            - kind: compute#instanceGroup
              id: '2080095531731225766'
              creationTimestamp: '2019-07-01T09:18:17.521-07:00'
              name: $$manager$$
              description: "This instance group is controlled by Instance Group Manager\
                \ '$$manager$$'. To modify instances in this group, use the Instance\
                \ Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
              size: 0
            - kind: compute#instanceGroup
              id: '2478418233350655855'
              creationTimestamp: '2019-07-01T09:14:56.966-07:00'
              name: mig-update-instances-zonal-20190701-161455-p5qr
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-update-instances-zonal-20190701-161455-p5qr'. To modify instances\
                \ in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-update-instances-zonal-20190701-161455-p5qr
              size: 0
            - kind: compute#instanceGroup
              id: '1580025746359291050'
              creationTimestamp: '2019-07-01T09:18:13.245-07:00'
              name: mig-update-stateful-igm-zonal-20190701-161811-2al4
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-update-stateful-igm-zonal-20190701-161811-2al4'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-update-stateful-igm-zonal-20190701-161811-2al4
              size: 0
            - kind: compute#instanceGroup
              id: '7249958635272899774'
              creationTimestamp: '2019-07-01T09:18:26.001-07:00'
              name: mig-update-stateful-igm-zonal-20190701-161820-pr5v
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-update-stateful-igm-zonal-20190701-161820-pr5v'. To modify\
                \ instances in this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-update-stateful-igm-zonal-20190701-161820-pr5v
              size: 0
            - kind: compute#instanceGroup
              id: '2197546854163910439'
              creationTimestamp: '2019-07-01T09:16:08.745-07:00'
              name: mig-updater-zonal-20190701-161606-rp2n
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-updater-zonal-20190701-161606-rp2n'. To modify instances in\
                \ this group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              network: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/networks/default
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-updater-zonal-20190701-161606-rp2n
              size: 0
            - kind: compute#instanceGroup
              id: '1967914198595243186'
              creationTimestamp: '2019-07-01T09:18:37.874-07:00'
              name: mig-wait-until-20190701-161835-jiku
              description: "This instance group is controlled by Instance Group Manager\
                \ 'mig-wait-until-20190701-161835-jiku'. To modify instances in this\
                \ group, use the Instance Group Manager API: https://cloud.google.com/compute/docs/reference/latest/instanceGroupManagers"
              fingerprint: 42WmSpB8rSM=
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/mig-wait-until-20190701-161835-jiku
              size: 0
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1715'
            Content-Type: application/json; charset=UTF-8
            ETag: '"6RY8lGPAWMya17y5BZ0EUOW4fhA=/Z0lOXEcrAZk-V6kK17OElgfhrAo="'
            status: '200'
          body:
            kind: compute#autoscalerList
            id: projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
            items:
            - kind: compute#autoscaler
              id: '987146420709985464'
              creationTimestamp: '2019-07-01T09:18:31.860-07:00'
              name: managed-instance-group-autoscaling-20190701-161808-owqv-b8ay
              description: whatever
              target: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/managed-instance-group-autoscaling-20190701-161808-owqv
              autoscalingPolicy:
                minNumReplicas: 5
                maxNumReplicas: 10
                coolDownPeriodSec: 60
                cpuUtilization:
                  utilizationTarget: 0.5
                customMetricUtilizations:
                - metric: foo.googleapis.com/metric1
                  utilizationTarget: 1.0
                  utilizationTargetType: GAUGE
                - metric: foo.googleapis.com/metric2
                  utilizationTarget: 2.0
                  utilizationTargetType: DELTA_PER_SECOND
                - metric: foo.googleapis.com/metric3
                  utilizationTarget: 3.0
                  utilizationTargetType: DELTA_PER_MINUTE
                loadBalancingUtilization:
                  utilizationTarget: 0.8
              zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
              selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers/managed-instance-group-autoscaling-20190701-161808-owqv-b8ay
              status: ACTIVE
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
    - expect_stdout: |
        ---
        name:       $$manager$$
        targetSize: 5
    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-groups managed wait-until --stable $$manager$$ --timeout
      600 --zone us-central1-f --no-user-output-enabled
    validation_only: true
    events:
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed rolling-action start-update $$manager$$
      --type proactive --canary-version template=$$template2$$,target-size=3 --version
      template=$$template1$$ --zone us-central1-f --format=disable
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1802'
            Content-Type: application/json; charset=UTF-8
            ETag: '"qkHY37UydaZfx9a02yQ45iIMDTE=/x_ld4_EDIVUXYZNMW9ZFS5TDMbM="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7056225871869742246'
            creationTimestamp: '2019-07-01T09:18:17.486-07:00'
            name: $$manager$$
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 5
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: jwFBC4GLJo8=
            currentActions:
              none: 5
              creating: 0
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 0
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 0
              deleting: 0
              recreating: 0
              restarting: 0
            status:
              isStable: true
              versionTarget:
                isReached: true
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 1
                calculated: 1
              maxUnavailable:
                fixed: 1
                calculated: 1
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$/listPerInstanceConfigs?alt=json&maxResults=500
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body: null
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              updatePolicy:
                minimalAction: REPLACE
                type: PROACTIVE
              versions:
              - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              - targetSize: {}
                instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '883'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '2566202627531967585'
            name: operation-1561997965677-58ca0fde25265-84bc274e-269ec49e
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: patch
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '7056225871869742246'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:19:26.984-07:00'
            startTime: '2019-07-01T09:19:27.001-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1561997965677-58ca0fde25265-84bc274e-269ec49e
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          body:
            json:
              targetSize: 5
              updatePolicy.maxSurge.calculated: 1
              updatePolicy.maxUnavailable.calculated: 1
              updatePolicy.type: PROACTIVE
              updatePolicy.minimalAction: REPLACE
              versions[0].targetSize.calculated: 2
              versions[1].targetSize.calculated: 3
              versions[1].targetSize.fixed: 3
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1871'
            Content-Type: application/json; charset=UTF-8
            ETag: '"cB5AR2ViUu7VLhkiFJG15_1akHY=/q9RrD1EM1MOZKG3tO7fM8Prt3xk="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7056225871869742246'
            creationTimestamp: '2019-07-01T09:18:17.486-07:00'
            name: $$manager$$
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 2
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
              targetSize:
                fixed: 3
                calculated: 3
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: C2KTuGYoc4w=
            currentActions:
              none: 4
              creating: 1
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 1
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 2
              deleting: 2
              recreating: 0
              restarting: 0
            status:
              isStable: false
              versionTarget:
                isReached: false
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: PROACTIVE
              minimalAction: REPLACE
              maxSurge:
                fixed: 1
                calculated: 1
              maxUnavailable:
                fixed: 1
                calculated: 1
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com
    - expect_exit:
        code: 0
- execute_command:
    command: compute instance-groups managed rolling-action stop-proactive-update
      $$manager$$ --zone us-central1-f --format=disable
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              updatePolicy:
                type: OPPORTUNISTIC
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '883'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '4733183764903464009'
            name: operation-1561997989461-58ca0ff4d3fd6-27bdd81e-1e4e27b6
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: patch
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '7056225871869742246'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:19:50.257-07:00'
            startTime: '2019-07-01T09:19:50.271-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1561997989461-58ca0ff4d3fd6-27bdd81e-1e4e27b6
        poll_operation: true
    - expect_stderr:
        matches: |
          Updated \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: GET
          headers: {}
          body: null
        expect_response:
          body:
            json:
              targetSize: 5
              updatePolicy.type: OPPORTUNISTIC
              versions[0].targetSize.calculated: 2
              versions[1].targetSize.calculated: 3
              versions[1].targetSize.fixed: 3
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '1875'
            Content-Type: application/json; charset=UTF-8
            ETag: '"CluSFF4zDYKHolnQgjrbTXLETJ8=/8q6Ufc5sJIUSXkIkDJR41zKtAY0="'
            status: '200'
          body:
            kind: compute#instanceGroupManager
            id: '7056225871869742246'
            creationTimestamp: '2019-07-01T09:18:17.486-07:00'
            name: $$manager$$
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            versions:
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
              targetSize:
                calculated: 2
            - instanceTemplate: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
              targetSize:
                fixed: 3
                calculated: 3
            instanceGroup: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroups/$$manager$$
            baseInstanceName: $$manager$$
            fingerprint: Uc1sBMN4XGU=
            currentActions:
              none: 4
              creating: 1
              creatingWithoutRetries: 0
              verifying: 0
              recreating: 0
              deleting: 1
              abandoning: 0
              restarting: 0
              refreshing: 0
            pendingActions:
              creating: 0
              deleting: 0
              recreating: 0
              restarting: 0
            status:
              isStable: false
              versionTarget:
                isReached: false
            targetSize: 5
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            updatePolicy:
              type: OPPORTUNISTIC
              minimalAction: REPLACE
              maxSurge:
                fixed: 1
                calculated: 1
              maxUnavailable:
                fixed: 1
                calculated: 1
              minReadySec: 0
            serviceAccount: 462803083913@cloudservices.gserviceaccount.com
    - expect_exit:
        code: 0

- execute_command:
    command: compute instance-groups managed delete $$manager$$ --zone us-central1-f
    cleanup_for: manager
    events:
    - expect_prompt_continue:
        message: |
          The following instance group managers will be deleted:
           - [$$manager$$] in [us-central1-f]
        user_input: y
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers?alt=json&maxResults=500
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '246'
            Content-Type: application/json; charset=UTF-8
            ETag: '"T9sqTj-y8xeEVPmtGRm10cJcgbQ=/rjUmKfO0sQ923hKYFrc-nICtWB8="'
            status: '200'
          body:
            kind: compute#autoscalerList
            id: projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/autoscalers
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '914'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '1701606340544662593'
            name: operation-1561997997920-58ca0ffce515d-c8ba1c70-83164860
            zone: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: compute.instanceGroupManagers.delete
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$
            targetId: '7056225871869742246'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:19:58.325-07:00'
            startTime: '2019-07-01T09:19:58.332-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1561997997920-58ca0ffce515d-c8ba1c70-83164860
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/zones/us-central1-f/instanceGroupManagers/$$manager$$\].
    - expect_progress_tracker:
        message: Deleting Managed Instance Group
        status: SUCCESS
    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-templates delete $$template1$$
    cleanup_for: template1
    events:
    - expect_prompt_continue:
        message: |
          The following instance templates will be deleted:
           - [$$template1$$]
        user_input: y
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '742'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '9100184813577932178'
            name: operation-1561998205558-58ca10c2e9df6-fa6a3614-d1ff2486
            operationType: delete
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$
            targetId: '836637447964560600'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:23:25.997-07:00'
            startTime: '2019-07-01T09:23:26.004-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1561998205558-58ca10c2e9df6-fa6a3614-d1ff2486
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template1$$\].
    - expect_exit:
        code: 0


- execute_command:
    command: compute instance-templates delete $$template2$$
    cleanup_for: template2
    events:
    - expect_prompt_continue:
        message: |
          The following instance templates will be deleted:
           - [$$template2$$]
        user_input: y
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '743'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5071937069718670701'
            name: operation-1561998210184-58ca10c753478-74944b1e-6affeffd
            operationType: delete
            targetLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$
            targetId: '7139669020482440367'
            status: RUNNING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2019-07-01T09:23:30.586-07:00'
            startTime: '2019-07-01T09:23:30.593-07:00'
            selfLink: https://$$compute-uri$$/beta/projects/cloud-sdk-integration-testing/global/operations/operation-1561998210184-58ca10c753478-74944b1e-6affeffd
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/beta/projects/cloud-sdk-integration-testing/global/instanceTemplates/$$template2$$\].
    - expect_exit:
        code: 0
