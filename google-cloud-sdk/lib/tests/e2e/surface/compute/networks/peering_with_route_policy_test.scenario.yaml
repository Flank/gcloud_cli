title: test peering with route policy
release_tracks:
- ALPHA
# TODO(b/117964785): add e2e test for "compute networks peerings list-routes" after b/112610241 is
# fixed.

summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: |
      compute networks create $$compute-peering-net1$$ --subnet-mode custom --verbosity none
      --format="value(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
  - stdout: |
      $$compute-peering-net1$$
- execute:
  - command: |
      compute networks subnets create $$compute-peering-sub1$$ --network $$compute-peering-net1$$
      --region us-central1 --range 10.1.0.0/16 --format="text(name, network)"
  - stderr: |
      Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$].
  - stdout: |
      ---
      name:    $$compute-peering-sub1$$
      network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
- execute:
  - command: |
      compute networks create $$compute-peering-net2$$ --subnet-mode custom --verbosity none
      --format="value(name)"
  - stderr: |
      Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
  - stdout: |
      $$compute-peering-net2$$
- execute:
  - command: |
      compute networks subnets create $$compute-peering-sub2$$ --network $$compute-peering-net2$$
      --region us-central1 --range 10.2.0.0/16 --format="text(name, network)"
  - stderr: |
      Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$].
  - stdout: |
      ---
      name:    $$compute-peering-sub2$$
      network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
- execute:
  - command: |
      compute networks peerings create $$compute-peering-peer1$$ --network
      $$compute-peering-net1$$ --peer-network $$compute-peering-net2$$ --auto-create-routes
      --no-export-custom-routes --import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
  - stderr: |
      WARNING: Flag --auto-create-routes is deprecated and will be removed in a future release.
  - stderr: |
      Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
  - stdout: |
      ---
      name:                         $$compute-peering-net1$$
      peerings[0].autoCreateRoutes: True
      peerings[0].name:             $$compute-peering-peer1$$
      peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
      peerings[0].state:            INACTIVE
- execute:
  - command: |
      compute networks peerings create $$compute-peering-peer2$$ --network
      $$compute-peering-net2$$ --peer-network $$compute-peering-net1$$ --auto-create-routes
      --export-custom-routes --no-import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
  - stderr: |
      WARNING: Flag --auto-create-routes is deprecated and will be removed in a future release.
  - stderr: |
      Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
  - stdout: |
      ---
      name:                         $$compute-peering-net2$$
      peerings[0].autoCreateRoutes: True
      peerings[0].name:             $$compute-peering-peer2$$
      peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
      peerings[0].state:            ACTIVE
- execute:
  - command: |
      compute networks peerings update $$compute-peering-peer1$$ --network
      $$compute-peering-net1$$ --export-custom-routes --no-import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
  - stderr: |
      Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
  - stdout: |
      ---
      name:                         $$compute-peering-net1$$
      peerings[0].autoCreateRoutes: True
      peerings[0].name:             $$compute-peering-peer1$$
      peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
      peerings[0].state:            ACTIVE
- execute:
  - command: |
      compute networks peerings update $$compute-peering-peer2$$ --network
      $$compute-peering-net2$$ --no-export-custom-routes --import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
  - stderr: |
      Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
  - stdout: |
      ---
      name:                         $$compute-peering-net2$$
      peerings[0].autoCreateRoutes: True
      peerings[0].name:             $$compute-peering-peer2$$
      peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
      peerings[0].state:            ACTIVE
- execute:
  - command: |
      compute networks subnets delete $$compute-peering-sub1$$ --region us-central1 --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$].
- execute:
  - command: |
      compute networks peerings delete $$compute-peering-peer1$$ --quiet
      --network $$compute-peering-net1$$
  - stderr: |
      Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
- execute:
  - command: |
      compute networks peerings delete $$compute-peering-peer2$$ --quiet
      --network $$compute-peering-net2$$
  - stderr: |
      Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
- execute:
  - command: |
      compute networks subnets delete $$compute-peering-sub2$$ --region us-central1 --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$].
- execute:
  - command: |
      compute networks delete $$compute-peering-net1$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
- execute:
  - command: |
      compute networks delete $$compute-peering-net2$$ --quiet
  - stderr: |
      Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
actions:
- generate_resource_id:
    reference: compute-peering-net1
    prefix: compute-peering-net
- generate_resource_id:
    reference: compute-peering-net2
    prefix: compute-peering-net
- generate_resource_id:
    reference: compute-peering-sub1
    prefix: compute-peering-sub
- generate_resource_id:
    reference: compute-peering-sub2
    prefix: compute-peering-sub
- generate_resource_id:
    reference: compute-peering-peer1
    prefix: compute-peering-peer
- generate_resource_id:
    reference: compute-peering-peer2
    prefix: compute-peering-peer
- execute_command:
    command: |
      compute networks create $$compute-peering-net1$$ --subnet-mode custom --verbosity none
      --format="value(name)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks?alt=json
          method: POST
          headers: {}
          body:
            json:
              autoCreateSubnetworks: false
              name: $$compute-peering-net1$$
              routingConfig:
                routingMode: REGIONAL
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '2841813045425693757'
            name: operation-1543953105793-57c37986bb26a-12dd165a-6a9d4918
            operationType: insert
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            targetId: '3823906512211502141'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-04T11:51:46.606-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1543953105793-57c37986bb26a-12dd165a-6a9d4918
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: bVP8n79DgfzE8yxFi0Xivjk3jNQ=/HBBnYdkwFUEFGBf1E8DKqwBM-UA=
            status: '200'
          body:
            id: '3823906512211502141'
            creationTimestamp: '2018-12-04T11:51:46.594-08:00'
            name: $$compute-peering-net1$$
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            autoCreateSubnetworks: false
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_stdout: |
        $$compute-peering-net1$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks subnets create $$compute-peering-sub1$$ --network $$compute-peering-net1$$
      --region us-central1 --range 10.1.0.0/16 --format="text(name, network)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks?alt=json
          method: POST
          headers: {}
          body:
            json:
              ipCidrRange: 10.1.0.0/16
              name: $$compute-peering-sub1$$
              network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
              privateIpGoogleAccess: false
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '8513048829848413211'
            name: operation-1543953139748-57c379a71ce35-e17f976b-f9fb4f0d
            operationType: insert
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$
            targetId: '7305820208267748379'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-04T11:52:20.958-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1543953139748-57c379a71ce35-e17f976b-f9fb4f0d
            region: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: UWPIPa4IW6FdQUDVIpwmN0vmqN0=/YrQTlKenf-mCglnYEjxhb1-q_AU=
            status: '200'
          body:
            id: '7305820208267748379'
            creationTimestamp: '2018-12-04T11:52:20.912-08:00'
            name: $$compute-peering-sub1$$
            network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            ipCidrRange: 10.1.0.0/16
            gatewayAddress: 10.1.0.1
            region: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$
            privateIpGoogleAccess: false
            fingerprint: vRn1rIwEscw=
            allowSubnetCidrRoutesOverlap: false
            kind: compute#subnetwork
    - expect_stdout: |
        ---
        name:    $$compute-peering-sub1$$
        network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks create $$compute-peering-net2$$ --subnet-mode custom --verbosity none
      --format="value(name)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks?alt=json
          method: POST
          headers: {}
          body:
            json:
              autoCreateSubnetworks: false
              name: $$compute-peering-net2$$
              routingConfig:
                routingMode: REGIONAL
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '3789387580880676324'
            name: operation-1543953163343-57c379bd9d87b-3d6a5fed-00f4214c
            operationType: insert
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            targetId: '2154971075269322212'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-04T11:52:44.115-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1543953163343-57c379bd9d87b-3d6a5fed-00f4214c
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: gcZY6t2OOnAIYOGX3AAUoqGzq_0=/G-gEbVZlHbhJxXexWzKx3wPkM6k=
            status: '200'
          body:
            id: '2154971075269322212'
            creationTimestamp: '2018-12-04T11:52:43.964-08:00'
            name: $$compute-peering-net2$$
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            autoCreateSubnetworks: false
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_stdout: |
        $$compute-peering-net2$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks subnets create $$compute-peering-sub2$$ --network $$compute-peering-net2$$
      --region us-central1 --range 10.2.0.0/16 --format="text(name, network)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks?alt=json
          method: POST
          headers: {}
          body:
            json:
              ipCidrRange: 10.2.0.0/16
              name: $$compute-peering-sub2$$
              network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
              privateIpGoogleAccess: false
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '8614042825445303756'
            name: operation-1543953186547-57c379d3be703-a87279f6-554c308b
            operationType: insert
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$
            targetId: '6896994494838433228'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-04T11:53:07.450-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1543953186547-57c379d3be703-a87279f6-554c308b
            region: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Created [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: 0ljTpSYUxBGv6JREobin8REJVSU=/iicwZ-wLPI0BRvyKJmy-kmag7VI=
            status: '200'
          body:
            id: '6896994494838433228'
            creationTimestamp: '2018-12-04T11:53:07.442-08:00'
            name: $$compute-peering-sub2$$
            network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            ipCidrRange: 10.2.0.0/16
            gatewayAddress: 10.2.0.1
            region: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$
            privateIpGoogleAccess: false
            fingerprint: _G8WefdjA2E=
            allowSubnetCidrRoutesOverlap: false
            kind: compute#subnetwork
    - expect_stdout: |
        ---
        name:    $$compute-peering-sub2$$
        network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks peerings create $$compute-peering-peer1$$ --network
      $$compute-peering-net1$$ --peer-network $$compute-peering-net2$$ --auto-create-routes
      --no-export-custom-routes --import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
    events:
    - expect_stderr: |
        WARNING: Flag --auto-create-routes is deprecated and will be removed in a future release.
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$/addPeering?alt=json
          method: POST
          headers: {}
          body:
            json:
              networkPeering:
                exchangeSubnetRoutes: true
                exportCustomRoutes: false
                importCustomRoutes: true
                name: $$compute-peering-peer1$$
                network: projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '2575166851326371285'
            name: operation-1543953210034-57c379ea247a9-0e8fb200-48874cf7
            operationType: addPeering
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            targetId: '3823906512211502141'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-12-04T11:53:30.613-08:00'
            startTime: '2018-12-04T11:53:30.615-08:00'
            endTime: '2018-12-04T11:53:30.615-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1543953210034-57c379ea247a9-0e8fb200-48874cf7
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: vO-JEm4AcWfXFdb9QH1-RSAsX6w=/b9fnZhIR2mPniJQeBPh8gpOpOyc=
            status: '200'
          body:
            id: '3823906512211502141'
            creationTimestamp: '2018-12-04T11:51:46.594-08:00'
            name: $$compute-peering-net1$$
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            autoCreateSubnetworks: false
            subnetworks:
            - https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$
            peerings:
            - name: $$compute-peering-peer1$$
              network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
              state: INACTIVE
              stateDetails: '[2018-12-04T11:53:30.873-08:00]: Waiting for peer network
                to connect.'
              autoCreateRoutes: true
              exportCustomRoutes: false
              importCustomRoutes: true
              exchangeSubnetRoutes: true
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_stdout: |
        ---
        name:                         $$compute-peering-net1$$
        peerings[0].autoCreateRoutes: True
        peerings[0].name:             $$compute-peering-peer1$$
        peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
        peerings[0].state:            INACTIVE
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks peerings create $$compute-peering-peer2$$ --network
      $$compute-peering-net2$$ --peer-network $$compute-peering-net1$$ --auto-create-routes
      --export-custom-routes --no-import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
    events:
    - expect_stderr: |
        WARNING: Flag --auto-create-routes is deprecated and will be removed in a future release.
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$/addPeering?alt=json
          method: POST
          headers: {}
          body:
            json:
              networkPeering:
                exchangeSubnetRoutes: true
                exportCustomRoutes: true
                importCustomRoutes: false
                name: $$compute-peering-peer2$$
                network: projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '7513150099395667412'
            name: operation-1543953211418-57c379eb76628-d434c4e3-33e68de9
            operationType: addPeering
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            targetId: '2154971075269322212'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-04T11:53:31.888-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1543953211418-57c379eb76628-d434c4e3-33e68de9
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: MF-ConaDTOrVBGiIa-FHbjkMt0c=/8OxW7eOrWDavc-Q1wTjntudjWzg=
            status: '200'
          body:
            id: '2154971075269322212'
            creationTimestamp: '2018-12-04T11:52:43.964-08:00'
            name: $$compute-peering-net2$$
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            autoCreateSubnetworks: false
            subnetworks:
            - https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$
            peerings:
            - name: $$compute-peering-peer2$$
              network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
              state: ACTIVE
              stateDetails: '[2018-12-04T11:53:33.709-08:00]: Connected.'
              autoCreateRoutes: true
              exportCustomRoutes: true
              importCustomRoutes: false
              exchangeSubnetRoutes: true
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_stdout: |
        ---
        name:                         $$compute-peering-net2$$
        peerings[0].autoCreateRoutes: True
        peerings[0].name:             $$compute-peering-peer2$$
        peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
        peerings[0].state:            ACTIVE
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks peerings update $$compute-peering-peer1$$ --network
      $$compute-peering-net1$$ --export-custom-routes --no-import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$/updatePeering?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              networkPeering:
                exportCustomRoutes: true
                importCustomRoutes: false
                name: $$compute-peering-peer1$$
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '5170742311309239735'
            name: operation-1543953239764-57c37a067ee93-97135c80-9597df75
            operationType: updatePeering
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            targetId: '3823906512211502141'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-04T11:54:00.380-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1543953239764-57c37a067ee93-97135c80-9597df75
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: KpBvobVBTNL4C3CFlAzw0Fms4is=/UQP4z_WRMLb_w5RpdrnCGiM4j1I=
            status: '200'
          body:
            id: '3823906512211502141'
            creationTimestamp: '2018-12-04T11:51:46.594-08:00'
            name: $$compute-peering-net1$$
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            autoCreateSubnetworks: false
            subnetworks:
            - https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$
            peerings:
            - name: $$compute-peering-peer1$$
              network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
              state: ACTIVE
              stateDetails: '[2018-12-04T11:54:00.825-08:00]: Connected.'
              autoCreateRoutes: true
              exportCustomRoutes: true
              importCustomRoutes: false
              exchangeSubnetRoutes: true
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_stdout: |
        ---
        name:                         $$compute-peering-net1$$
        peerings[0].autoCreateRoutes: True
        peerings[0].name:             $$compute-peering-peer1$$
        peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
        peerings[0].state:            ACTIVE
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks peerings update $$compute-peering-peer2$$ --network
      $$compute-peering-net2$$ --no-export-custom-routes --import-custom-routes
      --format="text(name,peerings[].autoCreateRoutes,peerings[].name,peerings[].network,peerings[].state)"
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$/updatePeering?alt=json
          method: PATCH
          headers: {}
          body:
            json:
              networkPeering:
                exportCustomRoutes: false
                importCustomRoutes: true
                name: $$compute-peering-peer2$$
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '6003479321168799131'
            name: operation-1543953267905-57c37a2155505-d389bb67-7ebdec30
            operationType: updatePeering
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            targetId: '2154971075269322212'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-12-04T11:54:28.327-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1543953267905-57c37a2155505-d389bb67-7ebdec30
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: 3EOtdTv8yQn8W5uVTDd6LFIowXY=/1AxS9H-CepJ0xEJBBIFsGzrS85A=
            status: '200'
          body:
            id: '2154971075269322212'
            creationTimestamp: '2018-12-04T11:52:43.964-08:00'
            name: $$compute-peering-net2$$
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            autoCreateSubnetworks: false
            subnetworks:
            - https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$
            peerings:
            - name: $$compute-peering-peer2$$
              network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
              state: ACTIVE
              stateDetails: '[2018-12-04T11:54:29.739-08:00]: Connected.'
              autoCreateRoutes: true
              exportCustomRoutes: false
              importCustomRoutes: true
              exchangeSubnetRoutes: true
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_stdout: |
        ---
        name:                         $$compute-peering-net2$$
        peerings[0].autoCreateRoutes: True
        peerings[0].name:             $$compute-peering-peer2$$
        peerings[0].network:          https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
        peerings[0].state:            ACTIVE
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks subnets delete $$compute-peering-sub1$$ --region us-central1 --quiet
    cleanup_for: compute-peering-sub1
    validation_only: true
    events:
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub1$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks peerings delete $$compute-peering-peer1$$ --quiet
      --network $$compute-peering-net1$$
    validation_only: true
    cleanup_for: compute-peering-peer1
    events:
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks peerings delete $$compute-peering-peer2$$ --quiet
      --network $$compute-peering-net2$$
    cleanup_for: compute-peering-peer2
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$/removePeering?alt=json
          method: POST
          headers: {}
          body:
            json:
              name: $$compute-peering-peer2$$
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '2488504470106498338'
            name: operation-1543953357184-57c37a7679d19-3d158bc3-3e47f132
            operationType: removePeering
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            targetId: '2154971075269322212'
            status: DONE
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 100
            insertTime: '2018-12-04T11:55:57.755-08:00'
            startTime: '2018-12-04T11:55:57.758-08:00'
            endTime: '2018-12-04T11:55:57.758-08:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1543953357184-57c37a7679d19-3d158bc3-3e47f132
            kind: compute#operation
        poll_operation: true
    - expect_stderr: |
        Updated [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: anv5GSNCcCPwlakhAgkF2HQpS5g=/DmWUW2J1Kil4Qi7sumWfJrxfXAc=
            status: '200'
          body:
            id: '2154971075269322212'
            creationTimestamp: '2018-12-04T11:52:43.964-08:00'
            name: $$compute-peering-net2$$
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$
            autoCreateSubnetworks: false
            subnetworks:
            - https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks subnets delete $$compute-peering-sub2$$ --region us-central1 --quiet
    validation_only: true
    cleanup_for: compute-peering-sub2
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '828'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5300612742131872736'
            name: operation-1543523599040-57bd397d2be01-18331b93-b376cf70
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$
            targetId: '4214389786119369269'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-29T12:33:19.791-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1543523599040-57bd397d2be01-18331b93-b376cf70
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$compute-peering-sub2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks delete $$compute-peering-net1$$ --quiet
    validation_only: true
    cleanup_for: compute-peering-net1
    events:
    - api_call:
        expect_request:
          uri: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '688'
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            kind: compute#operation
            id: '5288148875887899588'
            name: operation-1543523626754-57bd399799fd7-fe1816ce-7a81a942
            operationType: delete
            targetLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$
            targetId: '7890421276511957630'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-11-29T12:33:47.218-08:00'
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/global/operations/operation-1543523626754-57bd399799fd7-fe1816ce-7a81a942
        poll_operation: true
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net1$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      compute networks delete $$compute-peering-net2$$ --quiet
    validation_only: true
    cleanup_for: compute-peering-net2
    events:
    - expect_stderr: |
        Deleted [https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$compute-peering-net2$$].
    - expect_exit:
        code: 0
