title: custom instance creation errors scenario test
release_tracks:
- GA
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute instances create $$instance$$ --custom-cpu 2 --custom-memory
      14 --zone us-central1-f
  - error: |
      1: Could not fetch machine type:
       - Invalid resource usage: 'Memory size for a 2 vCPU instance must be between 2048MiB and 13312MiB, while 14336MiB was provided.'.
- execute:
  - command: compute instances create $$instance$$ --custom-cpu 2 --custom-memory
      3000MiB --zone us-central1-f
  - error: |
      1: Could not fetch machine type:
       - Invalid resource usage: 'Memory should be a multiple of 256MiB in zone us-central1-f for custom machine type, while 3000MiB is requested.'.
- execute:
  - command: compute instances create $$instance$$ --custom-cpu 3 --custom-memory
      10 --zone us-central1-f
  - error: |
      1: Could not fetch machine type:
       - Invalid resource usage: 'Number of vCPUs should be an even number if greater than 1, while 3 is requested.'.
- execute:
  - command: compute instances delete $$instance$$ --zone us-central1-f
  - prompt:
    - message: |
        The following instances will be deleted. Any attached disks configured to be auto-deleted will be deleted unless they are attached to any other instances or the `--keep-disks` flag is given and specifies them for keeping. Deleting a disk is irreversible and any data on the disk will be lost.
         - [$$instance$$] in [us-central1-f]
    - input: y
  - error: |
      1: Could not fetch resource:
       - The resource 'projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$' was not found
actions:
- define_reference:
    reference: compute-uri
    value: www.googleapis.com/compute
- generate_resource_id:
    reference: instance
    prefix: gcloud-compute-instances-creation-errors
- execute_command:
    command: compute instances create $$instance$$ --custom-cpu 2 --custom-memory
      14 --zone us-central1-f
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"tICMSDQHfhyCrfjN7C6Kv5FDt0M=/31aTbbV4Q2wd-filMqzoBzP1q28="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: us-central1-f
            description: us-central1-f
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/custom-2-14336?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '413'
            Content-Type: application/json; charset=UTF-8
            status: '400'
          body:
            error:
              errors:
              - domain: global
                reason: invalidResourceUsage
                message: "Invalid resource usage: 'Memory size for a 2 vCPU instance\
                  \ must be between 2048MiB and 13312MiB, while 14336MiB was provided.'."
              code: 400
              message: "Invalid resource usage: 'Memory size for a 2 vCPU instance\
                \ must be between 2048MiB and 13312MiB, while 14336MiB was provided.'."
    - expect_exit:
        code: 1
        message: |
          Could not fetch machine type:
           - Invalid resource usage: 'Memory size for a 2 vCPU instance must be between 2048MiB and 13312MiB, while 14336MiB was provided.'.
- execute_command:
    command: compute instances create $$instance$$ --custom-cpu 2 --custom-memory
      3000MiB --zone us-central1-f
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"rerzgInBt-uSMOwJtES6cSs4mpI=/lYWs-9iV69KVdV2Ik_3L2ynr7-Y="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: us-central1-f
            description: us-central1-f
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/custom-2-3000?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '437'
            Content-Type: application/json; charset=UTF-8
            status: '400'
          body:
            error:
              errors:
              - domain: global
                reason: invalidResourceUsage
                message: "Invalid resource usage: 'Memory should be a multiple of\
                  \ 256MiB in zone us-central1-f for custom machine type, while 3000MiB\
                  \ is requested.'."
              code: 400
              message: "Invalid resource usage: 'Memory should be a multiple of 256MiB\
                \ in zone us-central1-f for custom machine type, while 3000MiB is\
                \ requested.'."
    - expect_exit:
        code: 1
        message: |
          Could not fetch machine type:
           - Invalid resource usage: 'Memory should be a multiple of 256MiB in zone us-central1-f for custom machine type, while 3000MiB is requested.'.
- execute_command:
    command: compute instances create $$instance$$ --custom-cpu 3 --custom-memory
      10 --zone us-central1-f
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '510'
            Content-Type: application/json; charset=UTF-8
            ETag: '"ktAoFJXMd-EWId48-N7-qkBRV1g=/1Y7un36TxHBizngR4yprDQ1Tkzg="'
            status: '200'
          body:
            kind: compute#zone
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: us-central1-f
            description: us-central1-f
            status: UP
            region: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://www.googleapis.com/compute/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/custom-3-10240?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '375'
            Content-Type: application/json; charset=UTF-8
            status: '400'
          body:
            error:
              errors:
              - domain: global
                reason: invalidResourceUsage
                message: "Invalid resource usage: 'Number of vCPUs should be an even\
                  \ number if greater than 1, while 3 is requested.'."
              code: 400
              message: "Invalid resource usage: 'Number of vCPUs should be an even\
                \ number if greater than 1, while 3 is requested.'."
    - expect_exit:
        code: 1
        message: |
          Could not fetch machine type:
           - Invalid resource usage: 'Number of vCPUs should be an even number if greater than 1, while 3 is requested.'.
- execute_command:
    command: compute instances delete $$instance$$ --zone us-central1-f
    events:
    - expect_prompt_continue:
        message: |
          The following instances will be deleted. Any attached disks configured to be auto-deleted will be deleted unless they are attached to any other instances or the `--keep-disks` flag is given and specifies them for keeping. Deleting a disk is irreversible and any data on the disk will be lost.
           - [$$instance$$] in [us-central1-f]
        user_input: y
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/v1/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Cache-Control: private, max-age=0
            Content-Length: '423'
            Content-Type: application/json; charset=UTF-8
            status: '404'
          body:
            error:
              errors:
              - domain: global
                reason: notFound
                message: The resource 'projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$'
                  was not found
              code: 404
              message: The resource 'projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$'
                was not found
    - expect_exit:
        code: 1
        message: |
          Could not fetch resource:
           - The resource 'projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$' was not found
    cleanup_for: instance
