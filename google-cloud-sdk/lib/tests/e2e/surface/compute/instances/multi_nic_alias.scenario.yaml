title: Test creating instance with multiple network interfaces (multi nic)
release_tracks: [ALPHA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: compute networks create $$network1$$ --subnet-mode custom --format 'yaml(name,x_gcloud_subnet_mode)'
  - stderr: |
      Created [https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$\].
  - stdout:
      matches: ^(---\s)?name:\s$$network1$$\s+x_gcloud_subnet_mode:\sCUSTOM$
- execute:
  - command: compute networks subnets create $$subnet1$$ --region us-central1 --network
      $$network1$$ --range 10.0.3.0/24 --format 'text(name,network,ipCidrRange)'
  - stderr: |
      Created [https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$\].
  - stdout: |
      ---
      ipCidrRange: 10.0.3.0/24
      name:        $$subnet1$$
      network:     https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
- execute:
  - command: compute instances create $$instance$$ --zone us-central1-f --network-interface
      subnet=$$subnet1$$,aliases=/32  --format='yaml(networkInterfaces[].subnetwork,
      networkInterfaces[].aliasIpRanges)'
  - stderr: |
      Created [https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$\].
  - stdout: |-
      ---
      networkInterfaces:
      - aliasIpRanges:
        - ipCidrRange: 10.0.3.*/32
        subnetwork: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
      $
- execute:
  - command: compute instances network-interfaces update $$instance$$ --zone us-central1-f
      --aliases ''
  - progress_tracker:
    - message: Updating network interface [nic0] of instance [$$instance$$]
    - status: SUCCESS
- execute:
  - command: compute instances describe $$instance$$ --zone us-central1-f --format='yaml(networkInterfaces[].subnetwork,
      networkInterfaces[].aliasIpRanges)'
  - stdout: |
      networkInterfaces:
      - subnetwork: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
- execute:
  - command: compute instances network-interfaces update $$instance$$ --zone us-central1-f
      --aliases /32
  - progress_tracker:
    - message: Updating network interface [nic0] of instance [$$instance$$]
    - status: SUCCESS
- execute:
  - command: compute instances describe $$instance$$ --zone us-central1-f --format='yaml(networkInterfaces[].subnetwork,
      networkInterfaces[].aliasIpRanges)'
  - stdout: |-
      networkInterfaces:
      - aliasIpRanges:
        - ipCidrRange: 10.0.3.*/32
        subnetwork: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
      $
- execute:
  - command: compute instances delete $$instance$$ --zone us-central1-f --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$\].
- execute:
  - command: compute networks subnets delete $$subnet1$$ --region us-central1 --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$\].
- execute:
  - command: compute networks delete $$network1$$ --quiet
  - stderr: |
      Deleted [https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$\].
actions:
- define_reference:
    reference: compute-uri
    value: compute.googleapis.com/compute
- generate_resource_id:
    reference: network1
    prefix: multi-nic-template

- generate_resource_id:
    reference: subnet1
    prefix: multi-nic-template

- generate_resource_id:
    reference: instance
    prefix: multi-nic-template

- execute_command:
    command: compute networks create $$network1$$ --subnet-mode custom --format 'yaml(name,x_gcloud_subnet_mode)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks?alt=json
          method: POST
          headers: {}
          body:
            json:
              autoCreateSubnetworks: false
              name: $$network1$$
              routingConfig:
                routingMode: REGIONAL
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '8960750156329223838'
            name: operation-1537882225313-576b21bbf0777-3b9b0f3b-e35e72b7
            operationType: insert
            targetLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
            targetId: '1545482728873887390'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:30:25.936-07:00'
            selfLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1537882225313-576b21bbf0777-3b9b0f3b-e35e72b7
            kind: compute#operation
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: E7uv_l6j1jayyJOD3lKhXjSJ-7w=/W0ZL7bhiQi-CfJ_TYtm8zzTw1Fo=
            status: '200'
          body:
            id: '1545482728873887390'
            creationTimestamp: '2018-09-25T06:30:25.928-07:00'
            name: $$network1$$
            selfLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
            autoCreateSubnetworks: false
            routingConfig:
              routingMode: REGIONAL
            kind: compute#network
    - expect_stdout:
        matches: ^(---\s)?name:\s$$network1$$\s+x_gcloud_subnet_mode:\sCUSTOM$
    - expect_exit:
        code: 0
- execute_command:
    command: compute networks subnets create $$subnet1$$ --region us-central1 --network
      $$network1$$ --range 10.0.3.0/24 --format 'text(name,network,ipCidrRange)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks?alt=json
          method: POST
          headers: {}
          body:
            json:
              ipCidrRange: 10.0.3.0/24
              name: $$subnet1$$
              network: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              privateIpGoogleAccess: false
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '1964909027180119664'
            name: operation-1537882269798-576b21e65cea2-8a21fb77-54ee3bde
            operationType: insert
            targetLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
            targetId: '2058280761496667760'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:31:11.098-07:00'
            selfLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1537882269798-576b21e65cea2-8a21fb77-54ee3bde
            region: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            kind: compute#operation
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: DviVNwD7NGDnH74i0WUbpxdN_dY=/XzbWhVhh0yEMoxO8vTwA2qfsIEo=
            status: '200'
          body:
            id: '2058280761496667760'
            creationTimestamp: '2018-09-25T06:31:11.087-07:00'
            name: $$subnet1$$
            network: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
            ipCidrRange: 10.0.3.0/24
            gatewayAddress: 10.0.3.1
            region: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
            privateIpGoogleAccess: false
            fingerprint: E5sAXLHADXQ=
            allowSubnetCidrRoutesOverlap: false
            kind: compute#subnetwork
    - expect_stdout:
        matches: |
          ---
          ipCidrRange: 10.0.3.0/24
          name:        $$subnet1$$
          network:     https://.*.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances create $$instance$$ --zone us-central1-f --network-interface
      subnet=$$subnet1$$,aliases=/32  --format='yaml(networkInterfaces[].subnetwork,
      networkInterfaces[].aliasIpRanges)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: n6wsXUzvMFfnJ9CrSZlIM1kw3Q0=/Ao0CNsszYrCI5XajEhJlG15UpcQ=
            status: '200'
          body:
            id: '2004'
            creationTimestamp: '1969-12-31T16:00:00.000-08:00'
            name: us-central1-f
            description: us-central1-f
            status: UP
            region: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            selfLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            availableCpuPlatforms:
            - Intel Skylake
            - Intel Broadwell
            - Intel Haswell
            - Intel Ivy Bridge
            kind: compute#zone
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          omit_fields:
          - commonInstanceMetadata
          - quotas
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: carACCrGRMfbOTkmThBztlFQt1w=/CiIlRclFdOf8QFC2dHd-OSa1Lx4=
            status: '200'
          body:
            id: '17966956004057981335'
            creationTimestamp: '2014-09-30T07:55:22.502-07:00'
            name: cloud-sdk-integration-testing
            usageExportLocation:
              bucketName: cloud-sdk-integration-test-usage
              reportNamePrefix: ''
            enabledFeatures:
            - alpha-api
            selfLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing
            defaultServiceAccount: 462803083913-compute@developer.gserviceaccount.com
            xpnProjectStatus: UNSPECIFIED_XPN_PROJECT_STATUS
            defaultNetworkTier: PREMIUM
            kind: compute#project
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances?alt=json
          method: POST
          headers: {}
          body:
            json:
              canIpForward: false
              deletionProtection: false
              disks:
              - autoDelete: true
                boot: true
                initializeParams:
                  sourceImage: https://$$compute-uri$$/alpha/projects/debian-cloud/global/images/family/debian-9
                mode: READ_WRITE
                type: PERSISTENT
              machineType: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
              metadata: {}
              name: $$instance$$
              networkInterfaces:
              - accessConfigs:
                - name: external-nat
                  type: ONE_TO_ONE_NAT
                aliasIpRanges:
                - ipCidrRange: /32
                subnetwork: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              scheduling:
                automaticRestart: true
              serviceAccounts:
              - email: default
                scopes:
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring.write
                - https://www.googleapis.com/auth/pubsub
                - https://www.googleapis.com/auth/service.management.readonly
                - https://www.googleapis.com/auth/servicecontrol
                - https://www.googleapis.com/auth/trace.append
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '1025948284860466776'
            name: operation-1537882294292-576b21fdb8f70-9a8279a7-a7d3d684
            zone: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: insert
            targetLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            targetId: '476051617519994457'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:31:35.528-07:00'
            selfLink: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1537882294292-576b21fdb8f70-9a8279a7-a7d3d684
            kind: compute#operation
        poll_operation: true
    - expect_stderr:
        matches: |
          Created \[https://.*.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$\].
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: AeOUAyDwg95Dd78QizVbsfX9PqA=/Td8NTTTjAnG5XZCn8DS7Qdgx5Gw=
            status: '200'
          body:
            id: '476051617519994457'
            creationTimestamp: '2018-09-25T06:31:35.383-07:00'
            name: $$instance$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            canIpForward: false
            networkInterfaces:
            - network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              networkIP: 10.0.3.3
              name: nic0
              accessConfigs:
              - type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.239.216.172
                networkTier: PREMIUM
                kind: compute#accessConfig
              aliasIpRanges:
              - ipCidrRange: 10.0.3.2/32
              fingerprint: _vhSglkFVV8=
              kind: compute#networkInterface
            disks:
            - type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/disks/$$instance$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/alpha/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
              diskSizeGb: '10'
              kind: compute#attachedDisk
            metadata:
              fingerprint: 4_QxQ57NQak=
              kind: compute#metadata
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
            kind: compute#instance
    - expect_stdout:
        matches: |
          ---
          networkInterfaces:
          - aliasIpRanges:
            - ipCidrRange: 10.0.3.*/32
            subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances network-interfaces update $$instance$$ --zone us-central1-f
      --aliases ''
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3098'
            content-type: application/json; charset=UTF-8
            etag: ckgXdvxZ6sDi-Tmxt8A3Ed-yEJs=/QnjCyDmzVJBEbTSyyay7f_9i1BM=
            status: '200'
          body:
            id: '476051617519994457'
            creationTimestamp: '2018-09-25T06:31:35.383-07:00'
            name: $$instance$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            canIpForward: false
            networkInterfaces:
            - network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              networkIP: 10.0.3.3
              name: nic0
              accessConfigs:
              - type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.239.216.172
                networkTier: PREMIUM
                kind: compute#accessConfig
              aliasIpRanges:
              - ipCidrRange: 10.0.3.2/32
              fingerprint: _vhSglkFVV8=
              kind: compute#networkInterface
            disks:
            - type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/disks/$$instance$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/alpha/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
              diskSizeGb: '10'
              kind: compute#attachedDisk
            metadata:
              fingerprint: 4_QxQ57NQak=
              kind: compute#metadata
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
            kind: compute#instance
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$/updateNetworkInterface?alt=json&networkInterface=nic0
          method: PATCH
          headers: {}
          body:
            json:
              aliasIpRanges: []
        return_response:
          headers:
            cache-control: private
            content-length: '858'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '667685013793769019'
            name: operation-1537882324346-576b221a6266d-369c8dca-dbf18a06
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: updateNetworkInterface
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            targetId: '476051617519994457'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:32:04.860-07:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1537882324346-576b221a6266d-369c8dca-dbf18a06
            kind: compute#operation
        poll_operation: true
    - expect_progress_tracker:
        message: Updating network interface [nic0] of instance [$$instance$$]
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3005'
            content-type: application/json; charset=UTF-8
            etag: IcnsGjqiJIBUqPYqsfPvxsJnxf4=/6Xdcg_NGA7AkPp-7nLiKEM0QPS4=
            status: '200'
          body:
            id: '476051617519994457'
            creationTimestamp: '2018-09-25T06:31:35.383-07:00'
            name: $$instance$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            canIpForward: false
            networkInterfaces:
            - network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              networkIP: 10.0.3.3
              name: nic0
              accessConfigs:
              - type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.239.216.172
                networkTier: PREMIUM
                kind: compute#accessConfig
              fingerprint: iPpm6mCbNkc=
              kind: compute#networkInterface
            disks:
            - type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/disks/$$instance$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/alpha/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
              diskSizeGb: '10'
              kind: compute#attachedDisk
            metadata:
              fingerprint: 4_QxQ57NQak=
              kind: compute#metadata
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
            kind: compute#instance
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances describe $$instance$$ --zone us-central1-f --format='yaml(networkInterfaces[].subnetwork,
      networkInterfaces[].aliasIpRanges)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: RRK7t5jJJ3pFVhzG69ETpNQM0Kk=/ZrTPJ5UW_yILT7HcFUSkW3khfCc=
            status: '200'
          body:
            id: '476051617519994457'
            creationTimestamp: '2018-09-25T06:31:35.383-07:00'
            name: $$instance$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            canIpForward: false
            networkInterfaces:
            - network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              networkIP: 10.0.3.3
              name: nic0
              accessConfigs:
              - type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.239.216.172
                networkTier: PREMIUM
                kind: compute#accessConfig
              fingerprint: iPpm6mCbNkc=
              kind: compute#networkInterface
            disks:
            - type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/disks/$$instance$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/alpha/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
              diskSizeGb: '10'
              kind: compute#attachedDisk
            metadata:
              fingerprint: 4_QxQ57NQak=
              kind: compute#metadata
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
            kind: compute#instance
    - expect_stdout: |
        networkInterfaces:
        - subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances network-interfaces update $$instance$$ --zone us-central1-f
      --aliases /32
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3005'
            content-type: application/json; charset=UTF-8
            etag: YAX8raXkcDu4cswhuJ_Qykb7mB0=/bxXCUV6lgIQgPxwtX3ok2tBnnI4=
            status: '200'
          body:
            id: '476051617519994457'
            creationTimestamp: '2018-09-25T06:31:35.383-07:00'
            name: $$instance$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            canIpForward: false
            networkInterfaces:
            - network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              networkIP: 10.0.3.3
              name: nic0
              accessConfigs:
              - type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.239.216.172
                networkTier: PREMIUM
                kind: compute#accessConfig
              fingerprint: iPpm6mCbNkc=
              kind: compute#networkInterface
            disks:
            - type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/disks/$$instance$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/alpha/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
              diskSizeGb: '10'
              kind: compute#attachedDisk
            metadata:
              fingerprint: 4_QxQ57NQak=
              kind: compute#metadata
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
            kind: compute#instance
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$/updateNetworkInterface?alt=json&networkInterface=nic0
          method: PATCH
          headers: {}
          body:
            json:
              aliasIpRanges:
              - ipCidrRange: /32
        return_response:
          headers:
            cache-control: private
            content-length: '859'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '7393255494661932596'
            name: operation-1537882330752-576b22207e49f-accc58e2-e293196d
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: updateNetworkInterface
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            targetId: '476051617519994457'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:32:12.262-07:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1537882330752-576b22207e49f-accc58e2-e293196d
            kind: compute#operation
        poll_operation: true
    - expect_progress_tracker:
        message: Updating network interface [nic0] of instance [$$instance$$]
        status: SUCCESS
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3098'
            content-type: application/json; charset=UTF-8
            etag: T52KTBenH2Bh9Kpx9tkkCRPKohI=/YP8JQJXu60vvicJqSeRdHL2ZgKo=
            status: '200'
          body:
            id: '476051617519994457'
            creationTimestamp: '2018-09-25T06:31:35.383-07:00'
            name: $$instance$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            canIpForward: false
            networkInterfaces:
            - network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              networkIP: 10.0.3.3
              name: nic0
              accessConfigs:
              - type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.239.216.172
                networkTier: PREMIUM
                kind: compute#accessConfig
              aliasIpRanges:
              - ipCidrRange: 10.0.3.2/32
              fingerprint: _vhSglkFVV8=
              kind: compute#networkInterface
            disks:
            - type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/disks/$$instance$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/alpha/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
              diskSizeGb: '10'
              kind: compute#attachedDisk
            metadata:
              fingerprint: 4_QxQ57NQak=
              kind: compute#metadata
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
            kind: compute#instance
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances describe $$instance$$ --zone us-central1-f --format='yaml(networkInterfaces[].subnetwork,
      networkInterfaces[].aliasIpRanges)'
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            ETag: zg0AlC9GzLZretGG8-w2RdVTkUw=/sy9CnZo26zl6Z_wcHG8tuJ6DsbI=
            status: '200'
          body:
            id: '476051617519994457'
            creationTimestamp: '2018-09-25T06:31:35.383-07:00'
            name: $$instance$$
            tags:
              fingerprint: 42WmSpB8rSM=
            machineType: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/machineTypes/n1-standard-1
            status: RUNNING
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            canIpForward: false
            networkInterfaces:
            - network: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
              subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
              networkIP: 10.0.3.3
              name: nic0
              accessConfigs:
              - type: ONE_TO_ONE_NAT
                name: external-nat
                natIP: 35.239.216.172
                networkTier: PREMIUM
                kind: compute#accessConfig
              aliasIpRanges:
              - ipCidrRange: 10.0.3.2/32
              fingerprint: _vhSglkFVV8=
              kind: compute#networkInterface
            disks:
            - type: PERSISTENT
              mode: READ_WRITE
              source: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/disks/$$instance$$
              deviceName: persistent-disk-0
              index: 0
              boot: true
              autoDelete: true
              licenses:
              - https://www.googleapis.com/compute/alpha/projects/debian-cloud/global/licenses/debian-9-stretch
              interface: SCSI
              guestOsFeatures:
              - type: VIRTIO_SCSI_MULTIQUEUE
              diskSizeGb: '10'
              kind: compute#attachedDisk
            metadata:
              fingerprint: 4_QxQ57NQak=
              kind: compute#metadata
            serviceAccounts:
            - email: 462803083913-compute@developer.gserviceaccount.com
              scopes:
              - https://www.googleapis.com/auth/devstorage.read_only
              - https://www.googleapis.com/auth/logging.write
              - https://www.googleapis.com/auth/monitoring.write
              - https://www.googleapis.com/auth/pubsub
              - https://www.googleapis.com/auth/service.management.readonly
              - https://www.googleapis.com/auth/servicecontrol
              - https://www.googleapis.com/auth/trace.append
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            scheduling:
              onHostMaintenance: MIGRATE
              automaticRestart: true
              preemptible: false
            cpuPlatform: Intel Ivy Bridge
            labelFingerprint: 42WmSpB8rSM=
            startRestricted: false
            deletionProtection: false
            kind: compute#instance
    - expect_stdout:
        matches: |
          networkInterfaces:
          - aliasIpRanges:
            - ipCidrRange: 10.0.3.*/32
            subnetwork: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
    - expect_exit:
        code: 0
- execute_command:
    command: compute instances delete $$instance$$ --zone us-central1-f --quiet
    cleanup_for: instance
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '716938247045350917'
            name: operation-1537882345878-576b222eeb29d-f3eddc3e-ea9f754c
            zone: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f
            operationType: delete
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$
            targetId: '476051617519994457'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:32:27.119-07:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/operations/operation-1537882345878-576b222eeb29d-f3eddc3e-ea9f754c
            kind: compute#operation
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/zones/us-central1-f/instances/$$instance$$\].
    - expect_exit:
        code: 0
- execute_command:
    command: compute networks subnets delete $$subnet1$$ --region us-central1 --quiet
    cleanup_for: subnet1
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '7828940670840047581'
            name: operation-1537882417623-576b227357070-4d7a63e4-8764c53f
            operationType: delete
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$
            targetId: '2058280761496667760'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:33:38.499-07:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/operations/operation-1537882417623-576b227357070-4d7a63e4-8764c53f
            region: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1
            kind: compute#operation
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/regions/us-central1/subnetworks/$$subnet1$$\].
    - expect_exit:
        code: 0
- execute_command:
    command: compute networks delete $$network1$$ --quiet
    cleanup_for: network1
    events:
    - api_call:
        expect_request:
          uri: https://$$compute-uri$$/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            Content-Type: application/json; charset=UTF-8
            status: '200'
          body:
            id: '3778863523770632102'
            name: operation-1537882440651-576b22894d386-99a0590c-897182c9
            operationType: delete
            targetLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$
            targetId: '1545482728873887390'
            status: PENDING
            user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            progress: 0
            insertTime: '2018-09-25T06:34:01.149-07:00'
            selfLink: https://www.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/operations/operation-1537882440651-576b22894d386-99a0590c-897182c9
            kind: compute#operation
        poll_operation: true
    - expect_stderr:
        matches: |
          Deleted \[https://.*.googleapis.com/compute/alpha/projects/cloud-sdk-integration-testing/global/networks/$$network1$$\].
    - expect_exit:
        code: 0
