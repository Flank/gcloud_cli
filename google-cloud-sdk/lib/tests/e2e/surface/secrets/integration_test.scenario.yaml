title: cloud secrets integration test
release_tracks: [ALPHA]
summary:
# This summary is generated automatically on update and should not be edited.
- execute:
  - command: secrets create $$a-secret1$$ --locations=us-central1 --data-file=secret.data1
  - stdout: |
      Created version [1] of the secret [$$a-secret1$$].
- execute:
  - command: secrets access $$a-secret1$$
  - stdout: |
      thisissecretdata1
- execute:
  - command: secrets list --filter "name:$$a-secret1$$" --format "text(name,location)"
  - stdout: |
      ---
      name: projects/462803083913/secrets/$$a-secret1$$
- execute:
  - command: secrets describe $$a-secret1$$ --format "text(labels,name,policy)"
  - stdout: |
      name:                       projects/462803083913/secrets/$$a-secret1$$
      policy.replicaLocations[0]: us-central1
- execute:
  - command: |
      secrets update $$a-secret1$$ --locations=us-west1 --update-labels="foo=bar"
      --data-file=secret.data2
  - stdout: |
      Updated secret [$$a-secret1$$].
  - stdout: |
      Created version [2] of the secret [$$a-secret1$$].
- execute:
  - command: secrets describe $$a-secret1$$ --format "text(labels,name,policy)"
  - stdout: |
      labels.foo:                 bar
      name:                       projects/462803083913/secrets/$$a-secret1$$
      policy.replicaLocations[0]: us-west1
- execute:
  - command: secrets access $$a-secret1$$
  - stdout: |
      thisissecretdata2
- execute:
  - command: |
      secrets update $$a-secret2$$ --locations=us-central1 --create-if-missing
      --update-labels "foo=bar" --data-file=secret.data3
  - stdout: |
      Created secret [$$a-secret2$$].
  - stdout: |
      Created version [1] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets describe $$a-secret2$$ --format "text(name,policy,location,labels)"
  - stdout: |
      labels.foo:                 bar
      name:                       projects/462803083913/secrets/$$a-secret2$$
      policy.replicaLocations[0]: us-central1
- execute:
  - command: |
      secrets access $$a-secret2$$
  - stdout: |
      thisissecretdata3
- execute:
  - command: |
      secrets update $$a-secret2$$ --locations=us-central1
      --update-labels "foo=bar" --data-file=secret.data4
  - stdout: |
      Updated secret [$$a-secret2$$].
  - stdout: |
      Created version [2] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets update $$a-secret2$$ --locations=us-central1
      --update-labels "foo=bar" --data-file=secret.data5
  - stdout: |
      Updated secret [$$a-secret2$$].
  - stdout: |
      Created version [3] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets versions access 1 --secret $$a-secret2$$
  - stdout: |
      thisissecretdata3
- execute:
  - command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
  - stdout: |
      3	enabled
      2	enabled
      1	enabled
- execute:
  - command: |
      secrets versions disable 1 --secret $$a-secret2$$ --quiet
  - stdout: |
      Disabled version [1] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
  - stdout: |
      3	enabled
      2	enabled
      1	disabled
- execute:
  - command: |
      secrets versions enable 1 --secret $$a-secret2$$
  - stdout: |
      Enabled version [1] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
  - stdout: |
      3	enabled
      2	enabled
      1	enabled
- execute:
  - command: |
      secrets versions destroy 1 --secret $$a-secret2$$ --quiet
  - stdout: |
      Destroyed version [1] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
  - stdout: |
      3	enabled
      2	enabled
      1	destroyed
- execute:
  - command: |
      secrets versions destroy 2 --secret $$a-secret2$$ --quiet
  - stdout: |
      Destroyed version [2] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
  - stdout: |
      3	enabled
      2	destroyed
      1	destroyed
- execute:
  - command: |
      secrets versions destroy 3 --secret $$a-secret2$$ --quiet
  - stdout: |
      Destroyed version [3] of the secret [$$a-secret2$$].
- execute:
  - command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
  - stdout: |
      3	destroyed
      2	destroyed
      1	destroyed
- execute:
  - command: secrets delete $$a-secret2$$ -q
  - stdout: |
      Deleted secret [$$a-secret2$$].
- execute:
  - command: secrets delete $$a-secret1$$ -q
  - stdout: |
      Destroyed version [2] of the secret [$$a-secret1$$].
  - stdout: |
      Destroyed version [1] of the secret [$$a-secret1$$].
  - stdout: |
      Deleted secret [$$a-secret1$$].
actions:
- generate_resource_id:
    reference: a-secret1
    prefix: secrets
- generate_resource_id:
    reference: a-secret2
    prefix: secrets
- write_file:
    path: secret.data1
    contents: thisissecretdata1
- write_file:
    path: secret.data2
    contents: thisissecretdata2
- write_file:
    path: secret.data3
    contents: thisissecretdata3
- write_file:
    path: secret.data4
    contents: thisissecretdata4
- write_file:
    path: secret.data5
    contents: thisissecretdata5
- execute_command:
    command: secrets create $$a-secret1$$ --locations=us-central1 --data-file=secret.data1
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets?alt=json&secretId=$$a-secret1$$
          method: POST
          headers: {}
          body:
            json:
              policy:
                replicaLocations:
                - us-central1
        return_response:
          headers:
            cache-control: private
            content-length: '196'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:41.856659557Z'
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$:setPayload?alt=json
          method: POST
          headers: {}
          body:
            json:
              payload:
                data: dGhpc2lzc2VjcmV0ZGF0YTE=
        return_response:
          headers:
            cache-control: private
            content-length: '158'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$/versions/1
            createTime: '2019-06-28T15:45:42.161885908Z'
            state: ENABLED
    - expect_stdout: |
        Created version [1] of the secret [$$a-secret1$$].
    - expect_exit:
        code: 0
- execute_command:
    command: secrets access $$a-secret1$$
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$/latest:access?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '242'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            payload:
              data: dGhpc2lzc2VjcmV0ZGF0YTE=
            version:
              name: projects/462803083913/secrets/$$a-secret1$$/versions/1
              createTime: '2019-06-28T15:45:42.161885908Z'
              state: ENABLED
    - expect_stdout: |
        thisissecretdata1
    - expect_exit:
        code: 0
- execute_command:
    command: secrets list --filter "name:$$a-secret1$$" --format "text(name,location)"
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets?alt=json&pageSize=100
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '4168'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            secrets:
            - name: projects/462803083913/secrets/$$a-secret1$$
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-28T15:45:41.856659557Z'
            - name: projects/462803083913/secrets/my-secret4
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-26T20:06:39.387442525Z'
            - name: projects/462803083913/secrets/my-secret3
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-26T17:06:38.095049674Z'
            - name: projects/462803083913/secrets/my-secret2
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-26T17:03:50.247782482Z'
            - name: projects/462803083913/secrets/my-secret
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-26T17:03:40.190990555Z'
            - name: projects/462803083913/secrets/e2esecret-20190626-064726-6p34
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-26T06:47:26.631962391Z'
            - name: projects/462803083913/secrets/secrets-20190625-174449-sw23
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:44:49.364059786Z'
            - name: projects/462803083913/secrets/secrets-20190625-174432-a754
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:44:33.342296571Z'
            - name: projects/462803083913/secrets/secrets-20190625-174357-cdy5
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:43:57.615133042Z'
            - name: projects/462803083913/secrets/secrets-20190625-174338-xjix
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:43:38.567709412Z'
            - name: projects/462803083913/secrets/secrets-20190625-174325-ziyz
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:43:25.808196178Z'
            - name: projects/462803083913/secrets/secrets-20190625-174309-nk50
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:43:10.059026374Z'
            - name: projects/462803083913/secrets/secrets-20190625-173930-g1zk
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:39:31.605433896Z'
            - name: projects/462803083913/secrets/secrets-20190625-173930-68uh
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:39:30.497779466Z'
            - name: projects/462803083913/secrets/secrets-20190625-173917-s8mw
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:39:18.029332683Z'
            - name: projects/462803083913/secrets/secrets-20190625-173841-gnyj
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:38:41.809315605Z'
            - name: projects/462803083913/secrets/e2esecret-20190625-171404-vkiv
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:14:04.972676739Z'
            - name: projects/462803083913/secrets/e2esecret-20190625-171404-gutc
              policy:
                replicaLocations:
                - us-central1
              createTime: '2019-06-25T17:14:04.835353632Z'
            totalSize: 18
    - expect_stdout: |
        ---
        name: projects/462803083913/secrets/$$a-secret1$$
    - expect_exit:
        code: 0
- execute_command:
    command: secrets describe $$a-secret1$$ --format "text(labels,name,policy)"
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '196'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:41.856659557Z'
    - expect_stdout: |
        name:                       projects/462803083913/secrets/$$a-secret1$$
        policy.replicaLocations[0]: us-central1
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets update $$a-secret1$$ --locations=us-west1 --update-labels="foo=bar"
      --data-file=secret.data2
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '196'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:41.856659557Z'
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$?alt=json&updateMask=labels%2Cpolicy.replicaLocations
          method: PATCH
          headers: {}
          body:
            json:
              labels:
                foo: bar
              policy:
                replicaLocations:
                - us-west1
        return_response:
          headers:
            cache-control: private
            content-length: '229'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$
            policy:
              replicaLocations:
              - us-west1
            createTime: '2019-06-28T15:45:41.856659557Z'
            labels:
              foo: bar
    - expect_stdout: |
        Updated secret [$$a-secret1$$].
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$:setPayload?alt=json
          method: POST
          headers: {}
          body:
            json:
              payload:
                data: dGhpc2lzc2VjcmV0ZGF0YTI=
        return_response:
          headers:
            cache-control: private
            content-length: '158'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$/versions/2
            createTime: '2019-06-28T15:45:45.093497289Z'
            state: ENABLED
    - expect_stdout: |
        Created version [2] of the secret [$$a-secret1$$].
    - expect_exit:
        code: 0
- execute_command:
    command: secrets describe $$a-secret1$$ --format "text(labels,name,policy)"
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '229'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$
            policy:
              replicaLocations:
              - us-west1
            createTime: '2019-06-28T15:45:41.856659557Z'
            labels:
              foo: bar
    - expect_stdout: |
        labels.foo:                 bar
        name:                       projects/462803083913/secrets/$$a-secret1$$
        policy.replicaLocations[0]: us-west1
    - expect_exit:
        code: 0
- execute_command:
    command: secrets access $$a-secret1$$
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$/latest:access?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '242'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            payload:
              data: dGhpc2lzc2VjcmV0ZGF0YTI=
            version:
              name: projects/462803083913/secrets/$$a-secret1$$/versions/2
              createTime: '2019-06-28T15:45:45.093497289Z'
              state: ENABLED
    - expect_stdout: |
        thisissecretdata2
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets update $$a-secret2$$ --locations=us-central1 --create-if-missing
      --update-labels "foo=bar" --data-file=secret.data3
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '161'
            content-type: application/json; charset=UTF-8
            status: '404'
          body:
            error:
              code: 404
              message: Secret [projects/462803083913/secrets/$$a-secret2$$] not found.
              status: NOT_FOUND
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets?alt=json&secretId=$$a-secret2$$
          method: POST
          headers: {}
          body:
            json:
              labels:
                foo: bar
              policy:
                replicaLocations:
                - us-central1
        return_response:
          headers:
            cache-control: private
            content-length: '232'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:46.926484829Z'
            labels:
              foo: bar
    - expect_stdout: |
        Created secret [$$a-secret2$$].
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$:setPayload?alt=json
          method: POST
          headers: {}
          body:
            json:
              payload:
                data: dGhpc2lzc2VjcmV0ZGF0YTM=
        return_response:
          headers:
            cache-control: private
            content-length: '158'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/1
            createTime: '2019-06-28T15:45:47.230952208Z'
            state: ENABLED
    - expect_stdout: |
        Created version [1] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets describe $$a-secret2$$ --format "text(name,policy,location,labels)"
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '232'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:46.926484829Z'
            labels:
              foo: bar
    - expect_stdout: |
        labels.foo:                 bar
        name:                       projects/462803083913/secrets/$$a-secret2$$
        policy.replicaLocations[0]: us-central1
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets access $$a-secret2$$
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/latest:access?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '242'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            payload:
              data: dGhpc2lzc2VjcmV0ZGF0YTM=
            version:
              name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              state: ENABLED
    - expect_stdout: |
        thisissecretdata3
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets update $$a-secret2$$ --locations=us-central1
      --update-labels "foo=bar" --data-file=secret.data4
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '232'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:46.926484829Z'
            labels:
              foo: bar
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$?alt=json&updateMask=labels%2Cpolicy.replicaLocations
          method: PATCH
          headers: {}
          body:
            json:
              policy:
                replicaLocations:
                - us-central1
        return_response:
          headers:
            cache-control: private
            content-length: '196'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:46.926484829Z'
    - expect_stdout: |
        Updated secret [$$a-secret2$$].
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$:setPayload?alt=json
          method: POST
          headers: {}
          body:
            json:
              payload:
                data: dGhpc2lzc2VjcmV0ZGF0YTQ=
        return_response:
          headers:
            cache-control: private
            content-length: '158'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/2
            createTime: '2019-06-28T15:45:49.420008210Z'
            state: ENABLED
    - expect_stdout: |
        Created version [2] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets update $$a-secret2$$ --locations=us-central1
      --update-labels "foo=bar" --data-file=secret.data5
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '196'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:46.926484829Z'
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$?alt=json&updateMask=labels%2Cpolicy.replicaLocations
          method: PATCH
          headers: {}
          body:
            json:
              labels:
                foo: bar
              policy:
                replicaLocations:
                - us-central1
        return_response:
          headers:
            cache-control: private
            content-length: '232'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$
            policy:
              replicaLocations:
              - us-central1
            createTime: '2019-06-28T15:45:46.926484829Z'
            labels:
              foo: bar
    - expect_stdout: |
        Updated secret [$$a-secret2$$].
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$:setPayload?alt=json
          method: POST
          headers: {}
          body:
            json:
              payload:
                data: dGhpc2lzc2VjcmV0ZGF0YTU=
        return_response:
          headers:
            cache-control: private
            content-length: '158'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/3
            createTime: '2019-06-28T15:45:50.569034012Z'
            state: ENABLED
    - expect_stdout: |
        Created version [3] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions access 1 --secret $$a-secret2$$
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions/1:access?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '62'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            payload:
              data: dGhpc2lzc2VjcmV0ZGF0YTM=
    - expect_stdout: |
        thisissecretdata3
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '578'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/3
              createTime: '2019-06-28T15:45:50.569034012Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/2
              createTime: '2019-06-28T15:45:49.420008210Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              state: ENABLED
            totalSize: 3
    - expect_stdout: |
        3	enabled
        2	enabled
        1	enabled
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions disable 1 --secret $$a-secret2$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions/1?alt=json&updateMask=state
          method: PATCH
          headers: {}
          body:
            json:
              state: DISABLED
        return_response:
          headers:
            cache-control: private
            content-length: '159'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/1
            createTime: '2019-06-28T15:45:47.230952208Z'
            state: DISABLED
    - expect_stdout: |
        Disabled version [1] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '579'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/3
              createTime: '2019-06-28T15:45:50.569034012Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/2
              createTime: '2019-06-28T15:45:49.420008210Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              state: DISABLED
            totalSize: 3
    - expect_stdout: |
        3	enabled
        2	enabled
        1	disabled
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions enable 1 --secret $$a-secret2$$
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions/1?alt=json&updateMask=state
          method: PATCH
          headers: {}
          body:
            json:
              state: ENABLED
        return_response:
          headers:
            cache-control: private
            content-length: '158'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/1
            createTime: '2019-06-28T15:45:47.230952208Z'
            state: ENABLED
    - expect_stdout: |
        Enabled version [1] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '578'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/3
              createTime: '2019-06-28T15:45:50.569034012Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/2
              createTime: '2019-06-28T15:45:49.420008210Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              state: ENABLED
            totalSize: 3
    - expect_stdout: |
        3	enabled
        2	enabled
        1	enabled
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions destroy 1 --secret $$a-secret2$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions/1:destroy?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '211'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/1
            createTime: '2019-06-28T15:45:47.230952208Z'
            destroyTime: '2019-06-28T15:45:54.498899023Z'
            state: DESTROYED
    - expect_stdout: |
        Destroyed version [1] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '635'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/3
              createTime: '2019-06-28T15:45:50.569034012Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/2
              createTime: '2019-06-28T15:45:49.420008210Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              destroyTime: '2019-06-28T15:45:54.498899023Z'
              state: DESTROYED
            totalSize: 3
    - expect_stdout: |
        3	enabled
        2	enabled
        1	destroyed
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions destroy 2 --secret $$a-secret2$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions/2:destroy?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '211'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/2
            createTime: '2019-06-28T15:45:49.420008210Z'
            destroyTime: '2019-06-28T15:45:55.584154934Z'
            state: DESTROYED
    - expect_stdout: |
        Destroyed version [2] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '692'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/3
              createTime: '2019-06-28T15:45:50.569034012Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/2
              createTime: '2019-06-28T15:45:49.420008210Z'
              destroyTime: '2019-06-28T15:45:55.584154934Z'
              state: DESTROYED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              destroyTime: '2019-06-28T15:45:54.498899023Z'
              state: DESTROYED
            totalSize: 3
    - expect_stdout: |
        3	enabled
        2	destroyed
        1	destroyed
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions destroy 3 --secret $$a-secret2$$ --quiet
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions/3:destroy?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '211'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret2$$/versions/3
            createTime: '2019-06-28T15:45:50.569034012Z'
            destroyTime: '2019-06-28T15:45:56.564821704Z'
            state: DESTROYED
    - expect_stdout: |
        Destroyed version [3] of the secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: |
      secrets versions list $$a-secret2$$ --format=value(name,state)
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '749'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/3
              createTime: '2019-06-28T15:45:50.569034012Z'
              destroyTime: '2019-06-28T15:45:56.564821704Z'
              state: DESTROYED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/2
              createTime: '2019-06-28T15:45:49.420008210Z'
              destroyTime: '2019-06-28T15:45:55.584154934Z'
              state: DESTROYED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              destroyTime: '2019-06-28T15:45:54.498899023Z'
              state: DESTROYED
            totalSize: 3
    - expect_stdout: |
        3	destroyed
        2	destroyed
        1	destroyed
    - expect_exit:
        code: 0
- execute_command:
    command: secrets delete $$a-secret2$$ -q
    cleanup_for: a-secret2
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '749'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/3
              createTime: '2019-06-28T15:45:50.569034012Z'
              destroyTime: '2019-06-28T15:45:56.564821704Z'
              state: DESTROYED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/2
              createTime: '2019-06-28T15:45:49.420008210Z'
              destroyTime: '2019-06-28T15:45:55.584154934Z'
              state: DESTROYED
            - name: projects/462803083913/secrets/$$a-secret2$$/versions/1
              createTime: '2019-06-28T15:45:47.230952208Z'
              destroyTime: '2019-06-28T15:45:54.498899023Z'
              state: DESTROYED
            totalSize: 3
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret2$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3'
            content-type: application/json; charset=UTF-8
            status: '200'
          body: |
            {}
    - expect_stdout: |
        Deleted secret [$$a-secret2$$].
    - expect_exit:
        code: 0
- execute_command:
    command: secrets delete $$a-secret1$$ -q
    cleanup_for: a-secret1
    events:
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$/versions?alt=json&pageSize=0
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '399'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            versions:
            - name: projects/462803083913/secrets/$$a-secret1$$/versions/2
              createTime: '2019-06-28T15:45:45.093497289Z'
              state: ENABLED
            - name: projects/462803083913/secrets/$$a-secret1$$/versions/1
              createTime: '2019-06-28T15:45:42.161885908Z'
              state: ENABLED
            totalSize: 2
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/462803083913/secrets/$$a-secret1$$/versions/2:destroy?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '211'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$/versions/2
            createTime: '2019-06-28T15:45:45.093497289Z'
            destroyTime: '2019-06-28T15:45:58.626809636Z'
            state: DESTROYED
    - expect_stdout: |
        Destroyed version [2] of the secret [$$a-secret1$$].
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/462803083913/secrets/$$a-secret1$$/versions/1:destroy?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '211'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: projects/462803083913/secrets/$$a-secret1$$/versions/1
            createTime: '2019-06-28T15:45:42.161885908Z'
            destroyTime: '2019-06-28T15:45:58.938741819Z'
            state: DESTROYED
    - expect_stdout: |
        Destroyed version [1] of the secret [$$a-secret1$$].
    - api_call:
        expect_request:
          uri: https://secretmanager.googleapis.com/v1alpha/projects/cloud-sdk-integration-testing/secrets/$$a-secret1$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3'
            content-type: application/json; charset=UTF-8
            status: '200'
          body: |
            {}
    - expect_stdout: |
        Deleted secret [$$a-secret1$$].
    - expect_exit:
        code: 0
