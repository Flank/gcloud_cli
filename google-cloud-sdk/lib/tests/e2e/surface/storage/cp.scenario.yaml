title: Test basic bucket operations
release_tracks: [ALPHA]
filters:
  DoNotRunOnPy2:
    reason: Storage does not support Python 2.
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: storage buckets create $$bucket$$ --format none
  - stderr: |
      Created bucket [$$bucket$$].
- execute:
  - command: storage cp test_data/c/c.txt gs://$$bucket$$/c.txt
- execute:
  - command: storage cp test_data/c/c.txt gs://$$bucket$$/prefix/c.txt
- execute:
  - command: storage cp test_data/c/c.txt gs://$$bucket$$/prefix/subprefix/c.txt
- execute:
  - command: storage ls gs://$$bucket$$/**
  - stdout: |
      gs://$$bucket$$/c.txt
      gs://$$bucket$$/prefix/c.txt
      gs://$$bucket$$/prefix/subprefix/c.txt
- execute:
  - command: storage cp gs://$$bucket$$/c.txt test_data
  - write_file: test_data/c.txt
- execute:
  - command: storage cp gs://$$bucket$$/** test_data
  - write_file: test_data/c.txt
  - write_file: test_data/c.txt
  - write_file: test_data/c.txt
- execute:
  - command: storage cp gs://$$bucket$$/c.txt gs://$$bucket$$/a.txt
- execute:
  - command: storage cp gs://$$bucket$$/** gs://$$bucket$$/c_dir/
- execute:
  - command: storage ls gs://$$bucket$$/**
  - stdout: |
      gs://$$bucket$$/a.txt
      gs://$$bucket$$/c.txt
      gs://$$bucket$$/c_dir/a.txt
      gs://$$bucket$$/c_dir/c.txt
      gs://$$bucket$$/prefix/c.txt
      gs://$$bucket$$/prefix/subprefix/c.txt
- execute:
  - command: storage delete gs://$$bucket$$ --recursive --num-threads=0
  - stderr: |
      WARNING: Deleting a bucket is irreversible and makes that bucket name available for others to claim.
  - prompt:
    - message: |-
        This command will delete the following buckets:
          $$bucket$$
    - input: y
  - prompt:
    - message: |-
        You are about to delete the following:
          gs://$$bucket$$
          gs://$$bucket$$/a.txt
          gs://$$bucket$$/c.txt
          gs://$$bucket$$/c_dir/a.txt
          gs://$$bucket$$/c_dir/c.txt
          gs://$$bucket$$/prefix/c.txt
          gs://$$bucket$$/prefix/subprefix/c.txt
    - input: y
  - progress_bar:
    - message: Deleting Files
  - stderr: |2

      Deleted [6] files.
  - stderr: |
      Deleted bucket [gs://$$bucket$$].
actions:
# Setup.
- write_file:
    path: test_data/c/c.txt
    contents: contents
- generate_resource_id:
    reference: bucket
    prefix: storage-bucket
- execute_command:
    command: storage buckets create $$bucket$$ --format none
    validation_only: true
    events:
    - expect_stderr: |
        Created bucket [$$bucket$$].
    - expect_exit:
        code: 0
- execute_command:
    # Copy a single file to a directory.
    command: storage cp test_data/c/c.txt gs://$$bucket$$/c.txt
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 404
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '289'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            x-guploader-uploadid: ABg5-UyEjzdnsxmi3Au_Xxytd3-AEU2ci9-3-N6Fh28Uffz5D1Avr2y3bXbqPUmw0va80RygjzaCguaLY8zWeQe4vW8QJrp1Qw
          body:
            error:
              code: 404
              message: 'No such object: $$bucket$$/c.txt'
              errors:
              - message: 'No such object: $$bucket$$/c.txt'
                domain: global
                reason: notFound
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&maxResults=1000&prefix=c.txt&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '32'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-Uwz67WvO1uERGbxz8CCnJLiiEsh6MsM5zLIuQSFRlk2IqsCVAmJzggEkA9oDZtx4dfyD2EAttn56uTtQoxqtJ0OwvAqAA
          body:
            kind: storage#objects
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/upload/storage/v1/b/$$bucket$$/o?alt=json&uploadType=multipart
          method: POST
          headers: {}
          body:
            text:
              matches: |
                --===============\d+==
                Content-Type: application/json
                MIME-Version: 1.0

                {"bucket": "$$bucket$$", "name": "c.txt"}
                --===============\d+==
                Content-Type: application/octet-stream
                MIME-Version: 1.0
                Content-Transfer-Encoding: binary

                contents
                --===============\d+==--
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '814'
            content-type: application/json; charset=UTF-8
            etag: CPKH9eq7juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UzjofDQxwdkfB8uo-I-bOXwjV-0FWUTypFtYlWhM-4Ff9IDZeoTsONSMMQbAWELw3eWliqunPxvQMtp6ZXpPeto2rmhCA
          body:
            kind: storage#object
            id: $$bucket$$/c.txt/1601386028286962
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c.txt?generation=1601386028286962&alt=media
            name: c.txt
            bucket: $$bucket$$
            generation: '1601386028286962'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CPKH9eq7juwCEAE=
            timeCreated: '2020-09-29T13:27:08.286Z'
            updated: '2020-09-29T13:27:08.286Z'
            timeStorageClassUpdated: '2020-09-29T13:27:08.286Z'
    - expect_exit:
        code: 0
- execute_command:
    # Nest objects.
    command: storage cp test_data/c/c.txt gs://$$bucket$$/prefix/c.txt
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 404
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '303'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            x-guploader-uploadid: ABg5-UwvhbWtidfRWA0CZdZzRPheKrI04Jhl14Y1bfWfjPMttCHAp8wrEEfYNdUUN36k7Y0CAqhp0BoxKQuF6xmwvxFhQ-fgxg
          body:
            error:
              code: 404
              message: 'No such object: $$bucket$$/prefix/c.txt'
              errors:
              - message: 'No such object: $$bucket$$/prefix/c.txt'
                domain: global
                reason: notFound
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&maxResults=1000&prefix=prefix%2Fc.txt&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '32'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UzrQEW1iZUezb2rRfAtjALrTWBMubdSZmqye3_5oOrQHlkjmnx-FndeH6xTnchqddf9A1gjzucfiNDgijCPqj0LGZuCeA
          body:
            kind: storage#objects
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/upload/storage/v1/b/$$bucket$$/o?alt=json&uploadType=multipart
          method: POST
          headers: {}
          body:
            text:
              matches: |
                --===============\d+==
                Content-Type: application/json
                MIME-Version: 1.0

                {"bucket": "$$bucket$$", "name": "prefix/c.txt"}
                --===============\d+==
                Content-Type: application/octet-stream
                MIME-Version: 1.0
                Content-Transfer-Encoding: binary

                contents
                --===============\d+==--
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '846'
            content-type: application/json; charset=UTF-8
            etag: CLbGreu7juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UxvgL2hC3YxLPf9GhPkidUOfniF6gB7V74wO7QujDYG6wV18xrMxle4210HCIo7MxV9oazyzBMtzu0uyyiQmCQvugmEIA
          body:
            kind: storage#object
            id: $$bucket$$/prefix/c.txt/1601386029212470
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt?generation=1601386029212470&alt=media
            name: prefix/c.txt
            bucket: $$bucket$$
            generation: '1601386029212470'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CLbGreu7juwCEAE=
            timeCreated: '2020-09-29T13:27:09.212Z'
            updated: '2020-09-29T13:27:09.212Z'
            timeStorageClassUpdated: '2020-09-29T13:27:09.212Z'
    - expect_exit:
        code: 0
- execute_command:
    # Really nest objects.
    command: storage cp test_data/c/c.txt gs://$$bucket$$/prefix/subprefix/c.txt
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 404
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '323'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uxn9Usi-jvC_WWMOXd71wYUj8nLsT60aVPRoybrRS7NLplDR_PaNbvG3lALSmZlvLPQu370-CxIOqr4dlmn8-ki3DqQUA
          body:
            error:
              code: 404
              message: 'No such object: $$bucket$$/prefix/subprefix/c.txt'
              errors:
              - message: 'No such object: $$bucket$$/prefix/subprefix/c.txt'
                domain: global
                reason: notFound
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&maxResults=1000&prefix=prefix%2Fsubprefix%2Fc.txt&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '32'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UwKJn-b1AHhASlgR9C5PwGDT_uxAfGwT0YK9OStkSDOdU9_Ec9LDf_Ybmis-_vug017H8NJVIrVXfwRCWFRauwefqaFZA
          body:
            kind: storage#objects
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/upload/storage/v1/b/$$bucket$$/o?alt=json&uploadType=multipart
          method: POST
          headers: {}
          body:
            text:
              matches: |
                --===============\d+==
                Content-Type: application/json
                MIME-Version: 1.0

                {"bucket": "$$bucket$$", "name": "prefix/subprefix/c.txt"}
                --===============\d+==
                Content-Type: application/octet-stream
                MIME-Version: 1.0
                Content-Transfer-Encoding: binary

                contents
                --===============\d+==--
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '890'
            content-type: application/json; charset=UTF-8
            etag: CI2g6+u7juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UxbPYLu_8jYESHZkWqp8jNLVpjpXranqLZtg8MXcwm9ogtRoCPVJ4OTF3Hc0KKrQmyoUvrVuM0GeCkFrSaXN7JiOrGxvg
          body:
            kind: storage#object
            id: $$bucket$$/prefix/subprefix/c.txt/1601386030223373
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt?generation=1601386030223373&alt=media
            name: prefix/subprefix/c.txt
            bucket: $$bucket$$
            generation: '1601386030223373'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CI2g6+u7juwCEAE=
            timeCreated: '2020-09-29T13:27:10.223Z'
            updated: '2020-09-29T13:27:10.223Z'
            timeStorageClassUpdated: '2020-09-29T13:27:10.223Z'
    - expect_exit:
        code: 0
- execute_command:
    command: storage ls gs://$$bucket$$/**
    validation_only: true
    events:
    - expect_stdout: |
        gs://$$bucket$$/c.txt
        gs://$$bucket$$/prefix/c.txt
        gs://$$bucket$$/prefix/subprefix/c.txt
    - expect_exit:
        code: 0
- execute_command:
    # Download a file.
    command: storage cp gs://$$bucket$$/c.txt test_data
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '814'
            content-type: application/json; charset=UTF-8
            etag: CPKH9eq7juwCEAE=
            x-guploader-uploadid: ABg5-UzqUvEvzsbI37K_aa-LbqEDZb9pTbTQrP_a3ZcLDdwX94srnI5LrCh8455_nJ1EuMEWYI4WFvcAVCWYLB95fFbD2zswIQ
          body:
            kind: storage#object
            id: $$bucket$$/c.txt/1601386028286962
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c.txt?generation=1601386028286962&alt=media
            name: c.txt
            bucket: $$bucket$$
            generation: '1601386028286962'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CPKH9eq7juwCEAE=
            timeCreated: '2020-09-29T13:27:08.286Z'
            updated: '2020-09-29T13:27:08.286Z'
            timeStorageClassUpdated: '2020-09-29T13:27:08.286Z'
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt?alt=media
          method: GET
          headers: {}
          body: null
        return_response:
          status: 206
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-disposition: attachment
            content-length: '8'
            content-range: bytes 0-7/8
            content-type: application/octet-stream
            etag: CPKH9eq7juwCEAE=
            pragma: no-cache
            x-goog-generation: '1601386028286962'
            x-goog-metageneration: '1'
            x-goog-storage-class: STANDARD
            x-guploader-uploadid: ABg5-UzZ457ooFZEOUjTFwRr3yEbHaxDvFWBhNrp_ym8dGL-ShsbZ_ZrKlvfjQupBfyuyXBeAX8W6ICpoDhUMJx-s_2Yui2Sbw
          body: contents
    - expect_file_written:
        path: test_data/c.txt
        binary_contents: contents
    - expect_exit:
        code: 0
- execute_command:
    # Download everything.
    command: storage cp gs://$$bucket$$/** test_data
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&maxResults=1000&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '2830'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UyLkP_rNME2qNwysMHNwtwx97658JjF5RaeKHQjrHEnigIZXabAlw-vZERkvByqeIauOgHsLV3XAe8ST5nRsWDYfGIJhw
          body:
            kind: storage#objects
            items:
            - kind: storage#object
              id: $$bucket$$/c.txt/1601386028286962
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c.txt?generation=1601386028286962&alt=media
              name: c.txt
              bucket: $$bucket$$
              generation: '1601386028286962'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CPKH9eq7juwCEAE=
              timeCreated: '2020-09-29T13:27:08.286Z'
              updated: '2020-09-29T13:27:08.286Z'
              timeStorageClassUpdated: '2020-09-29T13:27:08.286Z'
            - kind: storage#object
              id: $$bucket$$/prefix/c.txt/1601386029212470
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt?generation=1601386029212470&alt=media
              name: prefix/c.txt
              bucket: $$bucket$$
              generation: '1601386029212470'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CLbGreu7juwCEAE=
              timeCreated: '2020-09-29T13:27:09.212Z'
              updated: '2020-09-29T13:27:09.212Z'
              timeStorageClassUpdated: '2020-09-29T13:27:09.212Z'
            - kind: storage#object
              id: $$bucket$$/prefix/subprefix/c.txt/1601386030223373
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt?generation=1601386030223373&alt=media
              name: prefix/subprefix/c.txt
              bucket: $$bucket$$
              generation: '1601386030223373'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CI2g6+u7juwCEAE=
              timeCreated: '2020-09-29T13:27:10.223Z'
              updated: '2020-09-29T13:27:10.223Z'
              timeStorageClassUpdated: '2020-09-29T13:27:10.223Z'
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt?alt=media
          method: GET
          headers: {}
          body: null
        return_response:
          status: 206
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-disposition: attachment
            content-length: '8'
            content-range: bytes 0-7/8
            content-type: application/octet-stream
            etag: CPKH9eq7juwCEAE=
            pragma: no-cache
            x-goog-generation: '1601386028286962'
            x-goog-metageneration: '1'
            x-goog-storage-class: STANDARD
            x-guploader-uploadid: ABg5-Uxmfy0foGo2rJ4Adg89Vvbt6YKnzEzWLvTEQdYD4FlhnYzUW0wp-z84NXovuBLHSDSsAlfZonekd-KvZuejRLBBferkdA
          body: contents
    - expect_file_written:
        path: test_data/c.txt
        binary_contents: contents
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt?alt=media
          method: GET
          headers: {}
          body: null
        return_response:
          status: 206
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-disposition: attachment
            content-length: '8'
            content-range: bytes 0-7/8
            content-type: application/octet-stream
            etag: CLbGreu7juwCEAE=
            pragma: no-cache
            x-goog-generation: '1601386029212470'
            x-goog-metageneration: '1'
            x-goog-storage-class: STANDARD
            x-guploader-uploadid: ABg5-UxcQrM7KgHcaf7rCsE54BLmba6u4UlutW9myXZWcxbrp5dWEhBLdbIK5fqOGgY29pdpDBDxEf0gmVfHkcITZuHJJ7-gXg
          body: contents
    - expect_file_written:
        path: test_data/c.txt
        binary_contents: contents
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt?alt=media
          method: GET
          headers: {}
          body: null
        return_response:
          status: 206
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-disposition: attachment
            content-length: '8'
            content-range: bytes 0-7/8
            content-type: application/octet-stream
            etag: CI2g6+u7juwCEAE=
            pragma: no-cache
            x-goog-generation: '1601386030223373'
            x-goog-metageneration: '1'
            x-goog-storage-class: STANDARD
            x-guploader-uploadid: ABg5-UzwhOLiPIrnca3a0Ngoq3VZfJe7thn4niq184Z6vFIvDffzkRKNXQhgo2UNLPY3-Gf1oeihRsRCUjeNi7E4kUMemlVK3A
          body: contents
    - expect_file_written:
        path: test_data/c.txt
        binary_contents: contents
    - expect_exit:
        code: 0
- execute_command:
    # Single intracloud copy.
    command: storage cp gs://$$bucket$$/c.txt gs://$$bucket$$/a.txt
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '814'
            content-type: application/json; charset=UTF-8
            etag: CPKH9eq7juwCEAE=
            x-guploader-uploadid: ABg5-UwZIAC3EF2c59Hg0vL6D8obMXaXLZPdxGyujQZ4y29lHYTyBCSWGO6UM9ZjT5yOYdONM9Vobqh_ZFGkaUMs7DkoFpXZKg
          body:
            kind: storage#object
            id: $$bucket$$/c.txt/1601386028286962
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c.txt?generation=1601386028286962&alt=media
            name: c.txt
            bucket: $$bucket$$
            generation: '1601386028286962'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CPKH9eq7juwCEAE=
            timeCreated: '2020-09-29T13:27:08.286Z'
            updated: '2020-09-29T13:27:08.286Z'
            timeStorageClassUpdated: '2020-09-29T13:27:08.286Z'
        repeatable: true
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 404
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '289'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uw9vaZKILnG9IS9ACCUfB2AMe6U1YQkF3wAw5k6iRc3ROmKM1d43V7TNu8r-pSrzUbLRYx2zYr_XJElFqKCOPhIdewD9A
          body:
            error:
              code: 404
              message: 'No such object: $$bucket$$/a.txt'
              errors:
              - message: 'No such object: $$bucket$$/a.txt'
                domain: global
                reason: notFound
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&maxResults=1000&prefix=a.txt&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '32'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UwlBMc6zE9zaL663tMvBIIu25n_Mc3pXRuDNsjhI-Z7SH_lrSbe_9tfWlbflSR8fZu3Ek3OSfKnHI8szw5vpVHC-2AO7Q
          body:
            kind: storage#objects
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt/copyTo/b/$$bucket$$/o/a.txt?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '929'
            content-type: application/json; charset=UTF-8
            etag: CM/bvO27juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UzLguG4aes4BVxPvsmZzqfuq5GWWNRFf2kqemnCKg_Escy6CcJskBE_fYzdwcRkebA0rANUo9kUc2JDdgsZqIwZLlKCTg
          body:
            kind: storage#object
            id: $$bucket$$/a.txt/1601386033655247
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/a.txt?generation=1601386033655247&alt=media
            name: a.txt
            bucket: $$bucket$$
            generation: '1601386033655247'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CM/bvO27juwCEAE=
            timeCreated: '2020-09-29T13:27:13.655Z'
            updated: '2020-09-29T13:27:13.655Z'
            timeStorageClassUpdated: '2020-09-29T13:27:13.655Z'
            owner:
              entity: user-462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
    - expect_exit:
        code: 0
- execute_command:
    # Intracloud copy everything.
    command: storage cp gs://$$bucket$$/** gs://$$bucket$$/c_dir/
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&maxResults=1000&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '3721'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-Uyl-7sS1OkuQ1wAMluQTqyySwnIJEqPnUxJorprLvKIbEvXh5ONvSIziMN0bQzOkJO6ipU3eDBsXA3NvIl64Ai94nQqzg
          body:
            kind: storage#objects
            items:
            - kind: storage#object
              id: $$bucket$$/a.txt/1601386033655247
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/a.txt?generation=1601386033655247&alt=media
              name: a.txt
              bucket: $$bucket$$
              generation: '1601386033655247'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CM/bvO27juwCEAE=
              timeCreated: '2020-09-29T13:27:13.655Z'
              updated: '2020-09-29T13:27:13.655Z'
              timeStorageClassUpdated: '2020-09-29T13:27:13.655Z'
            - kind: storage#object
              id: $$bucket$$/c.txt/1601386028286962
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c.txt?generation=1601386028286962&alt=media
              name: c.txt
              bucket: $$bucket$$
              generation: '1601386028286962'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CPKH9eq7juwCEAE=
              timeCreated: '2020-09-29T13:27:08.286Z'
              updated: '2020-09-29T13:27:08.286Z'
              timeStorageClassUpdated: '2020-09-29T13:27:08.286Z'
            - kind: storage#object
              id: $$bucket$$/prefix/c.txt/1601386029212470
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt?generation=1601386029212470&alt=media
              name: prefix/c.txt
              bucket: $$bucket$$
              generation: '1601386029212470'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CLbGreu7juwCEAE=
              timeCreated: '2020-09-29T13:27:09.212Z'
              updated: '2020-09-29T13:27:09.212Z'
              timeStorageClassUpdated: '2020-09-29T13:27:09.212Z'
            - kind: storage#object
              id: $$bucket$$/prefix/subprefix/c.txt/1601386030223373
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt?generation=1601386030223373&alt=media
              name: prefix/subprefix/c.txt
              bucket: $$bucket$$
              generation: '1601386030223373'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CI2g6+u7juwCEAE=
              timeCreated: '2020-09-29T13:27:10.223Z'
              updated: '2020-09-29T13:27:10.223Z'
              timeStorageClassUpdated: '2020-09-29T13:27:10.223Z'
        repeatable: true
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2F?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 404
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '291'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uyxg25OJ5FOLgcwBVZGBIuckiuw_LMPpyjfo1uxvQ08U-XEHUHTPTMPVIQgNZxU-BoXGDVL2Z7isSLHwbqqMRECT2mEyQ
          body:
            error:
              code: 404
              message: 'No such object: $$bucket$$/c_dir/'
              errors:
              - message: 'No such object: $$bucket$$/c_dir/'
                domain: global
                reason: notFound
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&maxResults=1000&prefix=c_dir&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '32'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UzIfKET9rp--gkbNvt-4Ip9TWkJ62p2ykLS1gtitYRVmHSpYLKtaFZ3mUcNUqcXRDU4D8vGBYgJUPh6Si_osSENqmIHbA
          body:
            kind: storage#objects
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt/copyTo/b/$$bucket$$/o/c_dir%2Fa.txt?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '957'
            content-type: application/json; charset=UTF-8
            etag: CLWzoe67juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uy_EwSRNiju-GN2jokalJjegbu8rwaZggmRcKDS1PDtwkKZCAgdp7Cj8MnlF_xX52-v8FCWW6VYUs3dVa85vzDZdeG18A
          body:
            kind: storage#object
            id: $$bucket$$/c_dir/a.txt/1601386035304885
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fa.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c_dir%2Fa.txt?generation=1601386035304885&alt=media
            name: c_dir/a.txt
            bucket: $$bucket$$
            generation: '1601386035304885'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CLWzoe67juwCEAE=
            timeCreated: '2020-09-29T13:27:15.304Z'
            updated: '2020-09-29T13:27:15.304Z'
            timeStorageClassUpdated: '2020-09-29T13:27:15.304Z'
            owner:
              entity: user-462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt/copyTo/b/$$bucket$$/o/c_dir%2Fc.txt?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '957'
            content-type: application/json; charset=UTF-8
            etag: CKLGr+67juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UwHBZzJ66yckuR_6mcjKHbJCU1PJAmqVb2B-IFrfS8NFtY0pBpUGChQYok_umUGy6RWlQLtgahNBXqd2QBiUbxUoVl7lQ
          body:
            kind: storage#object
            id: $$bucket$$/c_dir/c.txt/1601386035536674
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt?generation=1601386035536674&alt=media
            name: c_dir/c.txt
            bucket: $$bucket$$
            generation: '1601386035536674'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CKLGr+67juwCEAE=
            timeCreated: '2020-09-29T13:27:15.536Z'
            updated: '2020-09-29T13:27:15.536Z'
            timeStorageClassUpdated: '2020-09-29T13:27:15.536Z'
            owner:
              entity: user-462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt/copyTo/b/$$bucket$$/o/c_dir%2Fc.txt?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '957'
            content-type: application/json; charset=UTF-8
            etag: COjtxO67juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UyQmpSNYFKW0n3kf3lzR-bnL_vQkeskhSVoQ9jirTtx3aQxRCm-RGkyoXFfJL4frpHQdSyNOnfPEHe4ghYRrNMzxnvoYA
          body:
            kind: storage#object
            id: $$bucket$$/c_dir/c.txt/1601386035885800
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt?generation=1601386035885800&alt=media
            name: c_dir/c.txt
            bucket: $$bucket$$
            generation: '1601386035885800'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: COjtxO67juwCEAE=
            timeCreated: '2020-09-29T13:27:15.885Z'
            updated: '2020-09-29T13:27:15.885Z'
            timeStorageClassUpdated: '2020-09-29T13:27:15.885Z'
            owner:
              entity: user-462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt/copyTo/b/$$bucket$$/o/c_dir%2Fc.txt?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '957'
            content-type: application/json; charset=UTF-8
            etag: CK6v3e67juwCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UzUeWGvp2y4UfJC6kU-HqmvEyTT5NRBPq6SuFzPQC_i5fUL-nW08y0HA4ZWDf29X39Ooz6L7GyIFjGikkK4nbP3IENCOA
          body:
            kind: storage#object
            id: $$bucket$$/c_dir/c.txt/1601386036287406
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt?generation=1601386036287406&alt=media
            name: c_dir/c.txt
            bucket: $$bucket$$
            generation: '1601386036287406'
            metageneration: '1'
            contentType: application/octet-stream
            storageClass: STANDARD
            size: '8'
            md5Hash: mL99jBV4Two9YyBEQeHiqg==
            crc32c: E2fhmA==
            etag: CK6v3e67juwCEAE=
            timeCreated: '2020-09-29T13:27:16.287Z'
            updated: '2020-09-29T13:27:16.287Z'
            timeStorageClassUpdated: '2020-09-29T13:27:16.287Z'
            owner:
              entity: user-462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
    - expect_exit:
        code: 0
- execute_command:
    command: storage ls gs://$$bucket$$/**
    validation_only: true
    events:
    - expect_stdout: |
        gs://$$bucket$$/a.txt
        gs://$$bucket$$/c.txt
        gs://$$bucket$$/c_dir/a.txt
        gs://$$bucket$$/c_dir/c.txt
        gs://$$bucket$$/prefix/c.txt
        gs://$$bucket$$/prefix/subprefix/c.txt
    - expect_exit:
        code: 0
- execute_command:
    command: storage delete gs://$$bucket$$ --recursive --num-threads=0
    cleanup_for: bucket
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&maxResults=1000
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '5559'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UxUCgKT73Gj9P4c_V1QOV4dbjLq6Vpn2dEr0tBFYJAd-p5fDBJxIKU5p_DVtsOYy95ubGPmNzsrNUOKnSzo-ZyRy9RguQ
          body:
            kind: storage#objects
            items:
            - kind: storage#object
              id: $$bucket$$/a.txt/1601386033655247
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/a.txt?generation=1601386033655247&alt=media
              name: a.txt
              bucket: $$bucket$$
              generation: '1601386033655247'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CM/bvO27juwCEAE=
              timeCreated: '2020-09-29T13:27:13.655Z'
              updated: '2020-09-29T13:27:13.655Z'
              timeStorageClassUpdated: '2020-09-29T13:27:13.655Z'
            - kind: storage#object
              id: $$bucket$$/c.txt/1601386028286962
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c.txt?generation=1601386028286962&alt=media
              name: c.txt
              bucket: $$bucket$$
              generation: '1601386028286962'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CPKH9eq7juwCEAE=
              timeCreated: '2020-09-29T13:27:08.286Z'
              updated: '2020-09-29T13:27:08.286Z'
              timeStorageClassUpdated: '2020-09-29T13:27:08.286Z'
            - kind: storage#object
              id: $$bucket$$/c_dir/a.txt/1601386035304885
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fa.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c_dir%2Fa.txt?generation=1601386035304885&alt=media
              name: c_dir/a.txt
              bucket: $$bucket$$
              generation: '1601386035304885'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CLWzoe67juwCEAE=
              timeCreated: '2020-09-29T13:27:15.304Z'
              updated: '2020-09-29T13:27:15.304Z'
              timeStorageClassUpdated: '2020-09-29T13:27:15.304Z'
            - kind: storage#object
              id: $$bucket$$/c_dir/c.txt/1601386036287406
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt?generation=1601386036287406&alt=media
              name: c_dir/c.txt
              bucket: $$bucket$$
              generation: '1601386036287406'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CK6v3e67juwCEAE=
              timeCreated: '2020-09-29T13:27:16.287Z'
              updated: '2020-09-29T13:27:16.287Z'
              timeStorageClassUpdated: '2020-09-29T13:27:16.287Z'
            - kind: storage#object
              id: $$bucket$$/prefix/c.txt/1601386029212470
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt?generation=1601386029212470&alt=media
              name: prefix/c.txt
              bucket: $$bucket$$
              generation: '1601386029212470'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CLbGreu7juwCEAE=
              timeCreated: '2020-09-29T13:27:09.212Z'
              updated: '2020-09-29T13:27:09.212Z'
              timeStorageClassUpdated: '2020-09-29T13:27:09.212Z'
            - kind: storage#object
              id: $$bucket$$/prefix/subprefix/c.txt/1601386030223373
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt?generation=1601386030223373&alt=media
              name: prefix/subprefix/c.txt
              bucket: $$bucket$$
              generation: '1601386030223373'
              metageneration: '1'
              contentType: application/octet-stream
              storageClass: STANDARD
              size: '8'
              md5Hash: mL99jBV4Two9YyBEQeHiqg==
              crc32c: E2fhmA==
              etag: CI2g6+u7juwCEAE=
              timeCreated: '2020-09-29T13:27:10.223Z'
              updated: '2020-09-29T13:27:10.223Z'
              timeStorageClassUpdated: '2020-09-29T13:27:10.223Z'
    - expect_stderr: |
        WARNING: Deleting a bucket is irreversible and makes that bucket name available for others to claim.
    - expect_prompt_continue:
        message: |-
          This command will delete the following buckets:
            $$bucket$$
        user_input: y
    - expect_prompt_continue:
        message: |-
          You are about to delete the following:
            gs://$$bucket$$
            gs://$$bucket$$/a.txt
            gs://$$bucket$$/c.txt
            gs://$$bucket$$/c_dir/a.txt
            gs://$$bucket$$/c_dir/c.txt
            gs://$$bucket$$/prefix/c.txt
            gs://$$bucket$$/prefix/subprefix/c.txt
        user_input: y
    - expect_progress_bar:
        message: Deleting Files
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uxv99LkEdaL6wMfK0_sgIJgCXcTCn5e2t_hDdfg6nsvP-G3TzHfsMPRnCE7QFEuGdsbzweJ6yCFCkecbdrN7azcswewqA
          body: ''
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uy6nFC3jhHA4QDyUQni5Ir87QSm30Ssz6GsMqQb2Vmq8h5VK7R0o2uf9qgUnBDiCbRRMCoLQ26HqccayvGZNOhDm8RitA
          body: ''
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fa.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-UzVWn5B_zDjZkoAsRR5RvDGzBT9IZiir53IIqUXMtboOAvF2skGDud-DSHzpExsu-DJU6aqlmT5KlKWhu29BFR736uavQ
          body: ''
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/c_dir%2Fc.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uw17UH6HP5dumtKXBTiJC3bQbjK0oU21IKbKmpEekgjsykmdaXxah-v4_Rv7gyYXRE2igyRjFMtdonKyoa24UhFYJJJPA
          body: ''
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fc.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-UxkoCL6aZcvny-BsWOZocmkqV0M76FykL-2x1cGyvlVegmUY9spCioTxsYiRJmrM7PJzbs-NUXZcDD87yJyuj9ceXKRUw
          body: ''
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/prefix%2Fsubprefix%2Fc.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-UwA9WITrZ4xGCWORZEXB3VKvvuQFE6FlZq0XleAMv5UCi4iy4fCT0q0RCsB59uURnpW-cctzeknSN_gZsgq7s84yfdbQA
          body: ''
    - expect_stderr: |2

        Deleted [6] files.
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uw1K9UfvNAj_3G68rEgZz9FT2g2NGkN6mj0FBGBC99-2fkzSygFCmur3-LH0sDe8AkskqB_tIXUGeXK4tinwgMdmHAxIg
          body: ''
    - expect_stderr: |
        Deleted bucket [gs://$$bucket$$].
    - expect_exit:
        code: 0
