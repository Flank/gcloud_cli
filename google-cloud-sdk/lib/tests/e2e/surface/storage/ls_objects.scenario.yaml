title: Test storage ls.
release_tracks: [ALPHA]
filters:
  skip:
    reason: extra assertions - hartunian@ aware of cause and is working on it
    bug: b/168514509
    locally: true
#  DoNotRunOnPy2:  # un-comment this once the skip is removed
#    reason: Storage doesn't support Python 2.
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: storage buckets create $$bucket$$ --format none
  - stderr: |
      Created bucket [$$bucket$$].
- execute:
  - command: storage cp test_data/a.txt gs://$$bucket$$/
  - progress_bar:
    - message: Copying Files
  - stderr: |2

      Copied [1] file.
- execute:
  - command: storage ls gs://$$bucket$$
  - stdout: |
      gs://$$bucket$$/a.txt
- execute:
  - command: storage cp test_data/b.txt gs://$$bucket$$/renamed_b.txt
  - progress_bar:
    - message: Copying Files
  - stderr: |2

      Copied [1] file.
- execute:
  - command: storage ls gs://$$bucket$$
  - stdout: |
      gs://$$bucket$$/a.txt
      gs://$$bucket$$/renamed_b.txt
- execute:
  - command: storage cp test_data/a.txt gs://$$bucket$$/dir/a.txt
  - progress_bar:
    - message: Copying Files
  - stderr: |2

      Copied [1] file.
- execute:
  - command: storage cp test_data/a.txt gs://$$bucket$$/dir/subdir/a.txt
  - progress_bar:
    - message: Copying Files
  - stderr: |2

      Copied [1] file.
- execute:
  - command: storage ls gs://$$bucket$$ -r
  - stdout: |
      gs://$$bucket$$:
  - stdout: |
      gs://$$bucket$$/a.txt
      gs://$$bucket$$/renamed_b.txt

      gs://$$bucket$$/dir/:
  - stdout: |
      gs://$$bucket$$/dir/a.txt

      gs://$$bucket$$/dir/subdir/:
  - stdout: |
      gs://$$bucket$$/dir/subdir/a.txt
- execute:
  - command: storage delete gs://$$bucket$$ --recursive --num-threads=0
  - stderr: |
      WARNING: Deleting a bucket is irreversible and makes that bucket name available for others to claim.
  - prompt:
    - message: |-
        This command will delete the following buckets:
          $$bucket$$
    - input: y
  - prompt:
    - message: |-
        You are about to delete the following:
          gs://$$bucket$$
          gs://$$bucket$$/a.txt
          gs://$$bucket$$/dir/a.txt
          gs://$$bucket$$/dir/subdir/a.txt
          gs://$$bucket$$/renamed_b.txt
    - input: y
  - progress_bar:
    - message: Deleting Files
  - stderr: |2

      Deleted [4] files.
  - stderr: |
      Deleted bucket [gs://$$bucket$$].
actions:
- write_file:
    path: test_data/a.txt
    contents: a.txt contents
- write_file:
    path: test_data/b.txt
    contents: b.txt contents
- generate_resource_id:
    reference: bucket
    prefix: storage-bucket
# Setup.
- execute_command:
    command: storage buckets create $$bucket$$ --format none
    validation_only: true
    events:
    - expect_stderr: |
        Created bucket [$$bucket$$].
    - expect_exit:
        code: 0
- execute_command:
    # Copy a single file to a directory.
    command: storage cp test_data/a.txt gs://$$bucket$$/
    validation_only: true
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&maxResults=1000
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '32'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UzNfCdVlLUq1qvObe_Bwb_nWDvFD1_60OVlCBlZHwSLDtNurWsHliKHBDp95q9qxXRHTnqYi276g8wa5uIjNBs
          body:
            kind: storage#objects
    - expect_progress_bar:
        message: Copying Files
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/upload/storage/v1/b/$$bucket$$/o?alt=json&name=a.txt&uploadType=multipart
          method: POST
          headers: {}
          body:
            text:
              matches: |
                --===============\d+==
                Content-Type: application/json
                MIME-Version: 1.0

                {"size": "14"}
                --===============\d+==
                Content-Type: text/plain
                MIME-Version: 1.0
                Content-Transfer-Encoding: binary

                a.txt contents
                --===============\d+==--
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '801'
            content-type: application/json; charset=UTF-8
            etag: CIqJooCK2usCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uwd_2z1YvFBCURjWgvGZNjKxj89_BJWyNtxV3SaYjw7ZPH-ExYagAH4s71md1PCgP23gX9m1zU62_fmBsQ-Cg
          body:
            kind: storage#object
            id: $$bucket$$/a.txt/1599585944896650
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/a.txt?generation=1599585944896650&alt=media
            name: a.txt
            bucket: $$bucket$$
            generation: '1599585944896650'
            metageneration: '1'
            contentType: text/plain
            storageClass: STANDARD
            size: '14'
            md5Hash: JjNwdnoj+lk0gCNJZMq1RA==
            crc32c: p/7cTg==
            etag: CIqJooCK2usCEAE=
            timeCreated: '2020-09-08T17:25:44.896Z'
            updated: '2020-09-08T17:25:44.896Z'
            timeStorageClassUpdated: '2020-09-08T17:25:44.896Z'
    - expect_stderr: |2

        Copied [1] file.
    - expect_exit:
        code: 0
# Testing.
- execute_command:
    command: storage ls gs://$$bucket$$
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '707'
            content-type: application/json; charset=UTF-8
            etag: CAE=
            x-guploader-uploadid: ABg5-UxFReVnzltGI1TYLhxRE_nM7LRwYD0RMsMNEU4TafGX-BxTpFD9jUoy-ufxeOeVRCnNKvkhzQ287cDXie8HtA
          body:
            kind: storage#bucket
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$
            id: $$bucket$$
            name: $$bucket$$
            projectNumber: '462803083913'
            metageneration: '1'
            location: US
            storageClass: STANDARD
            etag: CAE=
            timeCreated: '2020-09-15T12:32:46.247Z'
            updated: '2020-09-15T12:32:46.247Z'
            versioning:
              enabled: false
            billing:
              requesterPays: false
            iamConfiguration:
              bucketPolicyOnly:
                enabled: false
              uniformBucketLevelAccess:
                enabled: false
            locationType: multi-region
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&fields=prefixes%2Citems%2Fname%2Citems%2Fsize%2Citems%2Fgeneration&maxResults=1000&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '115'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-Uw1qAKw9i2-4Da35omvIkt-j5IiLRVXHEhWgCvZDM_NLv1UqYJVg59ohqWCfVhEO_6gSzh2SQ4c8JedFQMh5w
          body:
            items:
            - name: a.txt
              generation: '1600173166983889'
              size: '14'
    - expect_stdout: |
        gs://$$bucket$$/a.txt
    - expect_exit:
        code: 0
# Setup.
- execute_command:
    # Copy a single file to a file.
    command: storage cp test_data/b.txt gs://$$bucket$$/renamed_b.txt
    validation_only: true
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&maxResults=1000
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '927'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-Ux0WYYrWI6jhfxRkoH_JluJ_itJXVrYz56g94O3EcQDH_fPrelcaM50pUjDj4BFlnFfPlrUsHJNYsxtJGhjkw
          body:
            kind: storage#objects
            items:
            - kind: storage#object
              id: $$bucket$$/a.txt/1599666082287035
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/a.txt?generation=1599666082287035&alt=media
              name: a.txt
              bucket: $$bucket$$
              generation: '1599666082287035'
              metageneration: '1'
              contentType: text/plain
              storageClass: STANDARD
              size: '14'
              md5Hash: JjNwdnoj+lk0gCNJZMq1RA==
              crc32c: p/7cTg==
              etag: CLub4MS03OsCEAE=
              timeCreated: '2020-09-09T15:41:22.286Z'
              updated: '2020-09-09T15:41:22.286Z'
              timeStorageClassUpdated: '2020-09-09T15:41:22.286Z'
    - expect_progress_bar:
        message: Copying Files
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/upload/storage/v1/b/$$bucket$$/o?alt=json&name=renamed_b.txt&uploadType=multipart
          method: POST
          headers: {}
          body:
            text:
              matches: |
                --===============\d+==
                Content-Type: application/json
                MIME-Version: 1.0

                {"size": "14"}
                --===============\d+==
                Content-Type: text/plain
                MIME-Version: 1.0
                Content-Transfer-Encoding: binary

                b.txt contents
                --===============\d+==--
        return_response:
          status: 200
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '833'
            content-type: application/json; charset=UTF-8
            etag: CNv8+Ma03OsCEAE=
            pragma: no-cache
            x-guploader-uploadid: ABg5-UwdCDx3L6Mez-8s2GKSjnawL9EH7nqGzH6cxSBaK9k510-5_m-oWMMuLgZABbP4DVU031vEfwlhJIo5xq3OBRY
          body:
            kind: storage#object
            id: $$bucket$$/renamed_b.txt/1599666086887003
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/renamed_b.txt
            mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/renamed_b.txt?generation=1599666086887003&alt=media
            name: renamed_b.txt
            bucket: $$bucket$$
            generation: '1599666086887003'
            metageneration: '1'
            contentType: text/plain
            storageClass: STANDARD
            size: '14'
            md5Hash: oZ3hz3jEF9fHzeTJKbvbeA==
            crc32c: W/cjhA==
            etag: CNv8+Ma03OsCEAE=
            timeCreated: '2020-09-09T15:41:26.886Z'
            updated: '2020-09-09T15:41:26.886Z'
            timeStorageClassUpdated: '2020-09-09T15:41:26.886Z'
    - expect_stderr: |2

        Copied [1] file.
    - expect_exit:
        code: 0
# Testing.
- execute_command:
    command: storage ls gs://$$bucket$$
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '707'
            content-type: application/json; charset=UTF-8
            etag: CAE=
            x-guploader-uploadid: ABg5-UwzTns8x7qfie7M_FpI8GLL4AdgkCXPmrqyrk3k1XSjZkvIAy2K6De1syHgPqt6ihLLcXavBxCitFW41pnj6A
          body:
            kind: storage#bucket
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$
            id: $$bucket$$
            name: $$bucket$$
            projectNumber: '462803083913'
            metageneration: '1'
            location: US
            storageClass: STANDARD
            etag: CAE=
            timeCreated: '2020-09-15T12:32:46.247Z'
            updated: '2020-09-15T12:32:46.247Z'
            versioning:
              enabled: false
            billing:
              requesterPays: false
            iamConfiguration:
              bucketPolicyOnly:
                enabled: false
              uniformBucketLevelAccess:
                enabled: false
            locationType: multi-region
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&fields=prefixes%2Citems%2Fname%2Citems%2Fsize%2Citems%2Fgeneration&maxResults=1000&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '218'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UyDGoIA5kdtpwff0ZSpW0N17LAbwoq9iux6DZ8Y340tgiXhnenNQ7WwvCgw-N6qg4rxkKCuWV5w8JFwtvD9PQ
          body:
            items:
            - name: a.txt
              generation: '1600173166983889'
              size: '14'
            - name: renamed_b.txt
              generation: '1600173168786809'
              size: '14'
    - expect_stdout: |
        gs://$$bucket$$/a.txt
        gs://$$bucket$$/renamed_b.txt
    - expect_exit:
        code: 0
# Setup.
- execute_command:
    # Copy a single file under a prefix.
    command: storage cp test_data/a.txt gs://$$bucket$$/dir/a.txt
    validation_only: true
    events:
    - expect_progress_bar:
        message: Copying Files
    - expect_stderr: |2

        Copied [1] file.
    - expect_exit:
        code: 0
- execute_command:
    # Copy a single file under a nested prefix.
    command: storage cp test_data/a.txt gs://$$bucket$$/dir/subdir/a.txt
    validation_only: true
    events:
    - expect_progress_bar:
        message: Copying Files
    - expect_stderr: |2

        Copied [1] file.
    - expect_exit:
        code: 0
# Testing.
- execute_command:
    command: storage ls gs://$$bucket$$ -r
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$?alt=json&projection=noAcl
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '707'
            content-type: application/json; charset=UTF-8
            etag: CAE=
            x-guploader-uploadid: ABg5-Ux4U6Ul0MNy4GYhyEUFWKegL5xQi0bRuXEYegbWquHsCt-xJUwF7TDHhUsFabOkS_2ixmcGzNqmrFLPMd2wfA
          body:
            kind: storage#bucket
            selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$
            id: $$bucket$$
            name: $$bucket$$
            projectNumber: '462803083913'
            metageneration: '1'
            location: US
            storageClass: STANDARD
            etag: CAE=
            timeCreated: '2020-09-15T12:32:46.247Z'
            updated: '2020-09-15T12:32:46.247Z'
            versioning:
              enabled: false
            billing:
              requesterPays: false
            iamConfiguration:
              bucketPolicyOnly:
                enabled: false
              uniformBucketLevelAccess:
                enabled: false
            locationType: multi-region
    - expect_stdout: |
        gs://$$bucket$$:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&fields=prefixes%2Citems%2Fname%2Citems%2Fsize%2Citems%2Fgeneration&maxResults=1000&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '250'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UyhLoXDjsL57jWzMPXL4ZKgaD6WuPTUoU83K7qNBrI4yUXOjceMcTkddLMKr6c6O9A131QpRMqS8fLmPwek9w
          body:
            prefixes:
            - dir/
            items:
            - name: a.txt
              generation: '1600173166983889'
              size: '14'
            - name: renamed_b.txt
              generation: '1600173168786809'
              size: '14'
    - expect_stdout: |
        gs://$$bucket$$/a.txt
        gs://$$bucket$$/renamed_b.txt

        gs://$$bucket$$/dir/:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&fields=prefixes%2Citems%2Fname%2Citems%2Fsize%2Citems%2Fgeneration&maxResults=1000&prefix=dir%2F&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '158'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-Ux6D6OgwmyCWDp3nagW1GJPc7BC7RvGo9B93nHKr3Imoa5Mg7rJp1ZHREDGS8gvFpitBFM4M8WBtpoY7VYrnVSoJrIzzg
          body:
            prefixes:
            - dir/subdir/
            items:
            - name: dir/a.txt
              generation: '1600173170086924'
              size: '14'
    - expect_stdout: |
        gs://$$bucket$$/dir/a.txt

        gs://$$bucket$$/dir/subdir/:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&delimiter=%2F&fields=prefixes%2Citems%2Fname%2Citems%2Fsize%2Citems%2Fgeneration&maxResults=1000&prefix=dir%2Fsubdir%2F&projection=noAcl&versions=False
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '126'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UyQfmp_FZjGDQxu8waKKtAm8l9CX-8U6BSDevVKoNTyKIh8kKifbywGP8F3Q1dag2_zFaxMPSN43Q5Pyke7QMNfguwLIQ
          body:
            items:
            - name: dir/subdir/a.txt
              generation: '1600173170797592'
              size: '14'
    - expect_stdout: |
        gs://$$bucket$$/dir/subdir/a.txt
    - expect_exit:
        code: 0
# Tear down.
- execute_command:
    command: storage delete gs://$$bucket$$ --recursive --num-threads=0
    cleanup_for: bucket
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o?alt=json&maxResults=1000
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '3665'
            content-type: application/json; charset=UTF-8
            x-guploader-uploadid: ABg5-UzdmHi-U_tnwmuyCV8Mq304RSa0xmvLLvDaXL4_zPTXA7HL8TD0LdoqVAqn8QWwLaIr215eYTx27u6OtSDLuJw
          body:
            kind: storage#objects
            items:
            - kind: storage#object
              id: $$bucket$$/a.txt/1600173166983889
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/a.txt?generation=1600173166983889&alt=media
              name: a.txt
              bucket: $$bucket$$
              generation: '1600173166983889'
              metageneration: '1'
              contentType: text/plain
              storageClass: STANDARD
              size: '14'
              md5Hash: JjNwdnoj+lk0gCNJZMq1RA==
              crc32c: p/7cTg==
              etag: CNH1ycmV6+sCEAE=
              timeCreated: '2020-09-15T12:32:46.983Z'
              updated: '2020-09-15T12:32:46.983Z'
              timeStorageClassUpdated: '2020-09-15T12:32:46.983Z'
            - kind: storage#object
              id: $$bucket$$/dir/a.txt/1600173170086924
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/dir%2Fa.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/dir%2Fa.txt?generation=1600173170086924&alt=media
              name: dir/a.txt
              bucket: $$bucket$$
              generation: '1600173170086924'
              metageneration: '1'
              contentType: text/plain
              storageClass: STANDARD
              size: '14'
              md5Hash: JjNwdnoj+lk0gCNJZMq1RA==
              crc32c: p/7cTg==
              etag: CIyoh8uV6+sCEAE=
              timeCreated: '2020-09-15T12:32:50.086Z'
              updated: '2020-09-15T12:32:50.086Z'
              timeStorageClassUpdated: '2020-09-15T12:32:50.086Z'
            - kind: storage#object
              id: $$bucket$$/dir/subdir/a.txt/1600173170797592
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/dir%2Fsubdir%2Fa.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/dir%2Fsubdir%2Fa.txt?generation=1600173170797592&alt=media
              name: dir/subdir/a.txt
              bucket: $$bucket$$
              generation: '1600173170797592'
              metageneration: '1'
              contentType: text/plain
              storageClass: STANDARD
              size: '14'
              md5Hash: JjNwdnoj+lk0gCNJZMq1RA==
              crc32c: p/7cTg==
              etag: CJjYssuV6+sCEAE=
              timeCreated: '2020-09-15T12:32:50.797Z'
              updated: '2020-09-15T12:32:50.797Z'
              timeStorageClassUpdated: '2020-09-15T12:32:50.797Z'
            - kind: storage#object
              id: $$bucket$$/renamed_b.txt/1600173168786809
              selfLink: https://www.googleapis.com/storage/v1/b/$$bucket$$/o/renamed_b.txt
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/$$bucket$$/o/renamed_b.txt?generation=1600173168786809&alt=media
              name: renamed_b.txt
              bucket: $$bucket$$
              generation: '1600173168786809'
              metageneration: '1'
              contentType: text/plain
              storageClass: STANDARD
              size: '14'
              md5Hash: oZ3hz3jEF9fHzeTJKbvbeA==
              crc32c: W/cjhA==
              etag: CPn6t8qV6+sCEAE=
              timeCreated: '2020-09-15T12:32:48.786Z'
              updated: '2020-09-15T12:32:48.786Z'
              timeStorageClassUpdated: '2020-09-15T12:32:48.786Z'
    - expect_stderr: |
        WARNING: Deleting a bucket is irreversible and makes that bucket name available for others to claim.
    - expect_prompt_continue:
        message: |-
          This command will delete the following buckets:
            $$bucket$$
        user_input: y
    - expect_prompt_continue:
        message: |-
          You are about to delete the following:
            gs://$$bucket$$
            gs://$$bucket$$/a.txt
            gs://$$bucket$$/dir/a.txt
            gs://$$bucket$$/dir/subdir/a.txt
            gs://$$bucket$$/renamed_b.txt
        user_input: y
    - expect_progress_bar:
        message: Deleting Files
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/a.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-UxoIEGjyP8ZVFjjkDu69Qy89s3PNYbA3KVzZPI7dmdscK7dIp5bZEpVDOfoUpWb92TVI_HHgNmFCksWBnVdwg
          body: ''
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/dir%2Fa.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uy5wNK8mbOXwtkJdDhWNTr7-h6yg49F11PcJy-x4PrWD-NUGx2S3cilNzv8Cn5l1O1PpN3oJ0wFsyLdIS7pLA7zSQS0rA
          body: ''
        repeatable: true
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/dir%2Fsubdir%2Fa.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-UyandHfnrUhiR674BT9QvIutNU9vH5PmMullznTwHJxfmPE33ELONAlBmpQuNLKbSaA_HoMZE79QAASs24YhQ
          body: ''
        repeatable: true
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$/o/renamed_b.txt?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-Uz7yRArhK75ppv79tHcIYgrfqK4klQNbe1XErEsSenjdn0wCjCUuVP80Z5O3oTe78lFhQk03-Jz8XuNInezAZ21hFRPkg
          body: ''
    - expect_stderr: |2

        Deleted [4] files.
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/$$bucket$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          status: 204
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '0'
            content-type: application/json
            pragma: no-cache
            x-guploader-uploadid: ABg5-UyyBFjz71y9kEL6poDhC0esER4fkN-RzaM98aj9JSlgMgmpXmFRvFQHyx5Sli98ruUpmdG7Hfp3Nnftw_80WA
          body: ''
    - expect_stderr: |
        Deleted bucket [gs://$$bucket$$].
    - expect_exit:
        code: 0
