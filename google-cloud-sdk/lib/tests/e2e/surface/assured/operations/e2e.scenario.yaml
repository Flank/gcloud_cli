title: List workloads
release_tracks: [BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: assured workloads create --organization=531459884741 --location=us-central1
      --display-name=$$workload-display-name$$ --compliance-regime=FEDRAMP_MODERATE
      --billing-account="billingAccounts/0172AD-FDF25F-A4A2E9" --next-rotation-time=2040-1-30T10:15:00.00Z
      --rotation-period=172800s --external-identifier gcloud-2e2
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - progress_tracker:
    - message: Creating Assured Workloads environment
    - status: SUCCESS
  - stderr: Created\ Assured\ Workloads\ environment\ \[organizations/531459884741/locations/us-central1/workloads/.*].$
- execute:
  - command: assured operations list --organization=531459884741 --location=us-central1
      --page-size=10 --limit=10
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stdout: .*$$operation$$.*$
- execute:
  - command: assured operations describe $$operation$$
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stdout: .*$$operation$$.*$
- execute:
  - command: projects delete $$proj0$$
  - prompt:
    - message: Your project will be deleted.
    - input: y
  - stderr: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj0$$.*$
- execute:
  - command: projects delete $$proj1$$
  - prompt:
    - message: Your project will be deleted.
    - input: y
  - stderr: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj1$$.*$
- execute:
  - command: assured workloads delete $$workload$$
  - prompt:
    - message: You are about to delete Workload [$$workload$$]
    - input: y
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stderr: |
      Deleted Assured Workloads environment [$$workload$$].
actions:
- generate_resource_id:
    reference: workload-display-name
    prefix: gcloud  # the generated ID must be under <=30 long - field limit
    requires_cleanup: false
- execute_command:
    # Create a new operation to be queried
    command: assured workloads create --organization=531459884741 --location=us-central1
      --display-name=$$workload-display-name$$ --compliance-regime=FEDRAMP_MODERATE
      --billing-account="billingAccounts/0172AD-FDF25F-A4A2E9" --next-rotation-time=2040-1-30T10:15:00.00Z
      --rotation-period=172800s --external-identifier gcloud-2e2
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        poll_operation: false
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/workloads?alt=json&externalId=gcloud-2e2
          method: POST
          body:
            text:
              is_none: false
        return_response:
          headers:
            cache-control: private
            content-length: '448'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/b93333a4-9eeb-479a-94b2-d12616a5ece8
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-10-02T11:24:30.439033Z'
              displayName: $$workload-display-name$$
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
          status: 200
        expect_response:
          extract_references:
          - field: name
            reference: operation
          body:
            text:
              matches: .*name\":\s\"organizations/531459884741/locations/us-central1/operations/.+
    - api_call:
        repeatable: true
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$operation$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '1041'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/b93333a4-9eeb-479a-94b2-d12616a5ece8
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-10-02T11:24:30.439033Z'
              displayName: $$workload-display-name$$
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
            done: true
            response:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
              name: organizations/531459884741/locations/us-central1/workloads/00-23465740-ff6e-497b-8935-f84
              displayName: $$workload-display-name$$
              resources:
              - resourceId: '231123688627'
              - resourceId: '10682046510'
              complianceRegime: FEDRAMP_MODERATE
              createTime: '2020-10-02T11:24:43.587Z'
              etag: '26331515'
              labels:
                goog-aw-external-identifier: gcloud-2e2
    - expect_progress_tracker:
        message: Creating Assured Workloads environment
        status: SUCCESS
    - api_call:
        expect_request:
          uri:
            matches: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/workloads/[0-9a-z\-]+\?alt=json
          method: GET
          body: None
        return_response:
          body:
            name: organizations/531459884741/locations/us-central1/workloads/00-23465740-ff6e-497b-8935-f84
            displayName: $$workload-display-name$$
            resources:
            - resourceId: '10682046510'
            - resourceId: '231123688627'
            complianceRegime: FEDRAMP_MODERATE
            createTime: '2020-10-02T11:24:43.587Z'
            etag: '26331515'
            labels:
              goog-aw-external-identifier: gcloud-2e2
          status: 200
          headers:
            cache-control: private
            content-length: '445'
            content-type: application/json; charset=UTF-8
        expect_response:
          extract_references:
          - field: name
            reference: workload
          - field: etag
            reference: workload-etag
          - field: resources[0].resourceId
            reference: proj0
          - field: resources[1].resourceId
            reference: proj1
          body:
            json: {}
    - expect_stderr:
        matches: Created\ Assured\ Workloads\ environment\ \[organizations/531459884741/locations/us-central1/workloads/.*].
    - expect_exit:
        code: 0
- execute_command:
    # List operations
    command: assured operations list --organization=531459884741 --location=us-central1
      --page-size=10 --limit=10
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/operations?alt=json&pageSize=10
          method: GET
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '11615'
            content-type: application/json; charset=UTF-8
          body:
            operations:
            - name: organizations/531459884741/locations/us-central1/operations/b93333a4-9eeb-479a-94b2-d12616a5ece8
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T11:24:30.439033Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-23465740-ff6e-497b-8935-f84
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '231123688627'
                - resourceId: '10682046510'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T11:24:43.587Z'
                etag: '26331515'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/378e56de-8705-477e-9b10-4f7d6f2f11b9
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T11:18:46.030299Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-dd5e4ea8-e1dc-4bf1-a211-70e
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '1007868254002'
                - resourceId: '676545047134'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T11:18:58.953Z'
                etag: '1996428539'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/d8ffcdb1-1485-49d2-853f-7fadc51cb611
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T11:05:25.579441Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-1a193932-3d6c-4a76-ac15-537
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '894455625902'
                - resourceId: '219549683303'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T11:05:38.669Z'
                etag: '-1190378926'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/d2544b2a-b7b5-4727-b4fe-a4e07dda3f8c
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T10:59:54.641714Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-e83fdd03-170b-4bd2-9318-39b
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '183908355425'
                - resourceId: '491375210389'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T11:00:07.356Z'
                etag: '122216927'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/aa2d8b56-e293-4a64-9971-73d2bc0d4470
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T10:58:34.660783Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-81af745f-cd48-4669-abf3-510
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '881753544720'
                - resourceId: '170735694143'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T10:58:47.167Z'
                etag: '-397111561'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/26b8c813-c3e3-4a79-bf23-d7f33617060c
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T10:39:42.769764Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-7dccecf2-a0a5-4ad8-8287-77c
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '450035048053'
                - resourceId: '757872518786'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T10:39:55.342Z'
                etag: '811684715'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/3b793398-8958-4527-b787-01ae2efe9193
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T09:05:41.290957Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-58bcc31b-8800-4623-a6e0-a29
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '1090161181713'
                - resourceId: '912976389387'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T09:05:54.159Z'
                etag: '-757433334'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/dc4f0600-e029-4deb-9f45-20f5c8d74be9
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T09:05:10.019769Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-8772a275-140b-4f46-902f-dfc
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '178269295561'
                - resourceId: '510667262326'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T09:05:22.297Z'
                etag: '1190050338'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/aa4f68eb-4c72-4693-a6e7-ba4e393cccfb
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T08:36:34.505074Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-5ca9b517-f4a4-4b5c-8547-0c2
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '661359985476'
                - resourceId: '371893914070'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T08:36:47.167Z'
                etag: '-925072081'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/c845f091-77d1-42b2-b009-feb95a7060b9
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-10-02T08:34:15.567585Z'
                displayName: $$workload-display-name$$
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-d948320b-0167-4641-93cd-406
                displayName: $$workload-display-name$$
                resources:
                - resourceId: '285023127361'
                - resourceId: '337657584365'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-10-02T08:34:27.872Z'
                etag: '933298411'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            nextPageToken: CjAKBgiHzNv7BQomKiRjODQ1ZjA5MS03N2QxLTQyYjItYjAwOS1mZWI5NWE3MDYwYjk=
          status: 200
    - expect_stdout:
        matches: .*$$operation$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Get operation
    command: assured operations describe $$operation$$
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        repeatable: true
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$operation$$?alt=json
          method: GET
          body: null
        expect_response:
          body:
            json:
              name: $$operation$$
        return_response:
          headers:
            cache-control: private
            content-length: '1041'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/b93333a4-9eeb-479a-94b2-d12616a5ece8
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-10-02T11:24:30.439033Z'
              displayName: $$workload-display-name$$
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
            done: true
            response:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
              name: organizations/531459884741/locations/us-central1/workloads/00-23465740-ff6e-497b-8935-f84
              displayName: $$workload-display-name$$
              resources:
              - resourceId: '231123688627'
              - resourceId: '10682046510'
              complianceRegime: FEDRAMP_MODERATE
              createTime: '2020-10-02T11:24:43.587Z'
              etag: '26331515'
              labels:
                goog-aw-external-identifier: gcloud-2e2
          status: 200
    - expect_stdout:
        matches: .*$$operation$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete workload project 0
    command: projects delete $$proj0$$
    validation_only: true
    events:
    - expect_prompt_continue:
        message: Your project will be deleted.
        user_input: y
    - expect_stderr:
        matches: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj0$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete workload project 1
    command: projects delete $$proj1$$
    validation_only: true
    events:
    - expect_prompt_continue:
        message: Your project will be deleted.
        user_input: y
    - expect_stderr:
        matches: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj1$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete created workload
    command: assured workloads delete $$workload$$
    events:
    - expect_prompt_continue:
        message: You are about to delete Workload [$$workload$$]
        user_input: y
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$workload$$?alt=json
          method: DELETE
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3'
            content-type: application/json; charset=UTF-8
          body: |
            {}
          status: 200
    - expect_stderr: |
        Deleted Assured Workloads environment [$$workload$$].
    - expect_exit:
        code: 0
