title: List workloads
release_tracks: [BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: assured workloads create --organization=531459884741 --location=us-central1
      --display-name=gcloud-e2e-workloads --compliance-regime=FEDRAMP_MODERATE --billing-account="billingAccounts/0172AD-FDF25F-A4A2E9"
      --next-rotation-time=2040-1-30T10:15:00.00Z --rotation-period=172800s --external-identifier
      gcloud-2e2
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - progress_tracker:
    - message: Creating Assured Workloads environment
    - status: SUCCESS
  - stderr: Created\ Assured\ Workloads\ environment\ \[organizations/531459884741/locations/us-central1/workloads/.*].$
- execute:
  - command: assured operations list --organization=531459884741 --location=us-central1
      --page-size=10 --limit=10
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stdout: .*$$operation$$.*$
- execute:
  - command: assured operations describe $$operation$$
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stdout: .*$$operation$$.*$
- execute:
  - command: projects delete $$proj0$$
  - prompt:
    - message: Your project will be deleted.
    - input: y
  - stderr: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj0$$.*$
- execute:
  - command: projects delete $$proj1$$
  - prompt:
    - message: Your project will be deleted.
    - input: y
  - stderr: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj1$$.*$
- execute:
  - command: assured workloads delete $$workload$$
  - prompt:
    - message: You are about to delete Workload [$$workload$$]
    - input: y
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stderr: |
      Deleted Assured Workloads environment [$$workload$$].
actions:
- execute_command:
    # Create a new operation to be queried
    command: assured workloads create --organization=531459884741 --location=us-central1
      --display-name=gcloud-e2e-workloads --compliance-regime=FEDRAMP_MODERATE --billing-account="billingAccounts/0172AD-FDF25F-A4A2E9"
      --next-rotation-time=2040-1-30T10:15:00.00Z --rotation-period=172800s --external-identifier
      gcloud-2e2
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        poll_operation: false
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/workloads?alt=json&externalId=gcloud-2e2
          method: POST
          body:
            text:
              is_none: false
        return_response:
          headers:
            cache-control: private
            content-length: '441'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/43c42e85-782b-4e98-9662-469a381494e2
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-09-11T10:51:51.767961Z'
              displayName: gcloud-e2e-workloads
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
          status: 200
        expect_response:
          extract_references:
          - field: name
            reference: operation
          body:
            text:
              matches: .*name\":\s\"organizations/531459884741/locations/us-central1/operations/.+
    - api_call:
        repeatable: true
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$operation$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '1030'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/43c42e85-782b-4e98-9662-469a381494e2
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-09-11T10:51:51.767961Z'
              displayName: gcloud-e2e-workloads
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
            done: true
            response:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
              name: organizations/531459884741/locations/us-central1/workloads/00-4aabf26c-c68e-4236-8738-084
              displayName: gcloud-e2e-workloads
              resources:
              - resourceId: '86122320567'
              - resourceId: '531115146655'
              complianceRegime: FEDRAMP_MODERATE
              createTime: '2020-09-11T10:52:03.653Z'
              etag: '-1566636141'
              labels:
                goog-aw-external-identifier: gcloud-2e2
    - expect_progress_tracker:
        message: Creating Assured Workloads environment
        status: SUCCESS
    - api_call:
        expect_request:
          uri:
            matches: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/workloads/[0-9a-z\-]+\?alt=json
          method: GET
          body: None
        return_response:
          body:
            name: organizations/531459884741/locations/us-central1/workloads/00-4aabf26c-c68e-4236-8738-084
            displayName: gcloud-e2e-workloads
            resources:
            - resourceId: '86122320567'
            - resourceId: '531115146655'
            complianceRegime: FEDRAMP_MODERATE
            createTime: '2020-09-11T10:52:03.653Z'
            etag: '-1566636141'
            labels:
              goog-aw-external-identifier: gcloud-2e2
          status: 200
          headers:
            cache-control: private
            content-length: '441'
            content-type: application/json; charset=UTF-8
        expect_response:
          extract_references:
          - field: name
            reference: workload
          - field: etag
            reference: workload-etag
          - field: resources[0].resourceId
            reference: proj0
          - field: resources[1].resourceId
            reference: proj1
          body:
            json: {}
    - expect_stderr:
        matches: Created\ Assured\ Workloads\ environment\ \[organizations/531459884741/locations/us-central1/workloads/.*].
    - expect_exit:
        code: 0
- execute_command:
    # List operations
    command: assured operations list --organization=531459884741 --location=us-central1
      --page-size=10 --limit=10
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/operations?alt=json&pageSize=10
          method: GET
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '11625'
            content-type: application/json; charset=UTF-8
          body:
            operations:
            - name: organizations/531459884741/locations/us-central1/operations/43c42e85-782b-4e98-9662-469a381494e2
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T10:51:51.767961Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-4aabf26c-c68e-4236-8738-084
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '86122320567'
                - resourceId: '531115146655'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T10:52:03.653Z'
                etag: '-1566636141'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/6606dd11-0768-45c9-afa6-6423568d37e2
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T10:48:15.051981Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-83562af2-e297-4530-b0e1-182
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '998275154822'
                - resourceId: '925681295020'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T10:48:26.963Z'
                etag: '794605754'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/a03d79a5-79c1-4650-995c-c1bc33e90ae6
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T10:47:48.778616Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-a0117331-69f8-4be6-956a-d4b
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '965185631677'
                - resourceId: '571865101671'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T10:48:01.158Z'
                etag: '-1864411607'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/f5b13fbc-3c9b-4481-9a0b-1a801310e0e8
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T10:47:36.665874Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-5d531606-a7f5-4e7a-8061-79a
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '308983945081'
                - resourceId: '758444579940'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T10:47:48.533Z'
                etag: '380599196'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/30621269-cfeb-48ba-b948-201aabed8442
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T10:44:53.717039Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-28c33e0f-3544-4877-aa80-404
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '82049547450'
                - resourceId: '756750800258'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T10:45:06.365Z'
                etag: '1190838330'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/f9e0e101-ccd5-46e4-ae3b-505f3049a2c9
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T10:29:48.701762Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-1a43b2e2-f214-4868-9b0c-b58
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '1049960351242'
                - resourceId: '1033712123195'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T10:30:01.949Z'
                etag: '110133649'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/703f437c-a5f1-49e2-abf0-0981ec4211cf
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T08:49:48.935335Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-3ae67a51-8b0f-4992-929d-b9e
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '785636701327'
                - resourceId: '422669275485'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T08:50:01.209Z'
                etag: '980310313'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/f7027732-693b-4097-8872-01a758edba88
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T08:47:17.808169Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-266a8455-8aac-4a73-aff8-249
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '825845509519'
                - resourceId: '313606069961'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T08:47:29.826Z'
                etag: '-1973832207'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/c2c2c8aa-dc99-48ad-ac42-788ce562a172
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T08:47:04.657611Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-3bb2977e-7c11-44db-826d-18d
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '994963098336'
                - resourceId: '648691856391'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T08:47:16.347Z'
                etag: '-427396444'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/f8e8d958-6800-41b3-ab86-e13291582130
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-11T08:44:22.973587Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-c3a85f02-d070-4899-9d88-03f
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '651758192467'
                - resourceId: '425477775207'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-11T08:44:34.754Z'
                etag: '-998455086'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            nextPageToken: CjAKBgjm8ez6BQomKiRmOGU4ZDk1OC02ODAwLTQxYjMtYWI4Ni1lMTMyOTE1ODIxMzA=
          status: 200
    - expect_stdout:
        matches: .*$$operation$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Get operation
    command: assured operations describe $$operation$$
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        repeatable: true
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$operation$$?alt=json
          method: GET
          body: null
        expect_response:
          body:
            json:
              name: $$operation$$
        return_response:
          headers:
            cache-control: private
            content-length: '1030'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/43c42e85-782b-4e98-9662-469a381494e2
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-09-11T10:51:51.767961Z'
              displayName: gcloud-e2e-workloads
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
            done: true
            response:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
              name: organizations/531459884741/locations/us-central1/workloads/00-4aabf26c-c68e-4236-8738-084
              displayName: gcloud-e2e-workloads
              resources:
              - resourceId: '86122320567'
              - resourceId: '531115146655'
              complianceRegime: FEDRAMP_MODERATE
              createTime: '2020-09-11T10:52:03.653Z'
              etag: '-1566636141'
              labels:
                goog-aw-external-identifier: gcloud-2e2
          status: 200
    - expect_stdout:
        matches: .*$$operation$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete workload project 0
    command: projects delete $$proj0$$
    validation_only: true
    events:
    - expect_prompt_continue:
        message: Your project will be deleted.
        user_input: y
    - expect_stderr:
        matches: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj0$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete workload project 1
    command: projects delete $$proj1$$
    validation_only: true
    events:
    - expect_prompt_continue:
        message: Your project will be deleted.
        user_input: y
    - expect_stderr:
        matches: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj1$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete created workload
    command: assured workloads delete $$workload$$
    events:
    - expect_prompt_continue:
        message: You are about to delete Workload [$$workload$$]
        user_input: y
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$workload$$?alt=json
          method: DELETE
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3'
            content-type: application/json; charset=UTF-8
          body: |
            {}
          status: 200
    - expect_stderr: |
        Deleted Assured Workloads environment [$$workload$$].
    - expect_exit:
        code: 0
