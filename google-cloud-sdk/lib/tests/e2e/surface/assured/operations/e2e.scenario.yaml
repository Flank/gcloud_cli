title: List workloads
release_tracks: [BETA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: assured workloads create --organization=531459884741 --location=us-central1
      --display-name=gcloud-e2e-workloads --compliance-regime=FEDRAMP_MODERATE --billing-account="billingAccounts/0172AD-FDF25F-A4A2E9"
      --next-rotation-time=2040-1-30T10:15:00.00Z --rotation-period=172800s --external-identifier
      gcloud-2e2
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - progress_tracker:
    - message: Creating Assured Workloads environment
    - status: SUCCESS
  - stderr: Created\ Assured\ Workloads\ environment\ \[organizations/531459884741/locations/us-central1/workloads/.*].$
- execute:
  - command: assured operations list organizations/531459884741/locations/us-central1
      --page-size=10 --limit=10
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stdout: .*$$operation$$.*$
- execute:
  - command: assured operations describe $$operation$$
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stdout: .*$$operation$$.*$
- execute:
  - command: projects delete $$proj0$$
  - prompt:
    - message: Your project will be deleted.
    - input: y
  - stderr: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj0$$.*$
- execute:
  - command: projects delete $$proj1$$
  - prompt:
    - message: Your project will be deleted.
    - input: y
  - stderr: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj1$$.*$
- execute:
  - command: assured workloads delete $$workload$$
  - prompt:
    - message: You are about to delete Workload [$$workload$$]
    - input: y
  - stderr: |
      Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
  - stderr: |
      Deleted Assured Workloads environment [$$workload$$].
actions:
- execute_command:
    # Create a new operation to be queried
    command: assured workloads create --organization=531459884741 --location=us-central1
      --display-name=gcloud-e2e-workloads --compliance-regime=FEDRAMP_MODERATE --billing-account="billingAccounts/0172AD-FDF25F-A4A2E9"
      --next-rotation-time=2040-1-30T10:15:00.00Z --rotation-period=172800s --external-identifier
      gcloud-2e2
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        poll_operation: false
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/workloads?alt=json&externalId=gcloud-2e2
          method: POST
          body:
            text:
              is_none: false
        return_response:
          headers:
            cache-control: private
            content-length: '441'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/c0d597da-796e-42dd-8344-2c59f3c36bfc
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-09-03T14:11:25.563941Z'
              displayName: gcloud-e2e-workloads
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
          status: 200
        expect_response:
          extract_references:
          - field: name
            reference: operation
          body:
            text:
              matches: .*name\":\s\"organizations/531459884741/locations/us-central1/operations/.+
    - api_call:
        repeatable: true
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$operation$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '1029'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/c0d597da-796e-42dd-8344-2c59f3c36bfc
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-09-03T14:11:25.563941Z'
              displayName: gcloud-e2e-workloads
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
            done: true
            response:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
              name: organizations/531459884741/locations/us-central1/workloads/00-e7f928e1-2a22-4a44-92ed-eb2
              displayName: gcloud-e2e-workloads
              resources:
              - resourceId: '52455744616'
              - resourceId: '1023952579958'
              complianceRegime: FEDRAMP_MODERATE
              createTime: '2020-09-03T14:11:37.617Z'
              etag: '939948929'
              labels:
                goog-aw-external-identifier: gcloud-2e2
    - expect_progress_tracker:
        message: Creating Assured Workloads environment
        status: SUCCESS
    - api_call:
        expect_request:
          uri:
            matches: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/workloads/[0-9a-z\-]+\?alt=json
          method: GET
          body: None
        return_response:
          body:
            name: organizations/531459884741/locations/us-central1/workloads/00-e7f928e1-2a22-4a44-92ed-eb2
            displayName: gcloud-e2e-workloads
            resources:
            - resourceId: '52455744616'
            - resourceId: '1023952579958'
            complianceRegime: FEDRAMP_MODERATE
            createTime: '2020-09-03T14:11:37.617Z'
            etag: '939948929'
            labels:
              goog-aw-external-identifier: gcloud-2e2
          status: 200
          headers:
            cache-control: private
            content-length: '440'
            content-type: application/json; charset=UTF-8
        expect_response:
          extract_references:
          - field: name
            reference: workload
          - field: etag
            reference: workload-etag
          - field: resources[0].resourceId
            reference: proj0
          - field: resources[1].resourceId
            reference: proj1
          body:
            json: {}
    - expect_stderr:
        matches: Created\ Assured\ Workloads\ environment\ \[organizations/531459884741/locations/us-central1/workloads/.*].
    - expect_exit:
        code: 0
- execute_command:
    # List operations
    command: assured operations list organizations/531459884741/locations/us-central1
      --page-size=10 --limit=10
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/organizations/531459884741/locations/us-central1/operations?alt=json&pageSize=10
          method: GET
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '11629'
            content-type: application/json; charset=UTF-8
          body:
            operations:
            - name: organizations/531459884741/locations/us-central1/operations/c0d597da-796e-42dd-8344-2c59f3c36bfc
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T14:11:25.563941Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-e7f928e1-2a22-4a44-92ed-eb2
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '52455744616'
                - resourceId: '1023952579958'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T14:11:37.617Z'
                etag: '939948929'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/abc12a54-f58b-4fec-93e2-3e9592e965fe
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T14:09:24.251125Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-7920da6b-c993-4176-8343-dc7
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '633368400761'
                - resourceId: '398374806135'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T14:09:36.679Z'
                etag: '-570877488'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/01c3de96-8739-4d02-abb4-634904d02008
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T14:06:27.225478Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-623f5087-f439-4341-8d54-21d
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '94945862203'
                - resourceId: '357658058341'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T14:06:39.732Z'
                etag: '-2097462961'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/c80f96a9-4fbb-4945-9e94-219b8b10451e
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T14:03:26.562367Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-d558e871-112f-4199-a15f-1f6
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '1000631042501'
                - resourceId: '820530794440'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T14:03:38.717Z'
                etag: '1167406154'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/9d857738-d97d-455b-b24a-2ab5b172d01a
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T13:59:57.144738Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-6e89f5b1-453c-4c54-9757-4c4
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '162087458085'
                - resourceId: '1084632513629'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T14:00:09.184Z'
                etag: '1037675721'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/7f6fa3c2-1564-41eb-9a42-7725043c9c8f
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T13:47:33.667685Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-675f8021-6b9d-4da8-985b-092
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '1027491750632'
                - resourceId: '951706912388'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T13:47:45.683Z'
                etag: '-573428799'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/64eb0fb0-e7fd-4218-b253-3a200f559943
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T13:45:35.228264Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-a40e4312-3fdc-477c-8fd1-0ee
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '85723279793'
                - resourceId: '1005020768694'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T13:45:47.028Z'
                etag: '-1126762845'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/2fb29f56-e065-4006-bc97-1132ad9533ac
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T13:36:29.926588Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-45ec8277-a939-4459-828a-ff0
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '488344945630'
                - resourceId: '263099510396'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T13:36:42.678Z'
                etag: '-644574462'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/d035d2e1-478f-4369-bee7-2ae0fd075761
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T12:42:25.796069Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-9add0bbe-2627-48a8-b1d1-884
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '409489774236'
                - resourceId: '1007483328483'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T12:42:38.002Z'
                etag: '-638694338'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            - name: organizations/531459884741/locations/us-central1/operations/ffde499e-6cf2-48ed-b3bf-51fd273959e1
              metadata:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
                createTime: '2020-09-03T12:08:42.731349Z'
                displayName: gcloud-e2e-workloads
                parent: organizations/531459884741/locations/us-central1
                complianceRegime: FEDRAMP_MODERATE
              done: true
              response:
                '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
                name: organizations/531459884741/locations/us-central1/workloads/00-c98cfeee-7bc9-40f4-89a0-a2b
                displayName: gcloud-e2e-workloads
                resources:
                - resourceId: '615848089445'
                - resourceId: '677011884675'
                complianceRegime: FEDRAMP_MODERATE
                createTime: '2020-09-03T12:08:54.279Z'
                etag: '419291750'
                labels:
                  goog-aw-external-identifier: gcloud-2e2
            nextPageToken: CjAKBgjKucP6BQomKiRmZmRlNDk5ZS02Y2YyLTQ4ZWQtYjNiZi01MWZkMjczOTU5ZTE=
          status: 200
    - expect_stdout:
        matches: .*$$operation$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Get operation
    command: assured operations describe $$operation$$
    events:
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        repeatable: true
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$operation$$?alt=json
          method: GET
          body: null
        expect_response:
          body:
            json:
              name: $$operation$$
        return_response:
          headers:
            cache-control: private
            content-length: '1029'
            content-type: application/json; charset=UTF-8
          body:
            name: organizations/531459884741/locations/us-central1/operations/c0d597da-796e-42dd-8344-2c59f3c36bfc
            metadata:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.CreateWorkloadOperationMetadata
              createTime: '2020-09-03T14:11:25.563941Z'
              displayName: gcloud-e2e-workloads
              parent: organizations/531459884741/locations/us-central1
              complianceRegime: FEDRAMP_MODERATE
            done: true
            response:
              '@type': type.googleapis.com/google.cloud.assuredworkloads.v1beta1.Workload
              name: organizations/531459884741/locations/us-central1/workloads/00-e7f928e1-2a22-4a44-92ed-eb2
              displayName: gcloud-e2e-workloads
              resources:
              - resourceId: '52455744616'
              - resourceId: '1023952579958'
              complianceRegime: FEDRAMP_MODERATE
              createTime: '2020-09-03T14:11:37.617Z'
              etag: '939948929'
              labels:
                goog-aw-external-identifier: gcloud-2e2
          status: 200
    - expect_stdout:
        matches: .*$$operation$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete workload project 0
    command: projects delete $$proj0$$
    validation_only: true
    events:
    - expect_prompt_continue:
        message: Your project will be deleted.
        user_input: y
    - expect_stderr:
        matches: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj0$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete workload project 1
    command: projects delete $$proj1$$
    validation_only: true
    events:
    - expect_prompt_continue:
        message: Your project will be deleted.
        user_input: y
    - expect_stderr:
        matches: Deleted\ \[https://cloudresourcemanager.googleapis.com/v1/projects/$$proj1$$.*
    - expect_exit:
        code: 0
- execute_command:
    # Cleanup: delete created workload
    command: assured workloads delete $$workload$$
    events:
    - expect_prompt_continue:
        message: You are about to delete Workload [$$workload$$]
        user_input: y
    - expect_stderr: |
        Using endpoint [https://us-central1-assuredworkloads.googleapis.com/]
    - api_call:
        expect_request:
          uri: https://us-central1-assuredworkloads.googleapis.com/v1beta1/$$workload$$?alt=json
          method: DELETE
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '3'
            content-type: application/json; charset=UTF-8
          body: |
            {}
          status: 200
    - expect_stderr: |
        Deleted Assured Workloads environment [$$workload$$].
    - expect_exit:
        code: 0
