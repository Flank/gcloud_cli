title: serverless services deploy, describe, update and delete.
release_tracks: [ALPHA]
summary:
# This summary is generated automatically on update and should not be edited.
- set_property: run/platform managed
- execute:
  - command: run deploy --region us-central1 --image gcr.io/cloud-sdk-integration-testing/helloworld-python
      --allow-unauthenticated $$service-name3$$ --source gs://cloud-sdk-integration-testing_cloudbuild/source/helloworld.tgz
  - stderr: |
      Deploying container to Cloud Run service [$$service-name3$$] in project [cloud-sdk-integration-testing] region [us-central1]
  - staged_progress_tracker:
    - message: Deploying and building new service...
    - status: SUCCESS
    - succeeded_stages: &id001
      - Building Container...
      - Setting IAM Policy...
      - Creating Revision...
      - Routing traffic...
  - stderr: |
      Service [$$service-name3$$] revision [$$service-revision-name-4$$] has been deployed and is serving 100 percent of traffic at https://$$service-name3$$-ixwc4imo7a-uc.a.run.app
- execute:
  - command: run deploy --region us-central1 --image gcr.io/knative-samples/helloworld-nodejs
      --allow-unauthenticated $$service-name$$
  - stderr: |
      Deploying container to Cloud Run service [$$service-name$$] in project [cloud-sdk-integration-testing] region [us-central1]
  - staged_progress_tracker:
    - message: Deploying new service...
    - status: SUCCESS
    - succeeded_stages: &id002
      - Setting IAM Policy...
      - Creating Revision...
      - Routing traffic...
  - stderr: |
      Service [$$service-name$$] revision [$$service-revision-name$$] has been deployed and is serving 100 percent of traffic at https://$$service-name$$-ixwc4imo7a-uc.a.run.app
- execute:
  - command: run services describe $$service-name$$ --region us-central1 --format='text(status.conditions[].status,status.conditions[].type)'
  - stdout: |
      status.conditions[0].status: True
      status.conditions[0].type:   Ready
      status.conditions[1].status: True
      status.conditions[1].type:   ConfigurationsReady
      status.conditions[2].status: True
      status.conditions[2].type:   RoutesReady
- execute:
  - command: run services update  --region us-central1 --update-labels label1=one,label2=two
      --max-instances 3 $$service-name$$
  - staged_progress_tracker:
    - message: Deploying...
    - status: SUCCESS
    - succeeded_stages: &id003
      - Creating Revision...
      - Routing traffic...
  - stderr: |
      Service [$$service-name$$] revision [$$service-revision-name-2$$] has been deployed and is serving 100 percent of traffic at https://$$service-name$$-ixwc4imo7a-uc.a.run.app
- execute:
  - command: run services replace --region us-central1 service.yaml
  - stderr: |
      Deploying container to Cloud Run service [$$service-name$$] in project [cloud-sdk-integration-testing] region [us-central1]
  - staged_progress_tracker:
    - message: Deploying...
    - status: SUCCESS
    - succeeded_stages: &id004
      - Creating Revision...
      - Routing traffic...
  - stderr: |
      Service [$$service-name$$] revision [$$service-revision-name-3$$] has been deployed and is serving 100 percent of traffic at https://$$service-name$$-ixwc4imo7a-uc.a.run.app
- execute:
  - command: run deploy --region us-central1  --image gcr.io/knative-samples/helloworld-nodejs
      --labels label1=one,label2=two --max-instances default --allow-unauthenticated
      $$service-name2$$
  - stderr: |
      Deploying container to Cloud Run service [$$service-name2$$] in project [cloud-sdk-integration-testing] region [us-central1]
  - staged_progress_tracker:
    - message: Deploying new service...
    - status: SUCCESS
    - succeeded_stages: &id005
      - Setting IAM Policy...
      - Creating Revision...
      - Routing traffic...
  - stderr: |
      Service [$$service-name2$$] revision [$$service2-revision-name$$] has been deployed and is serving 100 percent of traffic at https://$$service-name2$$-ixwc4imo7a-uc.a.run.app
- execute:
  - command: run services delete $$service-name3$$ --region us-central1 --quiet
  - stderr: |
      Deleted service [$$service-name3$$].
- execute:
  - command: run services delete $$service-name2$$ --region us-central1 --quiet
  - stderr: |
      Deleted service [$$service-name2$$].
- execute:
  - command: run services delete $$service-name$$ --region us-central1 --quiet
  - stderr: |
      Deleted service [$$service-name$$].
actions:
- set_property:
    run/platform: managed
- generate_resource_id:
    reference: service-name
    prefix: service-name
- generate_resource_id:
    reference: service-name2
    prefix: service-name2
- generate_resource_id:
    reference: service-name3
    prefix: service-name3
- execute_command:
    command: run deploy --region us-central1 --image gcr.io/cloud-sdk-integration-testing/helloworld-python
      --allow-unauthenticated $$service-name3$$ --source gs://cloud-sdk-integration-testing_cloudbuild/source/helloworld.tgz
    events:
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b/cloud-sdk-integration-testing_cloudbuild?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '483'
            content-type: application/json; charset=UTF-8
            etag: CAE=
            status: '200'
            x-guploader-uploadid: AEnB2UqqLJZumYKB2ZkNOUJmJV8zQYz1werNkJIwClrnuYzFeUwAHOY71pRNMA5TYZTA0plslyMHMd3o-ozed3a-xMdGKErVrg
          body:
            kind: storage#bucket
            selfLink: https://www.googleapis.com/storage/v1/b/cloud-sdk-integration-testing_cloudbuild
            id: cloud-sdk-integration-testing_cloudbuild
            name: cloud-sdk-integration-testing_cloudbuild
            projectNumber: '462803083913'
            metageneration: '1'
            location: US
            storageClass: STANDARD
            etag: CAE=
            timeCreated: '2016-06-30T22:08:30.379Z'
            updated: '2016-06-30T22:08:30.379Z'
            locationType: multi-region
    - api_call:
        expect_request:
          uri: https://storage.googleapis.com/storage/v1/b?alt=json&maxResults=1000&prefix=cloud-sdk-integration-testing_cloudbuild&project=cloud-sdk-integration-testing
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private, max-age=0, must-revalidate, no-transform
            content-length: '589'
            content-type: application/json; charset=UTF-8
            status: '200'
            x-guploader-uploadid: AEnB2Up6xbvHVTzNgH6z5ntXQVO58t_89fMEiI85Ld3rzMgVWWzvekytOCOeyR_8SPMzWAsOABju9Ao9kz4NfYsNc8OnWeJbmQ
          body:
            kind: storage#buckets
            items:
            - kind: storage#bucket
              selfLink: https://www.googleapis.com/storage/v1/b/cloud-sdk-integration-testing_cloudbuild
              id: cloud-sdk-integration-testing_cloudbuild
              name: cloud-sdk-integration-testing_cloudbuild
              projectNumber: '462803083913'
              metageneration: '1'
              location: US
              storageClass: STANDARD
              etag: CAE=
              timeCreated: '2016-06-30T22:08:30.379Z'
              updated: '2016-06-30T22:08:30.379Z'
              locationType: multi-region
    - api_call:
        expect_request:
          uri:
            matches: https://storage.googleapis.com/storage/v1/b/cloud-sdk-integration-testing_cloudbuild/o/source%2Fhelloworld.tgz/rewriteTo/b/cloud-sdk-integration-testing_cloudbuild/o/.*\?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: no-cache, no-store, max-age=0, must-revalidate
            content-length: '1324'
            content-type: application/json; charset=UTF-8
            pragma: no-cache
            status: '200'
            x-guploader-uploadid: AEnB2Upe_9kUxnT1AULrUlIfygcUhAInoUWKLXF4bKV9s07Bu5jhQDQC_AUeToiwNWNSeRvEq7jziNrdWPZWjTZqerpfN6-u7A
          body:
            kind: storage#rewriteResponse
            totalBytesRewritten: '755'
            objectSize: '755'
            done: true
            resource:
              kind: storage#object
              id: cloud-sdk-integration-testing_cloudbuild/source/1585878227.64-36f95bcdd84243d6becd9519edd7484d.tgz/1585878228110264
              selfLink: https://www.googleapis.com/storage/v1/b/cloud-sdk-integration-testing_cloudbuild/o/source%2F1585878227.64-36f95bcdd84243d6becd9519edd7484d.tgz
              mediaLink: https://storage.googleapis.com/download/storage/v1/b/cloud-sdk-integration-testing_cloudbuild/o/source%2F1585878227.64-36f95bcdd84243d6becd9519edd7484d.tgz?generation=1585878228110264&alt=media
              name: source/1585878227.64-36f95bcdd84243d6becd9519edd7484d.tgz
              bucket: cloud-sdk-integration-testing_cloudbuild
              generation: '1585878228110264'
              metageneration: '1'
              contentType: application/x-tar
              storageClass: STANDARD
              size: '755'
              md5Hash: 6Hs9Km9aGN/mU7We5YEtQw==
              crc32c: nVHdqQ==
              etag: CLiXxuOQy+gCEAE=
              timeCreated: '2020-04-03T01:43:48.110Z'
              updated: '2020-04-03T01:43:48.110Z'
              timeStorageClassUpdated: '2020-04-03T01:43:48.110Z'
              owner:
                entity: user-462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://cloudbuild.googleapis.com/v1/projects/cloud-sdk-integration-testing/builds?alt=json
          method: POST
          headers: {}
          body:
            json:
              images:
              - gcr.io/cloud-sdk-integration-testing/helloworld-python
              source:
                storageSource:
                  bucket: cloud-sdk-integration-testing_cloudbuild
              steps:
              - args:
                - build
                - --network
                - cloudbuild
                - --no-cache
                - -t
                - gcr.io/cloud-sdk-integration-testing/helloworld-python
                - .
                name: gcr.io/cloud-builders/docker
        return_response:
          headers:
            cache-control: private
            content-length: '1786'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            name: operations/build/cloud-sdk-integration-testing/MGExNTFhZDYtODJlMS00NDUyLTg0Y2YtZTI5ZTE0MDgzZjll
            metadata:
              '@type': type.googleapis.com/google.devtools.cloudbuild.v1.BuildOperationMetadata
              build:
                id: 0a151ad6-82e1-4452-84cf-e29e14083f9e
                status: QUEUED
                source:
                  storageSource:
                    bucket: cloud-sdk-integration-testing_cloudbuild
                    object: source/1585878227.64-36f95bcdd84243d6becd9519edd7484d.tgz
                    generation: '1585878228110264'
                createTime: '2020-04-03T01:43:48.304837458Z'
                steps:
                - name: gcr.io/cloud-builders/docker
                  args:
                  - build
                  - --network
                  - cloudbuild
                  - --no-cache
                  - -t
                  - gcr.io/cloud-sdk-integration-testing/helloworld-python
                  - .
                timeout: 600s
                images:
                - gcr.io/cloud-sdk-integration-testing/helloworld-python
                projectId: cloud-sdk-integration-testing
                logsBucket: gs://462803083913.cloudbuild-logs.googleusercontent.com
                sourceProvenance:
                  resolvedStorageSource:
                    bucket: cloud-sdk-integration-testing_cloudbuild
                    object: source/1585878227.64-36f95bcdd84243d6becd9519edd7484d.tgz
                    generation: '1585878228110264'
                options:
                  logging: LEGACY
                logUrl: https://console.cloud.google.com/cloud-build/builds/0a151ad6-82e1-4452-84cf-e29e14083f9e?project=462803083913
                artifacts:
                  images:
                  - gcr.io/cloud-sdk-integration-testing/helloworld-python
        poll_operation: true
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name3$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '229'
            content-type: application/json; charset=UTF-8
            status: '404'
          body:
            error:
              code: 404
              message: Resource '$$service-name3$$' of kind 'SERVICE' in region 'us-central1'
                in project 'cloud-sdk-integration-testing' does not exist.
              status: NOT_FOUND
    - expect_stderr: |
        Deploying container to Cloud Run service [$$service-name3$$] in project [cloud-sdk-integration-testing] region [us-central1]
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services?alt=json
          method: POST
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                annotations:
                  client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                labels: {}
                name: $$service-name3$$
                namespace: cloud-sdk-integration-testing
              spec:
                template:
                  metadata:
                    annotations:
                      client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                    labels: {}
                  spec:
                    containers:
                    - image: gcr.io/cloud-sdk-integration-testing/helloworld-python
              status:
                address: {}
        return_response:
          headers:
            cache-control: private
            content-length: '2016'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name3$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name3$$
              uid: d21d2f70-0481-489f-b7f5-a6633de73df8
              resourceVersion: AAWiWQ63FRk
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
              creationTimestamp: '2020-04-03T01:44:26.221849Z'
            spec:
              template:
                metadata:
                  name: $$service-name3$$-00001-yep
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                    autoscaling.knative.dev/maxScale: '1000'
                spec:
                  containerConcurrency: 80
                  timeoutSeconds: 900
                  containers:
                  - image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                    resources:
                      limits:
                        memory: 256M
                        cpu: 1000m
                    ports:
                    - containerPort: 8080
              traffic:
              - percent: 100
                latestRevision: true
            status: {}
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/cloud-sdk-integration-testing/locations/us-central1/services/$$service-name3$$:getIamPolicy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '21'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            etag: ACAB
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/cloud-sdk-integration-testing/locations/us-central1/services/$$service-name3$$:setIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              policy:
                bindings:
                - members:
                  - allUsers
                  role: roles/run.invoker
                etag: ACAB
        return_response:
          headers:
            cache-control: private
            content-length: '159'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            version: 1
            etag: BwWiWQ7DLvs=
            bindings:
            - role: roles/run.invoker
              members:
              - allUsers
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name3$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2982'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name3$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name3$$
              uid: d21d2f70-0481-489f-b7f5-a6633de73df8
              resourceVersion: AAWiWQ8jf5g
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
              creationTimestamp: '2020-04-03T01:44:26.221849Z'
            spec:
              template:
                metadata:
                  name: $$service-name3$$-00001-yep
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                    autoscaling.knative.dev/maxScale: '1000'
                spec:
                  containerConcurrency: 80
                  timeoutSeconds: 900
                  containers:
                  - image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                    resources:
                      limits:
                        memory: 256M
                        cpu: 1000m
                    ports:
                    - containerPort: 8080
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2020-04-03T01:44:33.327Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2020-04-03T01:44:32.974Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2020-04-03T01:44:33.327Z'
              latestReadyRevisionName: $$service-name3$$-00001-yep
              latestCreatedRevisionName: $$service-name3$$-00001-yep
              traffic:
              - revisionName: $$service-name3$$-00001-yep
                percent: 100
                latestRevision: true
              url: https://$$service-name3$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name3$$-ixwc4imo7a-uc.a.run.app
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying and building new service...
        status: SUCCESS
        succeeded_stages: *id001
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name3$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2982'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name3$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name3$$
              uid: d21d2f70-0481-489f-b7f5-a6633de73df8
              resourceVersion: AAWiWQ8jf5g
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
              creationTimestamp: '2020-04-03T01:44:26.221849Z'
            spec:
              template:
                metadata:
                  name: $$service-name3$$-00001-yep
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                    autoscaling.knative.dev/maxScale: '1000'
                spec:
                  containerConcurrency: 80
                  timeoutSeconds: 900
                  containers:
                  - image: gcr.io/cloud-sdk-integration-testing/helloworld-python
                    resources:
                      limits:
                        memory: 256M
                        cpu: 1000m
                    ports:
                    - containerPort: 8080
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2020-04-03T01:44:33.327Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2020-04-03T01:44:32.974Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2020-04-03T01:44:33.327Z'
              latestReadyRevisionName: $$service-name3$$-00001-yep
              latestCreatedRevisionName: $$service-name3$$-00001-yep
              traffic:
              - revisionName: $$service-name3$$-00001-yep
                percent: 100
                latestRevision: true
              url: https://$$service-name3$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name3$$-ixwc4imo7a-uc.a.run.app
        expect_response:
          extract_references:
          - field: status.latestCreatedRevisionName
            reference: service-revision-name-4
          body:
            json: {}
        repeatable: true
    - expect_stderr: |
        Service [$$service-name3$$] revision [$$service-revision-name-4$$] has been deployed and is serving 100 percent of traffic at https://$$service-name3$$-ixwc4imo7a-uc.a.run.app
    - expect_exit:
        code: 0
- execute_command:
    # Use the prebuilt image as documented in serverless quickstart page: https://cloud.google.com/serverless-engine/docs/quickstarts/prebuilt-deploy
    # This deploy has minimal flags so the update below starts minimal settings. The deploy below tests deploy with more flags.
    command: run deploy --region us-central1 --image gcr.io/knative-samples/helloworld-nodejs
      --allow-unauthenticated $$service-name$$
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '1016'
            content-type: application/json; charset=UTF-8
            status: '404'
          body:
            error:
              code: 404
              message: Resource '$$service-name$$' of kind 'SERVICE' in region 'us-central1'
                in project 'cloud-sdk-integration-testing' does not exist.
              status: NOT_FOUND
              details:
              - '@type': type.googleapis.com/google.rpc.DebugInfo
                detail: |-
                  [ORIGINAL ERROR] generic::not_found: userFacingMessage: Resource '$$service-name$$' of kind 'SERVICE' in region 'us-central1' in project 'cloud-sdk-integration-testing' does not exist.;
                  com.google.cloud.eventprocessing.serverless.error.NotFoundException: userFacingMessage: Resource '$$service-name$$' of kind 'SERVICE' in region 'us-central1' in project 'cloud-sdk-integration-testing' does not exist.;  Code: NOT_FOUND [google.rpc.error_details_ext] { message: "Resource \'$$service-name$$\' of kind \'SERVICE\' in region \'us-central1\' in project \'cloud-sdk-integration-testing\' does not exist." }
    - expect_stderr: |
        Deploying container to Cloud Run service [$$service-name$$] in project [cloud-sdk-integration-testing] region [us-central1]
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services?alt=json
          method: POST
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                annotations:
                  client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                labels: {}
                name: $$service-name$$
                namespace: cloud-sdk-integration-testing
              spec:
                template:
                  spec:
                    containers:
                    - image: gcr.io/knative-samples/helloworld-nodejs
              status:
                address: {}
        return_response:
          headers:
            cache-control: private
            content-length: '1628'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q14OaI
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00001-pof
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status: {}
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/cloud-sdk-integration-testing/locations/us-central1/services/$$service-name$$:getIamPolicy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '21'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            etag: ACAB
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/cloud-sdk-integration-testing/locations/us-central1/services/$$service-name$$:setIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              policy:
                bindings:
                - members:
                  - allUsers
                  role: roles/run.invoker
                etag: ACAB
        return_response:
          headers:
            cache-control: private
            content-length: '159'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            version: 1
            etag: BwWX3q2ISg0=
            bindings:
            - role: roles/run.invoker
              members:
              - allUsers
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2589'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q4iWfA
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00001-pof
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:22.974Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00001-pof
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00001-pof
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00001-pof
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying new service...
        status: SUCCESS
        succeeded_stages: *id002
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2589'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q4iWfA
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00001-pof
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:22.974Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00001-pof
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00001-pof
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00001-pof
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
        expect_response:
          extract_references:
          - field: status.latestCreatedRevisionName
            reference: service-revision-name
          body:
            json: {}
        repeatable: true
    - expect_stderr: |
        Service [$$service-name$$] revision [$$service-revision-name$$] has been deployed and is serving 100 percent of traffic at https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - expect_exit:
        code: 0
- execute_command:
    # Describe the service we just deployed
    command: run services describe $$service-name$$ --region us-central1 --format='text(status.conditions[].status,status.conditions[].type)'
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2589'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q4iWfA
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00001-pof
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:22.974Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00001-pof
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00001-pof
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00001-pof
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - expect_stdout: |
        status.conditions[0].status: True
        status.conditions[0].type:   Ready
        status.conditions[1].status: True
        status.conditions[1].type:   ConfigurationsReady
        status.conditions[2].status: True
        status.conditions[2].type:   RoutesReady

    - expect_exit:
        code: 0

- execute_command:
    command: run services update  --region us-central1 --update-labels label1=one,label2=two
      --max-instances 3 $$service-name$$
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2589'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q4iWfA
              generation: 1
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00001-pof
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:22.974Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00001-pof
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00001-pof
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00001-pof
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - api_call:
        expect_request:
          uri:
            matches: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/462803083913/revisions.*
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2816'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Revision
            metadata:
              name: service-name-20191121-173211-y1up-00001-pof
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/revisions/service-name-20191121-173211-y1up-00001-pof
              uid: 7f161a9d-fb37-4244-a948-45c870131c96
              resourceVersion: AAWX3q4Yoag
              generation: 1
              labels:
                serving.knative.dev/route: $$service-name$$
                serving.knative.dev/configuration: $$service-name$$
                serving.knative.dev/configurationGeneration: '1'
                serving.knative.dev/service: $$service-name$$
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              ownerReferences:
              - apiVersion: serving.knative.dev/v1
                kind: Configuration
                name: $$service-name$$
                uid: 32f80a67-abb9-4196-a307-208c076ab64e
                controller: true
                blockOwnerDeletion: true
              creationTimestamp: '2019-11-21T17:32:13.344441Z'
            spec:
              containerConcurrency: 80
              containers:
              - image: gcr.io/knative-samples/helloworld-nodejs
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:22.807Z'
              - type: Active
                status: 'True'
                severity: Info
                lastTransitionTime: '2019-11-21T17:32:22.807Z'
              - type: ContainerHealthy
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:22.807Z'
              - type: ResourcesAvailable
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:21.172Z'
              logUrl: https://console.cloud.google.com/logs/viewer?project=cloud-sdk-integration-testing&resource=cloud_run_revision/service_name/$$service-name$$/revision_name/service-name-20191121-173211-y1up-00001-pof&advancedFilter=resource.type%3D%22cloud_run_revision%22%0Aresource.labels.service_name%3D%22$$service-name$$%22%0Aresource.labels.revision_name%3D%22service-name-20191121-173211-y1up-00001-pof%22
              imageDigest: gcr.io/knative-samples/helloworld-nodejs@sha256:ae8c741379bbe004df62c1f29bbfd9bc92c84060a6d4af409d220e54f29959f6
        repeatable: true
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: PUT
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                annotations:
                  client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                  serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                  serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                generation: 1
                labels:
                  cloud.googleapis.com/location: us-central1
                  label1: one
                  label2: two
                name: $$service-name$$
                namespace: '462803083913'
                selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              spec:
                template:
                  metadata:
                    annotations:
                      autoscaling.knative.dev/maxScale: '3'
                    labels:
                      cloud.googleapis.com/location: us-central1
                      label1: one
                      label2: two
                  spec:
                    containerConcurrency: 80
                    containers:
                    - image: gcr.io/knative-samples/helloworld-nodejs@sha256:ae8c741379bbe004df62c1f29bbfd9bc92c84060a6d4af409d220e54f29959f6
                traffic:
                - latestRevision: true
                  percent: 100
              status: {}
        return_response:
          headers:
            cache-control: private
            content-length: '2842'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q5JRqY
              generation: 2
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00002-har
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                    autoscaling.knative.dev/maxScale: '3'
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs@sha256:ae8c741379bbe004df62c1f29bbfd9bc92c84060a6d4af409d220e54f29959f6
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:22.974Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:23.574Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00001-pof
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00001-pof
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00001-pof
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2842'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q9MJFA
              generation: 2
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00002-har
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                    autoscaling.knative.dev/maxScale: '3'
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs@sha256:ae8c741379bbe004df62c1f29bbfd9bc92c84060a6d4af409d220e54f29959f6
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 2
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:34.528Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00002-har
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00002-har
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00002-har
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying...
        status: SUCCESS
        succeeded_stages: *id003
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2842'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q9MJFA
              generation: 2
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00002-har
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                    autoscaling.knative.dev/maxScale: '3'
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs@sha256:ae8c741379bbe004df62c1f29bbfd9bc92c84060a6d4af409d220e54f29959f6
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 2
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:34.528Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00002-har
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00002-har
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00002-har
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
        expect_response:
          extract_references:
          - field: status.latestCreatedRevisionName
            reference: service-revision-name-2
          body:
            json: {}
        repeatable: true
    - expect_stderr: |
        Service [$$service-name$$] revision [$$service-revision-name-2$$] has been deployed and is serving 100 percent of traffic at https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - expect_exit:
        code: 0
- write_file:
    path: service.yaml
    contents: |
      apiVersion: serving.knative.dev/v1
      kind: Service
      metadata:
        name: $$service-name$$
        namespace: cloud-sdk-integration-testing
      spec:
        template:
          spec:
            containers:
            - image: gcr.io/cloudrun/hello
        traffic:
        - latestRevision: true
          percent: 100
- execute_command:
    command: run services replace --region us-central1 service.yaml
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/cloud-sdk-integration-testing?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '350'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            projectNumber: '462803083913'
            projectId: cloud-sdk-integration-testing
            lifecycleState: ACTIVE
            name: Cloud SDK Integration Testing
            labels:
              service-account-downloaded-notification-opt-out: 'true'
            createTime: '2014-09-30T14:51:18.935Z'
            parent:
              type: folder
              id: '396521612403'
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2842'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q9MJFA
              generation: 2
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00002-har
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                    autoscaling.knative.dev/maxScale: '3'
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs@sha256:ae8c741379bbe004df62c1f29bbfd9bc92c84060a6d4af409d220e54f29959f6
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 2
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:34.528Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00002-har
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00002-har
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00002-har
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - expect_stderr: |
        Deploying container to Cloud Run service [$$service-name$$] in project [cloud-sdk-integration-testing] region [us-central1]
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2842'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q9MJFA
              generation: 2
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata:
                  name: service-name-20191121-173211-y1up-00002-har
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                    autoscaling.knative.dev/maxScale: '3'
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs@sha256:ae8c741379bbe004df62c1f29bbfd9bc92c84060a6d4af409d220e54f29959f6
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 2
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:34.528Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00002-har
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00002-har
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00002-har
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: PUT
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                name: $$service-name$$
                namespace: cloud-sdk-integration-testing
              spec:
                template:
                  spec:
                    containers:
                    - image: gcr.io/cloudrun/hello
                traffic:
                - latestRevision: true
                  percent: 100
        return_response:
          headers:
            cache-control: private
            content-length: '2086'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3q+AoFg
              generation: 3
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata: {}
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 2
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:34.528Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:43.089Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-00002-har
              latestCreatedRevisionName: service-name-20191121-173211-y1up-00002-har
              traffic:
              - revisionName: service-name-20191121-173211-y1up-00002-har
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2074'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3rBu4gA
              generation: 3
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata: {}
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 3
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:02.144Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:54.242Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:02.144Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-qlcn9
              latestCreatedRevisionName: service-name-20191121-173211-y1up-qlcn9
              traffic:
              - revisionName: service-name-20191121-173211-y1up-qlcn9
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying...
        status: SUCCESS
        succeeded_stages: *id004
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2074'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name$$
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
              resourceVersion: AAWX3rBu4gA
              generation: 3
              labels:
                cloud.googleapis.com/location: us-central1
              annotations:
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              creationTimestamp: '2019-11-21T17:32:12.424610Z'
            spec:
              template:
                metadata: {}
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/cloudrun/hello
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 3
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:02.144Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:32:54.242Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:02.144Z'
              latestReadyRevisionName: service-name-20191121-173211-y1up-qlcn9
              latestCreatedRevisionName: service-name-20191121-173211-y1up-qlcn9
              traffic:
              - revisionName: service-name-20191121-173211-y1up-qlcn9
                percent: 100
                latestRevision: true
              url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name$$-ixwc4imo7a-uc.a.run.app
        expect_response:
          extract_references:
          - field: status.latestCreatedRevisionName
            reference: service-revision-name-3
          body:
            json: {}
    - expect_stderr: |
        Service [$$service-name$$] revision [$$service-revision-name-3$$] has been deployed and is serving 100 percent of traffic at https://$$service-name$$-ixwc4imo7a-uc.a.run.app
    - expect_exit:
        code: 0
- execute_command:
    command: run deploy --region us-central1  --image gcr.io/knative-samples/helloworld-nodejs
      --labels label1=one,label2=two --max-instances default --allow-unauthenticated
      $$service-name2$$
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '1020'
            content-type: application/json; charset=UTF-8
            status: '404'
          body:
            error:
              code: 404
              message: Resource '$$service-name2$$' of kind 'SERVICE' in region 'us-central1'
                in project 'cloud-sdk-integration-testing' does not exist.
              status: NOT_FOUND
              details:
              - '@type': type.googleapis.com/google.rpc.DebugInfo
                detail: |-
                  [ORIGINAL ERROR] generic::not_found: userFacingMessage: Resource '$$service-name2$$' of kind 'SERVICE' in region 'us-central1' in project 'cloud-sdk-integration-testing' does not exist.;
                  com.google.cloud.eventprocessing.serverless.error.NotFoundException: userFacingMessage: Resource '$$service-name2$$' of kind 'SERVICE' in region 'us-central1' in project 'cloud-sdk-integration-testing' does not exist.;  Code: NOT_FOUND [google.rpc.error_details_ext] { message: "Resource \'$$service-name2$$\' of kind \'SERVICE\' in region \'us-central1\' in project \'cloud-sdk-integration-testing\' does not exist." }
    - expect_stderr: |
        Deploying container to Cloud Run service [$$service-name2$$] in project [cloud-sdk-integration-testing] region [us-central1]
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services?alt=json
          method: POST
          headers: {}
          body:
            json:
              apiVersion: serving.knative.dev/v1
              kind: Service
              metadata:
                annotations:
                  client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                labels:
                  label1: one
                  label2: two
                name: $$service-name2$$
                namespace: cloud-sdk-integration-testing
              spec:
                template:
                  metadata:
                    labels:
                      label1: one
                      label2: two
                  spec:
                    containers:
                    - image: gcr.io/knative-samples/helloworld-nodejs
              status:
                address: {}
        return_response:
          headers:
            cache-control: private
            content-length: '1761'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name2$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name2$$
              uid: 9429ca22-b30d-4b35-823d-84fecf7ee4fd
              resourceVersion: AAWX3rCfbnE
              generation: 1
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:33:05.325681Z'
            spec:
              template:
                metadata:
                  name: service-name2-20191121-173211-265d-00001-qor
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status: {}
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/cloud-sdk-integration-testing/locations/us-central1/services/$$service-name2$$:getIamPolicy?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '21'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            etag: ACAB
    - api_call:
        expect_request:
          uri: https://run.googleapis.com/v1/projects/cloud-sdk-integration-testing/locations/us-central1/services/$$service-name2$$:setIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              policy:
                bindings:
                - members:
                  - allUsers
                  role: roles/run.invoker
                etag: ACAB
        return_response:
          headers:
            cache-control: private
            content-length: '159'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            version: 1
            etag: BwWX3rCt4fY=
            bindings:
            - role: roles/run.invoker
              members:
              - allUsers
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2727'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name2$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name2$$
              uid: 9429ca22-b30d-4b35-823d-84fecf7ee4fd
              resourceVersion: AAWX3rF4UyA
              generation: 1
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:33:05.325681Z'
            spec:
              template:
                metadata:
                  name: service-name2-20191121-173211-265d-00001-qor
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:19.540Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:19.335Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:19.540Z'
              latestReadyRevisionName: service-name2-20191121-173211-265d-00001-qor
              latestCreatedRevisionName: service-name2-20191121-173211-265d-00001-qor
              traffic:
              - revisionName: service-name2-20191121-173211-265d-00001-qor
                percent: 100
                latestRevision: true
              url: https://$$service-name2$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name2$$-ixwc4imo7a-uc.a.run.app
        repeatable: true
    - expect_staged_progress_tracker:
        message: Deploying new service...
        status: SUCCESS
        succeeded_stages: *id005
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name2$$?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '2727'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            apiVersion: serving.knative.dev/v1
            kind: Service
            metadata:
              name: $$service-name2$$
              namespace: '462803083913'
              selfLink: /apis/serving.knative.dev/v1/namespaces/462803083913/services/$$service-name2$$
              uid: 9429ca22-b30d-4b35-823d-84fecf7ee4fd
              resourceVersion: AAWX3rF4UyA
              generation: 1
              labels:
                label1: one
                label2: two
                cloud.googleapis.com/location: us-central1
              annotations:
                run.googleapis.com/client-name: gcloud
                serving.knative.dev/creator: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                serving.knative.dev/lastModifier: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
                client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
              creationTimestamp: '2019-11-21T17:33:05.325681Z'
            spec:
              template:
                metadata:
                  name: service-name2-20191121-173211-265d-00001-qor
                  labels:
                    label1: one
                    label2: two
                  annotations:
                    run.googleapis.com/client-name: gcloud
                    client.knative.dev/user-image: gcr.io/knative-samples/helloworld-nodejs
                spec:
                  containerConcurrency: 80
                  containers:
                  - image: gcr.io/knative-samples/helloworld-nodejs
              traffic:
              - percent: 100
                latestRevision: true
            status:
              observedGeneration: 1
              conditions:
              - type: Ready
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:19.540Z'
              - type: ConfigurationsReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:19.335Z'
              - type: RoutesReady
                status: 'True'
                lastTransitionTime: '2019-11-21T17:33:19.540Z'
              latestReadyRevisionName: service-name2-20191121-173211-265d-00001-qor
              latestCreatedRevisionName: service-name2-20191121-173211-265d-00001-qor
              traffic:
              - revisionName: service-name2-20191121-173211-265d-00001-qor
                percent: 100
                latestRevision: true
              url: https://$$service-name2$$-ixwc4imo7a-uc.a.run.app
              address:
                url: https://$$service-name2$$-ixwc4imo7a-uc.a.run.app
        expect_response:
          extract_references:
          - field: status.latestCreatedRevisionName
            reference: service2-revision-name
          body:
            json: {}
    - expect_stderr: |
        Service [$$service-name2$$] revision [$$service2-revision-name$$] has been deployed and is serving 100 percent of traffic at https://$$service-name2$$-ixwc4imo7a-uc.a.run.app
    - expect_exit:
        code: 0
- execute_command:
    # Clean up the test service
    command: run services delete $$service-name3$$ --region us-central1 --quiet
    cleanup_for: service-name3
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name3$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '188'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            status: Success
            details:
              name: $$service-name3$$
              group: v1
              kind: service
              uid: 12ca7a1f-fda5-43b8-9857-0597b17da9c6
    - expect_stderr: |
        Deleted service [$$service-name3$$].
    - expect_exit:
        code: 0
- execute_command:
    # Clean up the test service
    command: run services delete $$service-name2$$ --region us-central1 --quiet
    cleanup_for: service-name2
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name2$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '188'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            status: Success
            details:
              name: $$service-name2$$
              group: v1
              kind: service
              uid: 9429ca22-b30d-4b35-823d-84fecf7ee4fd
    - expect_stderr: |
        Deleted service [$$service-name2$$].
    - expect_exit:
        code: 0
- execute_command:
    # Clean up the test service
    command: run services delete $$service-name$$ --region us-central1 --quiet
    cleanup_for: service-name
    events:
    - api_call:
        expect_request:
          uri: https://us-central1-run.googleapis.com/apis/serving.knative.dev/v1/namespaces/cloud-sdk-integration-testing/services/$$service-name$$?alt=json
          method: DELETE
          headers: {}
          body: null
        return_response:
          headers:
            cache-control: private
            content-length: '187'
            content-type: application/json; charset=UTF-8
            status: '200'
          body:
            status: Success
            details:
              name: $$service-name$$
              group: v1
              kind: service
              uid: 7044030b-b65d-48e3-a2e4-f0c03970cb34
    - expect_stderr: |
        Deleted service [$$service-name$$].
    - expect_exit:
        code: 0
