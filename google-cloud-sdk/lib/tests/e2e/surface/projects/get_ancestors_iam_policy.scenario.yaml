title: projects get-ancestors-iam-policy test scenario
release_tracks: [GA]
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: projects get-ancestors-iam-policy cloudsdktest-org-proj1
  - stdout: |
      ---
      id: cloudsdktest-org-proj1
      policy:
        bindings:
        - members:
          - group:cloud-sdk-team@google.com
          - user:zjn@google.com
          role: roles/editor
        - members:
          - user:cloudsdk@cloudsdktest.joonix.net
          role: roles/owner
        etag: BwVkByWkIwg=
        version: 1
      type: project
      ---
      id: '1054311078602'
      policy:
        bindings:
        - members:
          - user:belitskiy@google.com
          - user:dhruvsinghal@google.com
          - user:wfaris@google.com
          - user:zjn@google.com
          role: roles/accesscontextmanager.policyAdmin
        - members:
          - user:wfaris@google.com
          role: roles/accesscontextmanager.policyEditor
        - members:
          - user:wfaris@google.com
          role: roles/billing.admin
        - members:
          - domain:cloudsdktest.joonix.net
          - user:wfaris@google.com
          role: roles/billing.creator
        - members:
          - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
          role: roles/compute.xpnAdmin
        - members:
          - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
          role: roles/logging.admin
        - members:
          - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
          - user:wfaris@google.com
          role: roles/orgpolicy.policyAdmin
        - members:
          - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
          - user:chaorenliu@google.com
          - user:cloudsdktester@gmail.com
          - user:cloudsdktesterota@gmail.com
          - user:hgregg@google.com
          - user:jmzhou@google.com
          - user:viveganandhan@google.com
          - user:wfaris@google.com
          role: roles/owner
        - members:
          - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
          - user:chaorenliu@google.com
          - user:hgregg@google.com
          - user:wfaris@google.com
          role: roles/resourcemanager.folderCreator
        - members:
          - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
          role: roles/resourcemanager.folderEditor
        - members:
          - group:cloud-sdk-team@google.com
          - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
          - user:cloudsdk@cloudsdktest.joonix.net
          - user:jmzhou@google.com
          - user:viveganandhan@google.com
          role: roles/resourcemanager.organizationAdmin
        - members:
          - domain:cloudsdktest.joonix.net
          role: roles/resourcemanager.projectCreator
        etag: BwWjb7VQ1rI=
        version: 1
      type: organization
- execute:
  - command: projects get-ancestors-iam-policy cloud-sdk-integration-testing
  - error: '1: User is not permitted to access IAM policy for one or more of the ancestors'
actions:
- execute_command:
    command: projects get-ancestors-iam-policy cloudsdktest-org-proj1
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/cloudsdktest-org-proj1:getAncestry?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '237'
            content-type: application/json; charset=UTF-8
          body:
            ancestor:
            - resourceId:
                type: project
                id: cloudsdktest-org-proj1
            - resourceId:
                type: organization
                id: '1054311078602'
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/cloudsdktest-org-proj1:getIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              options:
                requestedPolicyVersion: 3
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '325'
            content-type: application/json; charset=UTF-8
          body:
            version: 1
            etag: BwVkByWkIwg=
            bindings:
            - role: roles/editor
              members:
              - group:cloud-sdk-team@google.com
              - user:zjn@google.com
            - role: roles/owner
              members:
              - user:cloudsdk@cloudsdktest.joonix.net
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/organizations/1054311078602:getIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              options:
                requestedPolicyVersion: 3
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '2704'
            content-type: application/json; charset=UTF-8
          body:
            version: 1
            etag: BwWjb7VQ1rI=
            bindings:
            - role: roles/accesscontextmanager.policyAdmin
              members:
              - user:belitskiy@google.com
              - user:dhruvsinghal@google.com
              - user:wfaris@google.com
              - user:zjn@google.com
            - role: roles/accesscontextmanager.policyEditor
              members:
              - user:wfaris@google.com
            - role: roles/billing.admin
              members:
              - user:wfaris@google.com
            - role: roles/billing.creator
              members:
              - domain:cloudsdktest.joonix.net
              - user:wfaris@google.com
            - role: roles/compute.xpnAdmin
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - role: roles/logging.admin
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - role: roles/orgpolicy.policyAdmin
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              - user:wfaris@google.com
            - role: roles/owner
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              - user:chaorenliu@google.com
              - user:cloudsdktester@gmail.com
              - user:cloudsdktesterota@gmail.com
              - user:hgregg@google.com
              - user:jmzhou@google.com
              - user:viveganandhan@google.com
              - user:wfaris@google.com
            - role: roles/resourcemanager.folderCreator
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              - user:chaorenliu@google.com
              - user:hgregg@google.com
              - user:wfaris@google.com
            - role: roles/resourcemanager.folderEditor
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - role: roles/resourcemanager.organizationAdmin
              members:
              - group:cloud-sdk-team@google.com
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              - user:cloudsdk@cloudsdktest.joonix.net
              - user:jmzhou@google.com
              - user:viveganandhan@google.com
            - role: roles/resourcemanager.projectCreator
              members:
              - domain:cloudsdktest.joonix.net
    - expect_stdout: |
        ---
        id: cloudsdktest-org-proj1
        policy:
          bindings:
          - members:
            - group:cloud-sdk-team@google.com
            - user:zjn@google.com
            role: roles/editor
          - members:
            - user:cloudsdk@cloudsdktest.joonix.net
            role: roles/owner
          etag: BwVkByWkIwg=
          version: 1
        type: project
        ---
        id: '1054311078602'
        policy:
          bindings:
          - members:
            - user:belitskiy@google.com
            - user:dhruvsinghal@google.com
            - user:wfaris@google.com
            - user:zjn@google.com
            role: roles/accesscontextmanager.policyAdmin
          - members:
            - user:wfaris@google.com
            role: roles/accesscontextmanager.policyEditor
          - members:
            - user:wfaris@google.com
            role: roles/billing.admin
          - members:
            - domain:cloudsdktest.joonix.net
            - user:wfaris@google.com
            role: roles/billing.creator
          - members:
            - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            role: roles/compute.xpnAdmin
          - members:
            - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            role: roles/logging.admin
          - members:
            - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - user:wfaris@google.com
            role: roles/orgpolicy.policyAdmin
          - members:
            - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - user:chaorenliu@google.com
            - user:cloudsdktester@gmail.com
            - user:cloudsdktesterota@gmail.com
            - user:hgregg@google.com
            - user:jmzhou@google.com
            - user:viveganandhan@google.com
            - user:wfaris@google.com
            role: roles/owner
          - members:
            - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - user:chaorenliu@google.com
            - user:hgregg@google.com
            - user:wfaris@google.com
            role: roles/resourcemanager.folderCreator
          - members:
            - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            role: roles/resourcemanager.folderEditor
          - members:
            - group:cloud-sdk-team@google.com
            - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - user:cloudsdk@cloudsdktest.joonix.net
            - user:jmzhou@google.com
            - user:viveganandhan@google.com
            role: roles/resourcemanager.organizationAdmin
          - members:
            - domain:cloudsdktest.joonix.net
            role: roles/resourcemanager.projectCreator
          etag: BwWjb7VQ1rI=
          version: 1
        type: organization
    - expect_exit:
        code: 0
- execute_command:
    command: projects get-ancestors-iam-policy cloud-sdk-integration-testing
    events:
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/cloud-sdk-integration-testing:getAncestry?alt=json
          method: POST
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '439'
            content-type: application/json; charset=UTF-8
          body:
            ancestor:
            - resourceId:
                type: project
                id: cloud-sdk-integration-testing
            - resourceId:
                type: folder
                id: '432815178414'
            - resourceId:
                type: folder
                id: '545793274974'
            - resourceId:
                type: organization
                id: '433637338589'
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v1/projects/cloud-sdk-integration-testing:getIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              options:
                requestedPolicyVersion: 3
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '21250'
            content-type: application/json; charset=UTF-8
          body:
            version: 1
            etag: BwWua3s3udk=
            bindings:
            - role: organizations/433637338589/roles/service_account_creator
              members:
              - user:wujames@prod.google.com
            - role: roles/anthosconfigmanagement.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-anthosconfigmanagement.iam.gserviceaccount.com
            - role: roles/apigateway.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-apigateway.iam.gserviceaccount.com
            - role: roles/apigateway_management.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-apigateway-mgmt.iam.gserviceaccount.com
            - role: roles/apigee.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-apigee.iam.gserviceaccount.com
            - role: roles/appengine.appAdmin
              members:
              - user:wfaris@google.com
            - role: roles/appengine.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-gae-service.iam.gserviceaccount.com
            - role: roles/appengineflex.serviceAgent
              members:
              - serviceAccount:service-462803083913@gae-api-prod.google.com.iam.gserviceaccount.com
            - role: roles/artifactregistry.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-artifactregistry.iam.gserviceaccount.com
            - role: roles/automl.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-automl.iam.gserviceaccount.com
            - role: roles/bigquery.admin
              members:
              - user:chaoli@google.com
              - user:waf@google.com
              - user:wujames@prod.google.com
            - role: roles/bigquery.jobUser
              members:
              - user:wujames@prod.google.com
            - role: roles/bigquerydatatransfer.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-bigquerydatatransfer.iam.gserviceaccount.com
            - role: roles/bigtable.admin
              members:
              - group:cloud-bigtable-nonprod@twosync.google.com
            - role: roles/binaryauthorization.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-binaryauthorization.iam.gserviceaccount.com
            - role: roles/bioquery.managedResourceAdmin
              members:
              - serviceAccount:service-462803083913@bioquery-api.iam.gserviceaccount.com
            - role: roles/cloudasset.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-cloudasset.iam.gserviceaccount.com
            - role: roles/cloudbuild.builds.builder
              members:
              - serviceAccount:462803083913@cloudbuild.gserviceaccount.com
            - role: roles/cloudbuild.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-cloudbuild.iam.gserviceaccount.com
            - role: roles/cloudfunctions.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcf-admin-robot-staging.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@gcf-admin-robot.iam.gserviceaccount.com
            - role: roles/cloudiot.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-cloudiot.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@gcp-sa-staging-cloudiot.iam.gserviceaccount.com
            - role: roles/cloudiottoken.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-cloudiottoken.google.com.iam.gserviceaccount.com
            - role: roles/cloudkms.admin
              members:
              - serviceAccount:cleanup-service@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/cloudscheduler.admin
              members:
              - serviceAccount:cloud-run-events@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:knative-eventing@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/cloudtpu.serviceAgent
              members:
              - serviceAccount:service-462803083913@cloud-tpu.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@gcp-sa-tpu.iam.gserviceaccount.com
            - role: roles/composer.serviceAgent
              members:
              - serviceAccount:service-462803083913@cloudcomposer-accounts.iam.gserviceaccount.com
            - role: roles/compute.admin
              members:
              - serviceAccount:462803083913@cloudbuild.gserviceaccount.com
            - role: roles/compute.networkUser
              members:
              - serviceAccount:service-462803083913@gcf-admin-robot.iam.gserviceaccount.com
            - role: roles/compute.serviceAgent
              members:
              - serviceAccount:service-462803083913@compute-system-staging.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@compute-system.iam.gserviceaccount.com
            - role: roles/compute.storageAdmin
              members:
              - serviceAccount:462803083913-compute@developer.gserviceaccount.com
            - role: roles/computescanning.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-computescanning.iam.gserviceaccount.com
            - role: roles/consumerprocurement.entitlementManager
              members:
              - user:ibelle@google.com
            - role: roles/container.developer
              members:
              - serviceAccount:462803083913@cloudbuild.gserviceaccount.com
            - role: roles/container.serviceAgent
              members:
              - serviceAccount:service-462803083913@container-engine-robot.iam.gserviceaccount.com
            - role: roles/containeranalysis.ServiceAgent
              members:
              - serviceAccount:service-462803083913@container-analysis.iam.gserviceaccount.com
            - role: roles/containerscanning.ServiceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-containerscanning.iam.gserviceaccount.com
            - role: roles/dataflow.serviceAgent
              members:
              - serviceAccount:service-462803083913@dataflow-service-producer-prod.iam.gserviceaccount.com
            - role: roles/datafusion.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-datafusion.iam.gserviceaccount.com
            - role: roles/datamigration.admin
              members:
              - user:gerb@google.com
            - role: roles/datamigration.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-datamigration.iam.gserviceaccount.com
            - role: roles/dataproc.serviceAgent
              members:
              - serviceAccount:service-462803083913@dataproc-accounts.iam.gserviceaccount.com
            - role: roles/datastore.importExportAdmin
              members:
              - user:wfaris@google.com
            - role: roles/datastore.indexAdmin
              members:
              - user:wfaris@google.com
            - role: roles/datastore.owner
              members:
              - user:wfaris@google.com
            - role: roles/datastore.viewer
              members:
              - user:wfaris@google.com
            - role: roles/dialogflow.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-dialogflow.iam.gserviceaccount.com
            - role: roles/dlp.serviceAgent
              members:
              - serviceAccount:service-462803083913@dlp-api.iam.gserviceaccount.com
            - role: roles/dns.admin
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
            - role: roles/editor
              members:
              - group:cloud-sdk-eng@twosync.google.com
              - group:mdb.cloud-kubernetes-test@google.com
              - group:mdb.cloud-sdk-build@google.com
              - serviceAccount:414510413715-compute@developer.gserviceaccount.com
              - serviceAccount:462803083913-compute@developer.gserviceaccount.com
              - serviceAccount:462803083913-container-analysis@system.gserviceaccount.com
              - serviceAccount:462803083913-test@cloudservices.gserviceaccount.com
              - serviceAccount:462803083913@cloudservices.gserviceaccount.com
              - serviceAccount:462803083913@repo.gserviceaccount.com
              - serviceAccount:cloud-ml-service@cloud-sdk-integration-te-20c1c.iam.gserviceaccount.com
              - serviceAccount:cloud-sdk-integration-testing@appspot.gserviceaccount.com
              - serviceAccount:dev-20200902-160305-6tx7@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:dev-20200902-160343-r1uj@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:dev-20200902-160442-o2xe@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:dev-20200902-160550-94l7@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:dev-20200902-161957-kz1b@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:hitendrag@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:kokoro-dedicated@system.gserviceaccount.com
              - serviceAccount:local-development@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@container-analysis.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@containerregistry.iam.gserviceaccount.com
              - serviceAccount:test-access@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - user:aaronlerner@google.com
              - user:admin@novitas-gae.bigr.name
              - user:atrefai@google.com
              - user:belitskiy@google.com
              - user:cloud-sdk-build@prod.google.com
              - user:dannyxu@google.com
              - user:dharan@google.com
              - user:gbin@google.com
              - user:georgiie@google.com
              - user:jkh@google.com
              - user:jsand@google.com
              - user:mpoleski@google.com
              - user:msavigny@google.com
              - user:seyfer@google.com
              - user:strellis@google.com
              - user:thobrla@google.com
              - user:tracycui@google.com
              - user:vagababov@google.com
              - user:volkman@google.com
              - user:wfaris@google.com
              - user:xwxw@google.com
            - role: roles/file.editor
              members:
              - user:jasonshao@google.com
            - role: roles/file.serviceAgent
              members:
              - serviceAccount:service-462803083913@cloud-filer.iam.gserviceaccount.com
            - role: roles/firebaserules.system
              members:
              - serviceAccount:service-462803083913@firebase-rules.iam.gserviceaccount.com
            - role: roles/gameservices.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-autopush-gameservices.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@gcp-sa-gameservices.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@gcp-sa-staging-gameservices.iam.gserviceaccount.com
            - role: roles/genomics.serviceAgent
              members:
              - serviceAccount:service-462803083913@genomics-api.google.com.iam.gserviceaccount.com
            - role: roles/gkehub.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-gkehub.iam.gserviceaccount.com
            - role: roles/healthcare.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-healthcare.iam.gserviceaccount.com
            - role: roles/iam.serviceAccountActor
              members:
              - serviceAccount:462803083913@cloudbuild.gserviceaccount.com
              - user:wujames@google.com
            - role: roles/iam.serviceAccountAdmin
              members:
              - user:wujames@prod.google.com
            - role: roles/iam.serviceAccountCreator
              members:
              - user:wfaris@prod.google.com
            - role: roles/iam.serviceAccountTokenCreator
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              - serviceAccount:462803083913@cloudbuild.gserviceaccount.com
              - serviceAccount:gce-diagnostics-extract-logs@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - user:gerb@google.com
            - role: roles/iam.serviceAccountUser
              members:
              - serviceAccount:462803083913@cloudbuild.gserviceaccount.com
              - user:wujames@google.com
            - role: roles/lifesciences.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-lifesciences.iam.gserviceaccount.com
            - role: roles/logging.configWriter
              members:
              - serviceAccount:cloud-run-events@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:knative-eventing@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/logging.privateLogViewer
              members:
              - serviceAccount:cloud-run-events@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:knative-eventing@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/logging.viewer
              members:
              - user:dakeying@google.com
            - role: roles/managedidentities.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-mi.iam.gserviceaccount.com
            - role: roles/memcache.serviceAgent
              members:
              - serviceAccount:service-462803083913@cloud-memcache-sa.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@cloud-memcache-staging-sa.iam.gserviceaccount.com
            - role: roles/multiclusteringress.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-multiclusteringress.iam.gserviceaccount.com
            - role: roles/multiclustermetering.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-mcmetering.iam.gserviceaccount.com
            - role: roles/multiclusterservicediscovery.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-mcsd.iam.gserviceaccount.com
            - role: roles/notebooks.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-notebooks.iam.gserviceaccount.com
            - role: roles/osconfig.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-osconfig.iam.gserviceaccount.com
            - role: roles/owner
              members:
              - serviceAccount:462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              - user:alanga@google.com
              - user:cglouch@google.com
              - user:chaorenliu@google.com
              - user:cloudsdktesterota@gmail.com
              - user:gerb@google.com
              - user:hdubin@google.com
              - user:ibelle@google.com
              - user:kbandes@google.com
              - user:lmcallister@google.com
              - user:nathanlooney@google.com
              - user:shyamm@google.com
              - user:vilasj@google.com
              - user:wfaris@google.com
              - user:wujames@google.com
            - role: roles/pubsub.admin
              members:
              - serviceAccount:cloud-run-events@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:knative-eventing@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/pubsub.editor
              members:
              - serviceAccount:cloud-run-events-broker@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:cloud-run-events-sources@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:cre-pubsub@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:knative-eventing@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/redis.serviceAgent
              members:
              - serviceAccount:service-462803083913@cloud-redis-staging.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@cloud-redis.iam.gserviceaccount.com
            - role: roles/remotebuildexecution.configurationAdmin
              members:
              - user:msavigny@google.com
            - role: roles/remotebuildexecution.serviceAgent
              members:
              - serviceAccount:service-462803083913@remotebuildexecution.iam.gserviceaccount.com
            - role: roles/securitycenter.serviceAgent
              members:
              - serviceAccount:service-462803083913@security-center-api-test.iam.gserviceaccount.com
            - role: roles/serverless.serviceAgent
              members:
              - serviceAccount:service-462803083913@serverless-robot-prod.iam.gserviceaccount.com
            - role: roles/servicenetworking.serviceAgent
              members:
              - serviceAccount:service-462803083913@service-networking-staging.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@service-networking.iam.gserviceaccount.com
            - role: roles/sourcerepo.serviceAgent
              members:
              - serviceAccount:service-462803083913@sourcerepo-service-accounts.iam.gserviceaccount.com
            - role: roles/spanner.admin
              members:
              - serviceAccount:spanner-test@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/storage.admin
              members:
              - serviceAccount:cloud-run-events@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:knative-eventing@cloud-sdk-integration-testing.iam.gserviceaccount.com
            - role: roles/storage.objectCreator
              members:
              - serviceAccount:gce-diagnostics-extract-logs@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:kokoro-dedicated@system.gserviceaccount.com
            - role: roles/storage.objectViewer
              members:
              - serviceAccount:462803083913-compute@developer.gserviceaccount.com
              - serviceAccount:gce-diagnostics-extract-logs@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:kokoro-dedicated@system.gserviceaccount.com
            - role: roles/tpu.serviceAgent
              members:
              - serviceAccount:service-462803083913@cloud-tpu-staging.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@cloud-tpu.iam.gserviceaccount.com
            - role: roles/viewer
              members:
              - group:gcloud-dev@google.com
              - serviceAccount:414510413715-compute@developer.gserviceaccount.com
              - serviceAccount:491336106354-ib66m6rg34gm53hm55vosj6uivj78urh@developer.gserviceaccount.com
              - serviceAccount:cleanup-service@cloud-sdk-integration-testing.iam.gserviceaccount.com
              - serviceAccount:gke-scalability-prow@gke-scalability-prow.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@gcf-admin-robot.iam.gserviceaccount.com
              - user:alanga@google.com
              - user:bar@google.com
              - user:cloudsdktesterreader2@gmail.com
              - user:cloudsdktesterreader@gmail.com
              - user:kefanchen@google.com
              - user:tiran@google.com
            - role: roles/vpcaccess.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-vpcaccess.iam.gserviceaccount.com
            - role: roles/websecurityscanner.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-test-websecurityscanner.iam.gserviceaccount.com
              - serviceAccount:service-462803083913@gcp-sa-websecurityscanner.iam.gserviceaccount.com
            - role: roles/workflows.serviceAgent
              members:
              - serviceAccount:service-462803083913@gcp-sa-workflows.iam.gserviceaccount.com
    - api_call:
        expect_request:
          uri: https://cloudresourcemanager.googleapis.com/v2/folders/432815178414:getIamPolicy?alt=json
          method: POST
          headers: {}
          body:
            json:
              options:
                requestedPolicyVersion: 3
        return_response:
          status: 403
          headers:
            cache-control: private
            content-length: '487'
            content-type: application/json; charset=UTF-8
          body:
            error:
              code: 403
              message: The caller does not have permission
              status: PERMISSION_DENIED
              details:
              - '@type': type.googleapis.com/google.rpc.DebugInfo
                detail: '[ORIGINAL ERROR] generic::permission_denied: com.google.apps.framework.request.ForbiddenException:
                  User does not have permission [resourcemanager.folders.getIamPolicy]
                  for policy [type: "resourcemanager_folders" id: "00000064c5cb82ae"]'
    - expect_exit:
        code: 1
        message: User is not permitted to access IAM policy for one or more of the
          ancestors
