title: firestore database create
release_tracks: [GA]
# Running against GA, BETA, ALPHA in parallel on the same project doesn't work because of the weird
# Firestore DB provisining model.  So we only run against GA -- which is fine -- it is the important
# surface and identical to the rest.
summary:
# This summary is generated by http://go/gcloud-scenario-tests on update and should not be edited.
- execute:
  - command: |
      datastore databases create --region us-east1 --project=firestore-gcloud-create-test
  - stderr: |
      Success! The Google Cloud Firestore in Datastore Mode database was already created for firestore-gcloud-create-test
- execute:
  - command: |
      firestore databases create --region us-east1 --project=firestore-gcloud-create-test
  - progress_tracker:
    - message: Waiting for operation [$$operation$$] to complete
    - status: SUCCESS
  - stderr: |
      Success! The Google Cloud Firestore Native database has been created for firestore-gcloud-create-test
- execute:
  - command: |
      firestore databases create --region us-east1 --project=firestore-gcloud-create-test
  - stderr: |
      Success! The Google Cloud Firestore Native database was already created for firestore-gcloud-create-test
- execute:
  - command: |
      datastore databases create --region us-east1 --project=firestore-gcloud-create-test
  - progress_tracker:
    - message: Waiting for operation [$$operation$$] to complete
    - status: SUCCESS
  - stderr: |
      Success! The Google Cloud Firestore in Datastore Mode database has been created for firestore-gcloud-create-test
actions:
- execute_command:
    command: |
      datastore databases create --region us-east1 --project=firestore-gcloud-create-test
    events:
    - api_call:
        expect_request:
          uri: https://appengine.googleapis.com/v1/apps/firestore-gcloud-create-test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '552'
            content-type: application/json; charset=UTF-8
          body:
            name: apps/firestore-gcloud-create-test
            id: firestore-gcloud-create-test
            authDomain: gmail.com
            locationId: us-east1
            codeBucket: staging.firestore-gcloud-create-test.appspot.com
            servingStatus: SERVING
            defaultHostname: firestore-gcloud-create-test.ue.r.appspot.com
            defaultBucket: firestore-gcloud-create-test.appspot.com
            gcrDomain: us.gcr.io
            databaseType: CLOUD_DATASTORE_COMPATIBILITY
            featureSettings:
              splitHealthChecks: true
              useContainerOptimizedOs: true
    - expect_stderr: |
        Success! The Google Cloud Firestore in Datastore Mode database was already created for firestore-gcloud-create-test
    - expect_exit:
        code: 0
- execute_command:
    command: |
      firestore databases create --region us-east1 --project=firestore-gcloud-create-test
    events:
    - api_call:
        expect_request:
          uri: https://appengine.googleapis.com/v1/apps/firestore-gcloud-create-test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '552'
            content-type: application/json; charset=UTF-8
          body:
            name: apps/firestore-gcloud-create-test
            id: firestore-gcloud-create-test
            authDomain: gmail.com
            locationId: us-east1
            codeBucket: staging.firestore-gcloud-create-test.appspot.com
            servingStatus: SERVING
            defaultHostname: firestore-gcloud-create-test.ue.r.appspot.com
            defaultBucket: firestore-gcloud-create-test.appspot.com
            gcrDomain: us.gcr.io
            databaseType: CLOUD_DATASTORE_COMPATIBILITY
            featureSettings:
              splitHealthChecks: true
              useContainerOptimizedOs: true
    - api_call:
        expect_request:
          uri: https://appengine.googleapis.com/v1/apps/firestore-gcloud-create-test?alt=json&updateMask=databaseType
          method: PATCH
          headers: {}
          body:
            json:
              databaseType: CLOUD_FIRESTORE
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '450'
            content-type: application/json; charset=UTF-8
          body:
            name: apps/firestore-gcloud-create-test/operations/3e9a851a-cd29-4211-985c-3ea238c2716b
            metadata:
              '@type': type.googleapis.com/google.appengine.v1.OperationMetadataV1
              method: google.appengine.v1.Applications.UpdateApplication
              insertTime: '2020-08-25T23:35:32.566Z'
              user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              target: apps/firestore-gcloud-create-test
        poll_operation: true
    - expect_progress_tracker:
        message: Waiting for operation [$$operation$$] to complete
        status: SUCCESS
    - expect_stderr: |
        Success! The Google Cloud Firestore Native database has been created for firestore-gcloud-create-test
    - expect_exit:
        code: 0
- execute_command:
    command: |
      firestore databases create --region us-east1 --project=firestore-gcloud-create-test
    events:
    - api_call:
        expect_request:
          uri: https://appengine.googleapis.com/v1/apps/firestore-gcloud-create-test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '538'
            content-type: application/json; charset=UTF-8
          body:
            name: apps/firestore-gcloud-create-test
            id: firestore-gcloud-create-test
            authDomain: gmail.com
            locationId: us-east1
            codeBucket: staging.firestore-gcloud-create-test.appspot.com
            servingStatus: SERVING
            defaultHostname: firestore-gcloud-create-test.ue.r.appspot.com
            defaultBucket: firestore-gcloud-create-test.appspot.com
            gcrDomain: us.gcr.io
            databaseType: CLOUD_FIRESTORE
            featureSettings:
              splitHealthChecks: true
              useContainerOptimizedOs: true
    - expect_stderr: |
        Success! The Google Cloud Firestore Native database was already created for firestore-gcloud-create-test
    - expect_exit:
        code: 0
- execute_command:
    command: |
      datastore databases create --region us-east1 --project=firestore-gcloud-create-test
    events:
    - api_call:
        expect_request:
          uri: https://appengine.googleapis.com/v1/apps/firestore-gcloud-create-test?alt=json
          method: GET
          headers: {}
          body: null
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '538'
            content-type: application/json; charset=UTF-8
          body:
            name: apps/firestore-gcloud-create-test
            id: firestore-gcloud-create-test
            authDomain: gmail.com
            locationId: us-east1
            codeBucket: staging.firestore-gcloud-create-test.appspot.com
            servingStatus: SERVING
            defaultHostname: firestore-gcloud-create-test.ue.r.appspot.com
            defaultBucket: firestore-gcloud-create-test.appspot.com
            gcrDomain: us.gcr.io
            databaseType: CLOUD_FIRESTORE
            featureSettings:
              splitHealthChecks: true
              useContainerOptimizedOs: true
    - api_call:
        expect_request:
          uri: https://appengine.googleapis.com/v1/apps/firestore-gcloud-create-test?alt=json&updateMask=databaseType
          method: PATCH
          headers: {}
          body:
            json:
              databaseType: CLOUD_DATASTORE_COMPATIBILITY
        return_response:
          status: 200
          headers:
            cache-control: private
            content-length: '450'
            content-type: application/json; charset=UTF-8
          body:
            name: apps/firestore-gcloud-create-test/operations/6b329e9b-e8e0-4f7d-8dca-748675b90acb
            metadata:
              '@type': type.googleapis.com/google.appengine.v1.OperationMetadataV1
              method: google.appengine.v1.Applications.UpdateApplication
              insertTime: '2020-08-25T23:35:35.300Z'
              user: 462803083913-lak0k1ette3muh3o3kb3pp2im3urj3e9@developer.gserviceaccount.com
              target: apps/firestore-gcloud-create-test
        poll_operation: true
    - expect_progress_tracker:
        message: Waiting for operation [$$operation$$] to complete
        status: SUCCESS
    - expect_stderr: |
        Success! The Google Cloud Firestore in Datastore Mode database has been created for firestore-gcloud-create-test
    - expect_exit:
        code: 0
