---
args:
  command: alpha compute instances resume z4
  specified_args:
    --csek-key-file: key-file.json
    --zone: us-central1-a
---
state:
  interactive_console: true
  random_seed: -9179335631475115637
---
properties:
  app:
    runtime_root: /tmp/tmpuE0MvO/runtimes
  component_manager:
    disable_update_check: 'True'
  compute:
    zone: us-central1-a
  core:
    disable_color: 'True'
    disable_usage_reporting: 'True'
    project: fake-project
---
input:
  files:
  - content: |
      [
        {
        "uri": "https://www.googleapis.com/compute/v1/projects/fake-project/zones/us-central1-a/disks/z4",
        "key": "acXTX3rxrKAFTF0tYVLvydU1riRZTvUNC4g5I11NY1c=",
        "key-type": "raw"
        }
      ]
    name: key-file.json
---
request:
  body: |-
    --===============6147312573536242251==
    Content-Type: application/http
    MIME-Version: 1.0
    Content-Transfer-Encoding: binary
    Content-ID: <bfbac4c8-ac23-4b36-a6cd-4c72a8cf3774+0>

    GET /compute/alpha/projects/fake-project/zones/us-central1-a/instances/z4?alt=json HTTP/1.1
    Content-Type: application/json
    MIME-Version: 1.0
    accept-encoding: gzip, deflate
    content-length: 0
    accept: application/json
    user-agent: x_Tw5K8nnjoRAqULM9PFAC2b
    Host: www.googleapis.com


    --===============6147312573536242251==--
  headers:
    content-type: multipart/mixed; boundary="===============6147312573536242251=="
  method: POST
  uri: https://www.googleapis.com/batch/compute/alpha
---
response:
  content:
  - "--batch_jXre6oZsFOc_AASVxskqtEI\r\nContent-Type: application/http\r\nContent-ID:\
    \ <response-bfbac4c8-ac23-4b36-a6cd-4c72a8cf3774+0>\r\n\r\nHTTP/1.1 200 OK\r\n\
    ETag: \"6JUPwTRdRD25iM8m6GCxk5htBvw/KZ4gFEw4Xbejt57dqu3UyUDatQE\"\r\nContent-Type:\
    \ application/json; charset=UTF-8\r\nDate: Mon, 27 Nov 2017 22:39:30 GMT\r\nExpires:\
    \ Mon, 27 Nov 2017 22:39:30 GMT\r\nCache-Control: private, max-age=0\r\nContent-Length:\
    \ 2548\r\n\r\n"
  - json:
      canIpForward: false
      cpuPlatform: Intel Haswell
      creationTimestamp: '2017-11-27T13:46:03.678-08:00'
      deletionProtection: false
      disks:
      - autoDelete: true
        boot: true
        deviceName: z4
        diskEncryptionKey:
          sha256: rLJ+wNhHlYhTl0CQ/6sDxGlryRhMi88e2VpzyP4BCs8=
        diskSizeGb: '10'
        index: 0
        interface: SCSI
        kind: compute#attachedDisk
        licenses:
        - https://www.googleapis.com/compute/alpha/projects/bct-staging-functional/global/licenses/debian-9-stretch
        mode: READ_WRITE
        source: https://www.googleapis.com/compute/alpha/projects/fake-project/zones/us-central1-a/disks/z4
        type: PERSISTENT
      id: '6026542934805002612'
      kind: compute#instance
      labelFingerprint: 42WmSpB8rSM=
      machineType: https://www.googleapis.com/compute/alpha/projects/fake-project/zones/us-central1-a/machineTypes/n1-standard-1
      metadata:
        fingerprint: Tewg-kYB2-A=
        kind: compute#metadata
      name: z4
      networkInterfaces:
      - accessConfigs:
        - kind: compute#accessConfig
          name: external-nat
          natIP: 70.32.153.175
          networkTier: PREMIUM
          type: ONE_TO_ONE_NAT
        fingerprint: mOeOYLUc0OA=
        kind: compute#networkInterface
        name: nic0
        network: https://www.googleapis.com/compute/alpha/projects/fake-project/global/networks/default
        networkIP: 10.240.0.2
      scheduling:
        automaticRestart: true
        onHostMaintenance: MIGRATE
        preemptible: false
      selfLink: https://www.googleapis.com/compute/alpha/projects/fake-project/zones/us-central1-a/instances/z4
      serviceAccounts:
      - email: 341306109951-compute@developer.gserviceaccount.com
        scopes:
        - https://www.googleapis.com/auth/devstorage.read_only
        - https://www.googleapis.com/auth/logging.write
        - https://www.googleapis.com/auth/monitoring.write
        - https://www.googleapis.com/auth/pubsub
        - https://www.googleapis.com/auth/service.management.readonly
        - https://www.googleapis.com/auth/servicecontrol
        - https://www.googleapis.com/auth/trace.append
      startRestricted: false
      status: RUNNING
      tags:
        fingerprint: 42WmSpB8rSM=
      zone: https://www.googleapis.com/compute/alpha/projects/fake-project/zones/us-central1-a
  - "\n\r\n--batch_jXre6oZsFOc_AASVxskqtEI--\r\n"
  response:
    -content-encoding: gzip
    alt-svc: hq=":443"; ma=2592000; quic=51303431; quic=51303339; quic=51303338; quic=51303337;
      quic=51303335,quic=":443"; ma=2592000; v="41,39,38,37,35"
    cache-control: no-cache, no-store, max-age=0, must-revalidate
    content-type: multipart/mixed; boundary=batch_jXre6oZsFOc_AASVxskqtEI
    date: Mon, 27 Nov 2017 22:39:30 GMT
    expires: Mon, 01 Jan 1990 00:00:00 GMT
    pragma: no-cache
    server: GSE
    status: '200'
    transfer-encoding: chunked
    vary: Origin, X-Origin
    x-content-type-options: nosniff
    x-frame-options: SAMEORIGIN
    x-xss-protection: 1; mode=block
---
request:
  body: |-
    --===============5376898803545099177==
    Content-Type: application/http
    MIME-Version: 1.0
    Content-Transfer-Encoding: binary
    Content-ID: <584dd07a-430f-4116-9d87-3c341681ce24+0>

    POST /compute/alpha/projects/fake-project/zones/us-central1-a/instances/z4/resume?alt=json HTTP/1.1
    Content-Type: application/json
    MIME-Version: 1.0
    accept-encoding: gzip, deflate
    content-length: 199
    accept: application/json
    user-agent: x_Tw5K8nnjoRAqULM9PFAC2b
    Host: www.googleapis.com

    {"disks": [{"diskEncryptionKey": {"rawKey": "acXTX3rxrKAFTF0tYVLvydU1riRZTvUNC4g5I11NY1c="}, "source": "https://www.googleapis.com/compute/alpha/projects/fake-project/zones/us-central1-a/disks/z4"}]}
    --===============5376898803545099177==--
  headers:
    content-type: multipart/mixed; boundary="===============5376898803545099177=="
  method: POST
  uri: https://www.googleapis.com/batch/compute/alpha
---
response:
  content:
  - "--batch_Oflb5D98xn4_AAVATQUDn94\r\nContent-Type: application/http\r\nContent-ID:\
    \ <response-584dd07a-430f-4116-9d87-3c341681ce24+0>\r\n\r\nHTTP/1.1 400 Bad Request\r\
    \nContent-Type: application/json; charset=UTF-8\r\nDate: Mon, 27 Nov 2017 22:39:30\
    \ GMT\r\nExpires: Mon, 27 Nov 2017 22:39:30 GMT\r\nCache-Control: private, max-age=0\r\
    \nContent-Length: 3800\r\n\r\n"
  - json:
      error:
        code: 400
        errors:
        - debugInfo: "com.google.api.server.core.Fault: ImmutableErrorDefinition{base=INVALID_PARAMETER,\
            \ category=USER_ERROR, cause=null, debugInfo=null, domain=global, extendedHelp=null,\
            \ httpHeaders={}, httpStatus=badRequest, internalReason=Reason{arguments={},\
            \ cause=null, code=bigcluster.BigClusterErrorDomain.CUSTOMER_ENCRYPTION_KEY_IS_INCORRECT,\
            \ createdByBackend=true, debugMessage=null, errorProtoCode=CUSTOMER_ENCRYPTION_KEY_IS_INCORRECT,\
            \ errorProtoDomain=bigcluster.BigClusterErrorDomain, filteredMessage=null,\
            \ location=null, message=The encryption key provided for projects/fake-project/zones/us-central1-a/disks/z4\
            \ does not match the key that it was encrypted with., unnamedArguments=[projects/fake-project/zones/us-central1-a/disks/z4]},\
            \ location=null, message=The encryption key provided for 'projects/fake-project/zones/us-central1-a/disks/z4'\
            \ does not match the key that it was encrypted with., reason=customerEncryptionKeyIsIncorrect,\
            \ rpcCode=400} The encryption key provided for 'projects/fake-project/zones/us-central1-a/disks/z4'\
            \ does not match the key that it was encrypted with.\n\tat com.google.api.server.core.ErrorCollector.toFault(ErrorCollector.java:54)\n\
            \tat com.google.api.server.rest.adapter.rosy.RosyErrorConverter.toFault(RosyErrorConverter.java:67)\n\
            \tat com.google.api.server.rest.adapter.rosy.RosyHandler$2.call(RosyHandler.java:258)\n\
            \tat com.google.api.server.rest.adapter.rosy.RosyHandler$2.call(RosyHandler.java:238)\n\
            \tat com.google.api.server.core.util.CallableFuture.run(CallableFuture.java:62)\n\
            \tat com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:401)\n\
            \tat com.google.common.util.concurrent.AbstractFuture.executeListener(AbstractFuture.java:1019)\n\
            \tat com.google.common.util.concurrent.AbstractFuture.complete(AbstractFuture.java:870)\n\
            \tat com.google.common.util.concurrent.AbstractFuture.set(AbstractFuture.java:694)\n\
            \tat com.google.api.server.core.util.CallableFuture.run(CallableFuture.java:62)\n\
            \tat com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:401)\n\
            \tat com.google.common.util.concurrent.AbstractFuture.executeListener(AbstractFuture.java:1019)\n\
            \tat com.google.common.util.concurrent.AbstractFuture.complete(AbstractFuture.java:870)\n\
            \tat com.google.common.util.concurrent.AbstractFuture.set(AbstractFuture.java:694)\n\
            \tat com.google.api.server.core.util.CallableFuture.run(CallableFuture.java:62)\n\
            \tat com.google.api.server.thread.ThreadTrackers$ThreadTrackingRunnable.run(ThreadTrackers.java:126)\n\
            \tat com.google.tracing.TraceContext$TraceContextRunnable.runInContext(TraceContext.java:454)\n\
            \tat com.google.api.server.server.CommonModule$ContextCarryingExecutorService$1.runInContext(CommonModule.java:846)\n\
            \tat com.google.tracing.TraceContext$TraceContextRunnable$1.run(TraceContext.java:461)\n\
            \tat com.google.tracing.CurrentContext.runInContext(CurrentContext.java:351)\n\
            \tat com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContextNoUnref(TraceContext.java:320)\n\
            \tat com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContext(TraceContext.java:312)\n\
            \tat com.google.tracing.TraceContext$TraceContextRunnable.run(TraceContext.java:458)\n\
            \tat com.google.gse.internal.DispatchQueueImpl$WorkerThread.run(DispatchQueueImpl.java:403)\n"
          domain: global
          message: The encryption key provided for 'projects/fake-project/zones/us-central1-a/disks/z4'
            does not match the key that it was encrypted with.
          reason: customerEncryptionKeyIsIncorrect
        message: The encryption key provided for 'projects/fake-project/zones/us-central1-a/disks/z4'
          does not match the key that it was encrypted with.
  - "\n\r\n--batch_Oflb5D98xn4_AAVATQUDn94--\r\n"
  response:
    -content-encoding: gzip
    alt-svc: hq=":443"; ma=2592000; quic=51303431; quic=51303339; quic=51303338; quic=51303337;
      quic=51303335,quic=":443"; ma=2592000; v="41,39,38,37,35"
    cache-control: private, max-age=0
    content-type: multipart/mixed; boundary=batch_Oflb5D98xn4_AAVATQUDn94
    date: Mon, 27 Nov 2017 22:39:30 GMT
    expires: Mon, 27 Nov 2017 22:39:30 GMT
    server: GSE
    status: '200'
    transfer-encoding: chunked
    vary: Origin, X-Origin
    x-content-type-options: nosniff
    x-frame-options: SAMEORIGIN
    x-xss-protection: 1; mode=block
---
exception:
  message: 'HTTPError 400: The encryption key provided for ''projects/fake-project/zones/us-central1-a/disks/z4''
    does not match the key that it was encrypted with.'
  type: <class 'googlecloudsdk.core.exceptions.MultiError'>
---
output:
  stderr: "ERROR: (gcloud.alpha.compute.instances.resume) HTTPError 400:\
    \ The encryption key provided for 'projects/fake-project/zones/us-central1-a/disks/z4'\
    \ does not match the key that it was encrypted with.\n"
